<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ramadan Planner 1447H ‚ú®</title>
<meta name="theme-color" content="#020A14">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Ramadan Planner">
<meta name="description" content="Ramadan Planner 1447H ‚Äî Tracker ibadah, jadwal sahur & buka, dzikir, zakat oleh Andi Maulana Yusuf">
<link rel="manifest" id="pwaManifest">
<link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='20' fill='%23020A14'/><text y='.9em' font-size='80'>üåô</text></svg>">
<link href="https://fonts.googleapis.com/css2?family=Amiri:ital,wght@0,400;0,700;1,400&family=Nunito:wght@300;400;600;700;800;900&display=swap" rel="stylesheet">
<style>
:root {
  --gold: #C8973A; --gold-light: #E8BE6A; --gold-pale: #FDF3DC;
  --teal: #1A6B6B; --teal-dark: #0F4444; --teal-light: #2E9E9E;
  --cream: #FAF6EE; --cream-dark: #F0E8D4;
  --text: #2A1F0E; --text-muted: #7A6A50;
  --glass: rgba(250,246,238,0.88);
  --glass-border: rgba(200,151,58,0.25);
  --shadow: 0 8px 32px rgba(0,0,0,0.18), 0 1px 0 rgba(255,255,255,0.5) inset;
}
body.dark-mode {
  --cream: #1A1208; --cream-dark: #2A1E0E;
  --text: #F0E8D4; --text-muted: #A09070;
  --glass: rgba(30,20,10,0.90);
  --glass-border: rgba(200,151,58,0.30);
  --shadow: 0 8px 32px rgba(0,0,0,0.45), 0 1px 0 rgba(255,255,255,0.05) inset;
}
body.dark-mode .mood-label{color:#F0E8D4}
body.dark-mode input, body.dark-mode textarea, body.dark-mode select {
  background: var(--cream) !important; color: var(--text) !important;
  border-color: var(--cream-dark) !important;
}
body.dark-mode .modal-box { background: #1E1408; }
body.dark-mode .mood-btn, body.dark-mode .amal-btn, body.dark-mode .menu-tab { background: #2A1E0E; }
body.dark-mode .doa-card { background: rgba(26,107,107,0.15); }
body.dark-mode .save-bar { background: rgba(20,12,4,0.97) !important; }
body.dark-mode .quote-card { background: linear-gradient(135deg,rgba(200,151,58,.18),rgba(200,151,58,.06)); }
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family:'Nunito',sans-serif; background:#030D1A; color:var(--text); min-height:100vh; overflow-x:hidden; position:relative; }

/* BG */
#bg-canvas { position:fixed; inset:0; width:100%; height:100%; z-index:0; pointer-events:none; }
body::before { content:''; position:fixed; inset:0; z-index:1; pointer-events:none;
  background: radial-gradient(ellipse 80% 50% at 50% 0%,rgba(26,80,100,.55) 0%,transparent 70%),
              radial-gradient(ellipse 60% 60% at 80% 20%,rgba(200,151,58,.08) 0%,transparent 60%); }
.lanterns { position:fixed; top:0; left:0; right:0; z-index:3; pointer-events:none; height:130px; }
.lantern { position:absolute; top:-10px; display:flex; flex-direction:column; align-items:center; animation:swingLantern 4s ease-in-out infinite; transform-origin:top center; }
.lantern:nth-child(2){animation-duration:5s;animation-delay:-1s} .lantern:nth-child(3){animation-duration:3.5s;animation-delay:-2s} .lantern:nth-child(4){animation-duration:4.5s;animation-delay:-.5s} .lantern:nth-child(5){animation-duration:6s;animation-delay:-3s}
@keyframes swingLantern{0%,100%{transform:rotate(-6deg)}50%{transform:rotate(6deg)}}
.lantern-string{width:1px;height:30px;background:linear-gradient(180deg,rgba(200,151,58,.6),rgba(200,151,58,.2))}
.lantern-body{width:28px;height:44px;border-radius:50% 50% 40% 40%;position:relative;display:flex;align-items:center;justify-content:center;filter:drop-shadow(0 0 12px currentColor)}
.lantern-glow{position:absolute;inset:-8px;border-radius:50%;opacity:.3;animation:glowPulse 2s ease-in-out infinite}
@keyframes glowPulse{0%,100%{opacity:.25;transform:scale(1)}50%{opacity:.5;transform:scale(1.1)}}
.lantern-inner{font-size:20px;position:relative;z-index:1}
.lantern-bottom{width:10px;height:16px;border-radius:0 0 50% 50%;margin-top:-2px}
.lantern-tassel{width:1px;height:14px;background:rgba(200,151,58,.5);margin-top:-1px}
.particles{position:fixed;inset:0;z-index:2;pointer-events:none;overflow:hidden}
.particle{position:absolute;border-radius:50%;animation:floatUp linear infinite;opacity:0}
@keyframes floatUp{0%{transform:translateY(100vh) rotate(0);opacity:0}10%{opacity:1}90%{opacity:.6}100%{transform:translateY(-20vh) rotate(360deg);opacity:0}}
.mosque-silhouette{position:fixed;bottom:0;left:0;right:0;z-index:2;pointer-events:none;height:120px;overflow:hidden}
header,.save-bar,.day-wave,main,.toast-wrap,.modal-overlay{position:relative;z-index:10}

/* HEADER */
header { background:linear-gradient(180deg,rgba(5,20,35,.78) 0%,rgba(10,40,55,.5) 100%); backdrop-filter:blur(4px); color:white; padding:80px 20px 50px; text-align:center; overflow:hidden; border-bottom:1px solid rgba(200,151,58,.2); }
header::before{content:'';position:absolute;inset:0;background:url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23C8973A' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/svg%3E")}
.header-ornament{font-family:'Amiri',serif;font-size:14px;letter-spacing:3px;color:var(--gold-light);text-transform:uppercase;margin-bottom:12px}
header h1{font-family:'Amiri',serif;font-size:clamp(2.2rem,6vw,3.5rem);font-weight:700;margin-bottom:6px;text-shadow:0 2px 20px rgba(200,151,58,.4),0 4px 40px rgba(0,0,0,.5);background:linear-gradient(180deg,#fff 60%,rgba(232,190,106,.8));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.arabic-title{font-family:'Amiri',serif;font-size:clamp(1.4rem,4vw,2rem);color:var(--gold-light);margin-bottom:16px;direction:rtl}
.header-date{display:inline-block;background:rgba(200,151,58,.25);border:1px solid rgba(200,151,58,.5);color:var(--gold-light);padding:6px 20px;border-radius:20px;font-size:13px;font-weight:600;letter-spacing:1px}
.moon-deco{position:absolute;right:30px;top:20px;font-size:80px;opacity:.22;animation:floatAnim 4s ease-in-out infinite;filter:drop-shadow(0 0 20px rgba(255,220,100,.4))}
.star-deco{position:absolute;left:40px;top:30px;font-size:34px;opacity:.22;animation:floatAnim 5s ease-in-out infinite reverse;filter:drop-shadow(0 0 10px rgba(200,151,58,.5))}
@keyframes floatAnim{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}

/* SAVE BAR */
.save-bar { background:rgba(3,12,22,.92); backdrop-filter:blur(12px); border-bottom:1px solid rgba(200,151,58,.2); padding:10px 16px; display:flex; align-items:center; gap:10px; flex-wrap:wrap; justify-content:space-between; }
.save-bar-left { display:flex; align-items:center; gap:8px; flex-wrap:wrap; flex:1; }
.save-btn { display:flex;align-items:center;gap:5px; padding:8px 15px; border-radius:12px; border:none; font-family:'Nunito',sans-serif; font-size:12px; font-weight:800; cursor:pointer; transition:all .22s cubic-bezier(.22,1,.36,1); letter-spacing:.3px; white-space:nowrap; }
.btn-export { background:linear-gradient(135deg,var(--gold),var(--gold-light)); color:#2A1F0E; }
.btn-export:hover { transform:translateY(-1px); box-shadow:0 4px 14px rgba(200,151,58,.4); }
.btn-import { background:rgba(255,255,255,.1); color:white; border:1px solid rgba(255,255,255,.2); }
.btn-import:hover { background:rgba(255,255,255,.18); }
.btn-reset { background:rgba(200,60,60,.12); color:#FF9090; border:1px solid rgba(200,60,60,.3); }
.btn-reset:hover { background:rgba(200,60,60,.22); }
.save-status { font-size:11px; color:rgba(255,255,255,.5); font-weight:700; display:flex; align-items:center; gap:6px; white-space:nowrap; }
.save-dot { width:7px; height:7px; border-radius:50%; background:#4ADE80; animation:blink 2s infinite; flex-shrink:0; }
@keyframes blink{0%,100%{opacity:1}50%{opacity:.35}}

/* DAY WAVE */
.day-wave{background:rgba(4,16,28,.75);backdrop-filter:blur(10px);padding:12px 20px 20px;border-bottom:1px solid rgba(200,151,58,.12)}
.day-selector{display:flex;gap:7px;overflow-x:auto;padding-bottom:6px;scrollbar-width:none;max-width:900px;margin:0 auto}
.day-selector::-webkit-scrollbar{display:none}
.day-btn{flex-shrink:0;width:48px;height:62px;border-radius:14px;border:1.5px solid rgba(255,255,255,.13);background:rgba(255,255,255,.07);color:rgba(255,255,255,.6);cursor:pointer;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:2px;transition:all .22s cubic-bezier(.22,1,.36,1);font-family:'Nunito',sans-serif;position:relative}
.day-btn .hari{font-size:9px;text-transform:uppercase;letter-spacing:.5px}
.day-btn .num{font-size:16px;font-weight:900}
.day-btn:hover{background:rgba(255,255,255,.14);color:white;transform:translateY(-2px)}
.day-btn.active{background:linear-gradient(135deg,var(--gold),var(--gold-light));border-color:transparent;color:#1A0E00;font-weight:900;box-shadow:0 6px 20px rgba(200,151,58,.5),0 1px 0 rgba(255,255,255,.3) inset;transform:translateY(-4px) scale(1.04)}
.day-btn .dot{position:absolute;bottom:5px;width:5px;height:5px;border-radius:50%}
.day-btn .streak-star{position:absolute;top:3px;right:3px;font-size:8px}

/* MAIN */
main{max-width:820px;margin:0 auto;padding:20px 14px 180px}

/* CARDS */
.section-card{background:var(--glass);backdrop-filter:blur(18px);-webkit-backdrop-filter:blur(18px);border-radius:22px;padding:24px;margin-bottom:20px;box-shadow:0 8px 32px rgba(0,0,0,.22),0 1px 0 rgba(255,255,255,.06) inset;border:1px solid var(--glass-border);animation:fadeUp .45s cubic-bezier(.22,1,.36,1) both;transition:box-shadow .3s,transform .3s}
@keyframes fadeUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
.section-header{display:flex;align-items:center;gap:12px;margin-bottom:18px;padding-bottom:14px;border-bottom:1.5px solid var(--cream-dark);background:linear-gradient(90deg,rgba(200,151,58,.04),transparent 70%);margin:-24px -24px 18px;padding:16px 24px 14px;border-radius:22px 22px 0 0}
.section-icon{width:48px;height:48px;border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0;box-shadow:0 4px 12px rgba(0,0,0,.12);transition:transform .2s}.section-card:hover .section-icon{transform:scale(1.08) rotate(-3deg)}
.icon-gold{background:var(--gold-pale)} .icon-teal{background:#E6F4F4} .icon-rose{background:#FDEEF0} .icon-sky{background:#EEF4FD} .icon-green{background:#EEF8F0} .icon-purple{background:#F4EEF8}
.section-title{font-size:16px;font-weight:800;color:var(--text)}
.section-sub{font-size:12px;color:var(--text-muted);margin-top:1px}

/* QUOTE */
.quote-card{background:linear-gradient(135deg,rgba(200,151,58,.16),rgba(200,151,58,.04),rgba(26,107,107,.08));border:1px solid rgba(200,151,58,.35);border-radius:20px;padding:22px;margin-bottom:20px;backdrop-filter:blur(14px);text-align:center;box-shadow:0 6px 24px rgba(0,0,0,.15),0 1px 0 rgba(255,255,255,.05) inset}
.quote-icon{font-size:24px;margin-bottom:10px}
.quote-text{font-family:'Amiri',serif;font-size:clamp(.95rem,2.5vw,1.2rem);color:white;line-height:1.7;margin-bottom:8px;font-style:italic}
.quote-source{font-size:11px;color:var(--gold-light);font-weight:800;letter-spacing:.5px}

/* SUMMARY */
.summary-strip{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;background:linear-gradient(135deg,rgba(4,20,35,.92),rgba(12,55,55,.75));border-radius:18px;padding:18px;margin-bottom:18px;box-shadow:0 10px 40px rgba(0,0,0,.25);border:1px solid rgba(200,151,58,.2);backdrop-filter:blur(12px)}
.sum-item{text-align:center}
.sum-num{font-family:'Amiri',serif;font-size:1.8rem;color:var(--gold-light);font-weight:700;line-height:1}
.sum-label{font-size:10px;color:rgba(255,255,255,.58);font-weight:700;margin-top:3px;letter-spacing:.5px;text-transform:uppercase}

/* OVERALL PROGRESS */
.overall-progress{background:linear-gradient(135deg,rgba(4,22,42,.94),rgba(6,32,38,.85));border-radius:20px;padding:20px;margin-bottom:20px;border:1.5px solid rgba(200,151,58,.25);backdrop-filter:blur(16px);box-shadow:0 8px 32px rgba(0,0,0,.2)}
.prog-title{color:var(--gold-light);font-size:12px;font-weight:800;margin-bottom:14px;text-align:center;letter-spacing:.8px;text-transform:uppercase}
.prog-grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
.prog-label{font-size:11px;font-weight:700;color:rgba(255,255,255,.55);margin-bottom:5px;display:flex;justify-content:space-between}
.prog-label span{color:var(--gold-light)}
.prog-track{height:8px;background:rgba(255,255,255,.1);border-radius:99px;overflow:hidden}
.prog-fill{height:100%;border-radius:99px;transition:width .6s ease}
.fill-gold{background:linear-gradient(90deg,var(--gold),var(--gold-light))} .fill-teal{background:linear-gradient(90deg,var(--teal),var(--teal-light))} .fill-rose{background:linear-gradient(90deg,#C05070,#E07090)} .fill-green{background:linear-gradient(90deg,#20A060,#40D090)}

/* STREAK GRID */
.streak-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(30px,1fr));gap:6px;margin-top:6px}
.streak-day{width:30px;height:30px;border-radius:9px;display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:900;border:1.5px solid var(--cream-dark);background:var(--cream);color:var(--text-muted);cursor:pointer;transition:all .18s cubic-bezier(.34,1.56,.64,1)}
.streak-day:hover{transform:scale(1.22) translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,.2);z-index:2;position:relative}
.streak-day.perfect{background:linear-gradient(135deg,#28B060,#18D068);border-color:transparent;color:white;box-shadow:0 3px 10px rgba(50,160,100,.45),0 0 0 1px rgba(50,200,100,.2) inset}
.streak-day.partial{background:linear-gradient(135deg,var(--gold),var(--gold-light));border-color:transparent;color:white;box-shadow:0 2px 8px rgba(200,151,58,.3)}
.streak-day.today{outline:2.5px solid var(--gold);outline-offset:3px;box-shadow:0 0 12px rgba(200,151,58,.35)}
.streak-legend{display:flex;gap:14px;margin-top:12px;flex-wrap:wrap}
.legend-item{display:flex;align-items:center;gap:6px;font-size:11px;font-weight:700;color:var(--text-muted)}
.legend-dot{width:12px;height:12px;border-radius:4px}

/* WAKTU */
.time-grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
.time-item{background:var(--cream);border-radius:14px;padding:16px;text-align:center;border:2px solid transparent}
.time-item.sahur{border-color:rgba(200,151,58,.3);background:linear-gradient(135deg,#FDF8EE,#FDF0D0)}
.time-item.buka{border-color:rgba(26,107,107,.3);background:linear-gradient(135deg,#EFF8F8,#D6EDED)}
.time-label{font-size:11px;font-weight:800;letter-spacing:1px;text-transform:uppercase;margin-bottom:6px}
.time-item.sahur .time-label{color:var(--gold)} .time-item.buka .time-label{color:var(--teal)}
.time-main{font-family:'Amiri',serif;font-size:2rem;font-weight:700;margin-bottom:2px}
.time-item.sahur .time-main{color:var(--gold)} .time-item.buka .time-main{color:var(--teal)}
.time-note{font-size:11px;color:var(--text-muted)}
.city-selector{display:flex;align-items:center;gap:10px;margin-bottom:14px;flex-wrap:wrap}
.city-selector label{font-size:13px;font-weight:700;color:var(--text-muted)}
.city-selector select{border:1.5px solid rgba(26,107,107,.4);border-radius:10px;padding:7px 14px;font-family:'Nunito',sans-serif;font-size:13px;font-weight:700;color:var(--text);background:var(--cream);cursor:pointer;outline:none}
#jadwalContent{transition:opacity .3s ease}
.countdown-wrap{margin-top:16px;border-radius:16px;padding:0;text-align:center;overflow:hidden;position:relative}
.countdown-label{font-size:11px;font-weight:800;color:white;margin-bottom:4px;text-transform:uppercase;letter-spacing:.5px;opacity:.85}
.countdown-time{font-family:'Amiri',serif;font-size:2.2rem;color:white;font-weight:700;letter-spacing:2px;text-shadow:0 2px 8px rgba(0,0,0,.3)}
.jadwal-cards{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:16px}
.jadwal-card{border-radius:18px;padding:18px 14px;text-align:center;position:relative;overflow:hidden}
.jadwal-card-sahur{background:linear-gradient(145deg,#1A1A2E,#16213E);border:1.5px solid rgba(200,151,58,.4);box-shadow:0 8px 24px rgba(0,0,0,.3),0 0 40px rgba(200,151,58,.08) inset}
.jadwal-card-buka{background:linear-gradient(145deg,#0F3460,#1A5276);border:1.5px solid rgba(255,165,50,.35);box-shadow:0 8px 24px rgba(0,0,0,.3),0 0 40px rgba(255,165,50,.08) inset}
.jadwal-card-deco{position:absolute;font-size:64px;opacity:.06;right:-8px;bottom:-10px;line-height:1;pointer-events:none}
.jadwal-card-icon{font-size:28px;margin-bottom:8px;display:block;filter:drop-shadow(0 2px 6px rgba(0,0,0,.4))}
.jadwal-card-label{font-size:10px;font-weight:800;letter-spacing:1.5px;text-transform:uppercase;margin-bottom:6px;opacity:.75}
.jadwal-card-sahur .jadwal-card-label{color:var(--gold-light)}
.jadwal-card-buka .jadwal-card-label{color:#FFB347}
.jadwal-card-time{font-family:'Amiri',serif;font-size:2.4rem;font-weight:700;line-height:1;text-shadow:0 2px 10px rgba(0,0,0,.4)}
.jadwal-card-sahur .jadwal-card-time{color:var(--gold-light)}
.jadwal-card-buka .jadwal-card-time{color:#FFD080}
.jadwal-card-note{font-size:10.5px;font-weight:700;margin-top:6px;opacity:.65;color:white}
.jadwal-maghrib-row{display:flex;align-items:center;justify-content:center;gap:8px;background:rgba(255,255,255,.06);border-radius:10px;padding:7px 12px;margin-top:10px;border:1px solid rgba(255,255,255,.1)}
.jadwal-maghrib-label{font-size:11px;font-weight:800;color:rgba(255,255,255,.7)}
.jadwal-maghrib-time{font-family:'Amiri',serif;font-size:15px;font-weight:700;color:white}
.countdown-inner{background:linear-gradient(135deg,rgba(26,107,107,.85),rgba(15,68,68,.9));border:1.5px solid rgba(46,158,158,.4);border-radius:16px;padding:14px 18px;backdrop-filter:blur(8px);box-shadow:0 4px 20px rgba(0,0,0,.25)}

/* IBADAH */
.ibadah-list{display:flex;flex-direction:column;gap:10px}
.ibadah-item{display:flex;align-items:center;gap:14px;background:var(--cream);border-radius:18px;padding:15px 17px;cursor:pointer;transition:all .22s cubic-bezier(.22,1,.36,1);border:2px solid transparent;user-select:none;box-shadow:0 2px 10px rgba(0,0,0,.07)}
.ibadah-item:hover{border-color:var(--gold-light);transform:translateX(4px) scale(1.01);box-shadow:0 6px 20px rgba(200,151,58,.2)}
.ibadah-item:active{transform:scale(.98)}
.ibadah-item.checked{background:linear-gradient(135deg,#E0F7EA,#C8F0D8);border-color:rgba(50,160,100,.5);box-shadow:0 4px 18px rgba(50,160,100,.22)}
.ibadah-check{width:38px;height:38px;border-radius:12px;border:2.5px solid #C8B090;display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0;transition:all .28s cubic-bezier(.34,1.56,.64,1);background:white;box-shadow:0 2px 6px rgba(0,0,0,.1)}
.ibadah-item.checked .ibadah-check{background:linear-gradient(135deg,#28B060,#18D068);border-color:transparent;color:white;box-shadow:0 4px 14px rgba(50,160,100,.5);transform:scale(1.1)}
.ibadah-label-wrap{flex:1;display:flex;flex-direction:column;gap:2px}
.ibadah-label{font-size:15px;font-weight:800;color:var(--text);line-height:1.3}
.ibadah-sublabel{font-size:11px;color:var(--text-muted);font-weight:600}
.ibadah-item.checked .ibadah-label{color:#1A7040}
.ibadah-badge{font-size:11px;font-weight:800;padding:4px 11px;border-radius:20px;background:var(--gold-pale);color:var(--gold);letter-spacing:.3px;flex-shrink:0}
.ibadah-item.checked .ibadah-badge{background:#C8F0D8;color:#20A050}
.ibadah-hint{text-align:center;padding:10px;font-size:12px;color:var(--text-muted);font-style:italic;margin-top:4px;background:rgba(200,151,58,.06);border-radius:10px}
/* ‚îÄ‚îÄ Haid Mode ‚îÄ‚îÄ */
.haid-bar{display:flex;align-items:center;gap:12px;background:rgba(220,80,120,.06);border:1.5px solid rgba(220,80,120,.18);border-radius:14px;padding:12px 16px;margin-bottom:12px;transition:all .3s}
.haid-bar.on{background:rgba(220,80,120,.13);border-color:rgba(220,80,120,.45)}
.haid-info{flex:1}
.haid-title{font-size:13px;font-weight:900;color:var(--text)}
.haid-sub{font-size:11px;color:var(--text-muted);margin-top:2px;line-height:1.5}
.haid-switch{position:relative;width:46px;height:25px;flex-shrink:0}
.haid-switch input{opacity:0;width:0;height:0;position:absolute}
.haid-slider{position:absolute;inset:0;background:var(--cream-dark);border-radius:99px;cursor:pointer;transition:.3s}
.haid-slider::after{content:'';position:absolute;top:3px;left:3px;width:19px;height:19px;background:white;border-radius:50%;transition:.3s;box-shadow:0 1px 4px rgba(0,0,0,.2)}
.haid-switch input:checked+.haid-slider{background:linear-gradient(135deg,#E05080,#B02050)}
.haid-switch input:checked+.haid-slider::after{transform:translateX(21px)}
.haid-note{display:none;background:linear-gradient(135deg,rgba(220,80,120,.08),rgba(220,80,120,.03));border:1px solid rgba(220,80,120,.2);border-radius:12px;padding:12px 14px;margin-bottom:10px;font-size:12px;line-height:1.7;color:var(--text)}
.ibadah-item.haid-skip{opacity:.38;pointer-events:none}
.haid-tag{font-size:10px;font-weight:700;color:#E05080;margin-left:6px;background:rgba(220,80,120,.12);padding:1px 6px;border-radius:6px}
.haid-day-dot{width:5px;height:5px;background:#E05080;border-radius:50%;display:inline-block;margin-left:2px;vertical-align:middle}
.quran-section{margin-top:18px;padding-top:18px;border-top:1.5px solid var(--cream-dark)}
/* ‚îÄ‚îÄ Quran Progress redesign ‚îÄ‚îÄ */
.quran-progress-wrap{display:flex;flex-direction:column;gap:16px}
.quran-card{background:linear-gradient(135deg,rgba(26,107,107,.07),rgba(26,107,107,.02));border:1.5px solid rgba(26,107,107,.2);border-radius:18px;padding:16px 18px;transition:border-color .2s}
.quran-card:focus-within{border-color:var(--teal);box-shadow:0 0 0 3px rgba(26,107,107,.1)}
.quran-card-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
.quran-card-title{font-size:13px;font-weight:800;color:var(--text-muted);display:flex;align-items:center;gap:6px}
.quran-card-badge{font-size:11px;font-weight:800;padding:3px 10px;border-radius:20px;background:rgba(26,107,107,.12);color:var(--teal)}
.quran-input-row{display:flex;align-items:center;gap:12px}
.quran-num-input{border:2px solid var(--cream-dark);border-radius:12px;padding:10px 14px;font-family:'Nunito',sans-serif;font-size:22px;font-weight:900;width:90px;text-align:center;outline:none;transition:all .2s;color:var(--text);background:white;-moz-appearance:textfield}
.quran-num-input:focus{border-color:var(--teal);box-shadow:0 0 0 3px rgba(26,107,107,.1)}
.quran-num-input::-webkit-outer-spin-button,.quran-num-input::-webkit-inner-spin-button{-webkit-appearance:none}
.quran-of{font-size:13px;font-weight:700;color:var(--text-muted)}
.quran-track-wrap{flex:1;display:flex;flex-direction:column;gap:5px}
.quran-track{height:12px;background:var(--cream-dark);border-radius:99px;overflow:hidden}
.quran-fill{height:100%;border-radius:99px;transition:width .5s cubic-bezier(.4,0,.2,1);background:linear-gradient(90deg,var(--teal),#2E9E9E)}
.quran-fill-gold{background:linear-gradient(90deg,var(--gold),var(--gold-light))}
.quran-pct-label{font-size:11px;font-weight:800;color:var(--teal);text-align:right}
/* total progress ring */
.quran-total-wrap{display:flex;align-items:center;gap:16px;background:linear-gradient(135deg,rgba(200,151,58,.1),rgba(200,151,58,.03));border:1.5px solid rgba(200,151,58,.25);border-radius:18px;padding:16px 18px}
.quran-ring{position:relative;width:72px;height:72px;flex-shrink:0}
.quran-ring svg{transform:rotate(-90deg);width:72px;height:72px}
.quran-ring-bg{fill:none;stroke:var(--cream-dark);stroke-width:7}
.quran-ring-fill{fill:none;stroke:var(--gold);stroke-width:7;stroke-linecap:round;stroke-dasharray:188.5;stroke-dashoffset:188.5;transition:stroke-dashoffset .7s cubic-bezier(.4,0,.2,1)}
.quran-ring-text{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;line-height:1}
.quran-ring-pct{font-size:16px;font-weight:900;color:var(--gold)}
.quran-ring-sub{font-size:9px;font-weight:700;color:var(--text-muted)}
.quran-total-info{flex:1}
.quran-total-title{font-size:14px;font-weight:900;color:var(--text);margin-bottom:4px}
.quran-total-sub{font-size:12px;color:var(--text-muted);line-height:1.6}
.quran-total-num{font-size:20px;font-weight:900;color:var(--gold);margin-top:4px}
.quran-row{display:flex;align-items:center;gap:12px;margin-bottom:10px}
.quran-label{font-size:13px;font-weight:700;color:var(--text-muted);min-width:72px}
.quran-input{border:1.5px solid var(--cream-dark);border-radius:10px;padding:7px 12px;font-family:'Nunito',sans-serif;font-size:14px;font-weight:700;width:80px;text-align:center;outline:none;transition:border-color .2s;color:var(--text);background:var(--cream)}
.quran-input:focus{border-color:var(--teal)}
.progress-bar-wrap{flex:1;height:10px;background:var(--cream-dark);border-radius:99px;overflow:hidden}
.progress-bar-fill{height:100%;background:linear-gradient(90deg,var(--teal-light),var(--teal));border-radius:99px;transition:width .4s ease}
.progress-pct{font-size:12px;font-weight:800;color:var(--teal);min-width:36px;text-align:right}

/* MOOD */
.mood-section{margin-top:20px;padding-top:20px;border-top:1.5px solid var(--cream-dark)}
.mood-label{font-size:15px;font-weight:900;color:#2A1F0E;margin-bottom:14px;display:flex;align-items:center;gap:8px;font-family:'Nunito',sans-serif;letter-spacing:-.3px}
.mood-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:8px}
.mood-btn{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:6px;padding:14px 6px;border-radius:16px;border:2px solid var(--cream-dark);background:white;cursor:pointer;transition:all .22s;box-shadow:0 2px 6px rgba(0,0,0,.05);-webkit-tap-highlight-color:transparent;touch-action:manipulation}
.mood-btn:hover{transform:translateY(-3px);border-color:var(--gold-light);box-shadow:0 6px 16px rgba(200,151,58,.15)}
.mood-btn:active{transform:scale(.95)}
.mood-btn.selected{border-color:transparent;box-shadow:0 6px 18px rgba(0,0,0,.15);transform:translateY(-4px)}
.mood-btn[data-mood="semangat"].selected{background:linear-gradient(135deg,#FFF3DC,#FFE8B0);border-color:#E8B030}
.mood-btn[data-mood="tenang"].selected{background:linear-gradient(135deg,#DCF0FF,#B8E0F8);border-color:#3090D0}
.mood-btn[data-mood="syukur"].selected{background:linear-gradient(135deg,#FFE8F0,#FFD0E4);border-color:#E06080}
.mood-btn[data-mood="lelah"].selected{background:linear-gradient(135deg,#EEE8FF,#DDD0FF);border-color:#8060D0}
.mood-btn[data-mood="lapar"].selected{background:linear-gradient(135deg,#F0FFE8,#D8F5C0);border-color:#50A030}
.mood-emoji{font-size:28px;line-height:1;transition:transform .2s}
.mood-btn.selected .mood-emoji{transform:scale(1.2)}
.mood-text{font-size:10px;font-weight:900;color:var(--text-muted);text-align:center;line-height:1.2}
.mood-btn.selected .mood-text{font-weight:900}
.mood-btn[data-mood="semangat"].selected .mood-text{color:#A07010}
.mood-btn[data-mood="tenang"].selected .mood-text{color:#1060A0}
.mood-btn[data-mood="syukur"].selected .mood-text{color:#C03060}
.mood-btn[data-mood="lelah"].selected .mood-text{color:#6040B0}
.mood-btn[data-mood="lapar"].selected .mood-text{color:#308010}
.mood-selected-msg{margin-top:10px;padding:10px 14px;border-radius:12px;font-size:13px;font-weight:700;text-align:center;background:rgba(200,151,58,.08);color:var(--text-muted);display:none}
.mood-selected-msg.show{display:block}

/* TARGETS */
.target-list{display:flex;flex-direction:column;gap:8px}
.target-item{display:flex;align-items:center;gap:8px}
.target-input-wrap{flex:1;position:relative}
.target-input{width:100%;border:1.5px solid var(--cream-dark);border-radius:10px;padding:9px 38px 9px 12px;font-family:'Nunito',sans-serif;font-size:13px;font-weight:700;outline:none;background:var(--cream);color:var(--text);transition:all .2s}
.target-input:focus{border-color:var(--teal)}
.target-input.done-input{text-decoration:line-through;color:var(--text-muted);background:#F0F8F0;border-color:rgba(50,160,100,.3)}
.target-check-btn{position:absolute;right:8px;top:50%;transform:translateY(-50%);width:24px;height:24px;border-radius:7px;border:1.5px solid #D0C0A0;background:white;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:12px;transition:all .2s}
.target-check-btn.checked{background:#32A064;border-color:#32A064;color:white}
.target-del-btn{font-size:16px;color:#C05050;cursor:pointer;background:none;border:none;padding:4px;flex-shrink:0}
.add-target-btn{display:flex;align-items:center;gap:6px;padding:9px 16px;border-radius:10px;border:1.5px dashed var(--cream-dark);background:transparent;cursor:pointer;font-family:'Nunito',sans-serif;font-size:13px;font-weight:700;color:var(--text-muted);transition:all .2s;margin-top:4px}
.add-target-btn:hover{border-color:var(--gold);color:var(--gold)}

/* AMAL */
.amal-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.amal-card{background:var(--cream);border-radius:14px;padding:14px;display:flex;flex-direction:column;align-items:center;gap:8px;border:1.5px solid transparent;text-align:center;transition:all .2s}
.amal-card.active{background:linear-gradient(135deg,#FDF8EE,#FDF0D0);border-color:rgba(200,151,58,.4);box-shadow:0 4px 12px rgba(200,151,58,.15)}
.amal-icon{font-size:26px} .amal-name{font-size:12px;font-weight:800;color:var(--text)}
.amal-count{display:flex;align-items:center;gap:8px;margin-top:4px}
.amal-btn{width:28px;height:28px;border-radius:8px;border:1.5px solid var(--cream-dark);background:white;cursor:pointer;font-size:15px;font-weight:800;display:flex;align-items:center;justify-content:center;transition:all .15s;color:var(--text)}
.amal-btn:hover{background:var(--gold);border-color:var(--gold);color:white;transform:scale(1.1)}
.amal-num{font-size:18px;font-weight:900;color:var(--teal);min-width:28px;text-align:center}
.amal-unit{font-size:10px;color:var(--text-muted);font-weight:600}

/* SEDEKAH */
.sedekah-section{margin-top:16px;padding-top:16px;border-top:1.5px solid var(--cream-dark)}
.sedekah-row{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
.sedekah-input{flex:1;min-width:120px;border:1.5px solid var(--cream-dark);border-radius:10px;padding:9px 14px;font-family:'Nunito',sans-serif;font-size:14px;font-weight:700;outline:none;transition:border-color .2s;color:var(--text);background:var(--cream)}
.sedekah-input:focus{border-color:var(--gold)}
.sedekah-add{background:var(--gold);color:white;border:none;border-radius:10px;padding:9px 16px;font-family:'Nunito',sans-serif;font-size:13px;font-weight:800;cursor:pointer;transition:all .2s;flex-shrink:0}
.sedekah-add:hover{background:var(--gold-light);transform:translateY(-1px)}
.sedekah-total{margin-top:12px;background:linear-gradient(135deg,var(--gold-pale),#FDE8C0);border-radius:12px;padding:14px 16px;display:flex;justify-content:space-between;align-items:center}
.sedekah-total-label{font-size:12px;font-weight:700;color:var(--text-muted)}
.sedekah-total-num{font-family:'Amiri',serif;font-size:1.4rem;font-weight:700;color:var(--gold)}
.sedekah-log{margin-top:10px;display:flex;flex-direction:column;gap:6px}
.sedekah-log-item{display:flex;justify-content:space-between;background:var(--cream);border-radius:8px;padding:8px 12px;font-size:13px}
.sedekah-log-item .s-desc{font-weight:600;color:var(--text-muted)}
.sedekah-log-item .s-amt{font-weight:800;color:var(--teal)}

/* MENU */
.menu-tabs{display:flex;gap:8px;margin-bottom:14px}
.menu-tab{padding:7px 16px;border-radius:20px;font-size:13px;font-weight:700;cursor:pointer;border:1.5px solid var(--cream-dark);background:white;color:var(--text-muted);transition:all .2s}
.menu-tab.active{background:var(--teal);border-color:var(--teal);color:white}
.menu-row{display:flex;gap:8px}
.menu-input{flex:1;border:1.5px solid var(--cream-dark);border-radius:10px;padding:9px 14px;font-family:'Nunito',sans-serif;font-size:13px;outline:none;background:var(--cream);color:var(--text);transition:border-color .2s}
.menu-input:focus{border-color:var(--teal)}
.menu-add-btn{background:var(--teal);color:white;border:none;border-radius:10px;padding:9px 16px;cursor:pointer;font-size:18px;font-weight:800;transition:all .2s}
.menu-add-btn:hover{background:var(--teal-light)}
.menu-list{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
.menu-tag{display:flex;align-items:center;gap:6px;background:var(--cream);border:1.5px solid var(--cream-dark);border-radius:20px;padding:5px 12px;font-size:13px;font-weight:700;color:var(--text)}
.menu-tag .del{cursor:pointer;color:#C05050;font-size:14px}

/* NOTES */
.notes-area{width:100%;border:1.5px solid var(--cream-dark);border-radius:12px;padding:12px;font-family:'Nunito',sans-serif;font-size:13px;color:var(--text);background:var(--cream);min-height:90px;resize:vertical;outline:none;transition:border-color .2s;line-height:1.6}
.notes-area:focus{border-color:var(--teal)}

/* DOA HARIAN */
.doa-card{background:linear-gradient(135deg,rgba(26,107,107,.08),rgba(26,107,107,.02));border:1px solid rgba(26,107,107,.25);border-radius:16px;padding:20px;margin-bottom:14px}
.doa-all-list{display:flex;flex-direction:column;gap:10px}
.doa-item{border:1.5px solid rgba(26,107,107,.18);border-radius:16px;overflow:hidden;transition:border-color .2s,box-shadow .2s;background:var(--cream)}
.doa-item.open{border-color:rgba(26,107,107,.45);box-shadow:0 4px 18px rgba(26,107,107,.12)}
.doa-item-header{display:flex;align-items:center;gap:12px;padding:14px 16px;cursor:pointer;user-select:none;-webkit-tap-highlight-color:transparent;touch-action:manipulation}
.doa-item-icon{font-size:22px;flex-shrink:0}
.doa-item-title{flex:1;font-size:14px;font-weight:800;color:var(--text)}
.doa-item-arrow{font-size:20px;font-weight:900;color:var(--teal);transition:transform .3s;flex-shrink:0;line-height:1}
.doa-item.open .doa-item-arrow{transform:rotate(90deg)}
.doa-item-body{max-height:0;overflow:hidden;transition:max-height .4s cubic-bezier(.4,0,.2,1)}
.doa-item.open .doa-item-body{max-height:800px}
.doa-item-inner{padding:0 16px 16px}
.doa-item-arabic{font-family:'Amiri',serif;font-size:1.3rem;direction:rtl;text-align:right;line-height:2.2;color:var(--teal-dark);margin-bottom:10px;padding:12px 14px;background:rgba(26,107,107,.06);border-radius:12px}
.doa-item-latin{font-style:italic;font-size:12.5px;color:var(--text-muted);line-height:1.8;margin-bottom:8px;padding:0 4px}
.doa-item-arti{font-size:13px;font-weight:700;color:var(--text);line-height:1.7;padding:10px 14px;background:rgba(200,151,58,.07);border-radius:10px;border-left:3px solid var(--gold)}
.doa-arabic{font-family:'Amiri',serif;font-size:1.5rem;direction:rtl;text-align:right;color:var(--teal-dark);line-height:1.9;margin-bottom:10px}
.doa-latin{font-size:12px;color:var(--text-muted);font-style:italic;line-height:1.7;margin-bottom:8px}
.doa-arti{font-size:13px;color:var(--text);font-weight:700;line-height:1.6;padding:10px 12px;background:var(--cream);border-radius:10px;border-left:3px solid var(--teal)}
.doa-nav{display:flex;align-items:center;justify-content:space-between;margin-top:14px;gap:8px;flex-wrap:wrap}
.doa-nav-btn{background:var(--teal);color:white;border:none;border-radius:10px;padding:9px 16px;font-size:13px;font-weight:800;cursor:pointer;transition:all .2s;display:flex;align-items:center;gap:5px}
.doa-nav-btn:hover{background:var(--teal-light);transform:translateY(-1px)}
.doa-nav-btn:active{transform:scale(.97)}

.doa-indicator{font-size:11px;color:var(--text-muted);font-weight:700}

/* SYUKUR */
.syukur-list{display:flex;flex-direction:column;gap:8px;margin-bottom:10px}
.syukur-item{display:flex;align-items:center;gap:10px}
.syukur-num{width:26px;height:26px;border-radius:50%;background:linear-gradient(135deg,var(--gold),var(--gold-light));color:white;font-size:11px;font-weight:900;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.syukur-input{flex:1;border:1.5px solid var(--cream-dark);border-radius:10px;padding:9px 12px;font-family:'Nunito',sans-serif;font-size:13px;font-weight:600;outline:none;background:var(--cream);color:var(--text);transition:border-color .2s}
.syukur-input:focus{border-color:var(--gold)}
.syukur-hint{font-size:11px;color:var(--text-muted);text-align:center;padding:6px;font-style:italic}

/* STATISTIK */
.stat-tabs{display:flex;gap:6px;margin-bottom:16px;flex-wrap:wrap}
.stat-tab{padding:6px 14px;border-radius:20px;font-size:12px;font-weight:800;cursor:pointer;border:1.5px solid var(--cream-dark);background:white;color:var(--text-muted);transition:all .2s}
.stat-tab.active{background:var(--teal);border-color:var(--teal);color:white}
.chart-wrap{width:100%;overflow-x:auto}
.stat-chart-canvas{display:block;width:100%}
.stat-legend{display:flex;gap:14px;flex-wrap:wrap;margin-top:10px;justify-content:center}
.stat-legend-item{display:flex;align-items:center;gap:5px;font-size:11px;font-weight:700;color:var(--text-muted)}
.stat-legend-dot{width:10px;height:10px;border-radius:3px}
.stat-summary{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:14px}
.stat-sum-item{background:var(--cream);border-radius:12px;padding:10px 6px;text-align:center;overflow:hidden}
.stat-sum-num{font-family:'Amiri',serif;font-size:1.3rem;color:var(--teal);font-weight:700;line-height:1}
.stat-sum-label{font-size:9px;color:var(--text-muted);font-weight:700;margin-top:3px;text-transform:uppercase;letter-spacing:.1px;line-height:1.3;word-break:break-word;hyphens:auto}

/* ACHIEVEMENT */
.badge-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(100px,1fr));gap:10px}
.badge-item{display:flex;flex-direction:column;align-items:center;gap:4px;padding:14px 8px 10px;border-radius:14px;border:1.5px solid var(--cream-dark);background:var(--cream);text-align:center;transition:all .3s;position:relative;cursor:default}
.badge-item.unlocked{background:linear-gradient(135deg,#FDF8EE,#FDF0D0);border-color:rgba(200,151,58,.5);box-shadow:0 4px 14px rgba(200,151,58,.2)}
.badge-icon{font-size:28px;filter:grayscale(1) opacity(.3);transition:all .3s}
.badge-item.unlocked .badge-icon{filter:none;transform:scale(1.05)}
.badge-name{font-size:10px;font-weight:800;color:var(--text-muted);line-height:1.3}
.badge-item.unlocked .badge-name{color:var(--gold)}
.badge-new{position:absolute;top:-5px;right:-5px;background:var(--gold);color:white;font-size:9px;font-weight:900;padding:2px 6px;border-radius:10px;animation:badgePulse .8s ease infinite alternate}
@keyframes badgePulse{from{transform:scale(1)}to{transform:scale(1.2)}}
.badge-progress-wrap{margin-top:14px;padding-top:14px;border-top:1.5px solid var(--cream-dark)}
.badge-prog-item{display:flex;align-items:center;gap:10px;margin-bottom:8px}
.badge-prog-label{font-size:11px;font-weight:700;color:var(--text-muted);min-width:130px}
.badge-prog-bar{flex:1;height:7px;background:var(--cream-dark);border-radius:99px;overflow:hidden}
.badge-prog-fill{height:100%;border-radius:99px;background:linear-gradient(90deg,var(--gold),var(--gold-light));transition:width .6s ease}
.badge-prog-pct{font-size:11px;font-weight:800;color:var(--gold);min-width:30px;text-align:right}

/* TOAST */
.toast-wrap{position:fixed;top:80px;right:16px;z-index:999;display:flex;flex-direction:column;gap:8px;pointer-events:none}
.toast{background:rgba(8,24,40,.97);backdrop-filter:blur(16px);border:1px solid rgba(200,151,58,.4);color:white;padding:12px 18px;border-radius:16px;font-size:13px;font-weight:700;box-shadow:0 12px 32px rgba(0,0,0,.4),0 1px 0 rgba(255,255,255,.07) inset;pointer-events:all;animation:toastIn .35s cubic-bezier(.34,1.56,.64,1);max-width:300px;display:flex;align-items:center;gap:10px}
@keyframes toastIn{from{opacity:0;transform:translateX(20px)}to{opacity:1;transform:translateX(0)}}
.toast.out{animation:toastOut .3s ease forwards}
@keyframes toastOut{to{opacity:0;transform:translateX(20px)}}

/* MODAL */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.72);z-index:500;display:flex;align-items:center;justify-content:center;padding:20px;backdrop-filter:blur(4px)}
.modal-overlay.hidden{display:none}
.modal-box{background:var(--cream);border-radius:24px;padding:30px;max-width:440px;width:100%;box-shadow:0 24px 72px rgba(0,0,0,.45),0 1px 0 rgba(255,255,255,.5) inset;animation:fadeUp .32s cubic-bezier(.22,1,.36,1)}
.modal-title{font-size:18px;font-weight:900;color:var(--text);margin-bottom:6px}
.modal-sub{font-size:13px;color:var(--text-muted);margin-bottom:20px;line-height:1.5}
.modal-textarea{width:100%;border:1.5px solid var(--cream-dark);border-radius:12px;padding:12px;font-family:'Nunito',sans-serif;font-size:12px;height:150px;resize:none;outline:none;background:white;color:var(--text);line-height:1.5}
.modal-textarea:focus{border-color:var(--teal)}
.modal-btns{display:flex;gap:10px;margin-top:16px}
.modal-btn{flex:1;padding:11px;border-radius:10px;border:none;font-family:'Nunito',sans-serif;font-size:14px;font-weight:800;cursor:pointer;transition:all .2s}
.modal-btn-primary{background:var(--teal);color:white}
.modal-btn-primary:hover{background:var(--teal-light)}
.modal-btn-secondary{background:var(--cream-dark);color:var(--text)}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   RESPONSIVE - TABLET (max 768px)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
@media(max-width:768px){
  /* Lantern ‚Äî jangan menutupi konten, perkecil */
  .lanterns { height:100px; z-index:3; }
  .lantern-body { width:22px; height:34px; }
  .lantern-inner { font-size:16px; }
  .lantern-string { height:22px; }
  .lantern-bottom { width:8px; height:12px; }

  /* Header ‚Äî padding lebih kecil */
  header { padding:50px 16px 36px; }
  .moon-deco { font-size:48px; right:12px; top:12px; }
  .star-deco { font-size:22px; left:14px; top:16px; }
  .header-date { font-size:12px; padding:5px 14px; }

  /* Save bar ‚Äî stack rapi */
  .save-bar {
    flex-direction:column;
    align-items:stretch;
    padding:10px 14px;
    gap:8px;
  }
  .save-bar-left {
    display:grid;
    grid-template-columns:1fr 1fr 1fr;
    gap:8px;
    width:100%;
  }
  .save-btn {
    justify-content:center;
    padding:9px 8px;
    font-size:11px;
    width:100%;
  }
  .save-status {
    justify-content:center;
    padding:4px 0 2px;
  }

  /* Day selector ‚Äî lebih compact */
  .day-wave { padding:10px 14px 16px; }
  .day-btn { width:42px; height:52px; border-radius:10px; }
  .day-btn .num { font-size:15px; }

  /* Main padding */
  main { padding:14px 12px 140px; }

  /* Cards */
  .section-card { padding:18px 16px; border-radius:16px; }
  .section-icon { width:38px; height:38px; font-size:18px; border-radius:10px; }
  .section-title { font-size:15px; }

  /* Summary ‚Äî 2x2 grid */
  .summary-strip {
    grid-template-columns:1fr 1fr;
    gap:8px;
    padding:14px 12px;
    border-radius:14px;
  }
  .sum-num { font-size:1.5rem; }
  .sum-label { font-size:9px; }

  /* Overall progress ‚Äî 1 column */
  .prog-grid { grid-template-columns:1fr; gap:10px; }

  /* Streak grid ‚Äî smaller cells */
  .streak-grid { grid-template-columns:repeat(auto-fill,minmax(24px,1fr)); gap:4px; }
  .streak-day { width:24px; height:24px; font-size:9px; border-radius:6px; }

  /* Time grid */
  .time-grid { grid-template-columns:1fr 1fr; gap:10px; }
  .time-main { font-size:1.7rem; }

  /* Quran row ‚Äî stack on mobile */
  .quran-row { flex-wrap:wrap; gap:8px; }
  .quran-label { min-width:auto; width:100%; }
  .quran-input { width:70px; }

  .mood-grid { gap:6px; }
  .mood-btn { padding:12px 4px; border-radius:14px; }
  .mood-emoji { font-size:24px; }
  .mood-text { font-size:9px; }

  /* Sedekah row ‚Äî stack */
  .sedekah-row { flex-wrap:wrap; gap:8px; }
  .sedekah-input { width:100% !important; flex:unset; }
  .sedekah-add { width:100%; justify-content:center; }

  /* Amal grid */
  .amal-grid { grid-template-columns:1fr 1fr; gap:8px; }
  .amal-card { padding:12px 8px; }
  .amal-icon { font-size:22px; }

  /* Toast ‚Äî full width on mobile */
  .toast-wrap { right:10px; left:10px; top:70px; }
  .toast { max-width:100%; }

  /* Modal */
  .modal-box { padding:20px 16px; border-radius:16px; }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   RESPONSIVE - MOBILE SMALL (max 380px)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
@media(max-width:380px){
  header { padding:44px 12px 28px; }
  header h1 { font-size:1.8rem; }
  .arabic-title { font-size:1.2rem; }

  .save-bar-left { grid-template-columns:1fr 1fr; }
  .btn-reset { grid-column:1/-1; }

  .day-btn { width:38px; height:48px; }
  .day-btn .num { font-size:14px; }
  .day-btn .hari { font-size:8px; }

  .summary-strip { padding:12px 10px; gap:6px; }
  .sum-num { font-size:1.3rem; }

  .time-main { font-size:1.5rem; }
  .countdown-time { font-size:1.5rem; }

  .amal-card { padding:10px 6px; }
  .amal-num { font-size:16px; }

  main { padding:12px 10px 140px; }
  .section-card { padding:14px 12px; }
}

/* ‚îÄ‚îÄ DARK MODE TOGGLE ‚îÄ‚îÄ */
.dark-toggle{position:fixed;bottom:18px;left:18px;z-index:1100;background:rgba(3,12,22,.85);border:1.5px solid rgba(200,151,58,.35);color:var(--gold-light);width:42px;height:42px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:18px;cursor:pointer;backdrop-filter:blur(10px);transition:all .3s;box-shadow:0 4px 16px rgba(0,0,0,.3)}
.dark-toggle:hover{background:rgba(200,151,58,.25);transform:scale(1.1)}
.scroll-top-btn{position:fixed;bottom:18px;right:18px;z-index:1100;width:42px;height:42px;border-radius:50%;border:1.5px solid rgba(200,151,58,.5);background:linear-gradient(135deg,rgba(26,107,107,.92),rgba(15,68,68,.95));color:var(--gold-light);font-size:20px;display:flex;align-items:center;justify-content:center;cursor:pointer;backdrop-filter:blur(10px);box-shadow:0 4px 16px rgba(0,0,0,.35);transition:opacity .3s,transform .3s;opacity:0;pointer-events:none;-webkit-tap-highlight-color:transparent;touch-action:manipulation}
.scroll-top-btn.visible{opacity:1;pointer-events:auto}
.scroll-top-btn:hover{transform:scale(1.12);background:linear-gradient(135deg,rgba(46,158,158,.95),rgba(26,107,107,.98))}
.scroll-top-btn:active{transform:scale(.93)}

/* ‚îÄ‚îÄ STATUS PUASA ‚îÄ‚îÄ */
.status-puasa-wrap{display:flex;gap:8px;margin-bottom:4px}
.sp-btn{flex:1;padding:11px 6px;border-radius:14px;border:2px solid transparent;font-family:'Nunito',sans-serif;font-size:12px;font-weight:900;cursor:pointer;transition:all .22s;text-align:center;-webkit-tap-highlight-color:transparent;touch-action:manipulation;background:var(--cream);color:var(--text-muted);border-color:var(--cream-dark)}
.sp-btn.active-belum{background:linear-gradient(135deg,#3060C8,#5080E0);color:white;border-color:transparent;box-shadow:0 4px 14px rgba(48,96,200,.35);transform:translateY(-2px)}
.sp-btn.active-puasa{background:linear-gradient(135deg,#1A6B6B,#2E9E9E);color:white;border-color:transparent;box-shadow:0 4px 14px rgba(26,107,107,.35);transform:translateY(-2px)}
.sp-btn.active-buka{background:linear-gradient(135deg,#1A7A40,#28A855);color:white;border-color:transparent;box-shadow:0 4px 14px rgba(26,122,64,.4);transform:translateY(-2px)}
.batal-alasan-btn{padding:7px 8px;border-radius:9px;border:1.5px solid rgba(200,80,50,.3);background:rgba(200,80,50,.06);font-family:'Nunito',sans-serif;font-size:11px;font-weight:800;color:#C05030;cursor:pointer;transition:all .18s;text-align:center}
.batal-alasan-btn.active{background:rgba(200,80,50,.2);border-color:rgba(200,80,50,.6);transform:scale(1.04)}
.sp-btn.active-batal{background:linear-gradient(135deg,#B02010,#D02818);color:white;border-color:transparent;box-shadow:0 4px 14px rgba(180,30,20,.5);transform:translateY(-2px)}
.sp-btn:active{transform:scale(.95)!important}

/* ‚îÄ‚îÄ AIR MINUM ‚îÄ‚îÄ */
.air-wrap{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
.air-glasses{display:flex;gap:6px;flex-wrap:wrap;flex:1}
.air-glass{width:36px;height:36px;border-radius:10px;border:2px solid rgba(80,160,220,.3);background:rgba(80,160,220,.08);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:20px;transition:all .2s;-webkit-tap-highlight-color:transparent;touch-action:manipulation}
.air-glass.filled{background:linear-gradient(160deg,rgba(80,180,240,.35),rgba(40,120,200,.25));border-color:rgba(80,160,220,.6);box-shadow:0 2px 10px rgba(80,160,220,.25)}
.air-glass:active{transform:scale(.88)}
.air-count{font-size:24px;font-weight:900;color:#3090D0;min-width:28px;text-align:center}
.air-label{font-size:11px;color:var(--text-muted);font-weight:700}
.air-target-note{font-size:11px;color:var(--text-muted);margin-top:6px;font-weight:600}

/* ‚îÄ‚îÄ TIMER SHALAT ‚îÄ‚îÄ */
.shalat-timer-badge{display:inline-flex;align-items:center;gap:4px;font-size:10px;font-weight:800;padding:3px 9px;border-radius:20px;background:rgba(200,151,58,.15);color:var(--gold);margin-left:6px;vertical-align:middle;animation:timerPulse 1.5s ease-in-out infinite}
@keyframes timerPulse{0%,100%{opacity:1}50%{opacity:.6}}
.shalat-timer-badge.done{background:rgba(50,160,100,.15);color:#32A064;animation:none}

/* ‚îÄ‚îÄ MOOD KALENDER 30 HARI ‚îÄ‚îÄ */
.mood-cal-grid{display:grid;grid-template-columns:repeat(10,1fr);gap:5px;margin-top:12px}
.mood-cal-dot{height:28px;border-radius:8px;border:1.5px solid transparent;cursor:pointer;transition:transform .15s;position:relative;display:flex;align-items:center;justify-content:center;font-size:12px}
.mood-cal-dot:hover{transform:scale(1.2);z-index:2}
.mood-cal-dot.empty{background:var(--cream-dark)}
.mood-cal-dot.semangat{background:linear-gradient(135deg,#FFD060,#FFA820);border-color:rgba(255,180,0,.4)}
.mood-cal-dot.tenang{background:linear-gradient(135deg,#60C0F0,#3090D0);border-color:rgba(48,144,208,.4)}
.mood-cal-dot.syukur{background:linear-gradient(135deg,#F080A0,#D04070);border-color:rgba(208,64,112,.4)}
.mood-cal-dot.lelah{background:linear-gradient(135deg,#A080D0,#7050B0);border-color:rgba(112,80,176,.4)}
.mood-cal-dot.lapar{background:linear-gradient(135deg,#80D080,#40A040);border-color:rgba(64,160,64,.4)}
.mood-cal-label{font-size:10px;font-weight:800;text-align:center;color:var(--text-muted);margin-top:6px}

/* ‚îÄ‚îÄ RESET HARI INI ‚îÄ‚îÄ */
.reset-day-btn{display:flex;align-items:center;gap:6px;padding:8px 14px;border-radius:12px;border:1.5px solid rgba(200,60,60,.25);background:rgba(200,60,60,.06);color:#C03030;font-family:'Nunito',sans-serif;font-size:12px;font-weight:800;cursor:pointer;transition:all .2s;-webkit-tap-highlight-color:transparent}
.reset-day-btn:hover{background:rgba(200,60,60,.14);border-color:rgba(200,60,60,.5)}
.reset-day-btn:active{transform:scale(.96)}
/* ‚îÄ‚îÄ Modal konfirmasi reset ‚îÄ‚îÄ */
.confirm-modal-overlay{position:fixed;inset:0;z-index:2000;background:rgba(0,0,0,.75);display:flex;align-items:center;justify-content:center;padding:20px;backdrop-filter:blur(6px);animation:fadeIn .2s ease}
.confirm-modal-box{background:linear-gradient(135deg,#0B1F30,#061525);border:1.5px solid rgba(200,60,60,.4);border-radius:22px;padding:28px 24px;max-width:320px;width:100%;text-align:center;color:white;animation:fadeUp .25s ease}
.confirm-modal-icon{font-size:48px;margin-bottom:12px;display:block}
.confirm-modal-title{font-size:17px;font-weight:900;color:#FF6060;margin-bottom:8px}
.confirm-modal-msg{font-size:13px;color:rgba(255,255,255,.75);line-height:1.6;margin-bottom:20px}
.confirm-modal-btns{display:flex;gap:10px}
.confirm-modal-cancel{flex:1;padding:12px;border-radius:14px;border:1.5px solid rgba(255,255,255,.2);background:transparent;color:rgba(255,255,255,.7);font-family:'Nunito',sans-serif;font-size:14px;font-weight:800;cursor:pointer;transition:all .2s}
.confirm-modal-cancel:hover{background:rgba(255,255,255,.08)}
.confirm-modal-ok{flex:1;padding:12px;border-radius:14px;border:none;background:linear-gradient(135deg,#C03030,#E05050);color:white;font-family:'Nunito',sans-serif;font-size:14px;font-weight:900;cursor:pointer;box-shadow:0 4px 14px rgba(200,48,48,.4);transition:all .2s}
.confirm-modal-ok:hover{filter:brightness(1.12)}
.confirm-modal-ok:active{transform:scale(.96)}

/* ‚îÄ‚îÄ STREAK API TikTok ‚îÄ‚îÄ */
.streak-fire-display{display:flex;flex-direction:column;align-items:center;gap:6px;padding:20px 24px;border-radius:22px;margin:12px auto 18px;max-width:240px;transition:all .4s}
.streak-fire-emoji{font-size:56px;line-height:1.1;filter:drop-shadow(0 0 16px currentColor);animation:fireBounce 1.2s ease-in-out infinite;display:block}
@keyframes fireBounce{0%,100%{transform:scale(1) rotate(-3deg)}50%{transform:scale(1.12) rotate(3deg)}}
.streak-fire-num{font-size:36px;font-weight:900;line-height:1.2;font-variant-numeric:tabular-nums}
.streak-fire-label{font-size:11px;font-weight:800;letter-spacing:.5px;opacity:.8}
.streak-fire-tag{font-size:11px;font-weight:800;padding:5px 14px;border-radius:20px;background:rgba(255,255,255,.2);margin-top:4px}
/* Warna per level streak */
.sf-lv0{background:linear-gradient(135deg,rgba(100,100,100,.15),rgba(60,60,60,.08));color:#888}
.sf-lv1{background:linear-gradient(135deg,rgba(200,151,58,.25),rgba(232,190,106,.12));color:#C8973A}
.sf-lv2{background:linear-gradient(135deg,rgba(255,140,0,.3),rgba(255,100,0,.15));color:#FF8C00}
.sf-lv3{background:linear-gradient(135deg,rgba(255,60,0,.35),rgba(220,20,20,.2));color:#FF3C00}
.sf-lv4{background:linear-gradient(135deg,rgba(200,0,255,.3),rgba(100,0,255,.2));color:#C800FF}
.sf-lv5{background:linear-gradient(135deg,rgba(0,200,255,.3),rgba(0,100,200,.2));color:#00C8FF}

/* ‚îÄ‚îÄ SWIPE HARI ‚îÄ‚îÄ */
.swipe-hint{text-align:center;font-size:10px;color:var(--text-muted);margin-top:6px;font-weight:700;opacity:.6}


/* ‚îÄ‚îÄ CONFETTI ‚îÄ‚îÄ */
.confetti-piece{position:fixed;width:10px;height:10px;top:-20px;border-radius:2px;pointer-events:none;z-index:9999;animation:confettiFall linear forwards}
@keyframes confettiFall{0%{opacity:1;transform:translateY(0) rotate(0deg)}100%{opacity:0;transform:translateY(110vh) rotate(720deg)}}

/* ‚îÄ‚îÄ NIAT PUASA ‚îÄ‚îÄ */
.niat-card{background:linear-gradient(135deg,rgba(26,107,107,.12),rgba(26,107,107,.04));border:1.5px solid rgba(26,107,107,.25);border-radius:18px;padding:18px;margin-bottom:8px;text-align:center}
.niat-arabic{font-family:'Amiri',serif;font-size:1.4rem;direction:rtl;color:var(--teal-dark);line-height:2;margin-bottom:10px}
.niat-latin{font-style:italic;font-size:12px;color:var(--text-muted);margin-bottom:8px;line-height:1.7}
.niat-arti{font-size:13px;color:var(--text);font-weight:700;line-height:1.6}
.niat-confirm-btn{display:flex;align-items:center;justify-content:center;gap:8px;width:100%;padding:12px;border-radius:14px;border:none;cursor:pointer;font-family:'Nunito',sans-serif;font-size:14px;font-weight:800;margin-top:14px;transition:all .2s}
.niat-confirm-btn.confirmed{background:linear-gradient(135deg,#32A064,#20C070);color:white;box-shadow:0 4px 14px rgba(50,160,100,.35)}
.niat-confirm-btn.unconfirmed{background:var(--cream-dark);color:var(--text-muted);border:2px dashed rgba(26,107,107,.3)}

/* ‚îÄ‚îÄ SHARE / EXPORT REKAP ‚îÄ‚îÄ */
.share-btn{display:flex;align-items:center;gap:8px;padding:11px 20px;border-radius:14px;border:none;cursor:pointer;font-family:'Nunito',sans-serif;font-size:13px;font-weight:800;transition:all .2s}
.share-btn.copy{background:linear-gradient(135deg,#1A6B6B,#2E9E9E);color:white;box-shadow:0 3px 10px rgba(26,107,107,.3)}
.share-btn.screenshot{background:linear-gradient(135deg,#C8973A,#E8BE6A);color:white;box-shadow:0 3px 10px rgba(200,151,58,.3)}
.rekap-preview{background:linear-gradient(135deg,#020A14,#061525);border-radius:16px;padding:20px;color:white;margin-top:14px;font-size:13px;line-height:2;border:1px solid rgba(200,151,58,.3)}
.rekap-title{font-family:'Amiri',serif;font-size:18px;color:var(--gold-light);text-align:center;margin-bottom:10px}
.rekap-row{display:flex;justify-content:space-between;padding:4px 0;border-bottom:1px solid rgba(255,255,255,.07)}
.rekap-row:last-child{border-bottom:none}

/* ‚îÄ‚îÄ BIG COUNTDOWN ‚îÄ‚îÄ */
.big-cd-wrap{display:flex;align-items:center;justify-content:center;gap:12px;margin:16px 0 10px}
.big-cd-box{display:flex;flex-direction:column;align-items:center;background:linear-gradient(135deg,rgba(26,107,107,.1),rgba(26,107,107,.03));border:1.5px solid rgba(26,107,107,.2);border-radius:16px;padding:14px 18px;min-width:72px}
.big-cd-num{font-size:38px;font-weight:900;color:var(--teal);font-variant-numeric:tabular-nums;line-height:1;letter-spacing:-2px}
.big-cd-unit{font-size:10px;font-weight:800;color:var(--text-muted);text-transform:uppercase;letter-spacing:.8px;margin-top:4px}
.big-cd-sep{font-size:32px;font-weight:900;color:var(--teal);margin-bottom:14px;opacity:.6}
.big-cd-bar-wrap{height:8px;background:var(--cream-dark);border-radius:99px;overflow:hidden;margin:0 4px}
.big-cd-bar{height:100%;background:linear-gradient(90deg,var(--teal),#2E9E9E);border-radius:99px;transition:width 1s linear}

/* ‚îÄ‚îÄ AYAT HARIAN ‚îÄ‚îÄ */
.ayat-card{background:linear-gradient(135deg,rgba(200,151,58,.08),rgba(200,151,58,.02));border:1.5px solid rgba(200,151,58,.25);border-radius:16px;padding:20px}
.ayat-arabic{font-family:'Amiri',serif;font-size:1.5rem;direction:rtl;text-align:right;line-height:2.2;color:var(--teal-dark);margin-bottom:12px}
.ayat-latin{font-style:italic;font-size:12.5px;color:var(--text-muted);line-height:1.8;margin-bottom:8px}
.ayat-arti{font-size:13.5px;font-weight:700;color:var(--text);line-height:1.8;padding:12px 14px;background:rgba(200,151,58,.07);border-radius:12px;border-left:3px solid var(--gold);margin-bottom:10px}
.ayat-ref{font-size:11px;font-weight:800;color:var(--gold);text-align:right}

/* ‚îÄ‚îÄ TANTANGAN ‚îÄ‚îÄ */
.tantangan-card{background:linear-gradient(135deg,rgba(100,60,180,.08),rgba(100,60,180,.02));border:2px solid rgba(100,60,180,.2);border-radius:18px;padding:20px;text-align:center}
.tantangan-day{font-size:11px;font-weight:800;color:#8060C0;text-transform:uppercase;letter-spacing:.8px;margin-bottom:8px}
.tantangan-icon{font-size:48px;margin-bottom:10px;display:block;animation:floatIcon 3s ease-in-out infinite}
@keyframes floatIcon{0%,100%{transform:translateY(0)}50%{transform:translateY(-6px)}}
.tantangan-title{font-size:18px;font-weight:900;color:var(--text);margin-bottom:8px}
.tantangan-desc{font-size:13px;color:var(--text-muted);line-height:1.7;margin-bottom:16px}
.tantangan-done-btn{display:flex;align-items:center;justify-content:center;gap:8px;width:100%;padding:13px;border-radius:14px;border:none;cursor:pointer;font-family:'Nunito',sans-serif;font-size:14px;font-weight:800;transition:all .2s;-webkit-tap-highlight-color:transparent}
.tantangan-done-btn.undone{background:linear-gradient(135deg,#7040D0,#9060E8);color:white;box-shadow:0 4px 14px rgba(100,60,180,.35)}
.tantangan-done-btn.done{background:linear-gradient(135deg,#32A064,#5DC887);color:white;box-shadow:0 4px 14px rgba(50,160,100,.35)}
.tantangan-done-btn:active{transform:scale(.97)}

/* ‚îÄ‚îÄ SHARE CARD ‚îÄ‚îÄ */
.share-preview{background:linear-gradient(135deg,#061525,#0B2535);border:1.5px solid rgba(200,151,58,.3);border-radius:16px;padding:20px;margin-bottom:12px;color:white;font-family:'Nunito',sans-serif}
.share-header{font-size:14px;font-weight:900;color:var(--gold-light);text-align:center;margin-bottom:14px;letter-spacing:.3px}
.share-ibadah{display:flex;flex-wrap:wrap;gap:6px;justify-content:center;margin-bottom:14px}
.share-ibadah-tag{font-size:12px;padding:4px 10px;border-radius:20px;background:rgba(255,255,255,.1);font-weight:700}
.share-ibadah-tag.done{background:rgba(50,160,100,.3);color:#7EFFC0}
.share-ibadah-tag.undone{background:rgba(255,255,255,.06);color:rgba(255,255,255,.5)}
.share-quote{font-size:12px;font-style:italic;color:rgba(255,255,255,.7);text-align:center;padding:10px;border-top:1px solid rgba(255,255,255,.1);border-bottom:1px solid rgba(255,255,255,.1);margin-bottom:10px;line-height:1.6}
.share-footer{font-size:10px;color:rgba(255,255,255,.4);text-align:center;font-weight:700;letter-spacing:.5px}
.share-btn{display:flex;align-items:center;justify-content:center;gap:8px;width:100%;padding:12px;border-radius:14px;border:none;cursor:pointer;font-family:'Nunito',sans-serif;font-size:13px;font-weight:800;background:linear-gradient(135deg,var(--teal),var(--teal-light));color:white;margin-bottom:8px;transition:all .2s;-webkit-tap-highlight-color:transparent}
.share-btn:hover{filter:brightness(1.1);transform:translateY(-1px)}
.share-btn:active{transform:scale(.97)}
.share-btn-notif{background:linear-gradient(135deg,#C8973A,#E8BE6A)}

/* ‚îÄ‚îÄ REMINDER MODAL ‚îÄ‚îÄ */
.reminder-overlay{position:fixed;inset:0;z-index:500;background:rgba(0,0,0,.7);display:flex;align-items:center;justify-content:center;backdrop-filter:blur(8px)}
.reminder-overlay.hidden{display:none !important}
.reminder-box{background:linear-gradient(135deg,#061525,#0B1F30);border:2px solid rgba(200,151,58,.4);border-radius:24px;padding:32px 28px;max-width:360px;width:90%;text-align:center;color:white;animation:fadeUp .4s ease;position:relative;z-index:501}
.reminder-icon{font-size:60px;margin-bottom:16px;display:block}
.reminder-title{font-family:'Amiri',serif;font-size:22px;color:var(--gold-light);margin-bottom:8px}
.reminder-msg{font-size:14px;color:rgba(255,255,255,.8);line-height:1.7;margin-bottom:20px}
.reminder-close{background:linear-gradient(135deg,var(--gold),var(--gold-light));color:white;border:none;padding:12px 32px;border-radius:14px;font-family:'Nunito',sans-serif;font-size:14px;font-weight:800;cursor:pointer;transition:all .2s;position:relative;z-index:501;-webkit-tap-highlight-color:transparent;touch-action:manipulation}
.reminder-close:hover{transform:translateY(-2px);filter:brightness(1.1)}
.reminder-close:active{transform:scale(.97)}

/* ‚îÄ‚îÄ DZIKIR TRACKER ‚îÄ‚îÄ */
.dzikir-section-wrap{background:linear-gradient(135deg,rgba(26,107,107,.06),rgba(26,107,107,.01));border:1.5px solid rgba(26,107,107,.15);border-radius:18px;padding:18px;margin-top:20px}
.dzikir-section-title{font-size:15px;font-weight:900;color:var(--text);margin-bottom:4px;display:flex;align-items:center;gap:8px}
.dzikir-section-sub{font-size:12px;color:var(--text-muted);margin-bottom:14px;line-height:1.5}
.dzikir-grid{display:grid;grid-template-columns:1fr;gap:10px}
.dzikir-item{background:white;border:2px solid var(--cream-dark);border-radius:16px;padding:14px 16px;text-align:center;transition:all .25s;box-shadow:0 2px 8px rgba(0,0,0,.05)}
.dzikir-item.done{background:linear-gradient(135deg,#E8F8EC,#D5F2DC);border-color:#5DC887;box-shadow:0 3px 14px rgba(50,160,100,.18)}
.dzikir-item:not(.done):hover{border-color:rgba(26,107,107,.4);box-shadow:0 4px 14px rgba(26,107,107,.1)}
.dzikir-name{font-size:12.5px;font-weight:900;color:#1A3A3A;margin-bottom:4px;line-height:1.3}
.dzikir-item.done .dzikir-name{color:#1A7040}
.dzikir-arabic{font-family:'Amiri',serif;font-size:15px;color:#1A6B6B;direction:rtl;margin-bottom:8px;line-height:1.6;font-weight:700}
.dzikir-item.done .dzikir-arabic{color:#20A050}
.dzikir-count-wrap{display:flex;align-items:center;justify-content:center;gap:6px;margin-bottom:8px}
.dzikir-num{font-size:26px;font-weight:900;color:#0F4444;min-width:40px;letter-spacing:-1px;font-variant-numeric:tabular-nums}
.dzikir-item.done .dzikir-num{color:#1A7040}
.dzikir-tap-btn{width:36px;height:36px;border-radius:50%;border:2px solid rgba(26,107,107,.3);background:rgba(26,107,107,.08);cursor:pointer;font-size:18px;display:flex;align-items:center;justify-content:center;transition:all .15s;color:#0F4444;font-weight:900;-webkit-tap-highlight-color:transparent;touch-action:manipulation}
.dzikir-tap-btn:active{transform:scale(.88);background:rgba(26,107,107,.22)}
.dzikir-tap-btn.plus{background:rgba(26,107,107,.12);border-color:rgba(26,107,107,.5)}
.dzikir-item.done .dzikir-tap-btn{border-color:rgba(50,160,100,.4);background:rgba(50,160,100,.1);color:#1A7040}
.dzikir-progress-bar{height:5px;background:rgba(26,107,107,.12);border-radius:99px;overflow:hidden;margin-bottom:6px}
.dzikir-progress-fill{height:100%;background:linear-gradient(90deg,var(--teal),#2E9E9E);border-radius:99px;transition:width .3s ease}
.dzikir-item.done .dzikir-progress-fill{background:linear-gradient(90deg,#32A064,#5DC887)}
.dzikir-target{font-size:11px;font-weight:800;color:#4A7A6A;margin-top:2px}
.dzikir-item.done .dzikir-target{color:#1A7040}

/* ‚îÄ‚îÄ REKAP AKHIR RAMADAN ‚îÄ‚îÄ */
.rekap-akhir-banner{background:linear-gradient(135deg,rgba(200,151,58,.2),rgba(200,151,58,.05));border:2px solid rgba(200,151,58,.4);border-radius:20px;padding:20px;text-align:center;margin-bottom:14px}
.rekap-akhir-title{font-family:'Amiri',serif;font-size:22px;color:var(--gold);margin-bottom:6px}
.rekap-akhir-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:14px}
.rekap-akhir-item{background:var(--cream);border-radius:14px;padding:14px;text-align:center;border:1px solid var(--cream-dark)}
.rekap-akhir-num{font-size:24px;font-weight:900;color:var(--teal)}
.rekap-akhir-label{font-size:11px;color:var(--text-muted);margin-top:4px;font-weight:700}

/* ‚îÄ‚îÄ MILESTONE BADGE ‚îÄ‚îÄ */
.milestone-pop{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) scale(0);z-index:1000;background:linear-gradient(135deg,#C8973A,#E8BE6A);border-radius:24px;padding:32px 40px;text-align:center;color:white;box-shadow:0 20px 60px rgba(200,151,58,.5);transition:transform .4s cubic-bezier(.34,1.56,.64,1)}
.milestone-pop.show{transform:translate(-50%,-50%) scale(1)}
.milestone-pop-icon{font-size:60px;margin-bottom:12px}
.milestone-pop-title{font-family:'Amiri',serif;font-size:22px;margin-bottom:6px}
.milestone-pop-msg{font-size:13px;opacity:.9}


/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SPLASH SCREEN ONBOARDING
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
#splashScreen {
  position: fixed; inset: 0; z-index: 9999;
  background: linear-gradient(160deg, #020A14 0%, #061525 40%, #0A1F30 70%, #0D2538 100%);
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  overflow: hidden; transition: opacity .6s ease, visibility .6s ease;
}
#splashScreen.hidden { opacity: 0; visibility: hidden; pointer-events: none; }

.splash-stars { position: absolute; inset: 0; overflow: hidden; pointer-events: none; }
.splash-star {
  position: absolute; background: white; border-radius: 50%;
  animation: splashTwinkle ease-in-out infinite;
}
@keyframes splashTwinkle {
  0%,100% { opacity: .2; transform: scale(1); }
  50% { opacity: 1; transform: scale(1.4); }
}

.splash-lanterns {
  position: absolute; top: 0; left: 0; right: 0; height: 160px;
  display: flex; justify-content: space-around; align-items: flex-start;
  pointer-events: none;
}
.splash-lantern {
  display: flex; flex-direction: column; align-items: center;
  animation: splashSwing 3.5s ease-in-out infinite;
  transform-origin: top center;
}
.splash-lantern:nth-child(2) { animation-duration: 4.5s; animation-delay: -.8s; }
.splash-lantern:nth-child(3) { animation-duration: 3s; animation-delay: -1.5s; }
@keyframes splashSwing { 0%,100%{transform:rotate(-7deg)} 50%{transform:rotate(7deg)} }
.splash-lantern-string { width: 1px; height: 35px; background: linear-gradient(180deg,rgba(200,151,58,.7),rgba(200,151,58,.2)); }
.splash-lantern-body {
  width: 32px; height: 50px; border-radius: 50% 50% 40% 40%;
  display: flex; align-items: center; justify-content: center;
  font-size: 22px; filter: drop-shadow(0 0 16px currentColor);
  animation: splashGlow 2s ease-in-out infinite;
}
@keyframes splashGlow { 0%,100%{filter:drop-shadow(0 0 10px currentColor)} 50%{filter:drop-shadow(0 0 24px currentColor)} }

.splash-moon {
  font-size: clamp(70px, 15vw, 110px);
  animation: splashMoonIn 1s cubic-bezier(.34,1.56,.64,1) both, splashFloat 4s ease-in-out infinite 1s;
  filter: drop-shadow(0 0 40px rgba(200,151,58,.5));
  margin-bottom: 0;
}
@keyframes splashMoonIn { from{transform:scale(0) rotate(-30deg);opacity:0} to{transform:scale(1) rotate(0);opacity:1} }
@keyframes splashFloat { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-12px)} }

.splash-arabic {
  font-family: 'Amiri', serif;
  font-size: clamp(1.8rem, 6vw, 3rem);
  color: var(--gold-light);
  direction: rtl;
  text-align: center;
  animation: splashFadeUp .8s ease .3s both;
  margin: 10px 0 4px;
  text-shadow: 0 0 30px rgba(200,151,58,.4);
}
@keyframes splashFadeUp { from{opacity:0;transform:translateY(20px)} to{opacity:1;transform:translateY(0)} }

.splash-title {
  font-family: 'Amiri', serif;
  font-size: clamp(1.6rem, 5vw, 2.4rem);
  color: white;
  text-align: center;
  animation: splashFadeUp .8s ease .5s both;
  margin-bottom: 6px;
}
.splash-subtitle {
  font-size: 14px; color: rgba(255,255,255,.6);
  text-align: center;
  animation: splashFadeUp .8s ease .7s both;
  margin-bottom: 40px;
}
.splash-author {
  font-size: 12px; font-weight: 800;
  color: rgba(200,151,58,.8); letter-spacing: 2px;
  text-transform: uppercase; text-align: center;
  animation: splashFadeUp .8s ease .9s both;
  margin-bottom: 32px;
}
.splash-progress-wrap {
  width: min(260px, 70vw);
  animation: splashFadeUp .8s ease 1.1s both;
}
.splash-progress-bar {
  height: 4px; background: rgba(255,255,255,.15); border-radius: 99px; overflow: hidden;
  margin-bottom: 10px;
}
.splash-progress-fill {
  height: 100%; background: linear-gradient(90deg, var(--gold), var(--gold-light));
  border-radius: 99px; width: 0%;
  transition: width .05s linear;
}
.splash-loading-text {
  font-size: 12px; color: rgba(255,255,255,.5); text-align: center;
  animation: splashPulse 1.5s ease-in-out infinite;
}
@keyframes splashPulse { 0%,100%{opacity:.4} 50%{opacity:1} }

.splash-skip {
  position: absolute; bottom: 30px;
  font-size: 12px; color: rgba(255,255,255,.35);
  cursor: pointer; border: none; background: none;
  font-family: 'Nunito', sans-serif;
  animation: splashFadeUp .8s ease 1.5s both;
  transition: color .2s;
}
.splash-skip:hover { color: rgba(255,255,255,.7); }

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   PWA INSTALL BANNER
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
#pwaBanner {
  position: fixed; bottom: 0; left: 0; right: 0; z-index: 1200;
  background: linear-gradient(135deg, #061525, #0B1F30);
  border-top: 1px solid rgba(200,151,58,.35);
  padding: 14px 20px;
  display: flex; align-items: center; gap: 14px;
  transform: translateY(100%); transition: transform .4s cubic-bezier(.34,1.56,.64,1);
  box-shadow: 0 -8px 32px rgba(0,0,0,.4);
}
#pwaBanner.show { transform: translateY(0); }
.pwa-icon { font-size: 36px; flex-shrink: 0; }
.pwa-text { flex: 1; }
.pwa-text-title { font-size: 14px; font-weight: 800; color: white; }
.pwa-text-sub { font-size: 12px; color: rgba(255,255,255,.6); margin-top: 2px; }
.pwa-install-btn {
  background: linear-gradient(135deg, var(--gold), var(--gold-light));
  color: white; border: none; padding: 10px 18px;
  border-radius: 12px; font-family: 'Nunito', sans-serif;
  font-size: 13px; font-weight: 800; cursor: pointer;
  white-space: nowrap; flex-shrink: 0;
  box-shadow: 0 4px 14px rgba(200,151,58,.4);
  transition: all .2s;
}
.pwa-install-btn:hover { transform: translateY(-2px); filter: brightness(1.1); }
.pwa-close-btn {
  background: none; border: none; color: rgba(255,255,255,.4);
  font-size: 20px; cursor: pointer; flex-shrink: 0; padding: 4px;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SHARE CARD MODAL
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
#shareModal {
  position: fixed; inset: 0; z-index: 600;
  background: rgba(0,0,0,.85); backdrop-filter: blur(12px);
  display: flex; align-items: flex-start; justify-content: center;
  padding: 16px 16px 32px; opacity: 0; visibility: hidden;
  transition: opacity .3s, visibility .3s;
  overflow-y: auto; -webkit-overflow-scrolling: touch;
}
#shareModal.show { opacity: 1; visibility: visible; }

.share-modal-box {
  width: min(420px, 100%);
  margin: auto 0;
  animation: shareBoxIn .4s cubic-bezier(.34,1.56,.64,1) both;
}
@keyframes shareBoxIn { from{transform:scale(.8) translateY(30px);opacity:0} to{transform:none;opacity:1} }

/* THE SHARE CARD ‚Äî ini yang di-screenshot */
#shareCard {
  background: linear-gradient(160deg, #020A14 0%, #061525 50%, #0A1F2E 100%);
  border-radius: 20px; padding: clamp(16px, 4vw, 24px) clamp(14px, 4vw, 22px);
  border: 1px solid rgba(200,151,58,.3);
  position: relative; overflow: hidden;
  box-shadow: 0 20px 60px rgba(0,0,0,.6);
}
.share-card-bg {
  position: absolute; inset: 0; pointer-events: none; overflow: hidden;
}
.share-card-star {
  position: absolute; background: white; border-radius: 50%;
  animation: splashTwinkle ease-in-out infinite;
}
.share-card-moon {
  position: absolute; right: -20px; top: -20px;
  font-size: 100px; opacity: .07;
}
.share-card-header {
  text-align: center; margin-bottom: 20px; position: relative;
}
.share-card-icon { font-size: 42px; margin-bottom: 8px; display: block; }
.share-card-title {
  font-family: 'Amiri', serif; font-size: clamp(15px, 4vw, 20px);
  color: var(--gold-light); margin-bottom: 3px;
}
.share-card-subtitle { font-size: 12px; color: rgba(255,255,255,.5); }
.share-card-author {
  font-size: 11px; font-weight: 800; letter-spacing: 2px;
  color: rgba(200,151,58,.7); text-transform: uppercase; margin-top: 4px;
}
.share-card-divider {
  height: 1px; background: linear-gradient(90deg, transparent, rgba(200,151,58,.4), transparent);
  margin: 16px 0;
}
.share-card-stats {
  display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 16px;
}
.share-stat {
  background: rgba(255,255,255,.04);
  border: 1px solid rgba(255,255,255,.08);
  border-radius: 14px; padding: 12px 10px; text-align: center;
}
.share-stat-icon { font-size: 22px; margin-bottom: 4px; display: block; }
.share-stat-num { font-size: clamp(16px, 4.5vw, 22px); font-weight: 900; color: white; display: block; line-height: 1.2; }
.share-stat-label { font-size: 10px; color: rgba(255,255,255,.5); margin-top: 2px; }
.share-card-streak {
  background: linear-gradient(135deg, rgba(200,151,58,.15), rgba(200,151,58,.05));
  border: 1px solid rgba(200,151,58,.3);
  border-radius: 14px; padding: 10px 14px;
  display: flex; align-items: center; justify-content: space-between;
  margin-bottom: 10px; gap: 8px;
}
.share-card-streak-label { font-size: 11px; color: rgba(255,255,255,.7); font-weight: 700; white-space: nowrap; flex-shrink: 0; }
.share-card-streak-val { font-size: clamp(14px, 3.5vw, 18px); font-weight: 900; color: var(--gold-light); white-space: nowrap; }
.share-card-quote {
  font-size: 11px; color: rgba(255,255,255,.45); text-align: center;
  font-style: italic; line-height: 1.6; margin-top: 12px;
  padding-top: 12px;
  border-top: 1px solid rgba(255,255,255,.07);
}
.share-card-footer {
  display: flex; align-items: center; justify-content: space-between; margin-top: 14px;
}
.share-card-tag {
  font-size: 10px; color: rgba(200,151,58,.6); font-weight: 800;
}
.share-card-days {
  background: rgba(200,151,58,.15); border: 1px solid rgba(200,151,58,.3);
  border-radius: 20px; padding: 4px 12px;
  font-size: 11px; font-weight: 800; color: var(--gold-light);
}

/* Share action buttons */
.share-actions {
  display: flex; gap: 10px; margin-top: 14px; flex-wrap: wrap;
}
.share-action-btn {
  flex: 1; min-width: 120px;
  display: flex; align-items: center; justify-content: center; gap: 8px;
  padding: 12px 16px; border-radius: 14px; border: none;
  font-family: 'Nunito', sans-serif; font-size: 13px; font-weight: 800;
  cursor: pointer; transition: all .2s;
}
.share-action-btn:hover { transform: translateY(-2px); filter: brightness(1.1); }
.sab-screenshot { background: linear-gradient(135deg, #C8973A, #E8BE6A); color: white; }
.sab-wa { background: linear-gradient(135deg, #25D366, #128C7E); color: white; }
.sab-copy { background: rgba(255,255,255,.1); color: white; border: 1px solid rgba(255,255,255,.2); }
.sab-close { background: rgba(255,100,100,.15); color: #FF8080; border: 1px solid rgba(255,100,100,.2); width: 100%; margin-top: 4px; }

/* ONBOARDING */
#onboardingModal{position:fixed;inset:0;z-index:900;background:rgba(0,0,0,.92);backdrop-filter:blur(16px);display:flex;align-items:center;justify-content:center;padding:20px}
.onboarding-box{width:min(440px,100%);background:linear-gradient(160deg,#061525,#0A1F2E);border:1px solid rgba(200,151,58,.35);border-radius:24px;padding:28px 24px;animation:shareBoxIn .4s cubic-bezier(.34,1.56,.64,1) both}
.onboarding-step{display:none}.onboarding-step.active{display:block}
.onboarding-dots{display:flex;gap:8px;justify-content:center;margin:20px 0 16px}
.onboarding-dot{width:8px;height:8px;border-radius:50%;background:rgba(255,255,255,.2);transition:all .3s}
.onboarding-dot.active{background:var(--gold);width:24px;border-radius:4px}

/* PRINT */
@media print {
  header,#splashScreen,.save-bar,#tutorialPanel,.day-wave,.summary-strip,.overall-progress,
  .dark-toggle,#pwaBanner,#onboardingModal,.share-actions,.modal,canvas,.lanterns,.particles,
  .mosque-silhouette,.toast-wrap,.milestone-pop{display:none!important}
  body{background:white!important;color:#111!important}
  main{padding:10px!important;max-width:100%!important}
  .section-card{break-inside:avoid;background:white!important;border:1px solid #ddd!important;box-shadow:none!important;margin-bottom:12px!important}
  .section-title{color:#111!important}.section-sub{color:#555!important}
  .print-hide{display:none!important}
  .quran-track{background:#eee!important}
  @page{margin:15mm}
}

/* IBADAH INDICATOR */
.ibadah-time-dot{display:inline-block;width:7px;height:7px;border-radius:50%;margin-left:5px;vertical-align:middle}

/* ‚ïê‚ïê‚ïê WIDGET RINGKASAN HARIAN ‚ïê‚ïê‚ïê */
.daily-widget {
  background: linear-gradient(135deg, rgba(200,151,58,.18), rgba(200,151,58,.06));
  border: 1.5px solid rgba(200,151,58,.35);
  border-radius: 18px; padding: 14px 18px;
  margin: 0 0 14px; display: flex;
  align-items: center; gap: 12px;
  flex-wrap: wrap; position: relative;
  overflow: hidden;
}
.daily-widget::before {
  content: 'üåô'; position: absolute; right: 14px; top: 50%;
  transform: translateY(-50%); font-size: 52px; opacity: .06; pointer-events: none;
}
.dw-day { font-family:'Amiri',serif; font-size: 2rem; font-weight: 700; color: #E8BE6A; line-height: 1; }
.dw-sep { width: 1.5px; height: 36px; background: rgba(200,151,58,.3); border-radius: 2px; flex-shrink: 0; }
.dw-stats { display: flex; gap: 16px; flex-wrap: wrap; flex: 1; }
.dw-stat { display: flex; flex-direction: column; align-items: center; min-width: 52px; }
.dw-stat-val { font-size: 15px; font-weight: 900; color: #ffffff; line-height: 1.1; }
.dw-stat-lbl { font-size: 9px; font-weight: 700; color: rgba(255,255,255,.55); text-transform: uppercase; letter-spacing: .4px; margin-top: 2px; }
.dw-notif-btn {
  margin-left: auto; flex-shrink: 0;
  background: rgba(200,151,58,.2); border: 1.5px solid rgba(200,151,58,.4);
  border-radius: 10px; padding: 7px 12px;
  font-family: 'Nunito',sans-serif; font-size: 11px; font-weight: 800;
  color: var(--gold-light); cursor: pointer; transition: all .2s;
  display: flex; align-items: center; gap: 5px;
}
.dw-notif-btn:hover { background: rgba(200,151,58,.35); transform: translateY(-1px); }
.dw-notif-btn.active { background: rgba(46,158,100,.25); border-color: rgba(46,158,100,.5); color: #4ADE80; }
.dw-ibadah-bar { width: 100%; margin-top: 8px; }
.dw-bar-track { height: 6px; background: rgba(200,151,58,.15); border-radius: 3px; overflow: hidden; }
.dw-bar-fill { height: 100%; border-radius: 3px; background: linear-gradient(90deg, var(--gold), var(--gold-light)); transition: width .5s cubic-bezier(.34,1.56,.64,1); }
.dw-bar-label { display: flex; justify-content: space-between; font-size: 10px; font-weight: 700; color: rgba(255,255,255,.5); margin-top: 4px; }

/* ‚ïê‚ïê‚ïê NOTIF MODAL ‚ïê‚ïê‚ïê */
#notifModal {
  position: fixed; inset: 0; z-index: 650;
  background: rgba(0,0,0,.85); backdrop-filter: blur(12px);
  display: flex; align-items: flex-end; justify-content: center;
  padding: 20px; opacity: 0; visibility: hidden;
  transition: opacity .3s, visibility .3s;
}
#notifModal.show { opacity: 1; visibility: visible; }
.notif-box {
  width: min(440px, 100%); background: #0F1E2E;
  border: 1.5px solid rgba(200,151,58,.35); border-radius: 24px 24px 16px 16px;
  padding: 24px; animation: slideUp .35s cubic-bezier(.34,1.56,.64,1) both;
}
@keyframes slideUp { from{transform:translateY(60px);opacity:0} to{transform:none;opacity:1} }
.notif-toggle-row { display: flex; align-items: center; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,.07); }
.notif-toggle-label { font-size: 14px; font-weight: 800; color: white; }
.notif-toggle-sub { font-size: 11px; color: rgba(255,255,255,.45); margin-top: 2px; }
.notif-switch { position: relative; width: 44px; height: 24px; flex-shrink: 0; }
.notif-switch input { opacity: 0; width: 0; height: 0; }
.notif-slider { position: absolute; inset: 0; background: rgba(255,255,255,.15); border-radius: 24px; cursor: pointer; transition: .3s; }
.notif-slider:before { content:''; position:absolute; width:18px; height:18px; left:3px; top:3px; background:white; border-radius:50%; transition:.3s; }
input:checked + .notif-slider { background: var(--gold); }
input:checked + .notif-slider:before { transform: translateX(20px); }
.notif-time-row { display: flex; align-items: center; gap: 10px; margin-top: 14px; }
.notif-time-label { font-size: 12px; font-weight: 700; color: rgba(255,255,255,.6); flex: 1; }
.notif-time-input { background: rgba(255,255,255,.07); border: 1.5px solid rgba(200,151,58,.3); border-radius: 10px; padding: 8px 12px; font-family:'Nunito',sans-serif; font-size: 14px; font-weight: 800; color: white; outline: none; width: 100px; text-align: center; }
.notif-time-input:focus { border-color: var(--gold); }

/* ‚ïê‚ïê‚ïê PDF EXPORT MODAL ‚ïê‚ïê‚ïê */
#pdfModal {
  position: fixed; inset: 0; z-index: 650;
  background: rgba(0,0,0,.85); backdrop-filter: blur(12px);
  display: flex; align-items: center; justify-content: center;
  padding: 20px; opacity: 0; visibility: hidden;
  transition: opacity .3s, visibility .3s;
}
#pdfModal.show { opacity: 1; visibility: visible; }
.pdf-box {
  width: min(440px, 100%); background: #0F1E2E;
  border: 1.5px solid rgba(200,151,58,.35); border-radius: 24px;
  padding: 24px; animation: shareBoxIn .35s cubic-bezier(.34,1.56,.64,1) both;
  max-height: 90vh; overflow-y: auto;
}
.pdf-section-check { display: flex; align-items: center; gap: 10px; padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,.06); cursor: pointer; }
.pdf-section-check input[type=checkbox] { width: 18px; height: 18px; accent-color: var(--gold); cursor: pointer; flex-shrink: 0; }
.pdf-check-label { font-size: 13px; font-weight: 700; color: rgba(255,255,255,.85); }
.pdf-check-sub { font-size: 11px; color: rgba(255,255,255,.4); }
.pdf-export-btn { width: 100%; margin-top: 18px; padding: 14px; background: linear-gradient(135deg, var(--gold), var(--gold-light)); border: none; border-radius: 14px; font-family:'Nunito',sans-serif; font-size: 15px; font-weight: 900; color: #020A14; cursor: pointer; transition: all .2s; }
.pdf-export-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(200,151,58,.4); }


/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   WIDGET UPGRADE ‚Äî Visual Polish Pack
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

/* ‚îÄ‚îÄ Global micro-interaction enhancement ‚îÄ‚îÄ */
.section-card {
  transition: box-shadow .3s ease, transform .2s ease;
}
.section-card:hover {
  box-shadow: 0 12px 40px rgba(0,0,0,.18), 0 0 0 1px rgba(200,151,58,.08);
}

/* ‚îÄ‚îÄ Section icon pulse on hover ‚îÄ‚îÄ */
.section-icon {
  transition: transform .25s cubic-bezier(.34,1.56,.64,1), box-shadow .25s;
}
.section-card:hover .section-icon {
  transform: scale(1.12) rotate(-3deg);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   JADWAL SAHUR & BUKA ‚Äî enhanced
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.jadwal-card {
  transition: transform .2s cubic-bezier(.34,1.56,.64,1), box-shadow .2s;
}
.jadwal-card:hover {
  transform: translateY(-3px) scale(1.01);
  box-shadow: 0 16px 40px rgba(0,0,0,.4), 0 0 60px rgba(200,151,58,.12) inset !important;
}
.jadwal-card-time {
  font-family: 'Amiri', serif;
  font-size: 2.4rem;
  font-weight: 700;
  letter-spacing: 1px;
  line-height: 1;
  margin: 8px 0 4px;
  position: relative;
}
.jadwal-card-sahur .jadwal-card-time { color: #E8BE6A; }
.jadwal-card-buka .jadwal-card-time  { color: #6ECECE; }

/* Glowing time text */
.jadwal-card-sahur .jadwal-card-time { text-shadow: 0 0 24px rgba(200,151,58,.5); }
.jadwal-card-buka  .jadwal-card-time { text-shadow: 0 0 24px rgba(46,158,158,.5); }

/* Countdown pulsing dot */
.countdown-wrap::before {
  content: '';
  display: block;
  width: 8px; height: 8px;
  background: rgba(255,255,255,.8);
  border-radius: 50%;
  margin: 0 auto 6px;
  animation: blink 1.4s ease-in-out infinite;
}
@keyframes blink {
  0%, 100% { opacity: 1; transform: scale(1); }
  50% { opacity: .3; transform: scale(.7); }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   MOOD TRACKER ‚Äî expressive
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.mood-btn {
  transition: transform .2s cubic-bezier(.34,1.56,.64,1),
              background .2s, border-color .2s, box-shadow .2s;
  position: relative;
  overflow: hidden;
}
.mood-btn:hover {
  transform: translateY(-4px) scale(1.06);
  box-shadow: 0 8px 20px rgba(0,0,0,.12);
  border-color: var(--gold) !important;
}
.mood-btn.selected {
  animation: moodPop .35s cubic-bezier(.34,1.56,.64,1);
}
@keyframes moodPop {
  0%   { transform: scale(.9); }
  60%  { transform: scale(1.12); }
  100% { transform: scale(1); }
}
.mood-emoji {
  font-size: 1.8rem;
  display: block;
  transition: transform .2s cubic-bezier(.34,1.56,.64,1);
  filter: drop-shadow(0 2px 4px rgba(0,0,0,.15));
}
.mood-btn:hover .mood-emoji,
.mood-btn.selected .mood-emoji {
  transform: scale(1.2) rotate(-5deg);
}
.mood-text {
  font-size: 10px;
  font-weight: 800;
  letter-spacing: .3px;
}
/* Mood message box */
#moodMessage {
  animation: fadeSlideIn .4s ease;
  border-left: 3px solid var(--gold);
}
@keyframes fadeSlideIn {
  from { opacity: 0; transform: translateY(-8px); }
  to   { opacity: 1; transform: translateY(0); }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   DZIKIR ‚Äî counter cards
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.dzikir-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 12px;
}
.dzikir-item {
  transition: transform .2s ease, box-shadow .2s, border-color .25s;
  position: relative;
  overflow: hidden;
}
.dzikir-item::before {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(135deg, transparent 60%, rgba(26,107,107,.06));
  pointer-events: none;
}
.dzikir-item:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 24px rgba(0,0,0,.1);
  border-color: rgba(26,107,107,.35) !important;
}
.dzikir-item.done {
  animation: dzikirComplete .5s cubic-bezier(.34,1.56,.64,1);
  box-shadow: 0 4px 20px rgba(32,160,80,.2) !important;
}
@keyframes dzikirComplete {
  0%   { transform: scale(.97); }
  50%  { transform: scale(1.03); }
  100% { transform: scale(1); }
}

/* Counter button pulse on tap */
.dzikir-btn-plus {
  position: relative;
  transition: transform .15s cubic-bezier(.34,1.56,.64,1), box-shadow .15s;
}
.dzikir-btn-plus:active {
  transform: scale(.88);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   IBADAH TRACKER ‚Äî tap feedback
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.ibadah-item {
  transition: transform .2s cubic-bezier(.34,1.56,.64,1),
              background .25s, border-color .25s, box-shadow .25s;
}
.ibadah-item:hover {
  transform: translateX(4px);
  box-shadow: 0 4px 16px rgba(0,0,0,.1);
}
.ibadah-item.checked {
  animation: ibadahCheck .4s cubic-bezier(.34,1.56,.64,1);
}
@keyframes ibadahCheck {
  0%  { transform: scale(.97) translateX(0); }
  40% { transform: scale(1.03) translateX(6px); }
  100%{ transform: scale(1) translateX(0); }
}
.ibadah-icon {
  font-size: 1.4rem;
  width: 42px; height: 42px;
  border-radius: 12px;
  display: flex; align-items: center; justify-content: center;
  background: rgba(255,255,255,.6);
  flex-shrink: 0;
  transition: transform .2s cubic-bezier(.34,1.56,.64,1), background .2s;
}
.ibadah-item.checked .ibadah-icon {
  background: linear-gradient(135deg, rgba(32,160,80,.2), rgba(32,160,80,.1));
  transform: rotate(-5deg) scale(1.1);
}
.ibadah-badge {
  transition: transform .2s, background .2s;
}
.ibadah-item:hover .ibadah-badge {
  transform: scale(1.08);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   BADGE / ACHIEVEMENT ‚Äî unlock glow
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.badge-item {
  transition: transform .25s cubic-bezier(.34,1.56,.64,1), box-shadow .25s;
  position: relative;
  overflow: visible; /* badge-new bisa keluar kotak */
}
.badge-item:hover { transform: translateY(-4px) scale(1.03); }
.badge-item.unlocked:hover { box-shadow: 0 8px 28px rgba(200,151,58,.3) !important; }
/* Shimmer dikurung di ::before dengan clip-path */
.badge-item.unlocked::after {
  content: '';
  position: absolute;
  inset: 0;
  border-radius: inherit;
  background: linear-gradient(105deg, transparent 30%, rgba(255,255,255,.22) 50%, transparent 70%);
  background-size: 250% 100%;
  animation: badgeShimmer 3.5s ease-in-out infinite;
  pointer-events: none;
  border-radius: 14px;
  overflow: hidden;
  /* clip to badge shape */
  clip-path: inset(0 round 14px);
}
@keyframes badgeShimmer {
  0%   { background-position: -100% 0; opacity:0; }
  15%  { opacity:1; }
  55%  { background-position: 200% 0; opacity:1; }
  56%  { opacity:0; }
  100% { background-position: 200% 0; opacity:0; }
}
.badge-icon {
  transition: transform .3s cubic-bezier(.34,1.56,.64,1), filter .3s;
}
.badge-item.unlocked .badge-icon {
  filter: drop-shadow(0 2px 8px rgba(200,151,58,.4));
}
.badge-item.unlocked:hover .badge-icon {
  transform: scale(1.2) rotate(8deg);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SEDEKAH ‚Äî log items
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.sedekah-log-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
  padding: 10px 14px;
  background: linear-gradient(135deg, rgba(26,107,107,.07), rgba(26,107,107,.03));
  border: 1px solid rgba(26,107,107,.18);
  border-radius: 12px;
  margin-top: 8px;
  font-size: 13px;
  animation: slideInRight .25s ease;
  transition: background .2s, transform .2s;
}
.sedekah-log-item:hover {
  background: linear-gradient(135deg, rgba(26,107,107,.12), rgba(26,107,107,.06));
  transform: translateX(2px);
}
.sedekah-log-desc {
  font-weight: 700;
  color: var(--text);
  flex: 1;
}
.sedekah-log-amt {
  font-weight: 900;
  color: var(--teal);
  white-space: nowrap;
  font-family: 'Amiri', serif;
  font-size: 14px;
}
.sedekah-log-del {
  width: 26px; height: 26px;
  border-radius: 8px;
  border: none;
  background: rgba(220,50,50,.1);
  color: rgba(220,50,50,.7);
  font-size: 14px;
  cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  transition: background .2s, transform .15s;
  flex-shrink: 0;
}
.sedekah-log-del:hover {
  background: rgba(220,50,50,.2);
  transform: scale(1.1);
}
.sedekah-total {
  background: linear-gradient(135deg, rgba(26,107,107,.12), rgba(26,107,107,.05));
  border: 1.5px solid rgba(26,107,107,.25);
  border-radius: 14px;
  padding: 12px 16px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-top: 12px;
}
.sedekah-total-num {
  font-family: 'Amiri', serif;
  font-size: 1.3rem;
  font-weight: 700;
  color: var(--teal);
}
@keyframes slideInRight {
  from { opacity: 0; transform: translateX(-12px); }
  to   { opacity: 1; transform: translateX(0); }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   ZAKAT FITRAH ‚Äî result display
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.zakat-result-card {
  background: linear-gradient(135deg, rgba(200,151,58,.15), rgba(200,151,58,.06));
  border: 2px solid rgba(200,151,58,.35);
  border-radius: 18px;
  padding: 20px;
  text-align: center;
  animation: fadeUp .4s ease;
  position: relative;
  overflow: hidden;
}
.zakat-result-card::before {
  content: 'üåô';
  position: absolute;
  font-size: 80px;
  opacity: .05;
  right: -10px; bottom: -15px;
  line-height: 1;
}
.zakat-result-num {
  font-family: 'Amiri', serif;
  font-size: 2rem;
  font-weight: 700;
  color: var(--gold);
  text-shadow: 0 0 20px rgba(200,151,58,.3);
  line-height: 1.2;
}
.zakat-result-label {
  font-size: 11px;
  font-weight: 800;
  color: var(--text-muted);
  letter-spacing: .5px;
  margin-bottom: 4px;
}
.zakat-step-card {
  background: var(--cream);
  border-radius: 16px;
  padding: 16px;
  border: 1.5px solid var(--cream-dark);
  transition: border-color .2s, box-shadow .2s;
}
.zakat-step-card:focus-within {
  border-color: rgba(200,151,58,.4);
  box-shadow: 0 0 0 3px rgba(200,151,58,.1);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   STATISTIK ‚Äî chart container
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.chart-wrap {
  border-radius: 16px;
  background: linear-gradient(135deg, rgba(255,255,255,.04), rgba(255,255,255,.01));
  border: 1px solid rgba(255,255,255,.06);
  padding: 12px 4px 4px;
  margin: 12px 0;
  position: relative;
  overflow: hidden;
}
.stat-tab {
  transition: background .2s, color .2s, transform .2s cubic-bezier(.34,1.56,.64,1);
}
.stat-tab:hover {
  transform: translateY(-1px);
}
.stat-tab.active {
  animation: tabPop .25s cubic-bezier(.34,1.56,.64,1);
}
@keyframes tabPop {
  0%  { transform: scale(.95); }
  60% { transform: scale(1.04); }
  100%{ transform: scale(1); }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   STREAK GRID ‚Äî day cells
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.streak-day {
  transition: transform .15s cubic-bezier(.34,1.56,.64,1), box-shadow .15s;
  cursor: default;
}
.streak-day:hover {
  transform: scale(1.3);
  box-shadow: 0 4px 12px rgba(0,0,0,.2);
  z-index: 2;
  position: relative;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   QURAN PROGRESS ‚Äî ring pulse
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.quran-ring {
  transition: transform .2s ease;
}
.quran-ring:hover {
  transform: scale(1.05);
}
.quran-fill {
  transition: width .6s cubic-bezier(.65,0,.35,1);
}
.quran-ring-fill {
  transition: stroke-dashoffset .8s cubic-bezier(.65,0,.35,1);
}
.quran-num-input {
  transition: border-color .2s, box-shadow .2s;
}
.quran-num-input:focus {
  border-color: var(--teal) !important;
  box-shadow: 0 0 0 3px rgba(26,107,107,.15);
  outline: none;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   NIAT CARD ‚Äî glow on confirm
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.niat-card {
  transition: box-shadow .4s ease, border-color .4s;
  position: relative;
  overflow: hidden;
}
.niat-card.confirmed {
  border-color: rgba(26,107,107,.5) !important;
  box-shadow: 0 0 30px rgba(26,107,107,.2), 0 4px 20px rgba(0,0,0,.1);
}
.niat-confirm-btn {
  transition: transform .2s cubic-bezier(.34,1.56,.64,1),
              background .25s, box-shadow .25s;
  position: relative;
  overflow: hidden;
}
.niat-confirm-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 24px rgba(26,107,107,.3);
}
.niat-confirm-btn:active {
  transform: scale(.96);
}
/* Ripple effect on niat btn */
.niat-confirm-btn::after {
  content: '';
  position: absolute;
  inset: 0;
  background: radial-gradient(circle, rgba(255,255,255,.25) 0%, transparent 70%);
  opacity: 0;
  transition: opacity .4s;
}
.niat-confirm-btn:active::after {
  opacity: 1;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   TARGET PRIBADI ‚Äî checkbox pop
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.target-item {
  transition: opacity .2s;
  animation: fadeSlideIn .3s ease both;
}
.target-checkbox:checked + .target-label {
  text-decoration: line-through;
  opacity: .5;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   MENU MAKANAN ‚Äî tab polish
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.menu-tab {
  transition: background .2s, color .2s, transform .15s cubic-bezier(.34,1.56,.64,1) !important;
}
.menu-tab:hover {
  transform: translateY(-2px);
}
.menu-tab.active {
  box-shadow: 0 4px 14px rgba(200,151,58,.25);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   DOA HARIAN ‚Äî card hover
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.doa-card {
  transition: transform .2s ease, box-shadow .2s;
}
.doa-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 24px rgba(26,107,107,.15);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   REKAP AKHIR ‚Äî item reveal
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.rekap-akhir-grid > * {
  animation: fadeUp .4s ease both;
}
.rekap-akhir-grid > *:nth-child(1) { animation-delay: .05s; }
.rekap-akhir-grid > *:nth-child(2) { animation-delay: .1s; }
.rekap-akhir-grid > *:nth-child(3) { animation-delay: .15s; }
.rekap-akhir-grid > *:nth-child(4) { animation-delay: .2s; }

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SYUKUR / CATATAN ‚Äî textarea glow
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.syukur-input, .notes-area {
  transition: border-color .25s, box-shadow .25s;
}
.syukur-input:focus, .notes-area:focus {
  border-color: rgba(200,151,58,.5) !important;
  box-shadow: 0 0 0 3px rgba(200,151,58,.1);
  outline: none;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SAVE BAR ‚Äî pulse when unsaved
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.save-bar.unsaved {
  animation: savePulse 2s ease-in-out infinite;
}
@keyframes savePulse {
  0%, 100% { box-shadow: none; }
  50% { box-shadow: 0 -4px 20px rgba(200,151,58,.2); }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   DARK MODE ‚Äî extra depth
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
body.dark-mode .jadwal-card-sahur {
  box-shadow: 0 8px 32px rgba(0,0,0,.5), 0 0 60px rgba(200,151,58,.1) inset !important;
}
body.dark-mode .ibadah-item {
  box-shadow: 0 2px 10px rgba(0,0,0,.3);
}
body.dark-mode .dzikir-item {
  border-color: rgba(255,255,255,.08) !important;
}
body.dark-mode .sedekah-log-item {
  background: linear-gradient(135deg, rgba(26,107,107,.12), rgba(26,107,107,.05));
  border-color: rgba(26,107,107,.25);
}
body.dark-mode .zakat-step-card {
  background: rgba(255,255,255,.04);
  border-color: rgba(255,255,255,.08);
}


/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   VISUAL UPGRADE PACK v2 ‚Äî Rich, Textured, Expressive
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

/* ‚îÄ‚îÄ FIX: badge-new perlu overflow visible di parent ‚îÄ‚îÄ */
/* badge-new visible ‚Äî sudah diset di atas */
.badge-new {
  position: absolute !important;
  top: -8px !important; right: -8px !important;
  background: linear-gradient(135deg, #FF6B35, #FF4500) !important;
  color: white !important;
  font-size: 8px !important;
  font-weight: 900 !important;
  padding: 3px 7px !important;
  border-radius: 20px !important;
  letter-spacing: .5px !important;
  box-shadow: 0 2px 8px rgba(255,80,0,.5) !important;
  z-index: 10 !important;
  animation: newBadgePulse 1.2s ease-in-out infinite !important;
  border: 1.5px solid rgba(255,255,255,.4) !important;
}
@keyframes newBadgePulse {
  0%,100% { transform: scale(1) rotate(-3deg); box-shadow: 0 2px 8px rgba(255,80,0,.5); }
  50%     { transform: scale(1.15) rotate(3deg); box-shadow: 0 4px 16px rgba(255,80,0,.7); }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   HEADER ‚Äî starfield + depth
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
header {
  background: linear-gradient(160deg, #020D1F 0%, #061830 40%, #0A2240 70%, #051020 100%) !important;
  border-radius: 0 0 32px 32px !important;
  padding: 32px 24px 28px !important;
  position: relative !important;
  overflow: hidden !important;
  border-bottom: none !important;
  box-shadow: 0 8px 40px rgba(0,0,0,.5), 0 1px 0 rgba(200,151,58,.3) !important;
}
header::before {
  content: '';
  position: absolute; inset: 0;
  background: 
    radial-gradient(ellipse 60% 50% at 20% 0%, rgba(200,151,58,.12) 0%, transparent 60%),
    radial-gradient(ellipse 40% 60% at 80% 100%, rgba(26,107,107,.15) 0%, transparent 60%),
    radial-gradient(ellipse 30% 40% at 50% 50%, rgba(255,255,255,.02) 0%, transparent 70%);
  pointer-events: none;
}
header::after {
  content: '';
  position: absolute;
  bottom: 0; left: 0; right: 0;
  height: 1px;
  background: linear-gradient(90deg, transparent, rgba(200,151,58,.5), transparent);
}
header h1 {
  font-size: 1.9rem !important;
  letter-spacing: 1px !important;
  text-shadow: 0 2px 20px rgba(200,151,58,.4) !important;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SECTION CARDS ‚Äî glassmorphism depth
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.section-card {
  background: linear-gradient(160deg, rgba(255,255,255,.97) 0%, rgba(252,250,245,.97) 100%) !important;
  border: 1px solid rgba(200,151,58,.12) !important;
  box-shadow: 0 2px 16px rgba(0,0,0,.06), 0 1px 0 rgba(255,255,255,.9) inset !important;
  position: relative;
  overflow: hidden;
}
.section-card::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 3px;
  background: linear-gradient(90deg, transparent, rgba(200,151,58,.3), transparent);
  border-radius: 20px 20px 0 0;
}
/* Alternating accent lines */
.section-card:nth-child(odd)::before  { background: linear-gradient(90deg, transparent, rgba(200,151,58,.25), transparent); }
.section-card:nth-child(even)::before { background: linear-gradient(90deg, transparent, rgba(26,107,107,.2), transparent); }
.section-card:hover {
  border-color: rgba(200,151,58,.22) !important;
  box-shadow: 0 8px 32px rgba(0,0,0,.1), 0 1px 0 rgba(255,255,255,.9) inset !important;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SECTION ICONS ‚Äî colored gradients
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.icon-gold   { background: linear-gradient(135deg, #FDF0C8, #FAE090) !important; box-shadow: 0 3px 10px rgba(200,151,58,.25); }
.icon-teal   { background: linear-gradient(135deg, #D6F2F2, #A8E0E0) !important; box-shadow: 0 3px 10px rgba(26,107,107,.2); }
.icon-rose   { background: linear-gradient(135deg, #FDEEF0, #FACCCC) !important; box-shadow: 0 3px 10px rgba(220,80,80,.15); }
.icon-sky    { background: linear-gradient(135deg, #E8F3FF, #C8DCFF) !important; box-shadow: 0 3px 10px rgba(80,120,220,.15); }
.icon-green  { background: linear-gradient(135deg, #E8F8EE, #C0EAD0) !important; box-shadow: 0 3px 10px rgba(40,160,80,.15); }
.icon-purple { background: linear-gradient(135deg, #F2EEFF, #DDD0FF) !important; box-shadow: 0 3px 10px rgba(100,80,200,.15); }

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   JADWAL CARDS ‚Äî richer dark cards
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.jadwal-card-sahur {
  background: linear-gradient(145deg, #0D1B35, #1A2A50, #0A1525) !important;
  border: 1.5px solid rgba(200,151,58,.5) !important;
  box-shadow: 0 8px 32px rgba(0,0,0,.4), 0 0 0 1px rgba(200,151,58,.1) inset,
              0 -1px 0 rgba(200,151,58,.3) inset !important;
}
.jadwal-card-buka {
  background: linear-gradient(145deg, #051828, #0D2E40, #052030) !important;
  border: 1.5px solid rgba(46,158,158,.5) !important;
  box-shadow: 0 8px 32px rgba(0,0,0,.4), 0 0 0 1px rgba(46,158,158,.1) inset,
              0 -1px 0 rgba(46,158,158,.3) inset !important;
}
.jadwal-card-label {
  font-size: 10px !important;
  letter-spacing: 1.2px !important;
  text-transform: uppercase !important;
  opacity: .7 !important;
  font-weight: 900 !important;
}
.jadwal-card-note {
  font-size: 10px !important;
  opacity: .55 !important;
  margin-top: 6px !important;
  letter-spacing: .3px !important;
}
.jadwal-maghrib-row {
  margin-top: 10px !important;
  padding: 7px 10px !important;
  background: rgba(255,255,255,.06) !important;
  border-radius: 10px !important;
  border: 1px solid rgba(255,255,255,.08) !important;
}

/* Countdown ‚Äî gradient box */
.countdown-wrap {
  background: linear-gradient(135deg, #0A1A30, #102040) !important;
  border: 1.5px solid rgba(200,151,58,.3) !important;
  border-radius: 18px !important;
  padding: 16px 20px !important;
  box-shadow: 0 4px 20px rgba(0,0,0,.2), 0 0 40px rgba(200,151,58,.06) inset !important;
  position: relative !important;
  overflow: hidden !important;
}
.countdown-wrap::after {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(135deg, rgba(200,151,58,.04) 0%, transparent 60%);
  pointer-events: none;
}
.countdown-time {
  font-size: 2.2rem !important;
  font-weight: 900 !important;
  letter-spacing: 3px !important;
  color: white !important;
  text-shadow: 0 0 30px rgba(200,151,58,.5) !important;
  font-family: 'Amiri', serif !important;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   MOOD TRACKER ‚Äî pill cards, vivid colors
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.mood-btn {
  border-radius: 18px !important;
  border: 2px solid transparent !important;
  background: linear-gradient(white, white) padding-box,
              linear-gradient(135deg, rgba(200,151,58,.2), rgba(26,107,107,.2)) border-box !important;
  box-shadow: 0 2px 8px rgba(0,0,0,.06) !important;
  padding: 12px 4px !important;
}
.mood-btn:hover {
  background: linear-gradient(#FDF8EE, #FDF0D0) padding-box,
              linear-gradient(135deg, rgba(200,151,58,.5), rgba(200,151,58,.3)) border-box !important;
  box-shadow: 0 6px 20px rgba(200,151,58,.2) !important;
}
.mood-btn.selected {
  background: linear-gradient(135deg, #FDF0C8, #FAE8A0) !important;
  border-color: rgba(200,151,58,.6) !important;
  box-shadow: 0 4px 16px rgba(200,151,58,.3) !important;
}
.mood-text { font-size: 9px !important; font-weight: 900 !important; color: var(--text) !important; }
#moodMessage {
  padding: 12px 16px !important;
  background: linear-gradient(135deg, rgba(200,151,58,.1), rgba(200,151,58,.04)) !important;
  border-radius: 14px !important;
  border-left: 3px solid var(--gold) !important;
  font-size: 13px !important;
  font-weight: 700 !important;
  margin-top: 12px !important;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   IBADAH TRACKER ‚Äî polished list
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.ibadah-item {
  background: linear-gradient(135deg, #FAFAF8, #F5F3EE) !important;
  border: 1.5px solid rgba(200,151,58,.1) !important;
  box-shadow: 0 2px 8px rgba(0,0,0,.05), 0 1px 0 rgba(255,255,255,.9) inset !important;
  border-radius: 16px !important;
  padding: 13px 16px !important;
}
.ibadah-item.checked-state {
  background: linear-gradient(135deg, #F0FAF2, #E4F7E8) !important;
  border-color: rgba(32,160,80,.3) !important;
  box-shadow: 0 3px 12px rgba(32,160,80,.15) !important;
}
.ibadah-check {
  width: 28px; height: 28px;
  border-radius: 8px;
  border: 2px solid var(--cream-dark);
  display: flex; align-items: center; justify-content: center;
  font-size: 14px; font-weight: 900;
  transition: all .2s cubic-bezier(.34,1.56,.64,1);
  flex-shrink: 0;
  background: white;
}
.ibadah-item.checked-state .ibadah-check {
  background: linear-gradient(135deg, #32A064, #20C070) !important;
  border-color: transparent !important;
  color: white !important;
  box-shadow: 0 3px 10px rgba(32,160,80,.3) !important;
}
.ibadah-icon {
  background: white !important;
  box-shadow: 0 2px 6px rgba(0,0,0,.08) !important;
}
.ibadah-item.checked-state .ibadah-icon {
  background: linear-gradient(135deg, rgba(32,160,80,.15), rgba(32,160,80,.08)) !important;
}
.ibadah-label { font-size: 13px !important; font-weight: 800 !important; }
.ibadah-sublabel { font-size: 11px !important; color: var(--text-muted) !important; }
.ibadah-badge {
  font-size: 10px !important;
  padding: 3px 9px !important;
  border-radius: 20px !important;
  font-weight: 900 !important;
  letter-spacing: .3px !important;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   STREAK GRID ‚Äî depth dan warna
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.streak-grid { gap: 6px !important; }
.streak-day {
  border-radius: 8px !important;
  font-size: 9px !important;
  box-shadow: 0 1px 3px rgba(0,0,0,.08) !important;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   DZIKIR ‚Äî card richer
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.dzikir-item {
  background: linear-gradient(160deg, #FDFCF8, #F8F5EE) !important;
  border: 1.5px solid rgba(200,151,58,.12) !important;
  box-shadow: 0 2px 10px rgba(0,0,0,.06), 0 1px 0 rgba(255,255,255,.9) inset !important;
}
.dzikir-item.done {
  background: linear-gradient(160deg, #F0FAF4, #E0F5E8) !important;
  border-color: rgba(32,160,80,.3) !important;
  box-shadow: 0 4px 16px rgba(32,160,80,.15) !important;
}
.dzikir-name {
  font-size: 13px !important;
  font-weight: 900 !important;
  color: var(--text) !important;
}
.dzikir-count-wrap {
  background: rgba(255,255,255,.8) !important;
  border-radius: 12px !important;
  padding: 6px !important;
  box-shadow: 0 1px 4px rgba(0,0,0,.07) !important;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   QURAN PROGRESS ‚Äî premium cards
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.quran-card {
  box-shadow: 0 2px 12px rgba(26,107,107,.1), 0 1px 0 rgba(255,255,255,.7) inset !important;
}
.quran-card-title { font-weight: 900 !important; }
.quran-ring-pct {
  font-size: 1.1rem !important;
  font-weight: 900 !important;
  font-family: 'Amiri', serif !important;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   BADGE GRID ‚Äî richer unlocked state
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.badge-item {
  border: 1.5px solid rgba(0,0,0,.06) !important;
  box-shadow: 0 2px 8px rgba(0,0,0,.06), 0 1px 0 rgba(255,255,255,.9) inset !important;
}
.badge-item.unlocked {
  background: linear-gradient(160deg, #FFFDF5, #FFF8E0, #FDF3C8) !important;
  border-color: rgba(200,151,58,.45) !important;
  box-shadow: 0 4px 20px rgba(200,151,58,.2), 0 1px 0 rgba(255,255,255,.9) inset !important;
}
.badge-icon { font-size: 2rem !important; }
.badge-name {
  font-size: 11px !important;
  font-weight: 900 !important;
  color: var(--text) !important;
  line-height: 1.2 !important;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   AMAL SECTION ‚Äî vivid active state
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.amal-card {
  background: linear-gradient(160deg, #FAFAF8, #F5F3EE) !important;
  border: 1.5px solid rgba(0,0,0,.06) !important;
  box-shadow: 0 2px 8px rgba(0,0,0,.05) !important;
  transition: all .2s cubic-bezier(.34,1.56,.64,1) !important;
}
.amal-card:hover {
  transform: translateY(-3px) scale(1.02) !important;
  box-shadow: 0 8px 20px rgba(0,0,0,.1) !important;
}
.amal-card.active {
  background: linear-gradient(160deg, #FDF8EE, #FAF0CC) !important;
  border-color: rgba(200,151,58,.4) !important;
  box-shadow: 0 4px 16px rgba(200,151,58,.2) !important;
}
.amal-count {
  font-family: 'Amiri', serif !important;
  font-size: 1.4rem !important;
  font-weight: 700 !important;
  color: var(--teal) !important;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SEDEKAH ‚Äî polished input + total
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.sedekah-input {
  background: linear-gradient(135deg, #FAFAF8, #F5F3EE) !important;
  border: 1.5px solid rgba(200,151,58,.2) !important;
  transition: border-color .2s, box-shadow .2s !important;
}
.sedekah-input:focus {
  border-color: var(--teal) !important;
  box-shadow: 0 0 0 3px rgba(26,107,107,.1) !important;
  outline: none !important;
}
.sedekah-add {
  background: linear-gradient(135deg, var(--teal), var(--teal-dark)) !important;
  color: white !important;
  border: none !important;
  font-weight: 900 !important;
  box-shadow: 0 3px 12px rgba(26,107,107,.3) !important;
  transition: transform .15s, box-shadow .15s !important;
}
.sedekah-add:hover {
  transform: translateY(-2px) !important;
  box-shadow: 0 6px 20px rgba(26,107,107,.35) !important;
}
.sedekah-add:active { transform: scale(.96) !important; }

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   MENU MAKANAN ‚Äî pill tags
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.menu-tag {
  background: linear-gradient(135deg, #FDF8EE, #FAF0D0) !important;
  border-color: rgba(200,151,58,.3) !important;
  font-weight: 700 !important;
  box-shadow: 0 1px 4px rgba(200,151,58,.1) !important;
  transition: transform .15s, box-shadow .15s !important;
}
.menu-tag:hover { transform: scale(1.04); box-shadow: 0 3px 10px rgba(200,151,58,.2) !important; }
.menu-tab.active {
  background: linear-gradient(135deg, var(--gold), var(--gold-light)) !important;
  color: #020A14 !important;
  border-color: transparent !important;
  box-shadow: 0 3px 12px rgba(200,151,58,.3) !important;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   TARGET PRIBADI ‚Äî cleaner rows
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.target-item {
  background: linear-gradient(135deg, #FAFAF8, #F5F3EE);
  border-radius: 12px;
  padding: 8px 10px;
  border: 1.5px solid rgba(0,0,0,.05);
}
.target-input {
  background: transparent !important;
  border-color: rgba(200,151,58,.2) !important;
}
.target-input:focus {
  border-color: var(--gold) !important;
  box-shadow: 0 0 0 3px rgba(200,151,58,.1) !important;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   DOA HARIAN ‚Äî gradient cards
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.doa-card {
  background: linear-gradient(160deg, rgba(26,107,107,.08), rgba(26,107,107,.02)) !important;
  border-color: rgba(26,107,107,.2) !important;
  box-shadow: 0 2px 10px rgba(26,107,107,.08) !important;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   STATISTIK ‚Äî tabs dan chart
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.stat-tab {
  background: linear-gradient(135deg, #F5F3EE, #EEEAE0) !important;
  border-color: rgba(200,151,58,.15) !important;
}
.stat-tab.active {
  background: linear-gradient(135deg, var(--gold), var(--gold-light)) !important;
  color: #020A14 !important;
  border-color: transparent !important;
  box-shadow: 0 3px 12px rgba(200,151,58,.3) !important;
}
.chart-wrap {
  background: linear-gradient(160deg, #F5F0E6, #EDE6D4) !important;
  border: 1.5px solid rgba(200,151,58,.25) !important;
  box-shadow: inset 0 1px 0 rgba(255,255,255,.8), 0 2px 12px rgba(0,0,0,.08) !important;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   NIAT ‚Äî glowing confirm button
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.niat-confirm-btn.confirmed {
  background: linear-gradient(135deg, #1A6B6B, #0E5050) !important;
  box-shadow: 0 4px 20px rgba(26,107,107,.4) !important;
}
.niat-confirm-btn.unconfirmed {
  background: linear-gradient(135deg, #F5F2E8, #EDE8D8) !important;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   ZAKAT ‚Äî premium result
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.zakat-result-card {
  background: linear-gradient(160deg, rgba(26,107,107,.12), rgba(26,107,107,.04)) !important;
  border: 2px solid rgba(26,107,107,.35) !important;
  box-shadow: 0 4px 24px rgba(26,107,107,.12) !important;
}
.zakat-step-card {
  background: linear-gradient(160deg, #FAFAF8, #F5F2EE) !important;
  border-color: rgba(200,151,58,.15) !important;
  box-shadow: 0 2px 8px rgba(0,0,0,.04) !important;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SYUKUR & NOTES ‚Äî warm textured
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.syukur-input {
  background: linear-gradient(135deg, #FDFCF8, #F8F5EE) !important;
  border-color: rgba(200,151,58,.2) !important;
}
.notes-area {
  background: linear-gradient(160deg, #FDFCF8, #F8F5EE) !important;
  border-color: rgba(200,151,58,.2) !important;
  box-shadow: inset 0 2px 6px rgba(0,0,0,.04) !important;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SAVE BAR + QUOTE CARD ‚Äî polish
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.quote-card {
  border: 1px solid rgba(200,151,58,.25) !important;
  box-shadow: 0 4px 20px rgba(200,151,58,.08) !important;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   REKAP AKHIR ‚Äî stats grid
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.rekap-akhir-banner {
  background: linear-gradient(160deg, rgba(200,151,58,.2), rgba(200,151,58,.06)) !important;
  border: 2px solid rgba(200,151,58,.35) !important;
  box-shadow: 0 4px 20px rgba(200,151,58,.1) !important;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   DARK MODE ‚Äî semua override
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
body.dark-mode .section-card {
  background: linear-gradient(160deg, rgba(255,255,255,.05) 0%, rgba(255,255,255,.03) 100%) !important;
  border-color: rgba(255,255,255,.07) !important;
  box-shadow: 0 2px 20px rgba(0,0,0,.3), 0 1px 0 rgba(255,255,255,.05) inset !important;
}
body.dark-mode .section-card::before {
  opacity: .5;
}
body.dark-mode .ibadah-item {
  background: linear-gradient(135deg, rgba(255,255,255,.05), rgba(255,255,255,.03)) !important;
  border-color: rgba(255,255,255,.07) !important;
}
body.dark-mode .ibadah-item.checked-state {
  background: linear-gradient(135deg, rgba(32,160,80,.15), rgba(32,160,80,.08)) !important;
  border-color: rgba(32,160,80,.3) !important;
}
body.dark-mode .mood-btn {
  background: rgba(255,255,255,.06) !important;
  border-color: rgba(255,255,255,.1) !important;
}
body.dark-mode .mood-btn.selected {
  background: linear-gradient(135deg, rgba(200,151,58,.25), rgba(200,151,58,.15)) !important;
  border-color: rgba(200,151,58,.5) !important;
}
body.dark-mode .dzikir-item {
  background: linear-gradient(160deg, rgba(255,255,255,.06), rgba(255,255,255,.03)) !important;
  border-color: rgba(255,255,255,.08) !important;
}
body.dark-mode .amal-card {
  background: linear-gradient(160deg, rgba(255,255,255,.06), rgba(255,255,255,.03)) !important;
  border-color: rgba(255,255,255,.07) !important;
}
body.dark-mode .amal-card.active {
  background: linear-gradient(160deg, rgba(200,151,58,.2), rgba(200,151,58,.1)) !important;
  border-color: rgba(200,151,58,.4) !important;
}
body.dark-mode .badge-item {
  background: linear-gradient(160deg, rgba(255,255,255,.05), rgba(255,255,255,.03)) !important;
  border-color: rgba(255,255,255,.08) !important;
}
body.dark-mode .badge-item.unlocked {
  background: linear-gradient(160deg, rgba(200,151,58,.18), rgba(200,151,58,.08)) !important;
  border-color: rgba(200,151,58,.4) !important;
}
body.dark-mode .chart-wrap {
  background: linear-gradient(160deg, #0A1828, #071220) !important;
  border-color: rgba(200,151,58,.25) !important;
  box-shadow: none !important;
}
body.dark-mode .target-item {
  background: rgba(255,255,255,.04) !important;
  border-color: rgba(255,255,255,.07) !important;
}
body.dark-mode .zakat-step-card {
  background: rgba(255,255,255,.04) !important;
  border-color: rgba(255,255,255,.07) !important;
}
body.dark-mode .syukur-input,
body.dark-mode .notes-area {
  background: rgba(255,255,255,.05) !important;
}
body.dark-mode .sedekah-input {
  background: rgba(255,255,255,.05) !important;
}
body.dark-mode .niat-confirm-btn.unconfirmed {
  background: linear-gradient(135deg, rgba(255,255,255,.07), rgba(255,255,255,.04)) !important;
  color: var(--text) !important;
}


/* ‚îÄ‚îÄ Share card compact untuk HP kecil ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
@media (max-height: 700px) {
  .share-card-icon { font-size: 28px !important; margin-bottom: 4px !important; }
  .share-card-header { margin-bottom: 10px !important; }
  .share-card-divider { margin: 8px 0 !important; }
  .share-card-stats { gap: 6px !important; margin-bottom: 8px !important; }
  .share-stat { padding: 8px 6px !important; }
  .share-stat-icon { font-size: 16px !important; margin-bottom: 2px !important; }
  .share-card-streak { padding: 8px 12px !important; margin-bottom: 6px !important; }
  .share-card-quote { font-size: 10px !important; margin-top: 8px !important; padding-top: 8px !important; }
  .share-card-footer { margin-top: 8px !important; }
}

/* ‚îÄ‚îÄ Share action buttons compact ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
.share-action-btn {
  padding: 10px 12px !important;
  font-size: 12px !important;
}

/* ‚îÄ‚îÄ Share modal - pastikan bisa scroll di semua HP ‚îÄ‚îÄ */
#shareModal {
  overscroll-behavior: contain;
}

/* ‚îÄ‚îÄ Name input compact ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
#shareModal [style*="margin-top:14px"] {
  margin-top: 10px !important;
}

</style>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ONBOARDING ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="onboardingModal" style="display:none">
  <div class="onboarding-box">
    <div style="text-align:center;margin-bottom:20px">
      <div style="font-size:48px">üåô</div>
      <div style="font-family:'Amiri',serif;font-size:22px;color:var(--gold-light);margin:8px 0 4px">Selamat Datang!</div>
      <div style="font-size:12px;color:rgba(255,255,255,.5)">Ramadan Planner 1447H ¬∑ Made by Andi Maulana Yusuf</div>
    </div>
    <div class="onboarding-step active" id="obStep1">
      <div style="background:rgba(200,151,58,.1);border:1px solid rgba(200,151,58,.25);border-radius:16px;padding:18px;text-align:center">
        <div style="font-size:36px;margin-bottom:10px">üìÖ</div>
        <div style="font-size:15px;font-weight:900;color:white;margin-bottom:8px">Langkah 1 ‚Äî Pilih Hari</div>
        <div style="font-size:13px;color:rgba(255,255,255,.7);line-height:1.7">Gunakan <strong style="color:var(--gold-light)">scroll hari di atas</strong> untuk berpindah ke hari mana saja. Klik <strong style="color:var(--gold-light)">üìÖ Hari Ini</strong> untuk langsung ke hari yang sedang berjalan.</div>
      </div>
    </div>
    <div class="onboarding-step" id="obStep2">
      <div style="background:rgba(26,107,107,.1);border:1px solid rgba(26,107,107,.25);border-radius:16px;padding:18px;text-align:center">
        <div style="font-size:36px;margin-bottom:10px">üïå</div>
        <div style="font-size:15px;font-weight:900;color:white;margin-bottom:8px">Langkah 2 ‚Äî Catat Ibadah</div>
        <div style="font-size:13px;color:rgba(255,255,255,.7);line-height:1.7">Ketuk nama ibadah di <strong style="color:#4ECDC4">Tracker Ibadah</strong> untuk menandai ‚úÖ sudah dikerjakan. Makin banyak terisi, makin tinggi streak-mu üî•</div>
      </div>
    </div>
    <div class="onboarding-step" id="obStep3">
      <div style="background:rgba(100,200,100,.08);border:1px solid rgba(100,200,100,.2);border-radius:16px;padding:18px;text-align:center">
        <div style="font-size:36px;margin-bottom:10px">üíæ</div>
        <div style="font-size:15px;font-weight:900;color:white;margin-bottom:8px">Langkah 3 ‚Äî Backup Data</div>
        <div style="font-size:13px;color:rgba(255,255,255,.7);line-height:1.7">Data tersimpan <strong style="color:#90EE90">otomatis di browser ini</strong>. Tapi selalu klik <strong style="color:#90EE90">üíæ Export Backup</strong> seminggu sekali agar data tidak hilang jika browser dibersihkan.</div>
      </div>
    </div>
    <div class="onboarding-step" id="obStep4">
      <div style="background:rgba(200,60,200,.08);border:1px solid rgba(200,60,200,.2);border-radius:16px;padding:18px;text-align:center">
        <div style="font-size:36px;margin-bottom:10px">üéØ</div>
        <div style="font-size:15px;font-weight:900;color:white;margin-bottom:8px">Langkah 4 ‚Äî Set Target</div>
        <div style="font-size:13px;color:rgba(255,255,255,.7);line-height:1.7">Tentukan <strong style="color:#DDA0DD">target khatam Al-Qur'an</strong> dan isi catatan harian. Gunakan <strong style="color:#DDA0DD">üé¥ Share Ibadah</strong> untuk berbagi progress ke teman!</div>
      </div>
    </div>
    <div class="onboarding-dots">
      <div class="onboarding-dot active" id="obDot0"></div>
      <div class="onboarding-dot" id="obDot1"></div>
      <div class="onboarding-dot" id="obDot2"></div>
      <div class="onboarding-dot" id="obDot3"></div>
    </div>
    <div style="display:flex;gap:10px">
      <button id="obPrevBtn" onclick="obNav(-1)" style="flex:1;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,.2);background:rgba(255,255,255,.07);color:rgba(255,255,255,.7);font-family:'Nunito',sans-serif;font-size:13px;font-weight:800;cursor:pointer;display:none">‚Üê Kembali</button>
      <button id="obNextBtn" onclick="obNav(1)" style="flex:1;padding:12px;border-radius:12px;border:none;background:linear-gradient(135deg,var(--gold),var(--gold-light));color:#2A1F0E;font-family:'Nunito',sans-serif;font-size:13px;font-weight:900;cursor:pointer">Selanjutnya ‚Üí</button>
    </div>
    <div style="text-align:center;margin-top:10px">
      <button onclick="closeOnboarding()" style="background:transparent;border:none;color:rgba(255,255,255,.35);font-family:'Nunito',sans-serif;font-size:12px;cursor:pointer;text-decoration:underline">Lewati panduan ini</button>
    </div>
  </div>
</div>


<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SPLASH SCREEN ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="splashScreen">
  <!-- Stars -->
  <div class="splash-stars" id="splashStars"></div>

  <!-- Lanterns -->
  <div class="splash-lanterns">
    <div class="splash-lantern" style="margin-top:-5px">
      <div class="splash-lantern-string"></div>
      <div class="splash-lantern-body" style="background:#C0392B;color:#FF6B55">üèÆ</div>
    </div>
    <div class="splash-lantern" style="margin-top:10px">
      <div class="splash-lantern-string"></div>
      <div class="splash-lantern-body" style="background:#C8973A;color:#FFD080">üèÆ</div>
    </div>
    <div class="splash-lantern" style="margin-top:-8px">
      <div class="splash-lantern-string"></div>
      <div class="splash-lantern-body" style="background:#1A6B6B;color:#4ECDC4">üèÆ</div>
    </div>
  </div>

  <!-- Content -->
  <div class="splash-moon">üåô</div>
  <div class="splash-arabic">ÿ±ŸÖÿ∂ÿßŸÜ ŸÉÿ±ŸäŸÖ</div>
  <div class="splash-title">Ramadan Planner 1447H</div>
  <div class="splash-subtitle">Teman ibadahmu selama 30 hari penuh berkah</div>
  <div class="splash-author">Made by Andi Maulana Yusuf</div>

  <div class="splash-progress-wrap">
    <div class="splash-progress-bar">
      <div class="splash-progress-fill" id="splashFill"></div>
    </div>
    <div class="splash-loading-text" id="splashLoadingText">Memuat aplikasi...</div>
  </div>

  <button class="splash-skip" onclick="closeSplash()">Lewati ‚Üí</button>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PWA INSTALL BANNER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="pwaBanner">
  <div class="pwa-icon">üì≤</div>
  <div class="pwa-text">
    <div class="pwa-text-title">Pasang di Layar Utama</div>
    <div class="pwa-text-sub">Buka seperti aplikasi sungguhan, tanpa browser!</div>
  </div>
  <button class="pwa-install-btn" onclick="installPWA()">Pasang</button>
  <button class="pwa-close-btn" onclick="dismissPWA()">‚úï</button>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SHARE MODAL ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="shareModal" onclick="if(event.target===this)closeShareModal()">
  <div class="share-modal-box">
    <!-- The Card -->
    <div id="shareCard">
      <div class="share-card-bg">
        <div class="share-card-moon">üåô</div>
        <div id="shareCardStars"></div>
      </div>
      <div class="share-card-header">
        <span class="share-card-icon">üåô</span>
        <div class="share-card-title">Ramadan Planner 1447H</div>
        <div class="share-card-subtitle">ÿ±ŸÖÿ∂ÿßŸÜ ŸÉÿ±ŸäŸÖ</div>
        <div class="share-card-author" id="shareCardAuthor">‚ú¶ Andi Maulana Yusuf ‚ú¶</div>
      </div>
      <div class="share-card-divider"></div>
      <div class="share-card-stats" id="shareCardStats"></div>
      <div class="share-card-streak" id="shareCardStreak"></div>
      <div class="share-card-quote" id="shareCardQuote"></div>
      <div class="share-card-footer">
        <span class="share-card-tag">#Ramadan1447 #RamadanPlanner</span>
        <span class="share-card-days" id="shareCardDays">Hari 1</span>
      </div>
    </div>
    <!-- Name input -->
    <div style="margin-top:14px;display:flex;align-items:center;gap:8px;background:rgba(255,255,255,.06);border:1px solid rgba(200,151,58,.25);border-radius:12px;padding:8px 12px;">
      <span style="font-size:14px">‚úèÔ∏è</span>
      <input id="shareNameInput" type="text" placeholder="Nama kamu..." maxlength="40"
        style="flex:1;background:transparent;border:none;outline:none;color:white;font-family:'Nunito',sans-serif;font-size:13px;font-weight:700;"
        oninput="updateShareName()" />
    </div>
    <!-- Action buttons -->
    <div class="share-actions">
      <button class="share-action-btn sab-screenshot" onclick="downloadShareCard()">üì∏ Simpan Gambar</button>
      <button class="share-action-btn sab-wa" onclick="shareToWA()">üí¨ WhatsApp</button>
    </div>
    <div class="share-actions">
      <button class="share-action-btn sab-copy" onclick="copyShareText()">üìã Salin Teks</button>
      <button class="share-action-btn sab-close" onclick="closeShareModal()">‚úï Tutup</button>
    </div>
  </div>
</div>

<canvas id="bg-canvas"></canvas>
<div class="lanterns" id="lanternsContainer"></div>
<div class="particles" id="particlesContainer"></div>
<div class="mosque-silhouette">
  <svg viewBox="0 0 1440 120" preserveAspectRatio="none" width="100%" height="120" xmlns="http://www.w3.org/2000/svg">
    <path d="M0,120 L0,80 Q20,80 20,70 Q20,60 30,60 Q40,60 40,70 Q40,80 60,80 L60,60 Q70,60 70,50 Q70,40 80,40 Q90,40 90,50 Q90,60 100,60 L100,80 L110,80 Q120,80 130,60 Q135,45 140,30 Q145,15 150,10 Q155,5 160,10 Q165,15 170,30 Q175,45 180,60 Q190,80 200,80 L200,40 Q205,40 210,32 Q215,20 220,15 Q225,10 230,15 Q235,20 240,32 Q245,40 250,40 L250,80 L260,80 Q270,80 275,70 L280,60 L285,70 Q290,80 300,80 L300,50 Q305,50 310,42 Q315,30 320,24 Q325,18 330,24 Q335,30 340,42 Q345,50 350,50 L350,80 L400,80 L400,55 Q405,55 410,47 Q415,35 420,28 Q425,20 430,28 Q435,35 440,47 Q445,55 450,55 L450,80 L500,80 Q510,80 520,65 Q525,55 530,45 Q535,35 540,28 Q545,20 550,28 Q555,35 560,45 Q565,55 570,65 Q580,80 590,80 L600,80 L600,50 Q605,50 610,42 Q615,30 620,24 Q625,18 630,24 Q635,30 640,42 Q645,50 650,50 L650,80 L700,80 Q710,80 720,60 Q725,48 730,38 Q735,25 740,18 Q745,10 750,18 Q755,25 760,38 Q765,48 770,60 Q780,80 790,80 L800,80 L800,55 Q810,55 820,45 Q828,35 836,25 Q840,18 845,25 Q850,35 858,45 Q866,55 876,55 L876,80 L900,80 Q910,80 915,70 Q920,60 930,60 Q940,60 945,70 Q950,80 960,80 L960,50 Q968,50 975,38 Q980,28 985,20 Q990,12 995,20 Q1000,28 1005,38 Q1012,50 1020,50 L1020,80 L1060,80 Q1070,80 1080,65 Q1085,55 1090,45 Q1095,35 1100,28 Q1105,20 1110,28 Q1115,35 1120,45 Q1125,55 1130,65 Q1140,80 1150,80 L1150,50 Q1160,50 1168,40 Q1175,30 1180,22 Q1185,14 1190,22 Q1195,30 1202,40 Q1210,50 1220,50 L1220,80 L1250,80 Q1260,80 1265,70 L1270,60 L1275,70 Q1280,80 1290,80 L1290,50 Q1295,50 1300,42 Q1305,30 1310,24 Q1315,18 1320,24 Q1325,30 1330,42 Q1335,50 1340,50 L1340,80 L1440,80 L1440,120 Z" fill="rgba(2,8,18,0.92)"/>
    <text x="150" y="8" font-size="12" fill="rgba(200,151,58,.8)" text-anchor="middle">üåô</text>
    <text x="530" y="22" font-size="13" fill="rgba(200,151,58,.8)" text-anchor="middle">üåô</text>
    <text x="748" y="14" font-size="15" fill="rgba(230,180,90,.9)" text-anchor="middle">üåô</text>
    <text x="1100" y="22" font-size="13" fill="rgba(200,151,58,.8)" text-anchor="middle">üåô</text>
  </svg>
</div>

<div class="toast-wrap" id="toastWrap"></div>
<!-- DARK MODE TOGGLE -->
<button class="dark-toggle" id="darkToggle" onclick="toggleDarkMode()" title="Toggle Dark/Light Mode">üåô</button>
<div class="confirm-modal-overlay" id="confirmResetModal" style="display:none" onclick="if(event.target===this)closeConfirmReset()">
  <div class="confirm-modal-box">
    <span class="confirm-modal-icon">üóëÔ∏è</span>
    <div class="confirm-modal-title">Reset Data Hari Ini?</div>
    <div class="confirm-modal-msg" id="confirmResetMsg">Semua data hari ini akan dihapus.<br>Data hari lain tidak terpengaruh.</div>
    <div class="confirm-modal-btns">
      <button class="confirm-modal-cancel" onclick="closeConfirmReset()">Batal</button>
      <button class="confirm-modal-ok" onclick="doResetHari()">Ya, Reset!</button>
    </div>
  </div>
</div>
<button class="scroll-top-btn" id="scrollTopBtn" onclick="scrollToTop()" title="Kembali ke atas" aria-label="Scroll ke atas">&#8679;</button>

<!-- REMINDER MODAL -->


<!-- MILESTONE POP -->
<div class="milestone-pop" id="milestonePop">
  <div class="milestone-pop-icon" id="milestoneIcon">üî•</div>
  <div class="milestone-pop-title" id="milestoneTitle">Luar Biasa!</div>
  <div class="milestone-pop-msg" id="milestoneMsg">Streak kamu keren!</div>
</div>


<!-- IMPORT MODAL -->
<div class="modal-overlay hidden" id="importModal">
  <div class="modal-box">
    <div class="modal-title">üì• Import Data Backup</div>
    <div class="modal-sub">Paste kode backup kamu di bawah ini. Data saat ini akan <strong>digantikan</strong> dengan data dari backup.</div>
    <textarea class="modal-textarea" id="importTextarea" placeholder="Paste kode backup di sini..."></textarea>
    <div class="modal-btns">
      <button class="modal-btn modal-btn-secondary" onclick="closeModal()">Batal</button>
      <button class="modal-btn modal-btn-primary" onclick="doImport()">‚úÖ Import Sekarang</button>
    </div>
  </div>
</div>

<!-- RESET MODAL -->
<div class="modal-overlay hidden" id="resetModal">
  <div class="modal-box">
    <div class="modal-title">‚ö†Ô∏è Reset Semua Data?</div>
    <div class="modal-sub">Semua data Ramadan kamu dari hari 1 sampai 30 akan <strong>terhapus permanen</strong>. Pastikan sudah backup terlebih dahulu!</div>
    <div class="modal-btns">
      <button class="modal-btn modal-btn-secondary" onclick="closeModal()">Batal, Aman</button>
      <button class="modal-btn" style="background:#C05050;color:white" onclick="doReset()">üóëÔ∏è Ya, Reset Semua</button>
    </div>
  </div>
</div>

<header>
  <div class="moon-deco">üåô</div>
  <div class="star-deco">‚ú®</div>
  <div class="header-ornament">‚ú¶ Ramadan Mubarak 1447H ‚ú¶</div>
  <h1>Ramadan Planner</h1>
  <div class="arabic-title">ÿ±ŸÖÿ∂ÿßŸÜ ŸÉÿ±ŸäŸÖ</div>
  <div class="header-date" id="headerDate">Loading...</div>
  <div style="margin-top:14px;display:flex;flex-direction:column;align-items:center;gap:6px">
    <div style="display:flex;gap:14px;align-items:center;justify-content:center;flex-wrap:wrap">
    <div style="text-align:center"><div style="font-size:20px;font-weight:900;color:var(--gold);line-height:1" id="headerHariKe">1</div><div style="font-size:9px;font-weight:700;color:rgba(255,255,255,.45);letter-spacing:.6px;margin-top:2px">HARI KE</div></div>
    <div style="width:1px;height:26px;background:rgba(255,255,255,.15)"></div>
    <div style="text-align:center"><div style="font-size:12px;font-weight:800;color:rgba(255,255,255,.55)" id="headerProgressLabel">3%</div><div style="font-size:9px;font-weight:700;color:rgba(255,255,255,.35);letter-spacing:.5px;margin-top:2px">RAMADAN</div></div>
    <div style="width:1px;height:26px;background:rgba(255,255,255,.15)"></div>
    <div style="text-align:center"><div style="font-size:20px;font-weight:900;color:rgba(255,255,255,.7);line-height:1" id="headerSisaHari">29</div><div style="font-size:9px;font-weight:700;color:rgba(255,255,255,.35);letter-spacing:.5px;margin-top:2px">SISA HARI</div></div>
  </div>
    <div style="width:min(260px,70%);height:6px;background:rgba(255,255,255,.12);border-radius:99px;overflow:hidden">
      <div id="headerProgressBar" style="height:100%;border-radius:99px;background:linear-gradient(90deg,var(--gold),var(--gold-light));transition:width .6s ease;width:3%"></div>
    </div>
  </div>
</header>

<div class="save-bar">
  <div class="save-bar-left">
    <button class="save-btn btn-export" onclick="exportData(); showTooltip('export')" id="btnExport">üíæ Export Backup</button>
    <button class="save-btn btn-import" onclick="openImportModal(); showTooltip('import')" id="btnImport">üì• Import Data</button>
    <button class="save-btn btn-reset" onclick="openResetModal()" id="btnReset">üóëÔ∏è Reset</button>
    <button class="save-btn" onclick="openShareModal()" id="btnShare" style="background:linear-gradient(135deg,#C8973A,#E8BE6A);color:white;border-color:transparent;box-shadow:0 3px 12px rgba(200,151,58,.35)">üé¥ Share Ibadah</button>
    <button class="save-btn" onclick="openPdfModal()" style="background:rgba(200,100,60,.18);color:#FFB080;border:1.5px solid rgba(200,100,60,.4)">üìÑ PDF</button>
    <button class="save-btn" onclick="toggleTutorial()" id="tutorialBtn" style="background:rgba(255,255,255,.08);color:rgba(255,255,255,.8);border:1.5px solid rgba(255,255,255,.2)" id="btnPanduan">‚ùì Panduan</button>
  </div>
  <div class="save-status">
    <div class="save-dot"></div>
    <span id="saveStatus">Tersimpan otomatis</span>
  </div>
</div>

<!-- TUTORIAL PANEL -->
<div id="tutorialPanel" style="display:none;background:rgba(3,12,22,.98);border-bottom:2px solid rgba(200,151,58,.3);backdrop-filter:blur(20px);max-height:85vh;overflow-y:auto">
  <div style="max-width:860px;margin:0 auto;padding:20px 16px 28px">

    <!-- Header -->
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:18px">
      <div>
        <div style="font-size:16px;font-weight:900;color:var(--gold-light);display:flex;align-items:center;gap:8px">üìñ Panduan Lengkap Ramadan Planner</div>
        <div style="font-size:11px;color:rgba(255,255,255,.4);margin-top:3px">Baca panduan ini agar kamu bisa memaksimalkan semua fitur üåô</div>
      </div>
      <button onclick="toggleTutorial()" style="background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.15);color:rgba(255,255,255,.6);font-size:16px;cursor:pointer;padding:6px 12px;border-radius:10px">‚úï</button>
    </div>

    <!-- Tab navigasi panduan -->
    <div style="display:flex;gap:6px;flex-wrap:wrap;margin-bottom:18px" id="pandTab">
      <button onclick="showPand('mulai')" class="pand-tab pand-active" id="ptab-mulai">üöÄ Cara Mulai</button>
      <button onclick="showPand('ibadah')" class="pand-tab" id="ptab-ibadah">üïå Ibadah & Niat</button>
      <button onclick="showPand('haid')" class="pand-tab" id="ptab-haid">üå∏ Haid/Uzur</button>
      <button onclick="showPand('puasa')" class="pand-tab" id="ptab-puasa">üåô Status Puasa</button>
      <button onclick="showPand('qadha')" class="pand-tab" id="ptab-qadha">üìã Qadha</button>
      <button onclick="showPand('fitur')" class="pand-tab" id="ptab-fitur">‚ú® Fitur Lainnya</button>
      <button onclick="showPand('data')" class="pand-tab" id="ptab-data">üíæ Data & Backup</button>
    </div>

    <!-- KONTEN PANDUAN -->
    <div id="pand-mulai" class="pand-section">
      <div class="pand-hero">üåô Selamat datang di Ramadan Planner 1447H!</div>
      <div class="pand-desc">Aplikasi ini membantu kamu mencatat dan memantau ibadah selama 30 hari Ramadan. Berikut cara memulainya:</div>
      <div class="pand-steps">
        <div class="pand-step"><div class="pand-step-num">1</div><div><div class="pand-step-title">Pilih hari di bagian atas</div><div class="pand-step-desc">Geser kiri/kanan untuk berpindah hari. Klik tombol "üìÖ Hari Ini" untuk langsung ke hari yang sedang berlangsung.</div></div></div>
        <div class="pand-step"><div class="pand-step-num">2</div><div><div class="pand-step-title">Niatkan puasa setiap hari</div><div class="pand-step-desc">Buka bagian "ü§≤ Niat Puasa", baca niat, lalu tekan tombol "Tandai Sudah Berniat". Kamu juga bisa tulis doa/niat pribadi di kotak catatan.</div></div></div>
        <div class="pand-step"><div class="pand-step-num">3</div><div><div class="pand-step-title">Centang ibadah yang sudah selesai</div><div class="pand-step-desc">Ketuk nama ibadah (Subuh, Dzuhur, dll) ‚Äî warna akan berubah hijau ‚úÖ. Lakukan ini setiap selesai sholat.</div></div></div>
        <div class="pand-step"><div class="pand-step-num">4</div><div><div class="pand-step-title">Isi status puasa & minum air</div><div class="pand-step-desc">Tandai sedang puasa atau sudah berbuka. Catat juga berapa gelas air yang kamu minum ‚Äî target 8 gelas per hari.</div></div></div>
        <div class="pand-step"><div class="pand-step-num">5</div><div><div class="pand-step-title">Catat Al-Qur'an & sedekah</div><div class="pand-step-desc">Isi berapa juz/halaman yang sudah dibaca, dan catat setiap sedekah yang kamu keluarkan.</div></div></div>
        <div class="pand-step"><div class="pand-step-num">6</div><div><div class="pand-step-title">Backup data setiap minggu</div><div class="pand-step-desc">Tekan "üíæ Export Backup" agar data tidak hilang jika browser dibersihkan.</div></div></div>
      </div>
      <div class="pand-tip">üí° Data tersimpan otomatis ‚Äî tidak perlu tekan simpan setiap saat. Titik hijau di pojok kanan atas = data sudah aman.</div>
    </div>

    <div id="pand-ibadah" class="pand-section" style="display:none">
      <div class="pand-hero">üïå Tracker Ibadah & Niat Harian</div>
      <div class="pand-cards">
        <div class="pand-card pand-card-teal">
          <div class="pand-card-title">ü§≤ Cara Niat Puasa</div>
          <div class="pand-card-body">Buka bagian <b>Niat Puasa Harian</b>. Baca niat arabic & latinnya, lalu tekan tombol besar di bawah. Tombol akan berubah jadi hijau ‚úÖ ketika sudah diniatkan.<br><br>Kamu juga bisa menulis <b>doa atau harapan pribadi</b> di kotak catatan di bawahnya ‚Äî tersimpan per hari.</div>
          <div class="pand-card-tip">‚è∞ Waktu niat: sebelum tidur malam atau saat sahur sebelum imsak</div>
        </div>
        <div class="pand-card pand-card-gold">
          <div class="pand-card-title">‚úÖ Cara Centang Ibadah</div>
          <div class="pand-card-body">Di bagian <b>Tracker Ibadah</b>, ketuk nama ibadah yang sudah kamu selesaikan. Warna akan berubah hijau. Ketuk lagi untuk membatalkan.<br><br><b>Ibadah yang tersedia:</b><br>‚Ä¢ Sholat Fardhu 5 waktu (wajib)<br>‚Ä¢ Tarawih, Witir, Tahajud (sunnah)<br>‚Ä¢ Dzikir pagi/petang<br>‚Ä¢ I'tikaf</div>
          <div class="pand-card-tip">üî• Streak terhitung kalau semua sholat fardhu + tarawih sudah dicentang</div>
        </div>
        <div class="pand-card pand-card-green">
          <div class="pand-card-title">üî• Apa itu Streak?</div>
          <div class="pand-card-body">Streak adalah <b>berapa hari berturut-turut</b> kamu berhasil menyelesaikan semua sholat fardhu + tarawih. Semakin panjang streak, semakin tinggi level api üî• di layar.<br><br>Streak <b>tidak akan putus</b> di hari haid ‚Äî hari tersebut dianggap "exempt" otomatis.</div>
          <div class="pand-card-tip">‚ú® Target: streak 30 hari untuk badge Legendaris!</div>
        </div>
      </div>
    </div>

    <div id="pand-haid" class="pand-section" style="display:none">
      <div class="pand-hero" style="color:#FF69B4">üå∏ Panduan Mode Haid / Uzur</div>
      <div class="pand-desc">Mode haid dirancang khusus agar kamu tetap bisa mencatat ibadah selama masa uzur tanpa merasa tertinggal.</div>
      <div class="pand-cards">
        <div class="pand-card" style="border-color:rgba(255,105,180,.4);background:rgba(255,182,193,.08)">
          <div class="pand-card-title" style="color:#FF69B4">üå∏ Cara Mengaktifkan Mode Haid</div>
          <div class="pand-card-body">Di bagian <b>Tracker Ibadah</b>, ada toggle switch berlabel <b>"üå∏ Sedang Haid Hari Ini?"</b>. Aktifkan toggle tersebut.<br><br>Setelah aktif:<br>‚Ä¢ Sholat fardhu, tarawih, tahajud, witir, dan i'tikaf otomatis <b>dicoret dan dimaafkan</b><br>‚Ä¢ Dzikir pagi/petang tetap bisa dicatat<br>‚Ä¢ Hari tersebut ditandai warna <b>pink üå∏</b> di kalender</div>
          <div class="pand-card-tip" style="background:rgba(255,105,180,.15);color:#FF69B4">üí° Nonaktifkan kembali setelah masa haid selesai</div>
        </div>
        <div class="pand-card" style="border-color:rgba(255,105,180,.3);background:rgba(255,182,193,.06)">
          <div class="pand-card-title" style="color:#FF69B4">üìÖ Tampilan di Kalender</div>
          <div class="pand-card-body">Hari yang ditandai haid akan tampil:<br>‚Ä¢ üå∏ Warna <b>pink</b> di kalender streak 30 hari<br>‚Ä¢ Dot pink di selector hari (baris atas)<br>‚Ä¢ Label "üå∏ Haid/Uzur" saat hover/tap<br><br>Di legenda kalender ada keterangan "Haid üå∏" agar mudah dibedakan dari hari biasa.</div>
          <div class="pand-card-tip" style="background:rgba(255,105,180,.15);color:#FF69B4">üå∏ Streak tetap aman ‚Äî hari haid tidak memutus streak</div>
        </div>
        <div class="pand-card" style="border-color:rgba(255,105,180,.3);background:rgba(255,182,193,.06)">
          <div class="pand-card-title" style="color:#FF69B4">üìä Haid di Rekap & PDF</div>
          <div class="pand-card-body">Total hari haid otomatis dihitung dan ditampilkan:<br>‚Ä¢ Di kartu rekap keseluruhan (jumlah hari)<br>‚Ä¢ Di tabel harian PDF (kolom tersendiri dengan warna pink)<br>‚Ä¢ Di share card saat dibagikan ke teman<br>‚Ä¢ Masuk otomatis ke <b>Tracker Qadha</b></div>
          <div class="pand-card-tip" style="background:rgba(255,105,180,.15);color:#FF69B4">üìã Hari haid otomatis masuk daftar qadha yang perlu diganti</div>
        </div>
      </div>
    </div>

    <div id="pand-puasa" class="pand-section" style="display:none">
      <div class="pand-hero">üåô Status Puasa Harian</div>
      <div class="pand-desc">Catat status puasamu setiap hari di bagian <b>Status & Hidrasi</b>. Ada 4 pilihan:</div>
      <div class="pand-cards">
        <div class="pand-card pand-card-teal">
          <div class="pand-card-title">üò¥ Belum Mulai</div>
          <div class="pand-card-body">Status awal setiap hari. Tandai ini sambil menunggu waktu sahur atau di awal hari. Artinya puasa belum diniatkan/dimulai.</div>
        </div>
        <div class="pand-card pand-card-teal">
          <div class="pand-card-title">üåô Sedang Puasa</div>
          <div class="pand-card-body">Tandai ini setelah sahur dan niat. Ini menunjukkan kamu sedang menjalankan puasa Ramadan hari ini. Semangat! üí™</div>
        </div>
        <div class="pand-card pand-card-gold">
          <div class="pand-card-title">üåÖ Sudah Berbuka</div>
          <div class="pand-card-body">Tandai ini setelah waktu Maghrib dan kamu sudah berbuka. App akan otomatis mengingatkan untuk minum air putih jika gelasmu masih kurang dari 4.</div>
        </div>
        <div class="pand-card" style="border-color:rgba(200,80,50,.4);background:rgba(200,80,50,.08)">
          <div class="pand-card-title" style="color:#FF9070">‚ùå Batal Puasa</div>
          <div class="pand-card-body">Pilih ini jika puasamu batal. Kamu akan diminta memilih <b>alasan batal</b>:<br>‚Ä¢ ü§í Sakit<br>‚Ä¢ üå∏ Haid/Uzur<br>‚Ä¢ ‚úàÔ∏è Safar/Perjalanan<br>‚Ä¢ üìù Lainnya<br><br>Hari ini otomatis masuk ke <b>Tracker Qadha</b> agar tidak lupa diganti.</div>
          <div class="pand-card-tip" style="background:rgba(200,80,50,.12);color:#FF9070">‚ö†Ô∏è Wajib memilih alasan agar rekap qadha akurat</div>
        </div>
      </div>
      <div class="pand-tip">üíß Jangan lupa isi tracker air minum! Target 8 gelas per hari ‚Äî 4 saat sahur, 4 saat berbuka.</div>
    </div>

    <div id="pand-qadha" class="pand-section" style="display:none">
      <div class="pand-hero">üìã Tracker Qadha Puasa</div>
      <div class="pand-desc">Qadha adalah mengganti hari puasa yang ditinggalkan. Tracker ini membantu kamu mengingat berapa hari yang perlu diganti setelah Ramadan.</div>
      <div class="pand-cards">
        <div class="pand-card pand-card-gold">
          <div class="pand-card-title">üìã Apa yang Masuk Qadha?</div>
          <div class="pand-card-body">Secara otomatis, dua kondisi berikut akan masuk ke daftar qadha:<br><br><b>1. Hari Haid/Uzur üå∏</b><br>Semua hari yang kamu tandai mode haid akan otomatis masuk qadha ‚Äî kamu tidak perlu melakukan apa-apa.<br><br><b>2. Hari Batal Puasa ‚ùå</b><br>Hari yang kamu tandai "Batal Puasa" di status puasa juga otomatis masuk qadha.</div>
          <div class="pand-card-tip">üìÖ Selesaikan qadha sebelum Ramadan tahun depan</div>
        </div>
        <div class="pand-card pand-card-teal">
          <div class="pand-card-title">üìç Di Mana Lihat Daftar Qadha?</div>
          <div class="pand-card-body">Buka bagian <b>"üìã Tracker Qadha Puasa"</b> di halaman utama. Di sana kamu bisa melihat:<br>‚Ä¢ Total berapa hari yang perlu diqadha<br>‚Ä¢ Daftar hari beserta tanggal dan alasannya<br>‚Ä¢ Warna pink untuk haid, warna oranye untuk batal<br><br>Daftar ini juga muncul di <b>PDF rekap</b> sebagai halaman tersendiri.</div>
          <div class="pand-card-tip">üí° Tunjukkan daftar ini ke orang tua atau ustazah jika perlu konfirmasi</div>
        </div>
        <div class="pand-card pand-card-green">
          <div class="pand-card-title">‚úÖ Hukum Qadha Puasa</div>
          <div class="pand-card-body">Sekedar pengingat:<br>‚Ä¢ Qadha puasa <b>hukumnya wajib</b> bagi yang meninggalkan puasa Ramadan dengan uzur syar'i<br>‚Ä¢ Boleh diqadha kapan saja setelah Ramadan, tidak harus berurutan<br>‚Ä¢ Haid/nifas = uzur syar'i yang sah<br>‚Ä¢ Sakit = uzur syar'i yang sah<br>‚Ä¢ Safar = boleh tidak puasa, tapi wajib qadha</div>
          <div class="pand-card-tip">ü§≤ Semoga Allah mempermudah pelunasan qadha kita semua</div>
        </div>
      </div>
    </div>

    <div id="pand-fitur" class="pand-section" style="display:none">
      <div class="pand-hero">‚ú® Fitur-Fitur Lainnya</div>
      <div class="pand-cards">
        <div class="pand-card pand-card-gold">
          <div class="pand-card-title">üìñ Tracker Al-Qur'an</div>
          <div class="pand-card-body">Catat berapa <b>juz dan halaman</b> Al-Qur'an yang sudah dibaca hari ini. Progress akan terakumulasi selama 30 hari dan ditampilkan di grafik statistik.</div>
          <div class="pand-card-tip">üéØ Target khatam = 30 juz dalam 30 hari (1 juz/hari)</div>
        </div>
        <div class="pand-card pand-card-teal">
          <div class="pand-card-title">üíù Catatan Sedekah</div>
          <div class="pand-card-body">Catat setiap sedekah yang kamu keluarkan ‚Äî berapapun nominalnya. Tulis deskripsi singkat seperti "Infak masjid" atau "Bantu tetangga". Total sedekah akan dihitung otomatis.</div>
          <div class="pand-card-tip">üí∞ Sedekah di bulan Ramadan pahalanya berlipat ganda!</div>
        </div>
        <div class="pand-card pand-card-green">
          <div class="pand-card-title">üòä Mood Tracker</div>
          <div class="pand-card-body">Pilih mood hari ini: Semangat, Tenang, Syukur, Lelah, atau Lapar. Mood 30 hari ditampilkan sebagai kalender warna dan grafik tren ‚Äî kamu bisa lihat pola perasaanmu selama Ramadan.</div>
          <div class="pand-card-tip">üìà Tap kotak mood di kalender untuk pindah ke hari itu</div>
        </div>
        <div class="pand-card pand-card-gold">
          <div class="pand-card-title">‚ú® Catatan Syukur</div>
          <div class="pand-card-body">Isi 3 hal yang kamu syukuri hari ini. Latihan bersyukur terbukti meningkatkan kebahagiaan dan ketenangan hati, apalagi di bulan Ramadan.</div>
          <div class="pand-card-tip">üåü Isi setiap hari untuk unlock badge "Hati Bersyukur"</div>
        </div>
        <div class="pand-card pand-card-teal">
          <div class="pand-card-title">üìä Statistik & Grafik</div>
          <div class="pand-card-body">Lihat grafik perkembangan ibadah, quran, dan sedekah dalam 30 hari. <b>Tap/klik batang grafik</b> untuk melihat detail hari itu. Warna batang:<br>üü¢ Hijau = hari sempurna<br>üü° Kuning = sebagian<br>‚¨ú Abu = belum ada<br>üåü Gold = hari ini<br>üå∏ Pink = haid</div>
          <div class="pand-card-tip">üìà Gunakan untuk evaluasi diri tiap minggu</div>
        </div>
        <div class="pand-card pand-card-green">
          <div class="pand-card-title">üèÜ Badge & Pencapaian</div>
          <div class="pand-card-body">Kumpulkan badge dengan menyelesaikan berbagai tantangan: streak panjang, khatam Quran, rutin sedekah, dan banyak lagi. Badge terkunci sampai syaratnya terpenuhi.</div>
          <div class="pand-card-tip">üéØ Ada badge tersembunyi yang bisa kamu temukan!</div>
        </div>
        <div class="pand-card pand-card-gold">
          <div class="pand-card-title">üìä Rekap Mingguan Otomatis</div>
          <div class="pand-card-body">Setiap akhir minggu (hari ke-7, 14, 21, 28), muncul notifikasi rekap otomatis berisi total ibadah, hari sempurna, juz quran, dan streak minggu itu.</div>
          <div class="pand-card-tip">üìÖ Gunakan sebagai bahan muhasabah mingguan</div>
        </div>
        <div class="pand-card pand-card-teal">
          <div class="pand-card-title">üé¥ Share Card & PDF</div>
          <div class="pand-card-body"><b>Share Card:</b> Buat kartu cantik berisi ringkasan ibadahmu untuk dibagikan ke media sosial atau teman.<br><br><b>PDF:</b> Cetak rekap lengkap 30 hari ibadah, sedekah, syukur, qadha, dan badge dalam format yang rapi.</div>
          <div class="pand-card-tip">‚ú® Share card otomatis menyertakan info hari haid</div>
        </div>
        <div class="pand-card" style="border-color:rgba(255,105,180,.3);background:rgba(255,182,193,.07)">
          <div class="pand-card-title" style="color:#FF69B4">‚è≥ Counter Hari Tersisa</div>
          <div class="pand-card-body">Di widget ringkasan harian, ada penghitung mundur berapa hari Ramadan tersisa. Gunakan ini sebagai pengingat untuk terus semangat dan tidak menyia-nyiakan hari yang tersedia.</div>
          <div class="pand-card-tip" style="background:rgba(255,105,180,.12);color:#FF69B4">üåô Hari terakhir akan ditandai dengan pesan spesial</div>
        </div>
      </div>
    </div>

    <div id="pand-data" class="pand-section" style="display:none">
      <div class="pand-hero">üíæ Data, Backup & Keamanan</div>
      <div class="pand-desc">Pahami cara kerja penyimpanan data agar ibadahmu tidak hilang selama 30 hari.</div>
      <div class="pand-cards">
        <div class="pand-card pand-card-gold">
          <div class="pand-card-title">üíæ Export Backup</div>
          <div class="pand-card-body">Simpan semua data ibadahmu ke file <b>.json</b> di HP/laptop. File ini bisa dipulihkan kapan saja.<br><br>Lakukan ini <b>secara rutin setiap minggu</b> agar data tidak hilang jika browser dibersihkan atau HP rusak.</div>
          <div class="pand-card-tip">üí° Simpan file backup di Google Drive atau WhatsApp kepada dirimu sendiri</div>
        </div>
        <div class="pand-card pand-card-teal">
          <div class="pand-card-title">üì• Import Data</div>
          <div class="pand-card-body">Pulihkan data dari file backup yang sudah pernah di-export. Gunakan ini jika:<br>‚Ä¢ Ganti HP atau browser<br>‚Ä¢ Data hilang tiba-tiba<br>‚Ä¢ Ingin pindah dari satu perangkat ke perangkat lain</div>
          <div class="pand-card-tip">‚ö†Ô∏è Data yang ada sekarang akan <b>ditimpa</b> dengan data dari file backup</div>
        </div>
        <div class="pand-card" style="border-color:rgba(200,60,60,.3);background:rgba(200,60,60,.07)">
          <div class="pand-card-title" style="color:#FF9090">üóëÔ∏è Reset Semua Data</div>
          <div class="pand-card-body">Hapus <b>semua</b> data ibadah dari hari 1 sampai 30. Data tidak bisa dipulihkan kecuali sudah di-backup sebelumnya.<br><br>Gunakan ini hanya jika benar-benar ingin mulai dari nol.</div>
          <div class="pand-card-tip" style="background:rgba(200,60,60,.12);color:#FF7070">üö® Pikirkan dua kali sebelum mereset!</div>
        </div>
        <div class="pand-card pand-card-green">
          <div class="pand-card-title">‚ö†Ô∏è Penting: Cara Kerja Penyimpanan</div>
          <div class="pand-card-body">Data disimpan di <b>LocalStorage browser</b> ‚Äî bukan di server atau cloud. Artinya:<br>‚Ä¢ Data hanya ada di browser ini saja<br>‚Ä¢ Beda browser = data berbeda (Chrome ‚â† Safari ‚â† Firefox)<br>‚Ä¢ Hapus cache/cookies = data hilang<br>‚Ä¢ Gunakan browser yang sama setiap hari<br><br>Titik üü¢ di pojok kanan atas = data sudah tersimpan</div>
          <div class="pand-card-tip">üì± Saran: pakai Chrome atau browser utama kamu, dan jangan hapus data browser</div>
        </div>
      </div>
    </div>

  </div>
</div>

<style>
.pand-tab{padding:7px 14px;border-radius:20px;font-size:12px;font-weight:800;cursor:pointer;border:1.5px solid rgba(200,151,58,.35);background:transparent;color:rgba(255,255,255,.55);font-family:'Nunito',sans-serif;transition:all .18s;white-space:nowrap}
.pand-tab:hover{border-color:rgba(200,151,58,.6);color:rgba(255,255,255,.85)}
.pand-active{background:rgba(200,151,58,.2);border-color:rgba(200,151,58,.7);color:var(--gold-light)!important}
.pand-section{}
.pand-hero{font-size:18px;font-weight:900;color:var(--gold-light);margin-bottom:8px;font-family:'Amiri',serif}
.pand-desc{font-size:13px;color:rgba(255,255,255,.65);line-height:1.7;margin-bottom:16px}
.pand-cards{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:12px;margin-bottom:12px}
.pand-card{border-radius:14px;padding:16px;border:1.5px solid rgba(255,255,255,.1);background:rgba(255,255,255,.04)}
.pand-card-teal{border-color:rgba(26,107,107,.4);background:rgba(26,107,107,.1)}
.pand-card-gold{border-color:rgba(200,151,58,.4);background:rgba(200,151,58,.08)}
.pand-card-green{border-color:rgba(74,222,128,.3);background:rgba(74,222,128,.07)}
.pand-card-title{font-size:13px;font-weight:900;color:white;margin-bottom:8px;display:flex;align-items:center;gap:6px}
.pand-card-body{font-size:12px;color:rgba(255,255,255,.68);line-height:1.75}
.pand-card-tip{margin-top:10px;font-size:11px;font-weight:700;padding:7px 10px;border-radius:8px;background:rgba(255,255,255,.06);color:rgba(200,151,58,.9)}
.pand-steps{display:flex;flex-direction:column;gap:12px;margin-bottom:16px}
.pand-step{display:flex;align-items:flex-start;gap:12px;padding:12px;border-radius:12px;background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08)}
.pand-step-num{width:28px;height:28px;border-radius:50%;background:linear-gradient(135deg,var(--gold),var(--gold-light));color:#020A14;font-size:13px;font-weight:900;display:flex;align-items:center;justify-content:center;flex-shrink:0;font-family:'Nunito',sans-serif}
.pand-step-title{font-size:13px;font-weight:900;color:white;margin-bottom:4px}
.pand-step-desc{font-size:12px;color:rgba(255,255,255,.65);line-height:1.65}
.pand-tip{padding:12px 16px;border-radius:12px;background:rgba(200,151,58,.12);border:1px solid rgba(200,151,58,.3);font-size:12px;font-weight:700;color:rgba(200,151,58,.95);line-height:1.6;margin-top:4px}
</style>

<div class="day-wave">
  <div style="display:flex;align-items:center;gap:8px;max-width:900px;margin:0 auto 8px">
    <button onclick="goToToday()" id="todayBtn" style="flex-shrink:0;display:flex;align-items:center;gap:5px;padding:6px 14px;border-radius:10px;border:1.5px solid rgba(200,151,58,.5);background:rgba(200,151,58,.15);color:var(--gold-light);font-family:'Nunito',sans-serif;font-size:12px;font-weight:800;cursor:pointer;transition:all .2s;white-space:nowrap">
      üìÖ Hari Ini
    </button>
    <div style="font-size:11px;color:rgba(255,255,255,.4);font-weight:700" id="todayLabel"></div>
  </div>
  <div class="day-selector" id="daySelector"></div>
  <div class="swipe-hint">üëà Swipe kiri/kanan untuk pindah hari üëâ</div>
</div>

<main><!-- ‚ïê‚ïê‚ïê WIDGET RINGKASAN ‚ïê‚ïê‚ïê -->
  <div class="daily-widget" id="dailyWidget">
    <div>
      <div style="font-size:10px;font-weight:700;color:var(--text-muted);text-transform:uppercase;letter-spacing:.5px">Hari ke-</div>
      <div class="dw-day" id="dwDay">1</div>
    </div>
    <div class="dw-sep"></div>
    <div class="dw-stats">
      <div class="dw-stat">
        <div class="dw-stat-val" id="dwIbadah">0/9</div>
        <div class="dw-stat-lbl">Ibadah</div>
      </div>
      <div class="dw-stat">
        <div class="dw-stat-val" id="dwStreak">0\U0001f525</div>
        <div class="dw-stat-lbl">Streak</div>
      </div>
      <div class="dw-stat">
        <div class="dw-stat-val" id="dwNiat">\u274c</div>
        <div class="dw-stat-lbl">Niat</div>
      </div>
      <div class="dw-stat">
        <div class="dw-stat-val" id="dwJuz">0</div>
        <div class="dw-stat-lbl">Juz</div>
      </div>
    </div>
    <button class="dw-notif-btn" id="dwNotifBtn" onclick="openNotifModal()">\U0001f514 Notifikasi</button>
    <div id="dwHariTersisa" style="font-size:11px;font-weight:800;color:var(--gold-light);text-align:center;padding:4px 0;opacity:.85"></div>
    <div class="dw-ibadah-bar">
      <div class="dw-bar-track"><div class="dw-bar-fill" id="dwBar" style="width:0%"></div></div>
      <div class="dw-bar-label"><span id="dwBarLeft">0 ibadah selesai</span><span id="dwBarRight">target hari ini</span></div>
    </div>
  </div>

  <div class="quote-card">
    <div class="quote-icon">üåô</div>
    <div class="quote-text" id="quoteText"></div>
    <div class="quote-source" id="quoteSource"></div>
  </div>

  <!-- hidden sum elements agar JS tidak error -->
  <span id="sumHari" style="display:none"></span>
  <span id="sumIbadah" style="display:none"></span>
  <span id="sumStreak" style="display:none"></span>
  <span id="sumSedekah" style="display:none"></span>

  <div class="overall-progress">
    <div class="prog-title">üìä Progress Ramadan Keseluruhan</div>
    <div class="prog-grid">
      <div class="prog-item"><div class="prog-label">Ibadah Kumulatif <span id="progIbadahPct">0%</span></div><div class="prog-track"><div class="prog-fill fill-teal" id="progIbadah" style="width:0%"></div></div></div>
      <div class="prog-item"><div class="prog-label">Total Juz Quran <span id="progQuranPct">0 juz</span></div><div class="prog-track"><div class="prog-fill fill-gold" id="progQuran" style="width:0%"></div></div></div>
      <div class="prog-item"><div class="prog-label">Hari Sempurna <span id="progStreakPct">0 hari</span></div><div class="prog-track"><div class="prog-fill fill-green" id="progStreak" style="width:0%"></div></div></div>
      <div class="prog-item"><div class="prog-label">Total Sedekah <span id="progSedekahTotal">Rp 0</span></div><div class="prog-track"><div class="prog-fill fill-rose" id="progSedekah" style="width:0%"></div></div></div>
    </div>
  </div>

  <!-- üåô Niat Puasa -->
  <div class="section-card" id="niatSection">
    <div class="section-header"><div class="section-icon icon-teal">ü§≤</div><div><div class="section-title">Niat Puasa Harian</div><div class="section-sub" id="niatSub">Niatkan puasa sebelum imsak</div></div></div>
    <div class="niat-card">
      <div class="niat-arabic">ŸÜŸéŸàŸéŸäŸíÿ™Ÿè ÿµŸéŸàŸíŸÖŸé ÿ∫ŸéÿØŸç ÿπŸéŸÜŸí ÿ£ŸéÿØŸéÿßÿ°Ÿê ŸÅŸéÿ±Ÿíÿ∂Ÿê ÿ¥ŸéŸáŸíÿ±Ÿê ÿ±ŸéŸÖŸéÿ∂ŸéÿßŸÜŸé ŸáŸéÿ∞ŸêŸáŸê ÿßŸÑÿ≥ŸéŸëŸÜŸéÿ©Ÿê ŸÑŸêŸÑŸéŸëŸáŸê ÿ™ŸéÿπŸéÿßŸÑŸéŸâ</div>
      <div class="niat-latin">Nawaitu shauma ghadin 'an adƒÅ'i fardhi syahri RamadhƒÅna hƒÅdzihis sanati lillƒÅhi ta'ƒÅla</div>
      <div class="niat-arti">üåô "Aku niat berpuasa esok hari untuk menunaikan kewajiban bulan Ramadan tahun ini karena Allah Ta'ala."</div>
    </div>
        <div style="margin-top:14px;padding:14px;background:rgba(26,107,107,.08);border:1px solid rgba(26,107,107,.2);border-radius:14px">
      <div style="font-size:11px;font-weight:800;color:var(--teal);margin-bottom:8px;letter-spacing:.5px">üåô NIAT SAHUR <span style="font-weight:400;opacity:.7">(dibaca saat sahur)</span></div>
      <div class="niat-arabic" style="font-size:1.1rem">ŸÜŸéŸàŸéŸä€°ÿ™Ÿè ÿßŸÑÿµŸéŸëŸà€°ŸÖŸé ŸÑŸêÿ∫ŸéÿØŸç</div>
      <div class="niat-latin">Nawaitu s-sawma li-ghadin</div>
      <div class="niat-arti">üçΩÔ∏è "Aku niat berpuasa untuk esok hari."</div>
    </div>
    <div style="margin-top:10px;padding:14px;background:rgba(200,151,58,.07);border:1px solid rgba(200,151,58,.2);border-radius:14px">
      <div style="font-size:11px;font-weight:800;color:var(--gold);margin-bottom:8px;letter-spacing:.5px">‚òÄÔ∏è DOA BERBUKA <span style="font-weight:400;opacity:.7">(dibaca saat buka)</span></div>
      <div class="niat-arabic" style="font-size:1rem">ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ŸÑŸéŸÉŸé ÿµŸèŸÖ€°ÿ™Ÿè ŸàŸéÿ®ŸêŸÉŸé ÿ¢ŸÖŸéŸÜ€°ÿ™Ÿè ŸàŸéÿπŸéŸÑŸéŸâ ÿ±Ÿêÿ≤€°ŸÇŸêŸÉŸé ÿ£ŸéŸÅ€°ÿ∑Ÿéÿ±€°ÿ™Ÿè</div>
      <div class="niat-latin">AllƒÅhumma laka sumtu wa bika ƒÅmantu wa  øalƒÅ rizqika aftartu</div>
      <div class="niat-arti">‚òÄÔ∏è "Ya Allah, untuk-Mu aku berpuasa, kepada-Mu aku beriman, dan dengan rezeki-Mu aku berbuka."</div>
    </div>
    <button class="niat-confirm-btn unconfirmed" id="niatBtn" onclick="toggleNiat()">
      <span id="niatBtnIcon">‚≠ï</span> <span id="niatBtnText">Tandai Sudah Berniat Puasa Hari Ini</span>
    </button>
    <div style="font-size:11px;color:var(--text-muted);text-align:center;margin-top:10px">üí° Waktu niat: sebelum Imsak / sebelum tidur malam</div>
    <div style="margin-top:14px">
      <div style="font-size:12px;font-weight:800;color:var(--text-muted);margin-bottom:6px">‚úçÔ∏è Catatan Niat / Doa Pribadi <span style="font-weight:400;opacity:.6">(opsional)</span></div>
      <textarea id="niatCatatanInput" placeholder="Tulis niat, harapan, atau doa pribadimu hari ini..." oninput="saveNiatCatatan()" style="width:100%;min-height:70px;border-radius:12px;border:1.5px solid var(--cream-dark);background:var(--cream);font-family:'Nunito',sans-serif;font-size:13px;font-weight:600;color:var(--text);padding:10px 12px;resize:vertical;box-sizing:border-box;outline:none;transition:border-color .2s" onfocus="this.style.borderColor='var(--teal)'" onblur="this.style.borderColor='var(--cream-dark)'"></textarea>
    </div>
  </div>

  <!-- üî• Streak & Kalender -->
  <div class="section-card">
    <div class="section-header"><div class="section-icon icon-green">üî•</div><div><div class="section-title">Streak & Kalender Ibadah</div><div class="section-sub">Klik hari untuk berpindah</div></div></div>
    <div class="streak-grid" id="streakGrid"></div>
    <div class="streak-legend">
      <div class="legend-item"><div class="legend-dot" style="background:linear-gradient(135deg,#32A064,#20C070)"></div>Fardhu + Tarawih ‚úì üî•</div>
      <div class="legend-item"><div class="legend-dot" style="background:linear-gradient(135deg,var(--gold),var(--gold-light))"></div>Sebagian</div>
      <div class="legend-item"><div class="legend-dot" style="background:var(--cream-dark);border:1px solid var(--cream-dark)"></div>Belum</div>
      <div class="legend-item"><div class="legend-dot" style="background:rgba(255,182,193,0.5);border:1.5px solid rgba(255,105,180,0.6)"></div>Haid üå∏</div>
    </div>
    
    <!-- Streak api TikTok display -->
    <div class="streak-fire-display sf-lv0" id="streakFireDisplay">
      <span class="streak-fire-emoji" id="streakFireEmoji">üî•</span>
      <span class="streak-fire-num" id="streakFireNum">0</span>
      <span class="streak-fire-label">HARI STREAK</span>
      <span class="streak-fire-tag" id="streakFireTag">Mulai sekarang!</span>
    </div>
    
    <!-- Mood kalender 30 hari -->
    <div style="margin-top:16px;padding-top:14px;border-top:1.5px solid var(--cream-dark)">
      <div style="font-size:13px;font-weight:900;color:var(--text);margin-bottom:4px">üòä Mood 30 Hari</div>
      <div style="font-size:11px;color:var(--text-muted);margin-bottom:8px">Warna tiap kotak = mood hari itu ¬∑ Tap untuk pindah hari</div>
      <div class="mood-cal-grid" id="moodCalGrid"></div>
      <div class="mood-cal-label" id="moodCalLabel"></div>
      <!-- Mood tren chart -->
      <div style="margin-top:12px">
        <div style="font-size:11px;font-weight:800;color:var(--text-muted);margin-bottom:6px">üìà Tren Mood</div>
        <canvas id="moodTrendCanvas" height="60" style="width:100%;display:block;border-radius:8px"></canvas>
        <div id="moodTrendLegend" style="display:flex;gap:10px;flex-wrap:wrap;margin-top:6px"></div>
      </div>
    </div>
  </div>

  <!-- üìã Qadha Tracker -->
  <div class="section-card" id="qdhaSection">
    <div class="section-header"><div class="section-icon icon-gold">üìã</div><div><div class="section-title">Tracker Qadha Puasa</div><div class="section-sub">Hari batal puasa yang perlu diqadha</div></div></div>
    <div id="qadhaContent"></div>
  </div>

  <!-- ‚è∞ Jadwal Sahur & Buka -->
  <div class="section-card">
    <div class="section-header"><div class="section-icon icon-gold">üåô</div><div><div class="section-title">Jadwal Sahur & Buka</div><div class="section-sub" id="jadwalSub">Pilih zona waktu &amp; kota</div></div></div>

    <!-- 3 ZONA WAKTU TABS -->
    <div style="display:flex;gap:5px;margin-bottom:10px;background:rgba(0,0,0,0.2);border-radius:14px;padding:4px;">
      <button id="tabWIB" onclick="setZona('WIB')" style="flex:1;padding:9px 4px;border-radius:10px;border:none;font-family:'Nunito',sans-serif;font-size:13px;font-weight:800;cursor:pointer;transition:all .25s;background:var(--gold);color:#020A14;line-height:1.3">WIB<div style="font-size:9px;opacity:.75;font-weight:600">UTC+7</div></button>
      <button id="tabWITA" onclick="setZona('WITA')" style="flex:1;padding:9px 4px;border-radius:10px;border:none;font-family:'Nunito',sans-serif;font-size:13px;font-weight:800;cursor:pointer;transition:all .25s;background:transparent;color:var(--text-muted);line-height:1.3">WITA<div style="font-size:9px;opacity:.75;font-weight:600">UTC+8</div></button>
      <button id="tabWIT" onclick="setZona('WIT')" style="flex:1;padding:9px 4px;border-radius:10px;border:none;font-family:'Nunito',sans-serif;font-size:13px;font-weight:800;cursor:pointer;transition:all .25s;background:transparent;color:var(--text-muted);line-height:1.3">WIT<div style="font-size:9px;opacity:.75;font-weight:600">UTC+9</div></button>
    </div>
    <div id="zonaInfo" style="font-size:10.5px;color:var(--text-muted);margin-bottom:10px;padding:5px 10px;background:rgba(200,151,58,.07);border-radius:9px;border:1px solid rgba(200,151,58,.18);line-height:1.5;"></div>

    <div class="city-selector" style="display:flex;flex-direction:column;gap:10px">
      <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
        <label style="font-size:13px;font-weight:800;color:var(--text)">üèôÔ∏è Kota:</label>
        <select id="citySelect" onchange="onCityChange()" style="flex:1;min-width:140px"></select>
        <button onclick="detectLocation()" id="gpsBtn" style="display:flex;align-items:center;gap:6px;padding:8px 14px;border-radius:12px;border:1.5px solid rgba(26,107,107,.4);background:rgba(26,107,107,.1);color:var(--teal);font-family:'Nunito',sans-serif;font-size:13px;font-weight:800;cursor:pointer;transition:all .2s;white-space:nowrap">
          üìç Lokasiku
        </button>
      </div>
      <div id="locationStatus" style="font-size:12px;color:var(--teal);font-weight:700;display:none;padding:8px 12px;background:rgba(26,107,107,.08);border-radius:10px;border:1px solid rgba(26,107,107,.2)"></div>
      <div style="font-size:11px;color:var(--text-muted);display:flex;align-items:center;gap:6px">
        <span id="dataSourceBadge" style="background:rgba(200,151,58,.15);border:1px solid rgba(200,151,58,.3);padding:2px 8px;border-radius:20px;font-weight:700;color:var(--gold)">üì° tirto.id / Kemenag RI</span>
      </div>
    </div>

    <div id="jadwalLoading" style="display:none;text-align:center;padding:10px;font-size:13px;color:var(--teal)">‚è≥ Memuat jadwal...</div>
    <div id="jadwalError" style="display:none;text-align:center;padding:10px;font-size:13px;color:#e57373"></div>

    <div id="jadwalContent" style="margin-top:16px">
      <div class="jadwal-cards">
        <div class="jadwal-card jadwal-card-sahur">
          <div class="jadwal-card-deco">üåô</div>
          <span class="jadwal-card-icon">üåô</span>
          <div class="jadwal-card-label">Imsak / Sahur</div>
          <div class="jadwal-card-time" id="timeImsak">--:--</div>
          <div class="jadwal-card-note">Batas akhir makan sahur</div>
          <div class="jadwal-maghrib-row">
            <span class="jadwal-maghrib-label">üïå Subuh</span>
            <span class="jadwal-maghrib-time" id="timeSubuh">--:--</span>
          </div>
        </div>
        <div class="jadwal-card jadwal-card-buka">
          <div class="jadwal-card-deco">‚òÄÔ∏è</div>
          <span class="jadwal-card-icon">üåÖ</span>
          <div class="jadwal-card-label">Buka Puasa</div>
          <div class="jadwal-card-time" id="timeBuka">--:--</div>
          <div class="jadwal-card-note">Segera berbuka saat adzan</div>
          <div class="jadwal-maghrib-row">
            <span class="jadwal-maghrib-label">üïå Maghrib</span>
            <span class="jadwal-maghrib-time" id="timeMaghrib">--:--</span>
          </div>
        </div>
      </div>
      <div class="countdown-wrap">
        <div class="countdown-inner">
          <div class="countdown-label" id="countdownLabel">Menghitung...</div>
          <div class="countdown-time" id="countdownTime">--:--:--</div>
        </div>
      <!-- JADWAL 30 HARI -->
      <button onclick="toggleJadwal30()" id="btn30hari" style="margin-top:12px;width:100%;padding:10px 14px;border-radius:12px;border:1.5px dashed rgba(200,151,58,.4);background:rgba(200,151,58,.06);color:var(--gold);font-family:'Nunito',sans-serif;font-size:13px;font-weight:800;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px">
        üìÖ Lihat Jadwal Lengkap 30 Hari
      </button>
      <div id="jadwal30Container" style="display:none;margin-top:10px;border-radius:12px;border:1px solid rgba(255,255,255,.08);overflow:clip">
        <div style="background:rgba(200,151,58,.1);padding:8px 14px;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid rgba(255,255,255,.06)">
          <span style="font-size:12px;font-weight:800;color:var(--gold)">üìÖ Jadwal Ramadan 1447H</span>
          <span id="jadwal30Kota" style="font-size:11px;color:var(--text-muted);font-weight:700">‚Äî</span>
        </div>
        <div style="max-height:300px;overflow-y:auto;overflow-x:hidden;position:relative">
          <table style="width:100%;border-collapse:collapse;font-size:12px">
            <thead><tr style="background:rgba(12,28,45,.97);position:sticky;top:0;z-index:2">
              <th style="padding:8px 10px;text-align:center;color:var(--text-muted);font-weight:700;background:rgba(12,28,45,.97)">No</th>
              <th style="padding:8px 10px;text-align:center;color:var(--text-muted);font-weight:700;background:rgba(12,28,45,.97)">Tanggal</th>
              <th style="padding:8px 10px;text-align:center;color:var(--teal);font-weight:700;background:rgba(12,28,45,.97)">üåô Imsak</th>
              <th style="padding:8px 10px;text-align:center;color:var(--gold);font-weight:700;background:rgba(12,28,45,.97)">‚òÄÔ∏è Buka</th>
            </tr></thead>
            <tbody id="jadwal30Body"></tbody>
          </table>
        </div>
        <div style="padding:6px 10px;font-size:10px;color:var(--text-muted);text-align:right;border-top:1px solid rgba(255,255,255,.04)">Sumber: tirto.id / Kemenag RI 1447H</div>
      </div>
      </div>
    </div>
  </div>

  <!-- üíß Status & Hidrasi -->
  <div class="section-card">
    <div class="section-header"><div class="section-icon icon-sky">üíß</div><div><div class="section-title">Status & Hidrasi Hari Ini</div><div class="section-sub">Catat status puasa dan asupan air</div></div></div>
    
    <div style="font-size:13px;font-weight:800;color:var(--text);margin-bottom:10px">üåô Status Puasa</div>
    <div class="status-puasa-wrap">
      <button class="sp-btn" id="sp-belum" onclick="setStatusPuasa('belum')">üò¥ Belum Mulai</button>
      <button class="sp-btn" id="sp-puasa" onclick="setStatusPuasa('puasa')">üåô Sedang Puasa</button>
      <button class="sp-btn" id="sp-buka" onclick="setStatusPuasa('buka')">üåÖ Sudah Berbuka</button>
      <button class="sp-btn" id="sp-batal" onclick="setStatusPuasa('batal')" style="border-color:rgba(180,30,20,.4);color:#B02010">‚ùå Batal Puasa</button>
    </div>
    <div id="batalAlasanWrap" style="display:none;margin-top:10px;padding:12px;background:rgba(200,80,50,.08);border:1.5px solid rgba(200,80,50,.25);border-radius:12px">
      <div style="font-size:12px;font-weight:800;color:#C05030;margin-bottom:8px">üìù Alasan batal puasa (untuk rekap qadha):</div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:6px" id="batalAlasanBtns">
        <button onclick="setBatalAlasan('sakit')" class="batal-alasan-btn" id="ba-sakit">ü§í Sakit</button>
        <button onclick="setBatalAlasan('haid')" class="batal-alasan-btn" id="ba-haid">üå∏ Haid/Uzur</button>
        <button onclick="setBatalAlasan('safar')" class="batal-alasan-btn" id="ba-safar">‚úàÔ∏è Safar/Perjalanan</button>
        <button onclick="setBatalAlasan('lainnya')" class="batal-alasan-btn" id="ba-lainnya">üìù Lainnya</button>
      </div>
      <div id="batalQadhaNote" style="margin-top:8px;font-size:11px;color:rgba(200,80,50,.8);font-weight:700"></div>
    </div>

    <div style="font-size:13px;font-weight:800;color:var(--text);margin:16px 0 8px">üíß Tracker Air Minum</div>
    <div class="air-wrap">
      <div class="air-glasses" id="airGlasses"></div>
      <div style="display:flex;flex-direction:column;align-items:center">
        <div class="air-count" id="airCount">0</div>
        <div class="air-label">gelas</div>
      </div>
    </div>
    <div class="air-target-note">üéØ Target: 8 gelas/hari (4 saat sahur, 4 saat berbuka)</div>
    <div style="margin-top:8px;display:flex;gap:8px">
      <button onclick="resetAir()" style="flex:1;padding:8px;border-radius:10px;border:1.5px solid var(--cream-dark);background:transparent;font-family:'Nunito',sans-serif;font-size:12px;font-weight:800;color:var(--text-muted);cursor:pointer">üîÑ Reset Gelas</button>
      <button class="reset-day-btn" onclick="confirmResetHari()" style="flex:1;justify-content:center">üóëÔ∏è Reset Data Hari Ini</button>
    </div>
  </div>

  <!-- üïå Tracker Ibadah -->
  <div class="section-card">
    <div class="section-header"><div class="section-icon icon-teal">üïå</div><div><div class="section-title" id="txtSecIbadah">Tracker Ibadah Harian</div><div class="section-sub" id="txtSecIbadahSub">üëÜ Ketuk nama ibadah ‚Üí akan berubah hijau ‚úÖ</div></div></div>
    <div class="haid-bar" id="haidBar">
      <div class="haid-info">
        <div class="haid-title" id="txtHaidTitle">üå∏ Sedang Haid Hari Ini?</div>
        <div class="haid-sub" id="txtHaidSub">Aktifkan jika sedang haid ‚Äî shalat akan disesuaikan otomatis</div>
      </div>
      <label class="haid-switch"><input type="checkbox" id="haidCheck" onchange="toggleHaid()"><span class="haid-slider"></span></label>
    </div>
    <div class="haid-note" id="haidNote"></div>
    <div class="ibadah-list" id="ibadahList"></div>
  </div>

  <!-- üìø Dzikir -->
  <div class="section-card">
    <div class="section-header"><div class="section-icon icon-teal">üìø</div><div><div class="section-title">Dzikir Pagi &amp; Petang</div><div class="section-sub">Tekan Ôºã untuk tambah hitungan dzikir</div></div></div>
    <div class="dzikir-grid" id="dzikirGrid"></div>
  </div>


  <!-- üìñ Progress Quran -->
  <div class="section-card">
    <div class="section-header"><div class="section-icon icon-gold">üìñ</div><div><div class="section-title">Progress Al-Qur'an Hari Ini</div><div class="section-sub">Catat juz dan halaman yang sudah dibaca hari ini</div></div></div>
    <div class="quran-progress-wrap">

      <div class="quran-card">
        <div class="quran-card-header">
          <div class="quran-card-title">üïå Juz yang sudah dibaca</div>
          <div class="quran-card-badge" id="quranJuzBadge">0 / 30 juz</div>
        </div>
        <div class="quran-input-row">
          <input type="number" class="quran-num-input" id="quranJuz" min="0" max="30" value="0" oninput="updateQuran()" placeholder="0">
          <div class="quran-track-wrap">
            <div class="quran-track"><div class="quran-fill" id="quranBar" style="width:0%"></div></div>
            <div class="quran-pct-label" id="quranPct">0% dari target khatam</div>
          </div>
        </div>
      </div>

      <div class="quran-card">
        <div class="quran-card-header">
          <div class="quran-card-title">üìÑ Halaman terakhir dibaca</div>
          <div class="quran-card-badge" id="quranHalBadge" style="background:rgba(200,151,58,.15);color:var(--gold)">0 / 604 hal</div>
        </div>
        <div class="quran-input-row">
          <input type="number" class="quran-num-input" id="quranHal" min="0" max="604" value="0" oninput="updateHalaman()" placeholder="0">
          <div class="quran-track-wrap">
            <div class="quran-track"><div class="quran-fill quran-fill-gold" id="quranHalBar" style="width:0%"></div></div>
            <div class="quran-pct-label" id="quranHalPct" style="color:var(--gold)">0% dari 604 halaman</div>
          </div>
        </div>
      </div>

      <div class="quran-total-wrap">
        <div class="quran-ring">
          <svg viewBox="0 0 72 72"><circle class="quran-ring-bg" cx="36" cy="36" r="30"/><circle class="quran-ring-fill" id="quranRingFill" cx="36" cy="36" r="30"/></svg>
          <div class="quran-ring-text">
            <span class="quran-ring-pct" id="quranRingPct">0%</span>
            <span class="quran-ring-sub">khatam</span>
          </div>
        </div>
        <div class="quran-total-info">
          <div class="quran-total-title">Total Ramadan ini</div>
          <div class="quran-total-sub" id="quranTotalSub">Belum ada bacaan tercatat</div>
          <div class="quran-total-num" id="quranTotalNum">0 juz</div>
        </div>
      </div>

      <!-- TARGET KHATAM -->
      <div style="background:var(--cream);border-radius:16px;padding:16px;border:1.5px solid var(--cream-dark)" class="zakat-step-card">
        <div style="font-size:13px;font-weight:900;color:var(--text);margin-bottom:4px">üéØ Target Khatam Al-Qur'an</div>
        <div style="font-size:11px;color:var(--text-muted);margin-bottom:12px">Set targetmu, dan lihat apakah kamu on-track atau perlu kejar!</div>
        <div style="display:flex;align-items:center;gap:10px;margin-bottom:12px">
          <label style="font-size:12px;font-weight:800;color:var(--text-muted);white-space:nowrap">Target:</label>
          <select id="quranTargetSelect" onchange="updateQuranTarget()" style="flex:1;border:1.5px solid rgba(26,107,107,.3);border-radius:10px;padding:8px 12px;font-family:'Nunito',sans-serif;font-size:13px;font-weight:700;color:var(--text);background:white;outline:none;cursor:pointer">
            <option value="30">Khatam 1x (30 juz)</option>
            <option value="60">Khatam 2x (60 juz)</option>
            <option value="15">Setengah (15 juz)</option>
            <option value="10">10 juz saja</option>
            <option value="5">5 juz saja</option>
          </select>
        </div>
        <div id="quranTargetStatus" style="border-radius:12px;padding:12px 14px;text-align:center">
          <div style="font-size:12px;font-weight:800" id="quranTargetLabel">Set target dulu</div>
          <div style="font-size:11px;margin-top:4px;opacity:.8" id="quranTargetDetail"></div>
        </div>
      </div>

    </div>
  </div>


  <!-- üòä Mood Hari Ini -->
  <div class="section-card">
    <div class="section-header"><div class="section-icon icon-rose">üòä</div><div><div class="section-title">Bagaimana Perasaanmu Hari Ini?</div><div class="section-sub">Pilih mood yang paling menggambarkan perasaanmu</div></div></div>
    <div class="mood-grid">
      <div class="mood-btn" data-mood="semangat" onclick="setMood('semangat',this)"><span class="mood-emoji">üí™</span><span class="mood-text">Semangat</span></div>
      <div class="mood-btn" data-mood="tenang" onclick="setMood('tenang',this)"><span class="mood-emoji">üòå</span><span class="mood-text">Tenang</span></div>
      <div class="mood-btn" data-mood="syukur" onclick="setMood('syukur',this)"><span class="mood-emoji">ü•∞</span><span class="mood-text">Bersyukur</span></div>
      <div class="mood-btn" data-mood="lelah" onclick="setMood('lelah',this)"><span class="mood-emoji">üò¥</span><span class="mood-text">Lelah</span></div>
      <div class="mood-btn" data-mood="lapar" onclick="setMood('lapar',this)"><span class="mood-emoji">üò§</span><span class="mood-text">Nahan Lapar</span></div>
    </div>
    <div class="mood-selected-msg" id="moodMsg"></div>
  </div>

  <!-- üéØ Target Pribadi -->
  <div class="section-card">
    <div class="section-header"><div class="section-icon icon-purple">üéØ</div><div><div class="section-title">Target Pribadi Hari Ini</div><div class="section-sub">üìã Tulis hal yang ingin kamu lakukan hari ini, centang bila selesai</div></div></div>
    <div style="font-size:13px;color:var(--text-muted);margin-bottom:12px;padding:10px 14px;background:rgba(200,151,58,.07);border-radius:12px;line-height:1.6">
      üí° <strong>Cara pakai:</strong> Klik tombol hijau di bawah ‚Üí ketik target kamu ‚Üí klik ‚úì kalau sudah selesai
    </div>
    <div class="target-list" id="targetList"></div>
    <button class="add-target-btn" onclick="addTarget()" style="width:100%;justify-content:center;padding:12px;font-size:14px;border-radius:14px;border-width:2px;margin-top:6px;background:rgba(50,160,100,.08);border-color:rgba(50,160,100,.4);color:#20A060">
      Ôºã Tambah Target Baru
    </button>
  </div>

  <!-- üíù Amal & Sedekah -->
  <div class="section-card">
    <div class="section-header"><div class="section-icon icon-rose">üíù</div><div><div class="section-title">Amal & Sedekah</div><div class="section-sub">Tap untuk catat amal baik hari ini ü§≤</div></div></div>
    <div class="amal-grid" id="amalGrid"></div>
    <div class="sedekah-section">
      <div style="font-size:14px;font-weight:900;color:var(--text);margin-bottom:8px">üí∞ Catat Sedekah Hari Ini</div>
      <div style="font-size:12px;color:var(--text-muted);margin-bottom:12px;padding:8px 12px;background:rgba(26,107,107,.07);border-radius:10px">
        üìù Tulis keterangan sedekah ‚Üí isi jumlah uang ‚Üí klik tombol <strong>"+ Catat Sedekah"</strong>
      </div>
      <div class="sedekah-row">
        <input type="text" class="sedekah-input" id="sedekahDesc" placeholder="Contoh: Infak masjid, beri makan tetangga...">
        <input type="number" class="sedekah-input" id="sedekahAmt" placeholder="Nominal (Rp)" style="max-width:150px;min-width:110px">
        <button class="sedekah-add" onclick="addSedekah()" style="padding:10px 18px;font-size:13px;border-radius:12px">üíù Catat Sedekah</button>
      </div>
      <div class="sedekah-total"><span class="sedekah-total-label">Total Sedekah Hari Ini</span><span class="sedekah-total-num" id="sedekahTotal">Rp 0</span></div>
      <div class="sedekah-log" id="sedekahLog"></div>
    </div>
  </div>

  <!-- üçΩÔ∏è Menu Makanan -->
  <div class="section-card">
    <div class="section-header" onclick="toggleMenuCollapse()" style="cursor:pointer;user-select:none">
      <div class="section-icon icon-sky">üçΩÔ∏è</div>
      <div style="flex:1"><div class="section-title">Menu Makanan</div><div class="section-sub">Ketuk untuk buka/tutup ¬∑ Sahur, buka, takjil</div></div>
      <div id="menuCollapseArrow" style="font-size:18px;color:var(--text-muted);transition:transform .3s;flex-shrink:0">‚ñæ</div>
    </div>
    <div id="menuBody" style="display:none;margin-top:12px">
      <div class="menu-tabs">
        <div class="menu-tab active" onclick="switchMenu('sahur',this)">üåô Sahur</div>
        <div class="menu-tab" onclick="switchMenu('buka',this)">üåÖ Buka</div>
        <div class="menu-tab" onclick="switchMenu('takjil',this)">üßÜ Takjil</div>
      </div>
      <div style="font-size:12px;color:var(--text-muted);margin-bottom:10px;padding:8px 12px;background:rgba(26,107,107,.07);border-radius:10px">
        üìù Pilih jenis makanan ‚Üí ketik nama menu ‚Üí klik <strong>"Ôºã Tambah"</strong>
      </div>
      <div class="menu-row">
        <input type="text" class="menu-input" id="menuInput" placeholder="Contoh: Nasi goreng, kurma, air putih...">
        <button class="menu-add-btn" onclick="addMenu()" style="padding:9px 20px;font-size:13px;font-weight:800;border-radius:12px;display:flex;align-items:center;gap:6px">Ôºã Tambah</button>
      </div>
      <div class="menu-list" id="menuList"></div>
    </div>
  </div>

  <!-- ‚ú® Syukur -->
  <div class="section-card">
    <div class="section-header"><div class="section-icon icon-gold">‚ú®</div><div><div class="section-title">3 Hal yang Kusyukuri Hari Ini</div><div class="section-sub">Syukur membuka pintu nikmat yang lebih banyak</div></div></div>
    <div class="syukur-list" id="syukurList">
      <div class="syukur-item"><div class="syukur-num">1</div><input class="syukur-input" id="syukur0" placeholder="Hari ini aku bersyukur karena..." oninput="saveSyukur()"></div>
      <div class="syukur-item"><div class="syukur-num">2</div><input class="syukur-input" id="syukur1" placeholder="Nikmat yang aku rasakan..." oninput="saveSyukur()"></div>
      <div class="syukur-item"><div class="syukur-num">3</div><input class="syukur-input" id="syukur2" placeholder="Hal baik yang terjadi hari ini..." oninput="saveSyukur()"></div>
    </div>
    <div class="syukur-hint">üíõ Luangkan 2 menit untuk mengisi ini setiap hari</div>
  </div>

  <!-- ü§≤ Doa Harian -->
  <div class="section-card">
    <div class="section-header"><div class="section-icon icon-teal">ü§≤</div><div><div class="section-title">Doa Harian Ramadan</div><div class="section-sub">Ketuk doa untuk membuka bacaan lengkapnya</div></div></div>
    <div id="doaList" class="doa-all-list"></div>
  </div>

  <!-- üìä Statistik & Rekap Akhir ‚Äî digabung -->
  <div class="section-card" id="rekapAkhirCard">
    <div class="section-header"><div class="section-icon icon-sky">üìä</div><div><div class="section-title">Statistik & Rekap Ramadan</div><div class="section-sub">Visualisasi dan ringkasan perjalanan 30 hari</div></div></div>
    <!-- Tab switcher -->
    <div style="display:flex;gap:6px;margin-bottom:16px;background:rgba(0,0,0,.15);border-radius:14px;padding:4px">
      <button id="mainTabStat" onclick="switchMainTab('stat')" style="flex:1;padding:9px;border-radius:10px;border:none;font-family:'Nunito',sans-serif;font-size:13px;font-weight:800;cursor:pointer;transition:all .25s;background:rgba(26,107,107,.8);color:white">üìä Statistik</button>
      <button id="mainTabRekap" onclick="switchMainTab('rekap')" style="flex:1;padding:9px;border-radius:10px;border:none;font-family:'Nunito',sans-serif;font-size:13px;font-weight:800;cursor:pointer;transition:all .25s;background:transparent;color:rgba(255,255,255,.5)">üåü Rekap Akhir</button>
    </div>
    <!-- Panel Statistik -->
    <div id="mainPanelStat">
      <div class="stat-tabs">
        <div class="stat-tab active" onclick="switchStat('ibadah',this)">üïå Ibadah</div>
        <div class="stat-tab" onclick="switchStat('quran',this)">üìñ Quran</div>
        <div class="stat-tab" onclick="switchStat('sedekah',this)">üí∞ Sedekah</div>
      </div>
      <div class="chart-wrap" style="position:relative">
  <canvas id="statCanvas" class="stat-chart-canvas" height="240"></canvas>
  <div id="statTooltip" style="display:none;position:absolute;pointer-events:none;background:rgba(2,10,20,.92);border:1.5px solid rgba(200,151,58,.5);border-radius:10px;padding:8px 12px;font-size:12px;font-weight:800;color:white;white-space:nowrap;z-index:10;transform:translateX(-50%);box-shadow:0 4px 16px rgba(0,0,0,.4)"></div>
</div>
      <div class="stat-legend" id="statLegend"></div>
      <div class="stat-summary" id="statSummary"></div>
    </div>
    <!-- Panel Rekap Akhir -->
    <div id="mainPanelRekap" style="display:none">
      <div class="rekap-akhir-banner">
        <div class="rekap-akhir-title">‚ú® Alhamdulillah ‚ú®</div>
        <div style="font-size:13px;color:var(--text-muted)">Semoga ibadah Ramadan tahun ini diterima Allah SWT</div>
      </div>
      <div class="rekap-akhir-grid" id="rekapAkhirGrid"></div>
      <div style="margin-top:16px;padding:14px;background:var(--cream);border-radius:14px;text-align:center;border:1px solid var(--cream-dark)">
        <div style="font-size:13px;font-weight:800;color:var(--text);margin-bottom:6px">üèÜ Pencapaian Terbaik</div>
        <div style="font-size:12px;color:var(--text-muted);line-height:1.8" id="rekapAkhirBest"></div>
      </div>
    </div>
  </div>

  <!-- üèÖ Pencapaian -->
  <div class="section-card">
    <div class="section-header"><div class="section-icon icon-gold">üèÜ</div><div><div class="section-title">Pencapaianku</div><div class="section-sub">Kumpulkan badge dengan istiqomah beribadah</div></div></div>
    <div class="badge-grid" id="badgeGrid"></div>
    <div class="badge-progress-wrap" id="badgeProgressWrap"></div>
  </div>



  <!-- üìù Catatan & Refleksi -->
  <div class="section-card">
    <div class="section-header"><div class="section-icon icon-gold">üìù</div><div><div class="section-title">Catatan & Refleksi</div><div class="section-sub">Renungan dan doa harian</div></div></div>
    <textarea class="notes-area" id="notesArea" placeholder="Tulis catatan, refleksi harian, atau doa hari ini..."></textarea>
  </div>

  <!-- üìñ Ayat Harian -->
  <div class="section-card">
    <div class="section-header"><div class="section-icon icon-gold">üìñ</div><div><div class="section-title">Ayat Al-Qur'an Hari Ini</div><div class="section-sub">Satu ayat pilihan setiap hari Ramadan</div></div></div>
    <div class="ayat-card">
      <div class="ayat-arabic" id="ayatArabic"></div>
      <div class="ayat-latin" id="ayatLatin"></div>
      <div class="ayat-arti" id="ayatArti"></div>
      <div class="ayat-ref" id="ayatRef"></div>
    </div>
  </div>

  <!-- üåæ Zakat -->
  <div class="section-card">
    <div class="section-header"><div class="section-icon icon-green">üåæ</div><div><div class="section-title">Kalkulator Zakat Fitrah</div><div class="section-sub">Wajib dibayar sebelum Shalat Idul Fitri</div></div></div>

    <!-- Deadline banner -->
    <div style="background:linear-gradient(135deg,rgba(200,151,58,.18),rgba(200,151,58,.06));border:1.5px solid rgba(200,151,58,.4);border-radius:14px;padding:12px 16px;display:flex;align-items:center;gap:10px;margin-bottom:16px">
      <span style="font-size:22px">‚è∞</span>
      <div>
        <div style="font-size:13px;font-weight:900;color:var(--gold)">Batas Waktu Pembayaran</div>
        <div style="font-size:12px;color:var(--text-muted);margin-top:2px;line-height:1.5">Sebelum shalat Idul Fitri dimulai. Makin cepat makin baik ‚Äî bisa dari awal Ramadan!</div>
      </div>
    </div>

    <div style="display:flex;flex-direction:column;gap:14px">

      <!-- Step 1: Jumlah anggota keluarga -->
      <div style="background:var(--cream);border-radius:16px;padding:16px;border:1.5px solid var(--cream-dark)" class="zakat-step-card">
        <div style="font-size:13px;font-weight:900;color:var(--text);margin-bottom:4px">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Langkah 1 ‚Äî Berapa orang dalam keluargamu?</div>
        <div style="font-size:11px;color:var(--text-muted);margin-bottom:12px">Hitung semua anggota keluarga yang kamu tanggung, termasuk bayi</div>
        <div style="display:flex;align-items:center;justify-content:center;gap:16px">
          <button onclick="changeJiwa(-1)" style="width:44px;height:44px;border-radius:12px;border:2px solid var(--cream-dark);background:white;font-size:22px;font-weight:900;cursor:pointer;display:flex;align-items:center;justify-content:center;color:var(--text);transition:all .15s;box-shadow:0 2px 6px rgba(0,0,0,.06)">‚àí</button>
          <div style="text-align:center">
            <div id="jiwaCount" style="font-family:'Amiri',serif;font-size:3rem;font-weight:700;color:var(--teal);line-height:1">1</div>
            <div style="font-size:11px;font-weight:800;color:var(--text-muted);margin-top:2px">orang</div>
          </div>
          <button onclick="changeJiwa(1)" style="width:44px;height:44px;border-radius:12px;border:2px solid var(--cream-dark);background:white;font-size:22px;font-weight:900;cursor:pointer;display:flex;align-items:center;justify-content:center;color:var(--text);transition:all .15s;box-shadow:0 2px 6px rgba(0,0,0,.06)">+</button>
        </div>
      </div>

      <!-- Step 2: Cara bayar -->
      <div style="background:var(--cream);border-radius:16px;padding:16px;border:1.5px solid var(--cream-dark)" class="zakat-step-card">
        <div style="font-size:13px;font-weight:900;color:var(--text);margin-bottom:4px">üí≥ Langkah 2 ‚Äî Mau bayar pakai apa?</div>
        <div style="font-size:11px;color:var(--text-muted);margin-bottom:12px">Keduanya sah ‚Äî pilih yang paling mudah bagimu</div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
          <button id="btnCaraBeras" onclick="setCaraBayar('beras')" style="padding:12px 8px;border-radius:12px;border:2px solid var(--teal);background:linear-gradient(135deg,rgba(26,107,107,.12),rgba(26,107,107,.04));font-family:'Nunito',sans-serif;font-size:12px;font-weight:800;color:var(--teal);cursor:pointer;transition:all .2s;text-align:center;line-height:1.5">
            üåæ Serahkan Beras<br><span style="font-weight:600;font-size:10px;opacity:.8">Langsung ke masjid/amil</span>
          </button>
          <button id="btnCaraUang" onclick="setCaraBayar('uang')" style="padding:12px 8px;border-radius:12px;border:2px solid var(--cream-dark);background:white;font-family:'Nunito',sans-serif;font-size:12px;font-weight:800;color:var(--text-muted);cursor:pointer;transition:all .2s;text-align:center;line-height:1.5">
            üíµ Bayar Uang<br><span style="font-weight:600;font-size:10px;opacity:.8">Dikonversi ke beras</span>
          </button>
        </div>
      </div>

      <!-- Step 3: Harga beras (hanya tampil jika pilih uang) -->
      <div id="zakatUangWrap" style="display:none;background:var(--cream);border-radius:16px;padding:16px;border:1.5px solid var(--cream-dark)" class="zakat-step-card">
        <div style="font-size:13px;font-weight:900;color:var(--text);margin-bottom:4px">üí∞ Langkah 3 ‚Äî Pilih kisaran harga beras di daerahmu</div>
        <div style="font-size:11px;color:var(--text-muted);margin-bottom:12px">Tidak perlu tepat ‚Äî pilih yang paling mendekati</div>
        <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:6px;margin-bottom:10px">
          <button onclick="setPricePreset(12000)" id="preset1" style="padding:10px 4px;border-radius:10px;border:1.5px solid var(--cream-dark);background:white;font-family:'Nunito',sans-serif;font-size:11px;font-weight:800;color:var(--text-muted);cursor:pointer;transition:all .2s;text-align:center">
            Murah<br><span style="color:var(--teal);font-size:12px">Rp 12.000</span>
          </button>
          <button onclick="setPricePreset(15000)" id="preset2" style="padding:10px 4px;border-radius:10px;border:2px solid var(--teal);background:linear-gradient(135deg,rgba(26,107,107,.1),rgba(26,107,107,.03));font-family:'Nunito',sans-serif;font-size:11px;font-weight:800;color:var(--teal);cursor:pointer;transition:all .2s;text-align:center">
            Sedang<br><span style="font-size:12px">Rp 15.000</span>
          </button>
          <button onclick="setPricePreset(20000)" id="preset3" style="padding:10px 4px;border-radius:10px;border:1.5px solid var(--cream-dark);background:white;font-family:'Nunito',sans-serif;font-size:11px;font-weight:800;color:var(--text-muted);cursor:pointer;transition:all .2s;text-align:center">
            Mahal<br><span style="color:var(--teal);font-size:12px">Rp 20.000</span>
          </button>
        </div>
        <div style="display:flex;align-items:center;gap:8px">
          <span style="font-size:12px;font-weight:800;color:var(--text-muted);white-space:nowrap">atau isi manual:</span>
          <input type="number" id="hargaBeras" value="15000" min="1000" oninput="hitungZakat()" placeholder="Rp/kg" style="flex:1;border:1.5px solid rgba(26,107,107,.3);border-radius:10px;padding:8px 12px;font-family:'Nunito',sans-serif;font-size:13px;font-weight:700;color:var(--text);background:white;outline:none">
        </div>
      </div>

      <!-- Hasil -->
      <div style="background:linear-gradient(135deg,rgba(26,107,107,.12),rgba(26,107,107,.03));border:2px solid rgba(26,107,107,.3);border-radius:18px;padding:20px;text-align:center" class="zakat-result-card">
        <div style="font-size:11px;font-weight:800;color:var(--teal);text-transform:uppercase;letter-spacing:.8px;margin-bottom:12px">‚úÖ Zakat Fitrah yang Harus Dibayar</div>
        <div id="zakatHasilBeras" style="font-family:'Amiri',serif;font-size:2.4rem;font-weight:700;color:var(--teal);line-height:1.1">2,5 kg beras</div>
        <div id="zakatHasilUang" style="font-size:15px;font-weight:900;color:var(--gold);margin-top:8px">‚âà Rp 37.500</div>
        <div style="margin-top:14px;padding-top:12px;border-top:1px solid rgba(26,107,107,.15)">
          <div id="zakatContoh" style="font-size:12px;color:var(--text-muted);line-height:1.8;background:rgba(26,107,107,.05);border-radius:10px;padding:10px">
            1 orang √ó 2,5 kg = <strong>2,5 kg beras</strong>
          </div>
        </div>
      </div>

      <!-- Tips -->
      <div style="background:rgba(200,151,58,.07);border:1px solid rgba(200,151,58,.2);border-radius:14px;padding:14px 16px">
        <div style="font-size:12px;font-weight:900;color:var(--gold);margin-bottom:8px">üí° Tips untuk orang awam</div>
        <div style="display:flex;flex-direction:column;gap:6px">
          <div style="font-size:12px;color:var(--text-muted);display:flex;gap:8px"><span>üïå</span><span>Serahkan ke panitia zakat masjid terdekat atau Baznas/LAZ resmi</span></div>
          <div style="font-size:12px;color:var(--text-muted);display:flex;gap:8px"><span>üìÖ</span><span>Bayar lebih awal lebih baik agar panitia bisa mendistribusikan tepat waktu</span></div>
          <div style="font-size:12px;color:var(--text-muted);display:flex;gap:8px"><span>üë∂</span><span>Bayi yang baru lahir sebelum Idul Fitri juga wajib dizakati</span></div>
          <div style="font-size:12px;color:var(--text-muted);display:flex;gap:8px"><span>üåæ</span><span>Zakat fitrah berbeda dengan zakat mal (zakat harta) ‚Äî ini wajib bagi semua Muslim</span></div>
        </div>
      </div>

    </div>
  </div>

  <!-- üåô Doa Penutup -->
  <div class="section-card" style="margin-bottom:80px">
    <div class="section-header"><div class="section-icon icon-teal">ü§≤</div><div><div class="section-title">Doa Penutup Hari</div><div class="section-sub">Tutup harimu dengan doa yang tulus</div></div></div>
    <div class="ayat-card">
      <div class="ayat-arabic" id="doaArabic"></div>
      <div class="ayat-latin" id="doaLatin"></div>
      <div class="ayat-arti" id="doaArti"></div>
      <div class="ayat-ref" id="doaRef" style="margin-top:10px;font-size:11px;font-weight:800;color:var(--gold);text-align:right"></div>
    </div>
    <div style="text-align:center;margin-top:14px;font-size:12px;color:var(--text-muted);font-style:italic;padding:10px;background:rgba(26,107,107,.05);border-radius:10px;line-height:1.7">
      üåô Semoga Allah menerima seluruh ibadah dan amalmu hari ini.<br>Istirahat yang baik, besok semangat lagi! ‚ú®
    </div>
  </div>
<!-- WATERMARK -->
<div style="text-align:center;padding:24px 16px 32px;pointer-events:none;user-select:none">
  <div style="display:inline-flex;align-items:center;gap:8px;opacity:.35;transition:opacity .3s"
       onmouseenter="this.style.opacity='.7'" onmouseleave="this.style.opacity='.35'">
    <div style="width:32px;height:1px;background:linear-gradient(90deg,transparent,currentColor)"></div>
    <span style="font-size:11px;font-weight:800;letter-spacing:1.5px;font-family:'Nunito',sans-serif;color:var(--text-muted);text-transform:uppercase">Made by Andi Maulana Yusuf</span>
    <div style="width:32px;height:1px;background:linear-gradient(90deg,currentColor,transparent)"></div>
  </div>
  <div style="margin-top:4px;opacity:.2;font-size:9px;font-weight:700;letter-spacing:.8px;color:var(--text-muted);font-family:'Nunito',sans-serif">
    Ramadan Planner 1447H &nbsp;¬∑&nbsp; üåô
  </div>
</div>
</main>





<script>
// ===== LANGUAGE / LOCALIZATION =====
// ===== TEKS IBADAH (Bahasa Indonesia) =====
const IBADAH_LABELS = {
  subuh:   { label: 'Sholat Subuh',    tip: 'Sholat Subuh 2 rakaat' },
  dzuhur:  { label: 'Sholat Dzuhur',   tip: 'Sholat Dzuhur 4 rakaat' },
  ashar:   { label: 'Sholat Ashar',    tip: 'Sholat Ashar 4 rakaat' },
  maghrib: { label: 'Sholat Maghrib',  tip: 'Sholat Maghrib 3 rakaat' },
  isya:    { label: 'Sholat Isya',     tip: 'Sholat Isya 4 rakaat' },
  tarawih: { label: 'Sholat Tarawih',  tip: 'Sholat Tarawih berjamaah' },
  tahajud: { label: 'Sholat Tahajud',  tip: 'Sholat malam minimal 2 rakaat' },
  dzikir:  { label: 'Dzikir Pagi/Petang', tip: 'Baca dzikir pagi dan petang' },
  itikaf:  { label: "I'tikaf",         tip: "Berdiam di masjid dengan niat i'tikaf" },
  witir:   { label: 'Sholat Witir',    tip: 'Sholat witir minimal 1 rakaat' },
};

function L(key, ...args) {
  const TEKS = {
    haidTitle:    'üå∏ Hari Haid/Uzur',
    haidNote:     '<b>Mode Haid/Uzur aktif.</b> Ibadah fisik digantikan dengan dzikir & doa. Tetap semangat! üí™',
    haidSubOn:    'Hari ini ibadah fisik dimaafkan',
    haidSub:      'Tandai jika sedang haid/uzur',
    haidOn:       'Mode haid aktif. Semangat berdzikir! üå∏',
    haidOff:      'Mode haid dinonaktifkan.',
    haidTag:      'Dimaafkan',
    haidWaived:   'Dimaafkan saat haid/uzur',
    badgeWajib:   'Wajib',
    badgeSunnah:  'Sunnah',
    ibadahChecked:'‚úÖ Selesai',
    hintHaid:     `Haid/Uzur ‚Äî ${args[0]} dari ${args[1]} ibadah tersedia selesai üå∏`,
    hintNone:     'Belum ada ibadah hari ini. Yuk mulai! üí™',
    hintAll:      'MasyaAllah! Semua ibadah selesai hari ini! üåü',
    hintSome:     `${args[0]} dari ${args[1]} ibadah selesai. Terus semangat! ‚ú®`,
    toastStreak:  'üî• Streak! Kamu konsisten hari ini, terus pertahankan!',
    toastBadge:   `üèÜ Pencapaian baru: ${args[0]}`,
    toastDay:     `‚ú® Selamat datang di Hari ke-${args[0]} Ramadan 1447H!`,
  };
  // Support ibadah label/tip keys
  if (key.startsWith('ib_')) {
    const parts = key.split('_'); // e.g. ['ib','subuh','label']
    const id = parts[1]; const field = parts[2];
    return (IBADAH_LABELS[id] && IBADAH_LABELS[id][field]) || key;
  }
  return TEKS[key] !== undefined ? TEKS[key] : key;
}

// ===== DATA =====
const DAYS = 30;
let currentDay = 1;
let data = {};
const KEY = 'ramadanPlanner_1447H_v3';

function loadData() {
  try { const r = localStorage.getItem(KEY); if(r) data = JSON.parse(r); } catch(e){}
  for(let d=1;d<=DAYS;d++) if(!data[d]) data[d] = mkDay();
}

function saveData() {
  try {
    localStorage.setItem(KEY, JSON.stringify(data));
    const now = new Date().toLocaleTimeString('id-ID',{hour:'2-digit',minute:'2-digit'});
    document.getElementById('saveStatus').textContent = 'Tersimpan ¬∑ ' + now;
  } catch(e) { showToast('‚ö†Ô∏è Gagal menyimpan data!','error'); }
}

function mkDay() { return {ibadah:{},quranJuz:0,quranHal:0,amal:{},sedekah:[],menu:{sahur:[],buka:[],takjil:[]},notes:'',mood:'',targets:[],syukur:['','',''],tantangan:false,dzikir:{},statusPuasa:'',batalAlasan:'',niatCatatan:'',airMinum:0,shalatTimer:{},haid:false}; }
function ensureDay(d) {
  if(!d.ibadah) d.ibadah={};
  if(!d.sedekah) d.sedekah=[];
  if(!d.targets) d.targets=[];
  if(!d.amal) d.amal={};
  if(!d.menu) d.menu={sahur:[],buka:[],takjil:[]};
  if(!d.menu.sahur) d.menu.sahur=[];
  if(!d.menu.buka) d.menu.buka=[];
  if(!d.menu.takjil) d.menu.takjil=[];
  if(!d.syukur) d.syukur=['','',''];
  if(d.niat===undefined) d.niat=false;
  if(!d.dzikir) d.dzikir={};
  return d;
}

// ===== EXPORT / IMPORT =====
function toggleTutorial() {
  const panel = document.getElementById('tutorialPanel');
  const btn = document.getElementById('tutorialBtn');
  const isOpen = panel.style.display !== 'none';
  panel.style.display = isOpen ? 'none' : 'block';
  if (btn) btn.style.background = isOpen ? 'rgba(255,255,255,.08)' : 'rgba(200,151,58,.25)';
  if (btn) btn.style.borderColor = isOpen ? 'rgba(255,255,255,.2)' : 'rgba(200,151,58,.5)';
  if (btn) btn.style.color = isOpen ? 'rgba(255,255,255,.8)' : 'var(--gold-light)';
  if(!isOpen) showPand('mulai');
}

function showPand(id) {
  ['mulai','ibadah','haid','puasa','qadha','fitur','data'].forEach(s => {
    const el = document.getElementById('pand-' + s);
    if(el) el.style.display = 'none';
    const tab = document.getElementById('ptab-' + s);
    if(tab) tab.classList.remove('pand-active');
  });
  const target = document.getElementById('pand-' + id);
  if(target) target.style.display = 'block';
  const tab = document.getElementById('ptab-' + id);
  if(tab) tab.classList.add('pand-active');
}

function exportData() {
  const payload = btoa(unescape(encodeURIComponent(JSON.stringify({v:3,ts:new Date().toISOString(),data}))));
  const blob = new Blob([payload],{type:'text/plain'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href=url; a.download='ramadan-1447H-backup-'+new Date().toISOString().slice(0,10)+'.txt'; a.click();
  URL.revokeObjectURL(url);
  showToast('üíæ Backup berhasil! File tersimpan di Downloads.','success');
}

function openImportModal() { document.getElementById('importModal').classList.remove('hidden'); document.getElementById('importTextarea').value=''; }
function openResetModal() { document.getElementById('resetModal').classList.remove('hidden'); }
function closeModal() { document.querySelectorAll('.modal-overlay').forEach(m=>m.classList.add('hidden')); }

function doImport() {
  try {
    const raw = document.getElementById('importTextarea').value.trim();
    const decoded = JSON.parse(decodeURIComponent(escape(atob(raw))));
    if(!decoded.data) throw 'invalid';
    data = decoded.data;
    for(let d=1;d<=DAYS;d++) if(!data[d]) data[d]=mkDay();
    saveData(); closeModal(); buildDaySelector(); renderAll();
    showToast('‚úÖ Data berhasil diimport! Semua hari terpulihkan.','success');
  } catch(e) { showToast('‚ùå Kode backup tidak valid. Pastikan copy-paste dengan benar.','error'); }
}

function doReset() {
  data={}; for(let d=1;d<=DAYS;d++) data[d]=mkDay();
  saveData(); closeModal(); buildDaySelector(); renderAll();
  showToast('üóëÔ∏è Semua data telah direset.','info');
}

// ===== TOAST =====
function showToast(msg, type='info') {
  const w = document.getElementById('toastWrap');
  const t = document.createElement('div'); t.className='toast';
  const bg = {success:'rgba(15,70,40,.96)',error:'rgba(100,20,20,.96)',info:'rgba(15,35,50,.96)'};
  t.style.background = bg[type]||bg.info; t.textContent = msg; w.appendChild(t);
  setTimeout(()=>{t.classList.add('out');setTimeout(()=>t.remove(),320);},3200);
}

// ===== QUOTES =====
const QUOTES=[
  {text:'Barangsiapa berpuasa Ramadan karena iman dan mengharap pahala, dosanya yang telah lalu akan diampuni.',src:'HR. Bukhari & Muslim'},
  {text:'Ketika Ramadan tiba, pintu-pintu surga dibuka, pintu-pintu neraka ditutup, dan setan-setan dibelenggu.',src:'HR. Bukhari'},
  {text:'Puasa adalah perisai. Bila seorang dari kalian berpuasa, janganlah berkata kotor dan janganlah bertengkar.',src:'HR. Bukhari'},
  {text:'Ada dua kegembiraan bagi orang yang berpuasa: saat berbuka dan saat berjumpa dengan Rabb-nya.',src:'HR. Bukhari'},
  {text:'Sesungguhnya di dalam surga ada pintu bernama Ar-Rayyan, yang hanya dimasuki orang-orang yang berpuasa.',src:'HR. Bukhari & Muslim'},
  {text:'Wahai orang-orang beriman! Diwajibkan atas kamu berpuasa sebagaimana atas orang sebelum kamu, agar kamu bertakwa.',src:'QS. Al-Baqarah: 183'},
  {text:'Bulan Ramadan adalah bulan diturunkannya Al-Qur\'an sebagai petunjuk bagi manusia.',src:'QS. Al-Baqarah: 185'},
  {text:'Carilah Lailatul Qadar pada malam-malam ganjil di sepuluh hari terakhir bulan Ramadan.',src:'HR. Bukhari'},
  {text:'Sedekah yang paling utama adalah sedekah di bulan Ramadan.',src:'HR. Tirmidzi'},
  {text:'Umrah di bulan Ramadan menyamai pahala haji bersamaku.',src:'HR. Bukhari & Muslim'},
  {text:'Ramadan adalah bulan kesabaran, dan pahala kesabaran adalah surga.',src:'HR. Baihaqi'},
  {text:'Barangsiapa memberi makan orang yang berbuka puasa, maka baginya pahala seperti orang yang berpuasa tanpa menguranginya.',src:'HR. Tirmidzi'},
  {text:'Doa orang yang berpuasa tidak akan ditolak hingga ia berbuka.',src:'HR. Ibn Majah'},
  {text:'Perbanyaklah empat perkara di bulan Ramadan: dua yang membuat Allah ridha dan dua yang kamu butuhkan ‚Äî syahadat dan istighfar, serta meminta surga dan berlindung dari neraka.',src:'HR. Ibnu Khuzaimah'},
  {text:'Tidurnya orang yang berpuasa adalah ibadah, diamnya adalah tasbih, doanya dikabulkan, dan amalannya dilipatgandakan.',src:'HR. Baihaqi'},
  {text:'Sesungguhnya Allah dan para malaikat-Nya bershalawat kepada orang-orang yang sahur.',src:'HR. Ahmad'},
  {text:'Makan sahurlah kalian, karena sesungguhnya pada sahur itu terdapat keberkahan.',src:'HR. Bukhari & Muslim'},
  {text:'Sebaik-baik sedekah adalah yang diberikan kepada kerabat yang pernah memutus silaturahmi denganmu.',src:'HR. Ahmad'},
  {text:'Sesungguhnya Allah mencintai orang-orang yang berbuat kebaikan.',src:'QS. Al-Baqarah: 195'},
  {text:'Barangsiapa yang membaca satu huruf dari Al-Qur\'an, maka baginya satu kebaikan, dan satu kebaikan dilipatgandakan menjadi 10.',src:'HR. Tirmidzi'},
  {text:'Sesungguhnya amal yang paling dicintai Allah adalah yang dikerjakan secara terus-menerus meskipun sedikit.',src:'HR. Bukhari & Muslim'},
  {text:'Dan apabila hamba-hamba-Ku bertanya kepadamu tentang Aku, maka sesungguhnya Aku dekat. Aku mengabulkan permohonan orang yang berdoa.',src:'QS. Al-Baqarah: 186'},
  {text:'Sungguh beruntung orang yang menyucikan dirinya (jiwa), dan sungguh rugi orang yang mengotorinya.',src:'QS. Asy-Syams: 9-10'},
  {text:'Barangsiapa yang Allah kehendaki kebaikan baginya, maka Dia akan memahamkannya dalam agama.',src:'HR. Bukhari & Muslim'},
  {text:'Lailatul Qadar lebih baik dari seribu bulan. Para malaikat dan Ruh turun pada malam itu dengan izin Rabb mereka.',src:'QS. Al-Qadr: 3-4'},
  {text:'Sesungguhnya Allah tidak menyia-nyiakan pahala orang yang berbuat kebaikan.',src:'QS. At-Taubah: 120'},
  {text:'Dan bersegeralah kamu mencari ampunan dari Tuhanmu dan mendapatkan surga yang luasnya seluas langit dan bumi.',src:'QS. Ali Imran: 133'},
  {text:'Wahai manusia, sesungguhnya kamu telah bekerja keras menuju Tuhanmu, maka kamu akan menemui-Nya.',src:'QS. Al-Insyiqaq: 6'},
  {text:'Sesungguhnya orang-orang yang beriman dan mengerjakan amal saleh, mereka mendapat pahala yang tidak putus-putusnya.',src:'QS. At-Tin: 6'},
];

function renderQuote() {
  const q = QUOTES[(currentDay-1) % QUOTES.length];
  document.getElementById('quoteText').textContent = '\u201C' + q.text + '\u201D';
  document.getElementById('quoteSource').textContent = '\u2014 ' + q.src;
}

// ===== HEADER DATE =====
function renderHeaderDate() {
  const start = new Date(2026,1,19);
  const dt = new Date(start); dt.setDate(dt.getDate()+currentDay-1);
  document.getElementById('headerDate').textContent = 'Hari ke-'+currentDay+' \u00B7 '+dt.toLocaleDateString('id-ID',{weekday:'long',day:'numeric',month:'long',year:'numeric'});
}

// ===== TIMES & COUNTDOWN =====
// ‚îÄ‚îÄ Jadwal cache per kota ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let scheduleCache = {};
let currentSchedule = null;

// ‚îÄ‚îÄ Data jadwal offline Ramadan 1447H (19 Feb - 20 Mar 2026) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Format: [imsak, maghrib] per hari (30 hari)
// Sumber: Kemenag RI - bimasislam.kemenag.go.id (Kompas, KapanLagi, Radar Bangkalan)
const OFFLINE_SCHEDULE = {
  // Sumber: tirto.id (via Bimas Islam Kemenag RI) ‚Äî Ramadan 1447H/2026M
  // 3 Zona Waktu: WIB (UTC+7) | WITA (UTC+8) | WIT (UTC+9)
  'Jakarta': [
    ['04:31','18:18'],['04:32','18:18'],['04:32','18:17'],['04:32','18:17'],['04:32','18:17'],
    ['04:32','18:17'],['04:32','18:16'],['04:32','18:16'],['04:33','18:16'],['04:33','18:15'],
    ['04:33','18:15'],['04:33','18:14'],['04:33','18:14'],['04:33','18:14'],['04:33','18:13'],
    ['04:33','18:13'],['04:33','18:12'],['04:33','18:12'],['04:33','18:12'],['04:33','18:11'],
    ['04:33','18:11'],['04:33','18:10'],['04:33','18:10'],['04:33','18:09'],['04:33','18:09'],
    ['04:33','18:09'],['04:32','18:08'],['04:32','18:08'],['04:32','18:07'],['04:32','18:07']],
  'Bandung': [
    ['04:28','18:20'],['04:28','18:19'],['04:28','18:19'],['04:28','18:19'],['04:29','18:18'],
    ['04:29','18:18'],['04:29','18:18'],['04:29','18:17'],['04:29','18:17'],['04:29','18:17'],
    ['04:29','18:16'],['04:29','18:16'],['04:29','18:15'],['04:30','18:15'],['04:30','18:15'],
    ['04:30','18:14'],['04:30','18:14'],['04:30','18:13'],['04:30','18:13'],['04:30','18:12'],
    ['04:30','18:12'],['04:30','18:11'],['04:30','18:11'],['04:30','18:10'],['04:30','18:10'],
    ['04:29','18:10'],['04:29','18:09'],['04:29','18:09'],['04:29','18:08'],['04:29','18:08']],
  'Semarang': [
    ['04:16','18:04'],['04:16','18:04'],['04:17','18:04'],['04:17','18:03'],['04:17','18:03'],
    ['04:17','18:03'],['04:17','18:02'],['04:17','18:02'],['04:17','18:02'],['04:18','18:01'],
    ['04:18','18:01'],['04:18','18:00'],['04:18','18:00'],['04:18','18:00'],['04:18','17:59'],
    ['04:18','17:59'],['04:18','17:58'],['04:18','17:58'],['04:18','17:57'],['04:18','17:57'],
    ['04:18','17:57'],['04:18','17:56'],['04:18','17:56'],['04:18','17:55'],['04:18','17:55'],
    ['04:18','17:54'],['04:18','17:54'],['04:18','17:53'],['04:18','17:53'],['04:18','17:52']],
  'Yogyakarta': [
    ['04:16','18:05'],['04:16','18:04'],['04:16','18:04'],['04:16','18:04'],['04:17','18:03'],
    ['04:17','18:03'],['04:17','18:03'],['04:17','18:02'],['04:17','18:02'],['04:17','18:02'],
    ['04:17','18:01'],['04:17','18:01'],['04:17','18:01'],['04:17','18:00'],['04:17','18:00'],
    ['04:17','18:00'],['04:17','17:59'],['04:17','17:59'],['04:17','17:58'],['04:17','17:58'],
    ['04:17','17:58'],['04:18','17:57'],['04:18','17:57'],['04:18','17:56'],['04:18','17:56'],
    ['04:18','17:55'],['04:18','17:55'],['04:18','17:54'],['04:18','17:54'],['04:18','17:53']],
  'Surabaya': [
    ['04:07','17:55'],['04:07','17:55'],['04:07','17:55'],['04:07','17:54'],['04:08','17:54'],
    ['04:08','17:54'],['04:08','17:53'],['04:08','17:53'],['04:08','17:53'],['04:08','17:52'],
    ['04:08','17:52'],['04:08','17:51'],['04:08','17:51'],['04:09','17:51'],['04:09','17:50'],
    ['04:09','17:50'],['04:09','17:49'],['04:09','17:49'],['04:09','17:48'],['04:09','17:48'],
    ['04:09','17:48'],['04:09','17:47'],['04:09','17:47'],['04:09','17:46'],['04:09','17:46'],
    ['04:09','17:45'],['04:09','17:45'],['04:09','17:44'],['04:08','17:44'],['04:08','17:43']],
  'Malang': [
    ['04:06','17:53'],['04:06','17:53'],['04:06','17:52'],['04:06','17:52'],['04:07','17:52'],
    ['04:07','17:51'],['04:07','17:51'],['04:07','17:50'],['04:07','17:50'],['04:07','17:50'],
    ['04:07','17:49'],['04:07','17:49'],['04:07','17:48'],['04:08','17:48'],['04:08','17:47'],
    ['04:08','17:47'],['04:08','17:46'],['04:08','17:46'],['04:08','17:46'],['04:08','17:45'],
    ['04:08','17:45'],['04:08','17:44'],['04:08','17:44'],['04:08','17:43'],['04:08','17:43'],
    ['04:08','17:42'],['04:08','17:42'],['04:08','17:41'],['04:07','17:41'],['04:07','17:41']],
  'Medan': [
    ['04:59','18:35'],['04:59','18:35'],['04:59','18:34'],['04:59','18:34'],['04:59','18:34'],
    ['04:59','18:34'],['04:59','18:33'],['04:59','18:33'],['04:59','18:33'],['04:59','18:32'],
    ['04:58','18:32'],['04:58','18:31'],['04:58','18:31'],['04:58','18:31'],['04:58','18:30'],
    ['04:58','18:30'],['04:58','18:29'],['04:57','18:29'],['04:57','18:29'],['04:57','18:28'],
    ['04:57','18:28'],['04:56','18:27'],['04:56','18:27'],['04:56','18:26'],['04:56','18:26'],
    ['04:55','18:26'],['04:55','18:25'],['04:55','18:25'],['04:55','18:24'],['04:54','18:24']],
  'Palembang': [
    ['04:43','18:24'],['04:43','18:24'],['04:43','18:23'],['04:43','18:23'],['04:43','18:23'],
    ['04:43','18:23'],['04:43','18:22'],['04:43','18:22'],['04:43','18:22'],['04:43','18:21'],
    ['04:43','18:21'],['04:43','18:21'],['04:43','18:20'],['04:43','18:20'],['04:43','18:20'],
    ['04:43','18:19'],['04:43','18:19'],['04:43','18:18'],['04:43','18:18'],['04:43','18:18'],
    ['04:43','18:17'],['04:43','18:17'],['04:43','18:16'],['04:43','18:16'],['04:43','18:16'],
    ['04:43','18:15'],['04:43','18:15'],['04:43','18:14'],['04:43','18:14'],['04:43','18:14']],
  'Padang': [
    ['05:01','18:40'],['05:01','18:40'],['05:01','18:39'],['05:01','18:39'],['05:01','18:39'],
    ['05:02','18:39'],['05:02','18:39'],['05:02','18:38'],['05:02','18:38'],['05:02','18:38'],
    ['05:02','18:37'],['05:02','18:37'],['05:02','18:37'],['05:02','18:36'],['05:02','18:36'],
    ['05:02','18:36'],['05:02','18:35'],['05:02','18:35'],['05:02','18:34'],['05:02','18:34'],
    ['05:02','18:34'],['05:02','18:33'],['05:02','18:33'],['05:02','18:32'],['05:02','18:32'],
    ['05:02','18:31'],['05:02','18:31'],['05:02','18:31'],['05:02','18:30'],['05:02','18:30']],
  'Pekanbaru': [
    ['04:49','18:28'],['04:49','18:28'],['04:49','18:27'],['04:49','18:27'],['04:49','18:27'],
    ['04:49','18:27'],['04:49','18:26'],['04:49','18:26'],['04:49','18:26'],['04:49','18:25'],
    ['04:49','18:25'],['04:49','18:25'],['04:49','18:24'],['04:49','18:24'],['04:48','18:23'],
    ['04:48','18:23'],['04:48','18:23'],['04:48','18:22'],['04:48','18:22'],['04:48','18:21'],
    ['04:48','18:21'],['04:47','18:21'],['04:47','18:20'],['04:47','18:20'],['04:47','18:19'],
    ['04:47','18:19'],['04:47','18:18'],['04:47','18:18'],['04:47','18:18'],['04:47','18:17']],
  'Aceh': [
    ['05:05','18:41'],['05:05','18:41'],['05:05','18:40'],['05:05','18:40'],['05:05','18:40'],
    ['05:06','18:40'],['05:06','18:40'],['05:06','18:39'],['05:06','18:39'],['05:06','18:38'],
    ['05:06','18:38'],['05:06','18:38'],['05:06','18:37'],['05:06','18:37'],['05:06','18:37'],
    ['05:06','18:36'],['05:06','18:36'],['05:06','18:35'],['05:05','18:35'],['05:05','18:34'],
    ['05:05','18:34'],['05:05','18:34'],['05:04','18:33'],['05:04','18:33'],['05:04','18:32'],
    ['05:04','18:32'],['05:03','18:31'],['05:03','18:31'],['05:03','18:31'],['05:02','18:30']],
  'Pontianak': [
    ['04:25','17:58'],['04:25','17:58'],['04:25','17:58'],['04:25','17:57'],['04:25','17:57'],
    ['04:25','17:57'],['04:25','17:57'],['04:25','17:57'],['04:25','17:56'],['04:25','17:56'],
    ['04:25','17:56'],['04:25','17:56'],['04:25','17:55'],['04:25','17:55'],['04:25','17:55'],
    ['04:25','17:55'],['04:25','17:54'],['04:25','17:54'],['04:25','17:54'],['04:25','17:54'],
    ['04:25','17:53'],['04:25','17:53'],['04:25','17:53'],['04:25','17:53'],['04:25','17:52'],
    ['04:25','17:52'],['04:25','17:52'],['04:25','17:51'],['04:25','17:51'],['04:25','17:51']],
  'Makassar': [
    ['04:42','18:27'],['04:42','18:27'],['04:42','18:26'],['04:43','18:26'],['04:43','18:26'],
    ['04:43','18:25'],['04:43','18:25'],['04:43','18:25'],['04:43','18:25'],['04:43','18:24'],
    ['04:43','18:24'],['04:43','18:24'],['04:43','18:23'],['04:43','18:23'],['04:43','18:22'],
    ['04:43','18:22'],['04:43','18:22'],['04:43','18:21'],['04:43','18:21'],['04:43','18:21'],
    ['04:43','18:20'],['04:43','18:20'],['04:43','18:19'],['04:43','18:19'],['04:43','18:18'],
    ['04:42','18:18'],['04:42','18:18'],['04:42','18:17'],['04:42','18:17'],['04:42','18:16']],
  'Denpasar': [
    ['04:49','18:13'],['04:48','18:13'],['04:48','18:12'],['04:48','18:12'],['04:47','18:12'],
    ['04:47','18:11'],['04:47','18:10'],['04:46','18:10'],['04:46','18:09'],['04:46','18:09'],
    ['04:45','18:08'],['04:45','18:08'],['04:44','18:07'],['04:44','18:07'],['04:44','18:06'],
    ['04:43','18:06'],['04:43','18:05'],['04:43','18:04'],['04:42','18:04'],['04:42','18:03'],
    ['04:41','18:03'],['04:41','18:02'],['04:40','18:01'],['04:40','18:01'],['04:39','18:00'],
    ['04:39','17:59'],['04:38','17:59'],['04:38','17:58'],['04:37','17:57'],['04:37','17:57']],
  'Balikpapan': [
    ['04:37','18:07'],['04:36','18:06'],['04:36','18:06'],['04:36','18:05'],['04:35','18:05'],
    ['04:35','18:04'],['04:35','18:03'],['04:34','18:03'],['04:34','18:02'],['04:34','18:02'],
    ['04:33','18:01'],['04:33','18:00'],['04:32','18:00'],['04:32','17:59'],['04:32','17:58'],
    ['04:31','17:58'],['04:31','17:57'],['04:30','17:56'],['04:30','17:56'],['04:29','17:55'],
    ['04:29','17:54'],['04:28','17:54'],['04:28','17:53'],['04:27','17:52'],['04:27','17:52'],
    ['04:26','17:51'],['04:26','17:50'],['04:25','17:49'],['04:25','17:49'],['04:24','17:48']],
  'Manado': [
    ['04:26','18:06'],['04:25','18:05'],['04:25','18:05'],['04:25','18:04'],['04:24','18:04'],
    ['04:24','18:03'],['04:24','18:02'],['04:23','18:02'],['04:23','18:01'],['04:23','18:00'],
    ['04:22','18:00'],['04:22','17:59'],['04:21','17:58'],['04:21','17:58'],['04:20','17:57'],
    ['04:20','17:56'],['04:19','17:56'],['04:19','17:55'],['04:18','17:54'],['04:18','17:54'],
    ['04:17','17:53'],['04:17','17:52'],['04:16','17:51'],['04:16','17:51'],['04:15','17:50'],
    ['04:15','17:49'],['04:14','17:48'],['04:13','17:48'],['04:13','17:47'],['04:12','17:46']],
  'Banjarmasin': [
    ['04:32','18:10'],['04:31','18:09'],['04:31','18:09'],['04:31','18:08'],['04:30','18:07'],
    ['04:30','18:07'],['04:29','18:06'],['04:29','18:05'],['04:29','18:05'],['04:28','18:04'],
    ['04:28','18:04'],['04:27','18:03'],['04:27','18:02'],['04:27','18:02'],['04:26','18:01'],
    ['04:26','18:00'],['04:25','18:00'],['04:25','17:59'],['04:24','17:58'],['04:24','17:58'],
    ['04:23','17:57'],['04:23','17:56'],['04:22','17:55'],['04:22','17:55'],['04:21','17:54'],
    ['04:21','17:53'],['04:20','17:52'],['04:19','17:52'],['04:19','17:51'],['04:18','17:50']],
  'Samarinda': [
    ['04:33','18:04'],['04:33','18:04'],['04:32','18:03'],['04:32','18:02'],['04:31','18:02'],
    ['04:31','18:01'],['04:31','18:00'],['04:30','18:00'],['04:30','17:59'],['04:29','17:58'],
    ['04:29','17:58'],['04:28','17:57'],['04:28','17:56'],['04:27','17:55'],['04:27','17:55'],
    ['04:26','17:54'],['04:26','17:53'],['04:25','17:52'],['04:25','17:52'],['04:24','17:51'],
    ['04:24','17:50'],['04:23','17:49'],['04:23','17:49'],['04:22','17:48'],['04:22','17:47'],
    ['04:21','17:46'],['04:20','17:45'],['04:20','17:45'],['04:19','17:44'],['04:19','17:43']],
  'Kupang': [
    ['04:43','18:04'],['04:43','18:03'],['04:42','18:02'],['04:42','18:02'],['04:41','18:01'],
    ['04:41','18:00'],['04:40','18:00'],['04:40','17:59'],['04:39','17:58'],['04:39','17:57'],
    ['04:38','17:57'],['04:38','17:56'],['04:37','17:55'],['04:37','17:54'],['04:36','17:54'],
    ['04:36','17:53'],['04:35','17:52'],['04:34','17:51'],['04:34','17:51'],['04:33','17:50'],
    ['04:33','17:49'],['04:32','17:48'],['04:32','17:47'],['04:31','17:47'],['04:31','17:46'],
    ['04:30','17:45'],['04:29','17:44'],['04:29','17:43'],['04:28','17:43'],['04:28','17:42']],
  'Jayapura': [
    ['04:22','17:47'],['04:21','17:46'],['04:21','17:46'],['04:20','17:45'],['04:20','17:44'],
    ['04:19','17:44'],['04:19','17:43'],['04:19','17:42'],['04:18','17:42'],['04:18','17:41'],
    ['04:17','17:40'],['04:17','17:39'],['04:16','17:39'],['04:16','17:38'],['04:15','17:37'],
    ['04:15','17:36'],['04:14','17:36'],['04:13','17:35'],['04:13','17:34'],['04:12','17:33'],
    ['04:12','17:33'],['04:11','17:32'],['04:10','17:31'],['04:10','17:30'],['04:09','17:30'],
    ['04:09','17:29'],['04:08','17:28'],['04:07','17:27'],['04:07','17:26'],['04:06','17:26']],
  'Ambon': [
    ['04:34','18:00'],['04:33','17:59'],['04:33','17:58'],['04:32','17:58'],['04:32','17:57'],
    ['04:31','17:56'],['04:31','17:56'],['04:30','17:55'],['04:30','17:54'],['04:29','17:53'],
    ['04:29','17:53'],['04:28','17:52'],['04:28','17:51'],['04:27','17:50'],['04:27','17:50'],
    ['04:26','17:49'],['04:25','17:48'],['04:25','17:47'],['04:24','17:46'],['04:24','17:46'],
    ['04:23','17:45'],['04:22','17:44'],['04:22','17:43'],['04:21','17:42'],['04:21','17:42'],
    ['04:20','17:41'],['04:19','17:40'],['04:19','17:39'],['04:18','17:38'],['04:17','17:38']],
  'Ternate': [
    ['04:16','17:50'],['04:15','17:49'],['04:15','17:48'],['04:14','17:48'],['04:14','17:47'],
    ['04:13','17:46'],['04:13','17:45'],['04:12','17:45'],['04:12','17:44'],['04:11','17:43'],
    ['04:11','17:42'],['04:10','17:42'],['04:09','17:41'],['04:09','17:40'],['04:08','17:39'],
    ['04:08','17:39'],['04:07','17:38'],['04:06','17:37'],['04:06','17:36'],['04:05','17:35'],
    ['04:05','17:35'],['04:04','17:34'],['04:03','17:33'],['04:02','17:32'],['04:02','17:31'],
    ['04:01','17:31'],['04:00','17:30'],['04:00','17:29'],['03:59','17:28'],['03:58','17:27']],
  'Sorong': [
    ['04:29','17:57'],['04:28','17:57'],['04:28','17:56'],['04:27','17:55'],['04:27','17:55'],
    ['04:26','17:54'],['04:26','17:53'],['04:25','17:52'],['04:25','17:52'],['04:24','17:51'],
    ['04:24','17:50'],['04:23','17:49'],['04:22','17:49'],['04:22','17:48'],['04:21','17:47'],
    ['04:21','17:46'],['04:20','17:45'],['04:19','17:45'],['04:19','17:44'],['04:18','17:43'],
    ['04:18','17:42'],['04:17','17:41'],['04:16','17:41'],['04:16','17:40'],['04:15','17:39'],
    ['04:14','17:38'],['04:14','17:37'],['04:13','17:36'],['04:12','17:36'],['04:12','17:35']],
};

function getOfflineSchedule(city) {
  const data = OFFLINE_SCHEDULE[city] || OFFLINE_SCHEDULE['Jakarta'];
  return data.map(([imsak, maghrib]) => ({ imsak, maghrib }));
}

function cleanTime(str) {
  // Remove timezone offset like " (+07)", " (+08)", " (+09)" etc.
  return str.replace(/\s*\(\+\d+\)/g, '').trim().substring(0, 5);
}

// ‚îÄ‚îÄ Koordinat kota untuk API ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const CITY_COORDS = {
  'Jakarta':    { lat: -6.2088,  lng: 106.8456 },
  'Bandung':    { lat: -6.9175,  lng: 107.6191 },
  'Surabaya':   { lat: -7.2575,  lng: 112.7521 },
  'Medan':      { lat:  3.5952,  lng:  98.6722 },
  'Makassar':   { lat: -5.1477,  lng: 119.4328 },
  'Yogyakarta': { lat: -7.7956,  lng: 110.3695 },
  'Semarang':   { lat: -6.9932,  lng: 110.4203 },
  'Palembang':  { lat: -2.9761,  lng: 104.7754 },
  'Balikpapan': { lat: -1.2379,  lng: 116.8529 },
  'Manado':     { lat:  1.4748,  lng: 124.8421 },
  'Denpasar':   { lat: -8.6705,  lng: 115.2126 },
  'Padang':     { lat: -0.9471,  lng: 100.4172 },
  'Pekanbaru':  { lat:  0.5071,  lng: 101.4478 },
  'Pontianak':  { lat: -0.0264,  lng: 109.3425 },
  'Banjarmasin':{ lat: -3.3186,  lng: 114.5944 },
  'Aceh':       { lat:  5.5483,  lng:  95.3238 },
  'Malang':     { lat: -7.9666,  lng: 112.6326 },
  'Samarinda':  { lat: -0.5016,  lng: 117.1537 },
  'Jayapura':   { lat: -2.5337,  lng: 140.7181 },
  'Kupang':     { lat: -10.1772, lng: 123.6070 },
};

async function fetchScheduleFromAPI(lat, lng, cityName) {
  const results = [];
  const year = 2026;

  // Fungsi fetch tanpa AbortSignal agar kompatibel di semua lingkungan (termasuk iframe)
  async function safeFetch(url) {
    // Gunakan Promise.race untuk timeout manual tanpa AbortSignal
    const fetchPromise = fetch(url);
    const timeoutPromise = new Promise((_, reject) =>
      setTimeout(() => reject(new Error('timeout')), 8000)
    );
    return Promise.race([fetchPromise, timeoutPromise]);
  }

  try {
    setDataSource('online', 'üì° Memuat dari server...');

    const urlFeb = `https://api.aladhan.com/v1/calendar/${year}/2?latitude=${lat}&longitude=${lng}&method=11`;
    const urlMar = `https://api.aladhan.com/v1/calendar/${year}/3?latitude=${lat}&longitude=${lng}&method=11`;

    const [resFeb, resMar] = await Promise.all([safeFetch(urlFeb), safeFetch(urlMar)]);
    const [dataFeb, dataMar] = await Promise.all([resFeb.json(), resMar.json()]);

    if (dataFeb.code !== 200 || dataMar.code !== 200) throw new Error('API error');

    const febDays = dataFeb.data.slice(18); // 19 Feb dst
    const marDays = dataMar.data.slice(0, 20); // 1‚Äì20 Mar
    const allDays = [...febDays, ...marDays].slice(0, 30);

    for (const day of allDays) {
      results.push({
        imsak:   cleanTime(day.timings.Imsak),
        maghrib: cleanTime(day.timings.Maghrib),
      });
    }

    if (results.length >= 28) {
      setDataSource('online', `‚úÖ Data real-time ¬∑ ${cityName}`);
      return results;
    }
    throw new Error('Incomplete data');
  } catch (e) {
    // Sengaja tidak console.warn agar tidak ada pesan error di layar
    return null;
  }
}

function setDataSource(type, text) {
  const badge = document.getElementById('dataSourceBadge');
  const txt = document.getElementById('dataSourceText');
  if (!badge || !txt) return;
  if (type === 'online') {
    badge.style.background = 'rgba(50,160,100,.15)';
    badge.style.borderColor = 'rgba(50,160,100,.3)';
    badge.style.color = '#20A060';
    badge.textContent = 'üåê Online';
  } else {
    badge.style.background = 'rgba(200,151,58,.15)';
    badge.style.borderColor = 'rgba(200,151,58,.3)';
    badge.style.color = 'var(--gold)';
    badge.textContent = 'üì° Offline';
  }
  txt.textContent = text;
}

async function fetchSchedule() {
  const sel = document.getElementById('citySelect');
  const [city, country, tz] = sel.value.split('|');
  const cacheKey = city + '|' + country;

  // Kalau sudah ada cache, langsung pakai tanpa loading spinner
  if (scheduleCache[cacheKey]) {
    currentSchedule = scheduleCache[cacheKey];
    applySchedule(city);
    return;
  }

  // Belum ada cache, tampilkan loading
  document.getElementById('jadwalLoading').style.display = 'block';
  document.getElementById('jadwalError').style.display = 'none';
  document.getElementById('jadwalContent').style.opacity = '0.4';
  document.getElementById('jadwalSub').textContent = 'Mengambil jadwal...';

  // Coba API dulu, fallback ke offline
  const coords = CITY_COORDS[city];
  let apiResult = null;
  if (coords) {
    apiResult = await fetchScheduleFromAPI(coords.lat, coords.lng, city);
  }

  if (apiResult) {
    currentSchedule = apiResult;
    scheduleCache[cacheKey] = currentSchedule;
    applySchedule(city, true);
  } else {
    currentSchedule = getOfflineSchedule(city);
    scheduleCache[cacheKey] = currentSchedule;
    applySchedule(city, false);
  }
}

function toggleJadwal30() {
  const cont = document.getElementById('jadwal30Container');
  const btn  = document.getElementById('btn30hari');
  if (!cont) return;
  if (cont.style.display === 'none') {
    cont.style.display = 'block';
    renderJadwal30();
    if (btn) btn.innerHTML = 'üìÖ Sembunyikan Jadwal 30 Hari';
  } else {
    cont.style.display = 'none';
    if (btn) btn.innerHTML = 'üìÖ Lihat Jadwal Lengkap 30 Hari';
  }
}

function renderJadwal30() {
  const sel    = document.getElementById('citySelect');
  const city   = sel ? sel.value.split('|')[0] : 'Jakarta';
  const tbody  = document.getElementById('jadwal30Body');
  const kotaEl = document.getElementById('jadwal30Kota');
  if (!tbody) return;
  if (kotaEl) kotaEl.textContent = city;
  const sched = OFFLINE_SCHEDULE[city] || OFFLINE_SCHEDULE['Jakarta'];
  const start = new Date(2026, 1, 19);
  const bl = ['Jan','Feb','Mar','Apr','Mei','Jun','Jul','Ags','Sep','Okt','Nov','Des'];
  tbody.innerHTML = sched.map(([imsak, maghrib], i) => {
    const hari   = i + 1;
    const tgl    = new Date(start.getTime() + i * 86400000);
    const tglStr = tgl.getDate() + ' ' + bl[tgl.getMonth()];
    const isT    = hari === currentDay;
    const bg     = isT ? 'background:rgba(200,151,58,.2);' : (i%2===0 ? 'background:rgba(255,255,255,.015);' : '');
    return `<tr style="${bg}">
      <td style="padding:7px 10px;text-align:center;font-weight:${isT?900:600};color:${isT?'var(--gold)':'var(--text)'}">${hari}${isT?' üëà':''}</td>
      <td style="padding:7px 10px;text-align:center;color:var(--text-muted);font-size:11px">${tglStr}</td>
      <td style="padding:7px 10px;text-align:center;font-weight:700;color:var(--teal);font-family:monospace">${imsak}</td>
      <td style="padding:7px 10px;text-align:center;font-weight:700;color:var(--gold);font-family:monospace">${maghrib}</td>
    </tr>`;
  }).join('');
  if (currentDay >= 1 && currentDay <= 30) {
    setTimeout(() => {
      const rows = tbody.querySelectorAll('tr');
      if (rows[currentDay-1]) rows[currentDay-1].scrollIntoView({block:'nearest',behavior:'smooth'});
    }, 120);
  }
}


function applySchedule(city, isOnline) {
  document.getElementById('jadwalLoading').style.display = 'none';
  document.getElementById('jadwalError').style.display = 'none';
  document.getElementById('jadwalContent').style.opacity = '1';
  if (isOnline === true) {
    setDataSource('online', 'Data real-time Aladhan');
    document.getElementById('jadwalSub').textContent = `Jadwal ${city} ¬∑ Data Real-time Aladhan`;
  } else if (isOnline === false) {
    setDataSource('offline', 'tirto.id / Kemenag RI 1447H');
    document.getElementById('jadwalSub').textContent = `Jadwal ${city} ¬∑ Kemenag RI 1447H`;
  }
  // Kalau isOnline undefined (dari cache), tidak update teks ‚Äî biarkan teks sebelumnya
  updateTimes();
}

async function detectLocation() {
  const btn = document.getElementById('gpsBtn');
  const statusEl = document.getElementById('locationStatus');
  if (!navigator.geolocation) {
    showToast('‚ö†Ô∏è Browser tidak mendukung GPS', 'error');
    return;
  }
  btn.textContent = '‚è≥ Mendeteksi...';
  btn.style.opacity = '0.7';
  statusEl.style.display = 'block';
  statusEl.textContent = 'üìç Mendeteksi lokasi kamu...';

  navigator.geolocation.getCurrentPosition(async (pos) => {
    const { latitude: lat, longitude: lng } = pos.coords;
    statusEl.textContent = `üìç Koordinat: ${lat.toFixed(4)}, ${lng.toFixed(4)} ¬∑ Mengambil jadwal...`;

    // Reset cache for this location
    const cacheKey = `gps|${lat.toFixed(2)},${lng.toFixed(2)}`;
    document.getElementById('jadwalLoading').style.display = 'block';
    document.getElementById('jadwalContent').style.opacity = '0.4';

    const apiResult = await fetchScheduleFromAPI(lat, lng, 'Lokasimu');

    if (apiResult) {
      currentSchedule = apiResult;
      scheduleCache[cacheKey] = currentSchedule;
      document.getElementById('jadwalLoading').style.display = 'none';
      document.getElementById('jadwalContent').style.opacity = '1';
      setDataSource('online', 'Data real-time ¬∑ Lokasi GPS');
      document.getElementById('jadwalSub').textContent = `Jadwal Lokasimu ¬∑ Data Real-time Aladhan`;
      updateTimes();
      showToast('üìç Jadwal lokasi GPS berhasil dimuat! üåê', 'success');
      statusEl.textContent = `‚úÖ Jadwal real-time berhasil dimuat dari koordinat ${lat.toFixed(4)}, ${lng.toFixed(4)}`;
    } else {
      document.getElementById('jadwalLoading').style.display = 'none';
      document.getElementById('jadwalContent').style.opacity = '1';
      showToast('‚ö†Ô∏è Gagal ambil jadwal online, pakai data offline', 'error');
      statusEl.textContent = '‚ö†Ô∏è Jadwal real-time gagal, menggunakan data offline kota terdekat';
    }
    btn.textContent = 'üìç Lokasiku';
    btn.style.opacity = '1';
  }, (err) => {
    btn.textContent = 'üìç Lokasiku';
    btn.style.opacity = '1';
    statusEl.style.display = 'none';
    const msgs = { 1:'Izin lokasi ditolak', 2:'Lokasi tidak tersedia', 3:'Timeout' };
    showToast('‚ö†Ô∏è GPS: ' + (msgs[err.code] || 'Gagal'), 'error');
  }, { timeout: 10000, maximumAge: 300000 });
}

function getTodaySchedule() {
  if (!currentSchedule) return null;
  const idx = Math.min(Math.max(currentDay, 1), 30) - 1;
  return currentSchedule[idx] || currentSchedule[29];
}

let _lastCityKey = '';
function onCityChange() {
  const sel = document.getElementById('citySelect');
  const newKey = sel.value.split('|').slice(0,2).join('|');
  if (newKey === _lastCityKey && currentSchedule) {
    // Kota tidak berubah, cukup update tampilan
    updateTimes();
    return;
  }
  _lastCityKey = newKey;
  currentSchedule = null;
  fetchSchedule();
}
// ‚ïê‚ïê‚ïê 3 ZONA WAKTU INDONESIA ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// Sumber data: tirto.id (via Bimas Islam Kemenag RI) Ramadan 1447H/2026M
const ZONA_KOTA = {
  'WIB': [
    {v:'Jakarta|Indonesia|Asia/Jakarta',    l:'Jakarta'},
    {v:'Bandung|Indonesia|Asia/Jakarta',    l:'Bandung'},
    {v:'Semarang|Indonesia|Asia/Jakarta',   l:'Semarang'},
    {v:'Yogyakarta|Indonesia|Asia/Jakarta', l:'Yogyakarta'},
    {v:'Surabaya|Indonesia|Asia/Jakarta',   l:'Surabaya'},
    {v:'Malang|Indonesia|Asia/Jakarta',     l:'Malang'},
    {v:'Medan|Indonesia|Asia/Jakarta',      l:'Medan'},
    {v:'Palembang|Indonesia|Asia/Jakarta',  l:'Palembang'},
    {v:'Padang|Indonesia|Asia/Jakarta',     l:'Padang'},
    {v:'Pekanbaru|Indonesia|Asia/Jakarta',  l:'Pekanbaru'},
    {v:'Aceh|Indonesia|Asia/Jakarta',       l:'Banda Aceh'},
    {v:'Pontianak|Indonesia|Asia/Jakarta',  l:'Pontianak'},
  ],
  'WITA': [
    {v:'Makassar|Indonesia|Asia/Makassar',   l:'Makassar'},
    {v:'Denpasar|Indonesia|Asia/Makassar',   l:'Denpasar / Bali'},
    {v:'Balikpapan|Indonesia|Asia/Makassar', l:'Balikpapan'},
    {v:'Samarinda|Indonesia|Asia/Makassar',  l:'Samarinda'},
    {v:'Banjarmasin|Indonesia|Asia/Makassar',l:'Banjarmasin'},
    {v:'Manado|Indonesia|Asia/Makassar',     l:'Manado'},
    {v:'Kupang|Indonesia|Asia/Makassar',     l:'Kupang'},
  ],
  'WIT': [
    {v:'Jayapura|Indonesia|Asia/Jayapura', l:'Jayapura'},
    {v:'Ambon|Indonesia|Asia/Jayapura',    l:'Ambon'},
    {v:'Ternate|Indonesia|Asia/Jayapura',  l:'Ternate'},
    {v:'Sorong|Indonesia|Asia/Jayapura',   l:'Sorong'},
  ]
};
const ZONA_DESC = {
  'WIB':  'üó∫Ô∏è Waktu Indonesia Barat (UTC+7) ‚Äî Sumatera, Jawa, Kalimantan Barat & Tengah',
  'WITA': 'üó∫Ô∏è Waktu Indonesia Tengah (UTC+8) ‚Äî Bali, NTB, NTT, Sulawesi, Kalimantan Timur & Selatan',
  'WIT':  'üó∫Ô∏è Waktu Indonesia Timur (UTC+9) ‚Äî Maluku & Papua'
};
let currentZona = 'WIB';

function setZona(zona) {
  currentZona = zona;
  ['WIB','WITA','WIT'].forEach(z => {
    const btn = document.getElementById('tab'+z);
    if (!btn) return;
    if (z === zona) {
      btn.style.background = 'var(--gold)';
      btn.style.color = '#020A14';
    } else {
      btn.style.background = 'transparent';
      btn.style.color = 'var(--text-muted)';
    }
  });
  const infoEl = document.getElementById('zonaInfo');
  if (infoEl) infoEl.textContent = ZONA_DESC[zona] || '';
  populateCitySelect(zona);
  onCityChange();
}

function populateCitySelect(zona) {
  const sel = document.getElementById('citySelect');
  if (!sel) return;
  sel.innerHTML = '';
  (ZONA_KOTA[zona] || []).forEach(({v, l}) => {
    const o = document.createElement('option');
    o.value = v;
    o.textContent = l;
    sel.appendChild(o);
  });
}

function autoDetectZona(cityName) {
  for (const [zona, kota] of Object.entries(ZONA_KOTA)) {
    if (kota.some(k => k.v.startsWith(cityName + '|'))) return zona;
  }
  return 'WIB';
}


function updateTimes() {
  const t = getTodaySchedule();
  if (!t) return;
  document.getElementById('timeImsak').textContent = t.imsak;
  document.getElementById('timeBuka').textContent = t.maghrib;
  // Subuh ‚âà imsak + 2 menit, Maghrib = waktu buka
  const subuhEl = document.getElementById('timeSubuh');
  const maghribEl = document.getElementById('timeMaghrib');
  if (subuhEl) {
    // Tambah 2 menit dari imsak untuk waktu subuh
    const [h, m] = t.imsak.split(':').map(Number);
    const total = h * 60 + m + 2;
    subuhEl.textContent = String(Math.floor(total/60)).padStart(2,'0') + ':' + String(total%60).padStart(2,'0');
  }
  if (maghribEl) maghribEl.textContent = t.maghrib;
}

function updateCountdown() {
  const t = getTodaySchedule();
  if (!t) { document.getElementById('countdownTime').textContent = '--:--:--'; return; }
  const now = new Date();
  const [bh,bm] = t.maghrib.split(':').map(Number);
  const [sh,sm] = t.imsak.split(':').map(Number);
  const buka = new Date(); buka.setHours(bh,bm,0,0);
  const sahur = new Date(); sahur.setHours(sh,sm,0,0);
  let target, label;
  if (now < buka) { target = buka; label = 'üåÖ Buka puasa dalam'; }
  else { sahur.setDate(sahur.getDate()+1); target = sahur; label = 'üåô Sahur besok dalam'; }
  const diff = target - now;
  const h = Math.floor(diff/3600000), m = Math.floor((diff%3600000)/60000), s = Math.floor((diff%60000)/1000);
  document.getElementById('countdownLabel').textContent = label;
  document.getElementById('countdownTime').textContent = String(h).padStart(2,'0')+':'+String(m).padStart(2,'0')+':'+String(s).padStart(2,'0');
}
setInterval(updateCountdown, 1000);

// ===== DAY SELECTOR =====
const HARI=['Min','Sen','Sel','Rab','Kam','Jum','Sab'];

// streak:true  = wajib untuk streak (5 fardhu + tarawih)
// streak:false = opsional, tidak mempengaruhi streak
// IBADAH_LIST ‚Äî label & tip diterjemah via L()
const IBADAH_META = {
  subuh:   {icon:'üåÖ', streak:true,  badge:'wajib',  id:'subuh'},
  dzuhur:  {icon:'‚òÄÔ∏è', streak:true,  badge:'wajib',  id:'dzuhur'},
  ashar:   {icon:'üå§Ô∏è', streak:true,  badge:'wajib',  id:'ashar'},
  maghrib: {icon:'üåá', streak:true,  badge:'wajib',  id:'maghrib'},
  isya:    {icon:'üåô', streak:true,  badge:'wajib',  id:'isya'},
  tarawih: {icon:'üïå', streak:true,  badge:'sunnah', id:'tarawih'},
  tahajud: {icon:'‚≠ê', streak:false, badge:'sunnah', id:'tahajud'},
  dzikir:  {icon:'üìø', streak:false, badge:'sunnah', id:'dzikir'},
  itikaf:  {icon:'üïã', streak:false, badge:'sunnah', id:'itikaf'},
  witir:   {icon:'üå†', streak:false, badge:'sunnah', id:'witir'},
};
const IBADAH_ORDER = ['subuh','dzuhur','ashar','maghrib','isya','tarawih','tahajud','dzikir','itikaf','witir'];
// Proxy agar label/tip selalu pakai bahasa aktif
const IBADAH_LIST = IBADAH_ORDER.map(id => ({
  id, icon: IBADAH_META[id].icon, streak: IBADAH_META[id].streak, badge: IBADAH_META[id].badge,
  get label() { return L('ib_'+id+'_label'); },
  get tip()   { return L('ib_'+id+'_tip');   },
}));
const STREAK_LIST = IBADAH_LIST.filter(i=>i.streak);
const HAID_SKIP = new Set(['subuh','dzuhur','ashar','maghrib','isya','tarawih','witir','tahajud','itikaf']);

function isStreakDay(dd) {
  if (dd && dd.haid) {
    const avail = IBADAH_LIST.filter(i => !HAID_SKIP.has(i.id));
    return avail.length > 0 && avail.every(i => (dd.ibadah||{})[i.id]);
  }
  return STREAK_LIST.every(i=>(dd&&dd.ibadah||{})[i.id]);
}
function hasAnyIbadah(dd) {
  return Object.values(dd.ibadah||{}).some(v=>v);
}

function buildDaySelector() {
  const c = document.getElementById('daySelector'); c.innerHTML='';
  const start = new Date(2026,1,19);
  for(let d=1;d<=DAYS;d++){
    const dt=new Date(start); dt.setDate(dt.getDate()+d-1);
    const dd=data[d]||{};
    const perfect=isStreakDay(dd);
    const anyDone=hasAnyIbadah(dd);
    const isHaid=!!dd.haid;
    const btn=document.createElement('div');
    btn.className='day-btn'+(d===currentDay?' active':'');
    btn.id='dayBtn'+d;
    let dotHtml='';
    if(isHaid) dotHtml=`<span class="dot" style="background:#ff69b4"></span>`;
    else if(anyDone) dotHtml=`<span class="dot" style="background:${perfect?'#4ADE80':'var(--gold-light)'}"></span>`;
    if(perfect) dotHtml+=`<span class="streak-star">üî•</span>`;
    if(dd.haid) dotHtml+=`<span class="haid-day-dot" title="${L('haidTitle')}"></span>`;
    btn.innerHTML=`<span class="hari">${HARI[dt.getDay()]}</span><span class="num">${d}</span>${dotHtml}`;
    btn.onclick=()=>switchDay(d); c.appendChild(btn);
  }
  // Scroll container hari secara horizontal saja ‚Äî tidak scroll halaman ke atas
  requestAnimationFrame(() => {
    const activeBtn = document.getElementById('dayBtn' + currentDay);
    if (activeBtn && c) {
      const btnLeft = activeBtn.offsetLeft;
      const btnWidth = activeBtn.offsetWidth;
      const containerWidth = c.offsetWidth;
      c.scrollLeft = btnLeft - (containerWidth / 2) + (btnWidth / 2);
    }
  });
}

function updateHeaderProgress() {
  const pct = Math.round((currentDay / 30) * 100);
  const sisa = Math.max(0, 30 - currentDay);
  const label   = document.getElementById('headerProgressLabel');
  const bar     = document.getElementById('headerProgressBar');
  const hariKe  = document.getElementById('headerHariKe');
  const sisaEl  = document.getElementById('headerSisaHari');
  if (label)  label.textContent  = pct + '%';
  if (bar)    bar.style.width    = pct + '%';
  if (hariKe) hariKe.textContent = currentDay;
  if (sisaEl) sisaEl.textContent = sisa;
}

function switchDay(d) { currentDay=d; ensureDay(data[currentDay]); buildDaySelector(); renderAll(); updateTimes(); updateHeaderProgress(); checkRekapMingguan(); }

// ===== IBADAH =====
// ‚îÄ‚îÄ Haid UI renderer ‚îÄ‚îÄ
function renderHaidUI() {
  const d = data[currentDay] || {};
  const on = !!d.haid;
  const chk = document.getElementById('haidCheck');
  const bar = document.getElementById('haidBar');
  const note = document.getElementById('haidNote');
  const sub = document.getElementById('txtHaidSub');
  const title = document.getElementById('txtHaidTitle');
  if(chk) chk.checked = on;
  if(bar) bar.classList.toggle('on', on);
  if(note){ note.style.display = on?'block':'none'; if(on) note.innerHTML = L('haidNote'); }
  if(title) title.textContent = L('haidTitle');
  if(sub) sub.textContent = on ? L('haidSubOn') : L('haidSub');
}

function toggleHaid() {
  const d = data[currentDay];
  d.haid = !d.haid;
  if(d.haid) HAID_SKIP.forEach(id => { d.ibadah[id] = false; });
  saveData(); renderIbadah(); renderHaidUI(); updateDayBtn(currentDay);
  showToast(d.haid ? L('haidOn') : L('haidOff'), 'success');
  if(d.haid) {
    setTimeout(() => showToast('üå∏ Jangan lupa dzikir pagi & petang, baca Quran, dan berdoa ya!', 'info'), 1800);
  }
}

function renderIbadah() {
  const d=data[currentDay]; const c=document.getElementById('ibadahList'); c.innerHTML='';
  const isHaid = !!d.haid;
  IBADAH_LIST.forEach(item=>{
    const skip = isHaid && HAID_SKIP.has(item.id);
    const checked = skip ? false : !!(d.ibadah[item.id]);
    const el=document.createElement('div');
    el.className='ibadah-item'+(checked?' checked-state':'')+(skip?' haid-skip':'');
    el.setAttribute('data-ibadah-id', item.id);
    const badgeTxt = item.badge==='wajib' ? L('badgeWajib') : L('badgeSunnah');
    el.innerHTML=`
      <div class="ibadah-check">${checked?'‚úì':skip?'‚Äî':''}</div>
      <div class="ibadah-icon">${item.icon}</div>
      <div class="ibadah-label-wrap">
        <div class="ibadah-label">${item.label}${skip?`<span class="haid-tag">${L('haidTag')}</span>`:''}</div>
        <div class="ibadah-sublabel">${skip?L('haidWaived'):checked?L('ibadahChecked'):item.tip}</div>
      </div>
      <div class="ibadah-badge" style="${skip?'opacity:.35':''}">${badgeTxt}</div>`;
    if(!skip) el.onclick=()=>toggleIbadah(item.id);
    c.appendChild(el);
  });
  const hint=document.createElement('div'); hint.className='ibadah-hint';
  const avail = isHaid ? IBADAH_LIST.filter(i=>!HAID_SKIP.has(i.id)) : IBADAH_LIST;
  const done = avail.filter(i=>(d.ibadah||{})[i.id]).length;
  hint.textContent = isHaid ? L('hintHaid',done,avail.length)
    : done===0 ? L('hintNone')
    : done===IBADAH_LIST.length ? L('hintAll')
    : L('hintSome',done,IBADAH_LIST.length);
  c.appendChild(hint);
  renderHaidUI();
  updateSummary();
}

function toggleIbadah(id) {
  const d = data[currentDay];
  d.ibadah[id] = !d.ibadah[id];
  hapticFeedback(d.ibadah[id]);
  playClickSound(d.ibadah[id]);
  if (d.ibadah[id]) startShalatTimer(id);
  if (isStreakDay(d)) showToast(L('toastStreak'),'success');
  saveData(); renderIbadah(); updateDayBtn(currentDay); renderStreak(); renderOverallProgress();
  setTimeout(injectShalatTimers, 50);
  // Animate the item
  setTimeout(() => {
    const el = document.querySelector(`[data-ibadah-id="${id}"]`);
    if (el) { el.classList.add('checked'); setTimeout(() => el.classList.remove('checked'), 400);
    // Juga update checked-state untuk styling
    el.classList.toggle('checked-state', !!(data[currentDay].ibadah[id])); }
  }, 10);
}

// Update hanya satu tombol hari di selector tanpa rebuild seluruhnya (mencegah scroll)
function updateDayBtn(d) {
  const btn = document.getElementById('dayBtn' + d);
  if (!btn) return;
  const dd = data[d] || {};
  const perfect = isStreakDay(dd);
  const anyDone = hasAnyIbadah(dd);
  const isHaid = !!dd.haid;
  const dt = new Date(2026,1,19); dt.setDate(dt.getDate() + d - 1);
  let dotHtml = '';
  if (isHaid) dotHtml = `<span class="dot" style="background:#ff69b4"></span>`;
  else if (anyDone) dotHtml = `<span class="dot" style="background:${perfect?'#4ADE80':'var(--gold-light)'}"></span>`;
  if (perfect) dotHtml += `<span class="streak-star">üî•</span>`;
  btn.innerHTML = `<span class="hari">${HARI[dt.getDay()]}</span><span class="num">${d}</span>${dotHtml}`;
  if (isHaid) btn.style.cssText = (btn.style.cssText||'') + 'border-color:rgba(255,105,180,0.5)!important;';
}

// ===== QURAN =====
function renderQuran() {
  const d = data[currentDay];
  const juz = d.quranJuz || 0;
  const hal = d.quranHal || 0;
  const juzPct = Math.min(100, Math.round((juz / 30) * 100));
  const halPct = Math.min(100, Math.round((hal / 604) * 100));

  document.getElementById('quranJuz').value = juz;
  document.getElementById('quranHal').value = hal;
  document.getElementById('quranBar').style.width = juzPct + '%';
  document.getElementById('quranPct').textContent = juzPct + '% dari target khatam';
  document.getElementById('quranJuzBadge').textContent = juz + ' / 30 juz';
  document.getElementById('quranHalBar').style.width = halPct + '%';
  document.getElementById('quranHalPct').textContent = halPct + '% dari 604 halaman';
  document.getElementById('quranHalBadge').textContent = hal + ' / 604 hal';

  // Update ring & total
  const totalJuz = Array.from({length:30},(_,i)=>data[i+1]||{}).reduce((s,dd)=>s+(dd.quranJuz||0),0);
  const ringPct = Math.min(100, Math.round((totalJuz / 30) * 100));
  const offset = 188.5 - (188.5 * ringPct / 100);
  const ring = document.getElementById('quranRingFill');
  if (ring) ring.style.strokeDashoffset = offset;
  document.getElementById('quranRingPct').textContent = ringPct + '%';
  document.getElementById('quranTotalNum').textContent = totalJuz + ' juz';
  const msgs = ['Belum ada bacaan tercatat','Awal yang baik! Terus semangat üí™','Bagus! Setengah jalan lagi üìñ','Hampir khatam! Luar biasa üåü','Masya Allah! Khatam Ramadan ini üèÜ'];
  document.getElementById('quranTotalSub').textContent = ringPct === 0 ? msgs[0] : ringPct < 30 ? msgs[1] : ringPct < 70 ? msgs[2] : ringPct < 100 ? msgs[3] : msgs[4];
}

function updateQuran() {
  const el = document.getElementById('quranJuz');
  const v = Math.min(30, Math.max(0, parseInt(el.value) || 0));
  data[currentDay].quranJuz = v;
  saveData(); renderQuran(); renderOverallProgress(); buildDaySelector();
}
function updateHalaman() {
  const el = document.getElementById('quranHal');
  data[currentDay].quranHal = Math.min(604, Math.max(0, parseInt(el.value) || 0));
  saveData(); renderQuran();
}

// ===== MOOD =====
function setMood(mood,el) {
  data[currentDay].mood=mood;
  document.querySelectorAll('.mood-btn').forEach(b=>b.classList.remove('selected'));
  el.classList.add('selected');
  var msgs = {
    semangat: 'üí™ MasyaAllah! Semangat ibadahnya hari ini ya!',
    tenang: 'üòå Alhamdulillah, hati yang tenang adalah nikmat.',
    syukur: 'ü•∞ Bersyukur adalah ibadah. Masya Allah!',
    lelah: 'üò¥ Istirahat yang cukup juga bagian dari ibadah. Jaga kesehatan ya!',
    lapar: 'üò§ Sabar ya! Lapar ini bernilai ibadah. Sebentar lagi berbuka üåô'
  };
  var msgEl = document.getElementById('moodMsg');
  if (msgEl) { msgEl.textContent = msgs[mood]||''; msgEl.className = 'mood-selected-msg show'; }
  saveData();
  const labels={semangat:'üí™ Semangat!',tenang:'üòå Alhamdulillah tenang ya',syukur:'ü•∞ Bersyukurlah selalu!',lelah:'üò¥ Istirahat ya, puasa tetap semangat!',lapar:'üò§ Sabar, sebentar lagi buka!'};
  showToast(labels[mood]||'Mood tersimpan','success');
}
function renderMood() {
  var mood = data[currentDay].mood;
  document.querySelectorAll('.mood-btn').forEach(function(b){ b.classList.toggle('selected', b.dataset.mood===mood); });
  var msgs = {
    semangat:'üí™ MasyaAllah! Semangat ibadahnya hari ini ya!',
    tenang:'üòå Alhamdulillah, hati yang tenang adalah nikmat.',
    syukur:'ü•∞ Bersyukur adalah ibadah. Masya Allah!',
    lelah:'üò¥ Istirahat yang cukup juga bagian dari ibadah. Jaga kesehatan ya!',
    lapar:'üò§ Sabar ya! Lapar ini bernilai ibadah. Sebentar lagi berbuka üåô'
  };
  var msgEl = document.getElementById('moodMsg');
  if (msgEl && mood) { msgEl.textContent = msgs[mood]||''; msgEl.className = 'mood-selected-msg show'; }
  else if (msgEl) { msgEl.className = 'mood-selected-msg'; }
}

// ===== TARGETS =====
function renderTargets() {
  const d=data[currentDay]; const c=document.getElementById('targetList'); c.innerHTML='';
  (d.targets||[]).forEach((t,i)=>{
    const el=document.createElement('div'); el.className='target-item';
    el.innerHTML=`<div class="target-input-wrap"><input type="text" class="target-input${t.done?' done-input':''}" value="${(t.text||'').replace(/"/g,'&quot;')}" placeholder="Target hari ini..." oninput="updateTarget(${i},this.value)"><button class="target-check-btn${t.done?' checked':''}" onclick="toggleTarget(${i})">${t.done?'‚úì':''}</button></div><button class="target-del-btn" onclick="deleteTarget(${i})">‚úï</button>`;
    c.appendChild(el);
  });
}
function addTarget() {
  if(!data[currentDay].targets) data[currentDay].targets=[];
  data[currentDay].targets.push({text:'',done:false}); saveData(); renderTargets();
  setTimeout(()=>{ const ins=document.querySelectorAll('.target-input'); if(ins.length) ins[ins.length-1].focus(); },50);
}
function updateTarget(i,v) { data[currentDay].targets[i].text=v; saveData(); }
function toggleTarget(i) { data[currentDay].targets[i].done=!data[currentDay].targets[i].done; saveData(); renderTargets(); }
function deleteTarget(i) { data[currentDay].targets.splice(i,1); saveData(); renderTargets(); }

// ===== AMAL =====
const AMAL_LIST=[{id:'infak',icon:'üí∞',name:'Infak/Sedekah',unit:'kali'},{id:'silaturahmi',icon:'ü§ù',name:'Silaturahmi',unit:'kali'},{id:'tolong',icon:'üôè',name:'Menolong',unit:'kali'},{id:'istighfar',icon:'üìø',name:'Istighfar',unit:'\u00D7100'}];
function renderAmal() {
  const d=data[currentDay]; const c=document.getElementById('amalGrid'); c.innerHTML='';
  AMAL_LIST.forEach(item=>{
    const cnt=d.amal[item.id]||0; const el=document.createElement('div');
    el.className='amal-card'+(cnt>0?' active':'');
    el.innerHTML=`<div class="amal-icon">${item.icon}</div><div class="amal-name">${item.name}</div><div class="amal-count"><button class="amal-btn" onclick="changeAmal('${item.id}',-1,event)">\u2212</button><span class="amal-num">${cnt}</span><button class="amal-btn" onclick="changeAmal('${item.id}',1,event)">+</button></div><div class="amal-unit">${item.unit}</div>`;
    c.appendChild(el);
  });
  updateSummary();
}
function changeAmal(id,delta,e) {
  e.stopPropagation();
  const d=data[currentDay]; d.amal[id]=Math.max(0,(d.amal[id]||0)+delta);
  saveData(); renderAmal();
}

// ===== SEDEKAH =====
function renderSedekah() {
  const d = data[currentDay];
  if (!d.sedekah) d.sedekah = [];
  const total = (d.sedekah||[]).reduce((s,i) => s + i.amt, 0);
  document.getElementById('sedekahTotal').textContent = 'Rp ' + total.toLocaleString('id-ID');
  const log = document.getElementById('sedekahLog');
  if (!log) return;
  if (d.sedekah.length === 0) {
    log.innerHTML = '<div style="text-align:center;padding:16px;color:var(--text-muted);font-size:13px;opacity:.7">Belum ada catatan sedekah hari ini üíù</div>';
    return;
  }
  log.innerHTML = d.sedekah.map((item, i) => `
    <div class="sedekah-log-item">
      <span class="sedekah-log-desc">üíù ${item.desc || 'Sedekah'}</span>
      <span class="sedekah-log-amt">Rp ${item.amt.toLocaleString('id-ID')}</span>
      <button class="sedekah-log-del" onclick="delSedekah(${i})" title="Hapus">‚úï</button>
    </div>
  `).join('');
}
function addSedekah() {
  const desc=document.getElementById('sedekahDesc').value.trim()||'Sedekah';
  const amt=parseInt(document.getElementById('sedekahAmt').value)||0;
  if(amt<=0){showToast('‚ö†Ô∏è Masukkan nominal sedekah!','error');return;}
  if(!data[currentDay].sedekah) data[currentDay].sedekah=[];
  data[currentDay].sedekah.push({desc,amt});
  document.getElementById('sedekahDesc').value=''; document.getElementById('sedekahAmt').value='';
  saveData(); renderSedekah(); renderOverallProgress(); updateSummary();
  showToast('üíù Sedekah Rp'+amt.toLocaleString('id-ID')+' tercatat. Barakallahu fiik!','success');
}

function delSedekah(idx) {
  const d = data[currentDay];
  if (!d.sedekah) return;
  d.sedekah.splice(idx, 1);
  saveData();
  renderSedekah();
  showToast('üóëÔ∏è Catatan sedekah dihapus', 'success');
}
function removeSedekah(i) { data[currentDay].sedekah.splice(i,1); saveData(); renderSedekah(); renderOverallProgress(); }

// ===== MENU =====
let curMenuType='sahur';
function switchMenu(type,el) { curMenuType=type; document.querySelectorAll('.menu-tab').forEach(t=>t.classList.remove('active')); el.classList.add('active'); renderMenu(); }
function renderMenu() {
  const items=(data[currentDay].menu||{})[curMenuType]||[]; const c=document.getElementById('menuList'); c.innerHTML='';
  items.forEach((item,i)=>{ const el=document.createElement('div'); el.className='menu-tag'; el.innerHTML=`${item} <span class="del" onclick="removeMenu(${i})">&#10005;</span>`; c.appendChild(el); });
}
function addMenu() {
  const input=document.getElementById('menuInput'); const v=input.value.trim(); if(!v){showToast('‚ö†Ô∏è Ketik nama menu dulu!','error');return;}
  if(!data[currentDay].menu) data[currentDay].menu={sahur:[],buka:[],takjil:[]};
  if(!data[currentDay].menu[curMenuType]) data[currentDay].menu[curMenuType]=[];
  data[currentDay].menu[curMenuType].push(v); input.value=''; saveData(); renderMenu();
  showToast('üçΩÔ∏è Menu '+v+' ditambahkan ke '+curMenuType+'!','success');
}
function removeMenu(i) { data[currentDay].menu[curMenuType].splice(i,1); saveData(); renderMenu(); }
document.getElementById('menuInput').addEventListener('keydown',e=>{ if(e.key==='Enter') addMenu(); });

// ===== NOTES =====
function renderNotes() { document.getElementById('notesArea').value=data[currentDay].notes||''; }
document.getElementById('notesArea').addEventListener('input',function(){ data[currentDay].notes=this.value; saveData(); });

// ===== STREAK CALENDAR =====
function renderStreak() {
  const c=document.getElementById('streakGrid'); c.innerHTML='';
  for(let d=1;d<=DAYS;d++){
    const dd=data[d]||{};
    const perfect=isStreakDay(dd);
    const anyDone=hasAnyIbadah(dd);
    const isHaid=!!dd.haid;
    const streakDone=STREAK_LIST.filter(i=>(dd.ibadah||{})[i.id]).length;
    const el=document.createElement('div');
    el.className='streak-day'+(isHaid?' haid-day':perfect?' perfect':anyDone?' partial':'')+(d===currentDay?' today':'');
    el.textContent=d;
    el.title=isHaid ? `Hari ${d}: üå∏ Haid/Uzur` : `Hari ${d}: Streak ${streakDone}/${STREAK_LIST.length} (fardhu+tarawih)`;
    if(isHaid) el.style.cssText='background:rgba(255,182,193,0.35);border-color:rgba(255,105,180,0.6);color:#ff69b4;';
    el.onclick=()=>switchDay(d); c.appendChild(el);
  }
}

// calcStreak: streak aktif mundur dari currentDay (untuk tampilan summary)
function calcStreak() {
  let s=0;
  for(let d=currentDay;d>=1;d--){
    const dd=data[d]||{};
    if(dd.haid) continue; // hari haid exempt, tidak memutus streak
    if(isStreakDay(dd)) s++; else break;
  }
  return s;
}

// calcBestStreak: streak TERPANJANG yang pernah dicapai dari hari 1-30 (untuk badge)
function calcBestStreak() {
  let best=0, cur=0;
  for(let d=1;d<=30;d++){
    const dd=data[d]||{};
    if(dd.haid) continue; // hari haid exempt
    if(isStreakDay(dd)) { cur++; if(cur>best) best=cur; }
    else cur=0;
  }
  return best;
}

// ===== OVERALL PROGRESS =====
function renderOverallProgress() {
  let tIbadah=0,mxIbadah=0,tJuz=0,perfectDays=0,tSedekah=0;
  for(let d=1;d<=currentDay;d++){
    const dd=data[d]||{};
    const done=Object.values(dd.ibadah||{}).filter(v=>v).length;
    tIbadah+=done; mxIbadah+=IBADAH_LIST.length;
    tJuz+=(dd.quranJuz||0);
    if(isStreakDay(dd)) perfectDays++;
    tSedekah+=(dd.sedekah||[]).reduce((s,i)=>s+i.amt,0);
  }
  const ip=mxIbadah>0?Math.round((tIbadah/mxIbadah)*100):0;
  const qp=Math.min(100,Math.round((tJuz/30)*100));
  const sp=Math.round((perfectDays/Math.max(1,currentDay))*100);
  const sep=Math.min(100,Math.round((tSedekah/500000)*100));
  (function(){var _e=document.getElementById('progIbadah');if(_e)_e.style.width=ip+'%'})(); (function(){var _e=document.getElementById('progIbadahPct');if(_e)_e.textContent=ip+'%'})();
  (function(){var _e=document.getElementById('progQuran');if(_e)_e.style.width=qp+'%'})(); (function(){var _e=document.getElementById('progQuranPct');if(_e)_e.textContent=tJuz+' juz'})();
  (function(){var _e=document.getElementById('progStreak');if(_e)_e.style.width=sp+'%'})(); (function(){var _e=document.getElementById('progStreakPct');if(_e)_e.textContent=perfectDays+' hari'})();
  (function(){var _e=document.getElementById('progSedekah');if(_e)_e.style.width=sep+'%'})(); (function(){var _e=document.getElementById('progSedekahTotal');if(_e)_e.textContent='Rp '+(tSedekah>=1000000?(tSedekah/1000000).toFixed(1)+'jt':tSedekah>=1000?(tSedekah/1000).toFixed(0)+'rb':tSedekah)})();
}

// ===== SUMMARY =====

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// WIDGET RINGKASAN HARIAN
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function updateDailyWidget() {
  const d = data[currentDay] || {};
  const done = Object.values(d.ibadah||{}).filter(v=>v).length;
  const total = IBADAH_LIST.length;
  const streak = calcStreak();
  const juz = d.quranJuz || 0;
  const niat = d.niat;

  const dwDay = document.getElementById('dwDay');
  const dwIbadah = document.getElementById('dwIbadah');
  const dwStreak = document.getElementById('dwStreak');
  const dwNiat = document.getElementById('dwNiat');
  const dwJuz = document.getElementById('dwJuz');
  const dwBar = document.getElementById('dwBar');
  const dwBarLeft = document.getElementById('dwBarLeft');
  const dwBarRight = document.getElementById('dwBarRight');

  if(dwDay) dwDay.textContent = currentDay;
  if(dwIbadah) dwIbadah.textContent = done+'/'+total;
  if(dwStreak) dwStreak.textContent = streak + '\uD83D\uDD25';
  if(dwNiat) { dwNiat.textContent = niat ? '\u2705' : '\u274C'; }
  if(dwJuz) dwJuz.textContent = juz + ' juz';
  const pct = total > 0 ? Math.round((done/total)*100) : 0;
  if(dwBar) dwBar.style.width = pct + '%';
  if(dwBarLeft) dwBarLeft.textContent = done + ' ibadah selesai';
  if(dwBarRight) dwBarRight.textContent = pct + '% hari ini';

  // Hari tersisa counter
  const dwHT = document.getElementById('dwHariTersisa');
  if(dwHT) {
    const tersisa = 30 - currentDay;
    if(tersisa > 0) dwHT.textContent = '‚è≥ ' + tersisa + ' hari lagi menuju akhir Ramadan';
    else if(tersisa === 0) dwHT.textContent = 'üåô Ini hari terakhir Ramadan! Semangat!';
    else dwHT.textContent = 'üéâ Ramadan telah selesai. Semoga diterima Allah!';
  }

  // Haid badge di widget
  let haidBadge = document.getElementById('dwHaidBadge');
  if(d.haid) {
    if(!haidBadge) {
      haidBadge = document.createElement('div');
      haidBadge.id = 'dwHaidBadge';
      haidBadge.style.cssText = 'display:flex;align-items:center;gap:6px;padding:5px 12px;background:rgba(255,182,193,0.2);border:1.5px solid rgba(255,105,180,0.4);border-radius:20px;font-size:12px;font-weight:800;color:#ff69b4;margin-top:8px;width:fit-content;';
      haidBadge.innerHTML = 'üå∏ Hari Haid/Uzur ‚Äî Streak tetap terjaga';
      const dwEl = document.getElementById('dailyWidget');
      if(dwEl) dwEl.appendChild(haidBadge);
    }
    haidBadge.style.display = 'flex';
  } else {
    if(haidBadge) haidBadge.style.display = 'none';
  }

  // Update notif button state
  const notifBtn = document.getElementById('dwNotifBtn');
  const ns = getNotifSettings();
  if(notifBtn) {
    const anyOn = ns.imsak || ns.buka || ns.tarawih || ns.dzikir;
    notifBtn.classList.toggle('active', anyOn);
    notifBtn.textContent = anyOn ? '\uD83D\uDD14 Notif Aktif' : '\uD83D\uDD14 Notifikasi';
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// NOTIFIKASI
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function getNotifSettings() {
  try { return JSON.parse(localStorage.getItem('notifSettings')||'{}'); } catch(e) { return {}; }
}
function saveNotifSettings() {
  const s = {
    imsak: document.getElementById('notifImsak').checked,
    buka: document.getElementById('notifBuka').checked,
    tarawih: document.getElementById('notifTarawih').checked,
    dzikir: document.getElementById('notifDzikir').checked,
    imsakMenit: parseInt(document.getElementById('notifImsakMenit').value)||15,
    tarawihJam: document.getElementById('notifTarawihJam').value||'19:45',
  };
  localStorage.setItem('notifSettings', JSON.stringify(s));
  rescheduleNotifications();
  updateDailyWidget();
}
function loadNotifSettings() {
  const s = getNotifSettings();
  const el = id => document.getElementById(id);
  if(el('notifImsak')) el('notifImsak').checked = !!s.imsak;
  if(el('notifBuka')) el('notifBuka').checked = !!s.buka;
  if(el('notifTarawih')) el('notifTarawih').checked = !!s.tarawih;
  if(el('notifDzikir')) el('notifDzikir').checked = !!s.dzikir;
  if(el('notifImsakMenit')) el('notifImsakMenit').value = s.imsakMenit||15;
  if(el('notifTarawihJam')) el('notifTarawihJam').value = s.tarawihJam||'19:45';
}
function openNotifModal() {
  loadNotifSettings();
  updateNotifPermStatus();
  document.getElementById('notifModal').classList.add('show');
}
function closeNotifModal() {
  document.getElementById('notifModal').classList.remove('show');
}
function updateNotifPermStatus() {
  const el = document.getElementById('notifPermStatus');
  if(!el) return;
  if(!('Notification' in window)) {
    el.style.display='block'; el.textContent='\u26A0\uFE0F Browser ini tidak mendukung notifikasi.'; return;
  }
  if(Notification.permission === 'granted') {
    el.style.display='block'; el.style.background='rgba(46,158,100,.15)'; el.style.borderColor='rgba(46,158,100,.3)';
    el.textContent='\u2705 Izin notifikasi sudah diberikan. Notifikasi akan muncul saat tab ini terbuka.';
  } else if(Notification.permission === 'denied') {
    el.style.display='block'; el.style.background='rgba(200,60,60,.15)'; el.style.borderColor='rgba(200,60,60,.3)';
    el.textContent='\u274C Notifikasi diblokir browser. Buka pengaturan browser dan izinkan notifikasi untuk situs ini.';
  } else {
    el.style.display='block';
    el.textContent='\uD83D\uDCA1 Klik tombol di bawah untuk mengizinkan notifikasi dari browser.';
  }
}
async function requestNotifPermAndSave() {
  if(!('Notification' in window)) { showToast('\u26A0\uFE0F Browser tidak mendukung notifikasi','error'); return; }
  if(Notification.permission !== 'granted') {
    const perm = await Notification.requestPermission();
    if(perm !== 'granted') { updateNotifPermStatus(); return; }
  }
  saveNotifSettings();
  updateNotifPermStatus();
  showToast('\u2705 Notifikasi berhasil diaktifkan! \uD83D\uDD14','success');
  closeNotifModal();
}

// Scheduler notifikasi menggunakan setTimeout
let _notifTimers = [];
function rescheduleNotifications() {
  _notifTimers.forEach(t => clearTimeout(t));
  _notifTimers = [];
  if(Notification.permission !== 'granted') return;
  const s = getNotifSettings();
  const t = getTodaySchedule();
  if(!t) return;

  const now = new Date();
  function scheduleAt(targetDate, title, body, icon) {
    const diff = targetDate - now;
    if(diff > 0 && diff < 86400000) {
      const tid = setTimeout(() => {
        if(Notification.permission === 'granted') {
          new Notification(title, { body, icon: 'data:image/svg+xml,<svg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 100 100\'><text y=\'.9em\' font-size=\'80\'>' + icon + '</text></svg>' });
        }
      }, diff);
      _notifTimers.push(tid);
    }
  }

  // Imsak
  if(s.imsak && t.imsak) {
    const [ih,im] = t.imsak.split(':').map(Number);
    const imsakDate = new Date(); imsakDate.setHours(ih, im - (s.imsakMenit||15), 0, 0);
    scheduleAt(imsakDate, '\uD83C\uDF19 Waktu Imsak Hampir Tiba!', (s.imsakMenit||15)+' menit lagi imsak. Selesaikan sahur dan niatkan puasa. \uD83E\uDD32', '\uD83C\uDF19');
  }
  // Buka
  if(s.buka && t.maghrib) {
    const [bh,bm] = t.maghrib.split(':').map(Number);
    const bukaDate = new Date(); bukaDate.setHours(bh, bm, 0, 0);
    scheduleAt(bukaDate, '\uD83C\uDF05 Waktu Berbuka Puasa!', 'Alhamdulillah! Waktunya berbuka. Mulailah dengan air putih dan kurma. \uD83E\uDDC4', '\uD83C\uDF05');
  }
  // Tarawih
  if(s.tarawih && s.tarawihJam) {
    const [th,tm] = s.tarawihJam.split(':').map(Number);
    const tarawihDate = new Date(); tarawihDate.setHours(th, tm, 0, 0);
    scheduleAt(tarawihDate, '\uD83D\uDD4C Waktu Tarawih!', 'Yuk jangan lewatkan shalat Tarawih malam ini. Semangat! \uD83C\uDF1F', '\uD83D\uDD4C');
  }
  // Dzikir pagi (setelah subuh ~06:00)
  if(s.dzikir && t.imsak) {
    const [ih2,im2] = t.imsak.split(':').map(Number);
    const dzikirDate = new Date(); dzikirDate.setHours(ih2 + 1, im2, 0, 0);
    scheduleAt(dzikirDate, '\uD83D\uDCFF Dzikir Pagi', 'Jangan lupa dzikir pagi setelah Subuh. Subhanallah, Alhamdulillah, Allahuakbar 33x. \u2728', '\uD83D\uDCFF');
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PDF EXPORT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openPdfModal() {
  document.getElementById('pdfModal').classList.add('show');
}
function closePdfModal() {
  document.getElementById('pdfModal').classList.remove('show');
}

function generatePDF() {
  showToast('\uD83D\uDCCB Menyiapkan PDF...','success');
  closePdfModal();

  const inclRekap  = document.getElementById('pdfChkRekap').checked;
  const inclHarian = document.getElementById('pdfChkHarian').checked;
  const inclSedekah= document.getElementById('pdfChkSedekah').checked;
  const inclSyukur = document.getElementById('pdfChkSyukur').checked;
  const inclTarget = document.getElementById('pdfChkTarget').checked;
  const inclBadge  = document.getElementById('pdfChkBadge').checked;

  const {totalIbadah,totalJuz,totalHal,totalSedekah,streak,niatCount,fmtRp} = buildRekapText();
  const userName = getShareName();
  const HARI = ['Min','Sen','Sel','Rab','Kam','Jum','Sab'];

  let html = `<!DOCTYPE html><html><head><meta charset="UTF-8">
  <title>Rekap Ramadan 1447H - ${userName}</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Nunito:wght@400;700;800;900&display=swap');
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:Nunito,sans-serif;background:#fff;color:#1a1208;line-height:1.6}
    .cover{background:linear-gradient(160deg,#020A14,#061525,#0A1F2E);color:white;padding:60px 40px;text-align:center;min-height:200px}
    .cover-title{font-family:Amiri,serif;font-size:36px;color:#E8BE6A;margin-bottom:8px}
    .cover-sub{font-size:16px;color:rgba(255,255,255,.6);margin-bottom:4px}
    .cover-user{font-size:20px;font-weight:900;color:#E8BE6A;margin-top:12px}
    .cover-arabic{font-family:Amiri,serif;font-size:28px;color:rgba(255,255,255,.5);margin:8px 0}
    section{padding:28px 32px;border-bottom:2px solid #f0e8d4}
    h2{font-size:20px;font-weight:900;color:#1A6B6B;margin-bottom:16px;display:flex;align-items:center;gap:8px}
    .rekap-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:8px}
    .rekap-card{background:#FAF6EE;border:1.5px solid #E8BE6A;border-radius:12px;padding:16px;text-align:center}
    .rekap-num{font-family:Amiri,serif;font-size:28px;font-weight:700;color:#C8973A}
    .rekap-lbl{font-size:11px;color:#7A6A50;font-weight:700;text-transform:uppercase;letter-spacing:.5px;margin-top:4px}
    table{width:100%;border-collapse:collapse;font-size:12px}
    th{background:#1A6B6B;color:white;padding:8px;text-align:center;font-size:11px}
    td{padding:7px 8px;border-bottom:1px solid #F0E8D4;text-align:center;vertical-align:middle}
    tr:nth-child(even){background:#FAF6EE}
    tr.perfect-row td{background:#F0FDF4;font-weight:700}
    .check-y{color:#16A34A;font-size:14px} .check-n{color:#D1D5DB;font-size:14px}
    .sedekah-item{display:flex;justify-content:space-between;padding:8px 12px;border-radius:8px;background:#FAF6EE;margin-bottom:6px;font-size:13px}
    .sedekah-item .desc{color:#2A1F0E;font-weight:600} .sedekah-item .amt{color:#1A6B6B;font-weight:900}
    .badge-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
    .badge-card{text-align:center;padding:12px;border-radius:12px;border:1.5px solid}
    .badge-unlocked{background:#F0FDF4;border-color:#16A34A}
    .badge-locked{background:#FAF6EE;border-color:#E5E7EB;opacity:.5}
    .badge-icon{font-size:28px;margin-bottom:4px}
    .badge-name{font-size:11px;font-weight:800}
    .syukur-block{background:#FAF6EE;border-radius:10px;padding:12px;margin-bottom:8px;border-left:4px solid #E8BE6A}
    .syukur-day{font-size:11px;font-weight:900;color:#7A6A50;margin-bottom:6px}
    .syukur-item{font-size:12px;color:#2A1F0E;margin-bottom:3px}
    .target-item{font-size:12px;padding:4px 0;border-bottom:1px solid #F0E8D4;display:flex;align-items:center;gap:6px}
    .footer{text-align:center;padding:20px;font-size:11px;color:#A09070;background:#FAF6EE}
    @media print{section{break-inside:avoid}}
  
/* ‚îÄ‚îÄ Share card compact untuk HP kecil ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
@media (max-height: 700px) {
  .share-card-icon { font-size: 28px !important; margin-bottom: 4px !important; }
  .share-card-header { margin-bottom: 10px !important; }
  .share-card-divider { margin: 8px 0 !important; }
  .share-card-stats { gap: 6px !important; margin-bottom: 8px !important; }
  .share-stat { padding: 8px 6px !important; }
  .share-stat-icon { font-size: 16px !important; margin-bottom: 2px !important; }
  .share-card-streak { padding: 8px 12px !important; margin-bottom: 6px !important; }
  .share-card-quote { font-size: 10px !important; margin-top: 8px !important; padding-top: 8px !important; }
  .share-card-footer { margin-top: 8px !important; }
}

/* ‚îÄ‚îÄ Share action buttons compact ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
.share-action-btn {
  padding: 10px 12px !important;
  font-size: 12px !important;
}

/* ‚îÄ‚îÄ Share modal - pastikan bisa scroll di semua HP ‚îÄ‚îÄ */
#shareModal {
  overscroll-behavior: contain;
}

/* ‚îÄ‚îÄ Name input compact ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
#shareModal [style*="margin-top:14px"] {
  margin-top: 10px !important;
}

</style>
  </head><body>`;

  // COVER
  html += `<div class="cover">
    <div class="cover-arabic">ÿ±ŸÖÿ∂ÿßŸÜ ŸÉÿ±ŸäŸÖ</div>
    <div class="cover-title">üåô Rekap Ramadan 1447H</div>
    <div class="cover-sub">Perjalanan 30 Hari Ibadahku</div>
    <div class="cover-user">‚ú¶ ${userName} ‚ú¶</div>
    <div style="font-size:13px;color:rgba(255,255,255,.4);margin-top:16px">Dibuat dengan Ramadan Planner 1447H ¬∑ ${new Date().toLocaleDateString('id-ID',{day:'numeric',month:'long',year:'numeric'})}</div>
  </div>`;

  // REKAP
  if(inclRekap) {
    const bestStreak = calcBestStreak();
    const badgesUnlocked = BADGES.filter(b=>b.check()).length;
    html += `<section>
      <h2>üìä Rekap Keseluruhan</h2>
      <div class="rekap-grid">
        <div class="rekap-card"><div class="rekap-num">${niatCount}</div><div class="rekap-lbl">Hari Berniat</div></div>
        <div class="rekap-card"><div class="rekap-num">${totalIbadah}</div><div class="rekap-lbl">Total Ibadah ‚úì</div></div>
        <div class="rekap-card"><div class="rekap-num">${totalJuz}</div><div class="rekap-lbl">Juz Quran</div></div>
        <div class="rekap-card"><div class="rekap-num">${totalHal}</div><div class="rekap-lbl">Halaman Quran</div></div>
        <div class="rekap-card"><div class="rekap-num">${bestStreak}üî•</div><div class="rekap-lbl">Streak Terbaik</div></div>
        <div class="rekap-card"><div class="rekap-num">${fmtRp(totalSedekah)}</div><div class="rekap-lbl">Total Sedekah</div></div>
        <div class="rekap-card"><div class="rekap-num">${badgesUnlocked}/${BADGES.length}</div><div class="rekap-lbl">Badge Terkumpul</div></div>
        <div class="rekap-card"><div class="rekap-num">${getPerfectDays()}</div><div class="rekap-lbl">Hari Sempurna</div></div>
        <div class="rekap-card"><div class="rekap-num">${getSyukurDays()}</div><div class="rekap-lbl">Hari Bersyukur</div></div>
      </div>
    </section>`;
  }

  // HARIAN
  if(inclHarian) {
    html += `<section><h2>üìÖ Detail Harian</h2>
      <table>
        <thead><tr><th>Hari</th><th>Tgl</th><th>Niat</th><th>Subuh</th><th>Dzuhur</th><th>Ashar</th><th>Maghrib</th><th>Isya</th><th>Tarawih</th><th>Juz</th><th>Sempurna</th><th style="background:#C06080">Haid üå∏</th></tr></thead>
        <tbody>`;
    const startDate = new Date(2026,1,19);
    for(let d=1;d<=30;d++){
      const dd = data[d]||{};
      const ib = dd.ibadah||{};
      const perfect = isStreakDay(dd);
      const isHaid = !!dd.haid;
      const dt = new Date(startDate); dt.setDate(dt.getDate()+d-1);
      const tgl = dt.getDate()+'/'+(dt.getMonth()+1);
      const c = v => v ? '<span class="check-y">‚úì</span>' : '<span class="check-n">‚Äî</span>';
      const rowStyle = isHaid ? 'background:#FFF0F5;' : (perfect ? '' : '');
      html += `<tr class="${perfect&&!isHaid?'perfect-row':''}" style="${rowStyle}">
        <td style="font-weight:800">${d}</td>
        <td>${HARI[dt.getDay()]} ${tgl}</td>
        <td>${c(dd.niat)}</td>
        <td>${isHaid?'<span style="color:#E05080">üå∏</span>':c(ib.subuh)}</td><td>${isHaid?'<span style="color:#E05080">üå∏</span>':c(ib.dzuhur)}</td><td>${isHaid?'<span style="color:#E05080">üå∏</span>':c(ib.ashar)}</td>
        <td>${isHaid?'<span style="color:#E05080">üå∏</span>':c(ib.maghrib)}</td><td>${isHaid?'<span style="color:#E05080">üå∏</span>':c(ib.isya)}</td><td>${isHaid?'<span style="color:#E05080">üå∏</span>':c(ib.tarawih)}</td>
        <td>${dd.quranJuz||0}</td>
        <td>${perfect&&!isHaid?'üî•':'‚Äî'}</td>
        <td style="color:#E05080;font-weight:800">${isHaid?'üå∏':'‚Äî'}</td>
      </tr>`;
    }
    html += `</tbody></table></section>`;
  }

  // SEDEKAH
  if(inclSedekah) {
    html += `<section><h2>üíù Catatan Sedekah</h2>`;
    let totalSed = 0; let hasSedekah = false;
    for(let d=1;d<=30;d++){
      const sedList = data[d]?.sedekah||[];
      if(sedList.length>0){
        hasSedekah = true;
        const dt = new Date(2026,1,18+d); 
        html += `<div style="font-size:12px;font-weight:900;color:#7A6A50;margin:10px 0 4px">Hari ${d} ‚Äî ${dt.toLocaleDateString('id-ID',{weekday:'long',day:'numeric',month:'long'})}</div>`;
        sedList.forEach(s=>{
          totalSed += s.amt;
          html += `<div class="sedekah-item"><span class="desc">${s.desc||'Sedekah'}</span><span class="amt">Rp ${s.amt.toLocaleString('id-ID')}</span></div>`;
        });
      }
    }
    if(!hasSedekah) html += `<div style="color:#A09070;font-style:italic">Belum ada catatan sedekah.</div>`;
    else html += `<div style="text-align:right;font-size:14px;font-weight:900;color:#1A6B6B;margin-top:12px;padding-top:8px;border-top:2px solid #E8BE6A">Total Sedekah: Rp ${totalSed.toLocaleString('id-ID')}</div>`;
    html += `</section>`;
  }

  // SYUKUR
  if(inclSyukur) {
    html += `<section><h2>‚ú® Catatan Syukur</h2>`;
    let hasSyukur = false;
    for(let d=1;d<=30;d++){
      const sy = data[d]?.syukur||[];
      const filled = sy.filter(s=>s&&s.trim());
      if(filled.length>0){
        hasSyukur = true;
        const dt = new Date(2026,1,18+d);
        html += `<div class="syukur-block"><div class="syukur-day">Hari ${d} ‚Äî ${dt.toLocaleDateString('id-ID',{weekday:'long',day:'numeric',month:'long'})}</div>`;
        filled.forEach((s,i)=>{ html += `<div class="syukur-item">${i+1}. ${s}</div>`; });
        html += `</div>`;
      }
    }
    if(!hasSyukur) html += `<div style="color:#A09070;font-style:italic">Belum ada catatan syukur.</div>`;
    html += `</section>`;
  }

  // TARGET
  if(inclTarget) {
    html += `<section><h2>üéØ Target Harian</h2>`;
    let hasTarget = false;
    for(let d=1;d<=30;d++){
      const targets = data[d]?.targets||[];
      if(targets.length>0){
        hasTarget = true;
        const dt = new Date(2026,1,18+d);
        html += `<div style="font-size:12px;font-weight:900;color:#7A6A50;margin:10px 0 4px">Hari ${d} ‚Äî ${dt.toLocaleDateString('id-ID',{weekday:'long',day:'numeric',month:'long'})}</div>`;
        targets.forEach(t=>{
          html += `<div class="target-item"><span>${t.done?'‚úÖ':'‚≠ï'}</span><span style="${t.done?'text-decoration:line-through;color:#9CA3AF':''}">${t.text}</span></div>`;
        });
      }
    }
    if(!hasTarget) html += `<div style="color:#A09070;font-style:italic">Belum ada target harian.</div>`;
    html += `</section>`;
  }

  // BADGE
  if(inclBadge) {
    html += `<section><h2>üèÜ Pencapaian & Badge</h2><div class="badge-grid">`;
    BADGES.forEach(b=>{
      const unlocked = b.check();
      html += `<div class="badge-card ${unlocked?'badge-unlocked':'badge-locked'}">
        <div class="badge-icon">${b.icon}</div>
        <div class="badge-name">${b.name}</div>
        <div style="font-size:10px;color:#7A6A50;margin-top:4px">${b.desc}</div>
        ${unlocked?'<div style="color:#16A34A;font-size:11px;font-weight:800;margin-top:6px">‚úì Tercapai!</div>':'<div style="color:#D1D5DB;font-size:11px;margin-top:6px">Belum</div>'}
      </div>`;
    });
    html += `</div></section>`;
  }

  // QADHA SECTION di PDF
  const allQadhaPdf = Array.from({length:30},(_,i)=>i+1).filter(d=>data[d]?.statusPuasa==='batal'||data[d]?.haid);
  if(allQadhaPdf.length > 0) {
    const HARI_PDF = ['Min','Sen','Sel','Rab','Kam','Jum','Sab'];
    const startDateQ = new Date(2026,1,19);
    const ALASAN_PDF = {sakit:'ü§í Sakit', haid:'üå∏ Haid/Uzur', safar:'‚úàÔ∏è Safar', lainnya:'üìù Lainnya'};
    html += `<section style="background:#FFF8F8">
      <h2 style="color:#C05030">üìã Qadha Puasa (${allQadhaPdf.length} Hari)</h2>
      <div style="background:#FFF0EC;border:1.5px solid #FFB8A0;border-radius:10px;padding:12px;margin-bottom:14px;font-size:13px;color:#C05030;font-weight:700">
        ‚ö†Ô∏è Hari-hari berikut perlu diqadha setelah Ramadan. Selesaikan sebelum Ramadan tahun depan.
      </div>
      <table>
        <thead><tr><th>Hari</th><th>Tanggal</th><th>Alasan</th><th>Jenis</th></tr></thead>
        <tbody>
          ${allQadhaPdf.map(d => {
            const dd = data[d]||{};
            const dt = new Date(startDateQ); dt.setDate(dt.getDate()+d-1);
            const tgl = HARI_PDF[dt.getDay()] + ' ' + dt.getDate()+'/'+(dt.getMonth()+1);
            const alasan = dd.haid ? 'üå∏ Haid/Uzur' : (ALASAN_PDF[dd.batalAlasan]||'‚ùå Batal Puasa');
            const jenis = dd.haid ? 'Haid' : 'Batal';
            return `<tr style="background:${dd.haid?'#FFF0F5':'#FFF8F5'}">
              <td style="font-weight:800">H${d}</td>
              <td>${tgl}</td>
              <td>${alasan}</td>
              <td><span style="padding:2px 8px;border-radius:10px;background:${dd.haid?'#FFB6C1':'#FFCDB4'};font-size:11px;font-weight:800">${jenis}</span></td>
            </tr>`;
          }).join('')}
        </tbody>
      </table>
    </section>`;
  }

  html += `<div class="footer">Ramadan Planner 1447H ¬∑ ${userName} ¬∑ Semoga ibadah kita diterima Allah SWT. Aamiin ü§≤</div></body></html>`;

  // Buka di tab baru lalu print/save
  const win = window.open('','_blank');
  win.document.write(html);
  win.document.close();
  setTimeout(()=>{ win.focus(); win.print(); }, 800);
  showToast('\uD83D\uDCC4 PDF siap! Pilih \'Simpan sebagai PDF\' di dialog print.','success');
}

function updateSummary() {
  const d=data[currentDay];
  (function(){var _e=document.getElementById('sumHari');if(_e)_e.textContent=currentDay})();
  const done=Object.values(d.ibadah||{}).filter(v=>v).length;
  (function(){var _e=document.getElementById('sumIbadah');if(_e)_e.textContent=done+'/'+IBADAH_LIST.length})();
  const _streak=calcStreak(); (function(){var _e=document.getElementById('sumStreak');if(_e)_e.textContent=_streak+'\uD83D\uDD25'})(); checkMilestone(_streak);
  updateStreakFire(_streak);
  const ts=(d.sedekah||[]).reduce((s,i)=>s+i.amt,0);
  (function(){var _e=document.getElementById('sumSedekah');if(_e)_e.textContent=ts>=1000000?(ts/1000000).toFixed(1)+'jt':ts>=1000?(ts/1000).toFixed(0)+'rb':ts})();
  updateDailyWidget();
}


// ===== DOA HARIAN =====
const DOA_LIST = [
  {
    judul: 'Doa Buka Puasa',
    arabic: 'ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ŸÑŸéŸÉŸé ÿµŸèŸÖŸíÿ™Ÿè ŸàŸéÿ®ŸêŸÉŸé ÿ¢ŸÖŸéŸÜŸíÿ™Ÿè ŸàŸéÿπŸéŸÑŸéŸâ ÿ±Ÿêÿ≤ŸíŸÇŸêŸÉŸé ÿ£ŸéŸÅŸíÿ∑Ÿéÿ±Ÿíÿ™Ÿè',
    latin: 'Allahumma laka shumtu wa bika aamantu wa \u2018ala rizqika afthartu',
    arti: '"Ya Allah, karena-Mu aku berpuasa, kepada-Mu aku beriman, dan dengan rezeki-Mu aku berbuka."'
  },
  {
    judul: 'Doa Sahur (Niat Puasa)',
    arabic: 'ŸÜŸéŸàŸéŸäŸíÿ™Ÿè ÿµŸéŸàŸíŸÖŸé ÿ∫ŸéÿØŸç ÿπŸéŸÜŸí ÿ£ŸéÿØŸéÿßÿ°Ÿê ŸÅŸéÿ±Ÿíÿ∂Ÿê ÿ¥ŸéŸáŸíÿ±Ÿê ÿ±ŸéŸÖŸéÿ∂ŸéÿßŸÜŸé ŸáŸéÿ∞ŸêŸáŸê ÿßŸÑÿ≥ŸéŸëŸÜŸéÿ©Ÿê ŸÑŸêŸÑŸéŸëŸáŸê ÿ™ŸéÿπŸéÿßŸÑŸéŸâ',
    latin: 'Nawaitu shauma ghadin \u2018an adaa\u2019i fardhi syahri Ramadhana hadzihis sanati lillahi ta\u2019ala',
    arti: '"Aku niat berpuasa esok hari untuk menunaikan fardhu di bulan Ramadan tahun ini karena Allah Ta\u2019ala."'
  },
  {
    judul: 'Doa Ketika Berbuka',
    arabic: 'ÿ∞ŸéŸáŸéÿ®Ÿé ÿßŸÑÿ∏ŸéŸëŸÖŸéÿ£Ÿè ŸàŸéÿßÿ®Ÿíÿ™ŸéŸÑŸéŸëÿ™Ÿê ÿßŸÑŸíÿπŸèÿ±ŸèŸàŸÇŸè ŸàŸéÿ´Ÿéÿ®Ÿéÿ™Ÿé ÿßŸÑÿ£Ÿéÿ¨Ÿíÿ±Ÿè ÿ•ŸêŸÜŸí ÿ¥Ÿéÿßÿ°Ÿé ÿßŸÑŸÑŸéŸëŸáŸè',
    latin: 'Dzahabazh zhama\u2019u wabtallatil \u2018uruuqu wa tsabatal ajru insyaa Allah',
    arti: '"Telah hilang dahaga, telah basah tenggorokan, dan pahala telah ditetapkan, insya Allah."'
  },
  {
    judul: 'Doa Malam Lailatul Qadar',
    arabic: 'ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ•ŸêŸÜŸéŸëŸÉŸé ÿπŸéŸÅŸèŸàŸåŸë ÿ™Ÿèÿ≠Ÿêÿ®ŸèŸë ÿßŸÑŸíÿπŸéŸÅŸíŸàŸé ŸÅŸéÿßÿπŸíŸÅŸè ÿπŸéŸÜŸêŸëŸä',
    latin: 'Allahumma innaka \u2018afuwwun tuhibbul \u2018afwa fa\u2018fu \u2018anni',
    arti: '"Ya Allah, sesungguhnya Engkau Maha Pemaaf dan mencintai pemaafan, maka maafkanlah aku."'
  },
  {
    judul: 'Doa Memohon Ampunan',
    arabic: 'ÿ±Ÿéÿ®ŸéŸëŸÜŸéÿß ÿ∏ŸéŸÑŸéŸÖŸíŸÜŸéÿß ÿ£ŸéŸÜŸÅŸèÿ≥ŸéŸÜŸéÿß ŸàŸéÿ•ŸêŸÜ ŸÑŸéŸëŸÖŸí ÿ™Ÿéÿ∫ŸíŸÅŸêÿ±Ÿí ŸÑŸéŸÜŸéÿß ŸàŸéÿ™Ÿéÿ±Ÿíÿ≠ŸéŸÖŸíŸÜŸéÿß ŸÑŸéŸÜŸéŸÉŸèŸàŸÜŸéŸÜŸéŸë ŸÖŸêŸÜŸé ÿßŸÑŸíÿÆŸéÿßÿ≥Ÿêÿ±ŸêŸäŸÜŸé',
    latin: 'Rabbana zhaalamnaa anfusanaa wa illam taghfir lanaa wa tarhamnaa lanakuunanna minal khasiriin',
    arti: '"Ya Tuhan kami, kami telah menzalimi diri kami sendiri. Jika Engkau tidak mengampuni dan merahmati kami, niscaya kami termasuk orang yang rugi."'
  },
  {
    judul: 'Doa Mohon Husnul Khatimah',
    arabic: 'ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿßÿÆŸíÿ™ŸêŸÖŸí ŸÑŸéŸÜŸéÿß ÿ®ŸêÿßŸÑÿ•ŸêŸäŸÖŸéÿßŸÜŸê ŸàŸéÿßÿÆŸíÿ™ŸêŸÖŸí ŸÑŸéŸÜŸéÿß ÿ®ŸêÿßŸÑÿ£ŸéÿπŸíŸÖŸéÿßŸÑŸê ÿßŸÑÿµŸéŸëÿßŸÑŸêÿ≠Ÿéÿ©Ÿê',
    latin: 'Allahummakhtim lanaa bil iimaan wakhtim lanaa bil a\u2019maalis shaalihah',
    arti: '"Ya Allah, akhirilah hidup kami dengan iman, dan akhirilah amal kami dengan amal-amal yang shalih."'
  },
  {
    judul: 'Doa Masuk & Keluar Masjid',
    arabic: 'ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿßŸÅŸíÿ™Ÿéÿ≠Ÿí ŸÑŸêŸä ÿ£Ÿéÿ®ŸíŸàŸéÿßÿ®Ÿé ÿ±Ÿéÿ≠ŸíŸÖŸéÿ™ŸêŸÉŸé',
    latin: 'Allahummaftah lii abwaaba rahmatik',
    arti: '"Ya Allah, bukakanlah untukku pintu-pintu rahmat-Mu."'
  },
  {
    judul: 'Doa Dzikir Pagi & Petang',
    arabic: 'ÿ£ŸéÿµŸíÿ®Ÿéÿ≠ŸíŸÜŸéÿß ŸàŸéÿ£ŸéÿµŸíÿ®Ÿéÿ≠Ÿé ÿßŸÑŸíŸÖŸèŸÑŸíŸÉŸè ŸÑŸêŸÑŸéŸëŸáŸê ŸàŸéÿßŸÑŸíÿ≠ŸéŸÖŸíÿØŸè ŸÑŸêŸÑŸéŸëŸáŸê ŸÑŸéÿß ÿ•ŸêŸÑŸéŸáŸé ÿ•ŸêŸÑŸéŸëÿß ÿßŸÑŸÑŸéŸëŸáŸè ŸàŸéÿ≠ŸíÿØŸéŸáŸè ŸÑŸéÿß ÿ¥Ÿéÿ±ŸêŸäŸÉŸé ŸÑŸéŸáŸè',
    latin: 'Ashbahnaa wa ashbahal mulku lillah, walhamdulillah, laa ilaaha illallahu wahdahu laa syariikalah',
    arti: '"Kami memasuki pagi hari dan kerajaan hanya milik Allah, segala puji milik Allah, tidak ada Tuhan selain Allah Yang Maha Esa, tiada sekutu bagi-Nya."'
  },
  {
    judul: 'Doa Istighfar',
    arabic: 'ÿ£Ÿéÿ≥Ÿíÿ™Ÿéÿ∫ŸíŸÅŸêÿ±Ÿè ÿßŸÑŸÑŸéŸëŸáŸé ÿßŸÑŸíÿπŸéÿ∏ŸêŸäŸÖŸé ÿßŸÑŸéŸëÿ∞ŸêŸä ŸÑŸéÿß ÿ•ŸêŸÑŸéŸáŸé ÿ•ŸêŸÑŸéŸëÿß ŸáŸèŸàŸé ÿßŸÑŸíÿ≠ŸéŸäŸèŸë ÿßŸÑŸíŸÇŸéŸäŸèŸëŸàŸÖŸè ŸàŸéÿ£Ÿéÿ™ŸèŸàÿ®Ÿè ÿ•ŸêŸÑŸéŸäŸíŸáŸê',
    latin: 'Astaghfirullahal \u2018azhim alladzi laa ilaaha illaa huwal hayyul qayyuumu wa atuubu ilaih',
    arti: '"Aku memohon ampun kepada Allah Yang Maha Agung, yang tidak ada Tuhan selain Dia, Yang Maha Hidup dan Berdiri Sendiri, dan aku bertaubat kepada-Nya."'
  },
  {
    judul: 'Doa Memohon Surga',
    arabic: 'ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ•ŸêŸÜŸêŸëŸä ÿ£Ÿéÿ≥Ÿíÿ£ŸéŸÑŸèŸÉŸé ÿßŸÑŸíÿ¨ŸéŸÜŸéŸëÿ©Ÿé ŸàŸéÿ£ŸéÿπŸèŸàÿ∞Ÿè ÿ®ŸêŸÉŸé ŸÖŸêŸÜŸé ÿßŸÑŸÜŸéŸëÿßÿ±Ÿê',
    latin: 'Allahumma innii as\u2019alukal jannata wa a\u2019uudzu bika minan naar',
    arti: '"Ya Allah, aku memohon kepada-Mu surga dan aku berlindung kepada-Mu dari neraka."'
  },
];

let currentDoaIdx = 0;
let doaListBuilt = false;

const DOA_ICONS = ['üåô','‚≠ê','üíß','‚ú®','ü§≤','üåü','üïå','üìø','üõ°Ô∏è','üå∫'];

function renderDoa() {
  var container = document.getElementById('doaList');
  if (!container) return;
  if (doaListBuilt) return;
  doaListBuilt = true;
  container.innerHTML = '';

  DOA_LIST.forEach(function(doa, i) {
    var item = document.createElement('div');
    item.className = 'doa-item' + (i === 0 ? ' open' : '');

    var header = document.createElement('div');
    header.className = 'doa-item-header';
    header.onclick = function(){ toggleDoa(this.parentElement); };
    header.innerHTML =
      '<div class="doa-item-icon">' + (DOA_ICONS[i]||'ü§≤') + '</div>' +
      '<div class="doa-item-title">' + doa.judul + '</div>' +
      '<div class="doa-item-arrow">&#x203A;</div>';

    var body = document.createElement('div');
    body.className = 'doa-item-body';
    var inner = document.createElement('div');
    inner.className = 'doa-item-inner';
    inner.innerHTML =
      '<div class="doa-item-arabic">' + doa.arabic + '</div>' +
      '<div class="doa-item-latin">' + doa.latin + '</div>' +
      '<div class="doa-item-arti">' + doa.arti + '</div>';
    body.appendChild(inner);

    item.appendChild(header);
    item.appendChild(body);
    container.appendChild(item);
  });
}

function toggleDoa(el) {
  const isOpen = el.classList.contains('open');
  // Tutup semua
  document.querySelectorAll('.doa-item').forEach(d => d.classList.remove('open'));
  // Buka yang diklik (toggle)
  if (!isOpen) el.classList.add('open');
}

// stub untuk nextDoa/prevDoa agar tidak error jika masih ada referensi
function nextDoa() {}
function prevDoa() {}


// ===== SYUKUR =====
function renderSyukur() {
  const d = data[currentDay];
  const syukur = d.syukur || ['','',''];
  for(let i=0;i<3;i++) {
    const el = document.getElementById('syukur'+i);
    if(el) el.value = syukur[i] || '';
  }
}
function saveSyukur() {
  if(!data[currentDay].syukur) data[currentDay].syukur = ['','',''];
  for(let i=0;i<3;i++) {
    const el = document.getElementById('syukur'+i);
    if(el) data[currentDay].syukur[i] = el.value;
  }
  saveData();
}

// ===== STATISTIK =====
let currentStat = 'ibadah';
function switchStat(type, el) {
  currentStat = type;
  document.querySelectorAll('.stat-tab').forEach(t=>t.classList.remove('active'));
  el.classList.add('active');
  requestAnimationFrame(renderStat_impl);
}

// renderStat implemented in renderAll block above

// ===== ACHIEVEMENT / BADGE =====
const BADGES = [
  { id:'hari1',    icon:'üåô', name:'Hari Pertama',    desc:'Buka app hari pertama Ramadan',        check: ()=> true },
  { id:'streak3',  icon:'üî•', name:'3 Hari Streak',   desc:'3 hari berturut-turut sempurna',        check: ()=> calcBestStreak()>=3 },
  { id:'streak7',  icon:'‚ö°', name:'Seminggu Penuh',  desc:'7 hari berturut-turut sempurna',        check: ()=> calcBestStreak()>=7 },
  { id:'streak15', icon:'üí´', name:'Setengah Jalan',  desc:'15 hari berturut-turut sempurna',       check: ()=> calcBestStreak()>=15 },
  { id:'streak30', icon:'üëë', name:'Sebulan Penuh',   desc:'30 hari sempurna non-stop',             check: ()=> calcBestStreak()>=30 },
  { id:'quran5',   icon:'üìñ', name:'Santri',          desc:'Baca 5 juz Al-Qur\'an',                check: ()=> getTotalJuz()>=5 },
  { id:'quran15',  icon:'üìö', name:'Hafidz Muda',     desc:'Baca 15 juz Al-Qur\'an',               check: ()=> getTotalJuz()>=15 },
  { id:'quranAll', icon:'üåü', name:'Khatam!',         desc:'Khatam 30 juz Al-Qur\'an',             check: ()=> getTotalJuz()>=30 },
  { id:'sedekah1', icon:'üí∞', name:'Dermawan',        desc:'Sedekah pertama kali',                  check: ()=> getTotalSedekah()>0 },
  { id:'sedekah5', icon:'üíé', name:'Murah Hati',      desc:'Sedekah di 5 hari berbeda',             check: ()=> getSedekahDays()>=5 },
  { id:'syukur7',  icon:'‚ú®', name:'Hati Bersyukur',  desc:'Isi catatan syukur 7 hari',             check: ()=> getSyukurDays()>=7 },
  { id:'perfect',  icon:'üèÜ', name:'Sempurna!',       desc:'1 hari dengan semua ibadah lengkap',    check: ()=> getPerfectDays()>=1 },
  { id:'perfect7', icon:'üå†', name:'Konsisten',       desc:'7 hari sempurna (tidak harus berurut)', check: ()=> getPerfectDays()>=7 },
  { id:'niat30',   icon:'ü§≤', name:'Istiqomah Niat',  desc:'Berniat puasa selama 30 hari penuh',    check: ()=> getNiatCount()>=30 },
  { id:'niat15',   icon:'üåô', name:'Setia Berniat',   desc:'Berniat puasa 15 hari',                 check: ()=> getNiatCount()>=15 },
  { id:'syukur30', icon:'üíõ', name:'Jiwa Syukur',     desc:'Isi catatan syukur 30 hari penuh',      check: ()=> getSyukurDays()>=30 },
  { id:'target10', icon:'üéØ', name:'Fokus',           desc:'Selesaikan 10 target pribadi',          check: ()=> getTargetDone()>=10 },
  { id:'dzikir7',  icon:'üìø', name:'Dzikir Istiqomah',desc:'Dzikir selama 7 hari berturut-turut',   check: ()=> getDzikirStreak()>=7 },
  { id:'allibadah',icon:'‚≠ê', name:'Lengkap Sempurna',desc:'Semua ibadah (termasuk sunnah) selesai 1 hari', check: ()=> getAllIbadahDay() },
  { id:'itikaf1',  icon:'üïã', name:"I'tikaf Perdana",   desc:"Tandai I'tikaf untuk pertama kalinya",     check: ()=> Object.values(data).some(d=>d?.ibadah?.itikaf) },
  { id:'witir10',  icon:'üå†', name:'Witir Istiqomah',  desc:'Shalat Witir minimal 10 hari',              check: ()=> Array.from({length:30},(_,i)=>data[i+1]?.ibadah?.witir).filter(Boolean).length >= 10 },
];

function getTotalJuz() { return Array.from({length:30},(_,i)=>i+1).reduce((s,d)=>s+(data[d]?.quranJuz||0),0); }
function getTotalSedekah() { return Array.from({length:30},(_,i)=>i+1).reduce((s,d)=>s+(data[d]?.sedekah||[]).reduce((a,b)=>a+b.amt,0),0); }
function getSedekahDays() { return Array.from({length:30},(_,i)=>i+1).filter(d=>(data[d]?.sedekah||[]).length>0).length; }
function getSyukurDays() { return Array.from({length:30},(_,i)=>i+1).filter(d=>(data[d]?.syukur||[]).some(s=>s&&s.trim())).length; }
function getPerfectDays() { return Array.from({length:30},(_,i)=>i+1).filter(d=>isStreakDay(data[d]||{})).length; }
function getNiatCount() { return Array.from({length:30},(_,i)=>i+1).filter(d=>data[d]?.niat).length; }
function getTargetDone() { return Array.from({length:30},(_,i)=>i+1).reduce((s,d)=>s+(data[d]?.targets||[]).filter(t=>t.done).length,0); }
function getDzikirStreak() {
  let best=0,cur=0;
  for(let d=1;d<=30;d++){
    const dz=data[d]?.dzikir||{};
    const total=Object.values(dz).reduce((s,v)=>s+v,0);
    if(total>0){cur++;if(cur>best)best=cur;}else cur=0;
  }
  return best;
}
function getAllIbadahDay() {
  return Array.from({length:30},(_,i)=>i+1).some(d=>{
    const ib=data[d]?.ibadah||{};
    return IBADAH_LIST.every(item=>ib[item.id]);
  });
}

let prevUnlocked = new Set();
function renderBadges() {
  const grid = document.getElementById('badgeGrid');
  const progWrap = document.getElementById('badgeProgressWrap');
  if(!grid) return;

  const nowUnlocked = new Set(BADGES.filter(b=>b.check()).map(b=>b.id));

  // Simpan prevUnlocked sebelum diperbarui untuk deteksi badge baru
  const newlyUnlocked = new Set([...nowUnlocked].filter(id => !prevUnlocked.has(id)));
  
  // Toast untuk badge baru yang baru unlock
  newlyUnlocked.forEach(id => {
    const b = BADGES.find(b=>b.id===id);
    if(b && prevUnlocked.size > 0) showToast(L('toastBadge',b.icon+' '+b.name), 'success');
  });
  prevUnlocked = new Set(nowUnlocked);

  grid.innerHTML = BADGES.map(b => {
    const unlocked = nowUnlocked.has(b.id);
    const isNew = newlyUnlocked.has(b.id);
    return `<div class="badge-item${unlocked?' unlocked':''}" title="${b.desc}">
      ${isNew ? '<div class="badge-new">NEW</div>' : ''}
      <div class="badge-icon">${b.icon}</div>
      <div class="badge-name">${b.name}</div>
      <div class="badge-desc" style="font-size:10px;color:${unlocked?'rgba(50,160,100,.9)':'var(--text-muted)'};margin-top:3px;line-height:1.4;text-align:center;padding:0 4px">${b.desc}</div>
    </div>`;
  }).join('');

  // Progress bars menuju badge berikutnya
  const totalJuz = getTotalJuz();
  const streakNow = calcStreak();
  const bestStreak = calcBestStreak();
  const sedDays = getSedekahDays();
  const syukurDays = getSyukurDays();
  const perfDays = getPerfectDays();
  const unlocked = nowUnlocked.size;

  progWrap.innerHTML = `
    <div style="font-size:11px;font-weight:800;color:var(--text-muted);margin-bottom:10px;text-transform:uppercase;letter-spacing:.5px">
      üèÖ ${unlocked}/${BADGES.length} Badge Terkumpul
    </div>
    ${mkProg('Streak Aktif', streakNow, 30, streakNow+' hari')}
    ${mkProg('Streak Terbaik', bestStreak, 30, bestStreak+' hari')}
    ${mkProg('Baca Al-Qur\u2019an', totalJuz, 30, totalJuz+' juz')}
    ${mkProg('Hari Sempurna', perfDays, 30, perfDays+' hari')}
    ${mkProg('Catatan Syukur', syukurDays, 30, syukurDays+' hari')}
  `;
}

function mkProg(label, val, max, display) {
  const pct = Math.min(100, Math.round((val/max)*100));
  return `<div class="badge-prog-item">
    <div class="badge-prog-label">${label}</div>
    <div class="badge-prog-bar"><div class="badge-prog-fill" style="width:${pct}%"></div></div>
    <div class="badge-prog-pct">${display}</div>
  </div>`;
}


// ===== DARK MODE =====
// Default: mode siang. Hanya pakai saved preference kalau user pernah ubah manual
const _savedDark = localStorage.getItem('darkMode');
let darkMode = _savedDark !== null ? (_savedDark === 'true') : false;
function applyDarkMode() {
  document.body.classList.toggle('dark-mode', darkMode);
  document.getElementById('darkToggle').textContent = darkMode ? '‚òÄÔ∏è' : 'üåô';
  localStorage.setItem('darkMode', darkMode);
  // Re-render grafik supaya warna ikut mode
  if(typeof renderStat === 'function') renderStat();
  if(typeof renderMoodCalendar === 'function') renderMoodCalendar();
}
function toggleDarkMode() {
  darkMode = !darkMode;
  applyDarkMode();
  showToast(darkMode ? 'üåô Dark mode aktif' : '‚òÄÔ∏è Light mode aktif', 'success');
}
function autoCheckDarkMode() {
  const t = getTodaySchedule();
  if (!t) return;
  const now = new Date();
  const [bh,bm] = t.maghrib.split(':').map(Number);
  const [sh,sm] = t.imsak.split(':').map(Number);
  const maghrib = new Date(); maghrib.setHours(bh,bm,0,0);
  const imsak = new Date(); imsak.setHours(sh,sm,0,0);
  // Auto dark mode after maghrib until imsak next day
  const shouldBeDark = now >= maghrib || now < imsak;
  if (shouldBeDark !== darkMode && !localStorage.getItem('darkModeManual')) {
    darkMode = shouldBeDark;
    applyDarkMode();
  }
}

// ===== NIAT PUASA =====
function toggleNiat() {
  data[currentDay].niat = !data[currentDay].niat;
  saveData();
  renderNiat();
  const niatCard = document.querySelector('.niat-card');
  if (niatCard) niatCard.classList.toggle('confirmed', data[currentDay].niat);
  if (data[currentDay].niat) {
    showToast('ü§≤ Alhamdulillah, niat puasa tercatat!', 'success');
    launchConfetti(15);
  }
}
function renderNiat() {
  const done = data[currentDay].niat;
  const btn = document.getElementById('niatBtn');
  const icon = document.getElementById('niatBtnIcon');
  const txt = document.getElementById('niatBtnText');
  const sub = document.getElementById('niatSub');
  if (!btn) return;
  const niatCard = document.querySelector('.niat-card');
  if (niatCard) niatCard.classList.toggle('confirmed', done);
  btn.className = 'niat-confirm-btn ' + (done ? 'confirmed' : 'unconfirmed');
  icon.textContent = done ? '‚úÖ' : '‚≠ï';
  txt.textContent = done ? 'Niat Puasa Sudah Dikonfirmasi ‚úì' : 'Tandai Sudah Berniat Puasa Hari Ini';
  sub.textContent = done ? `‚úÖ Niat puasa hari ke-${currentDay} sudah dikonfirmasi` : 'Niatkan puasa sebelum imsak';
}

// ===== DZIKIR TRACKER =====
const DZIKIR_LIST = [
  { id:'subhanallah', name:'Subhanallah', arabic:'ÿ≥Ÿèÿ®Ÿíÿ≠ŸéÿßŸÜŸé ÿßŸÑŸÑŸáŸê', target:33 },
  { id:'alhamdulillah', name:'Alhamdulillah', arabic:'ÿßŸÑŸíÿ≠ŸéŸÖŸíÿØŸè ŸÑŸêŸÑŸéŸëŸáŸê', target:33 },
  { id:'allahuakbar', name:'Allahu Akbar', arabic:'ÿßŸÑŸÑŸáŸè ÿ£ŸéŸÉŸíÿ®Ÿéÿ±Ÿè', target:33 },
  { id:'istighfar', name:'Istighfar', arabic:'ÿ£Ÿéÿ≥Ÿíÿ™Ÿéÿ∫ŸíŸÅŸêÿ±Ÿè ÿßŸÑŸÑŸáŸé', target:100 },
  { id:'sholawat', name:'Sholawat', arabic:'ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿµŸéŸÑŸêŸë ÿπŸéŸÑŸéŸâ ŸÖŸèÿ≠ŸéŸÖŸéŸëÿØŸç', target:100 },
  { id:'lailahaillallah', name:'LƒÅ ilƒÅha illallƒÅh', arabic:'ŸÑŸéÿß ÿ•ŸêŸÑŸéŸáŸé ÿ•ŸêŸÑŸéŸëÿß ÿßŸÑŸÑŸáŸè', target:100 },
];

function renderDzikir() {
  var grid = document.getElementById('dzikirGrid');
  if (!grid) return;
  var dzikir = data[currentDay].dzikir || {};
  grid.innerHTML = DZIKIR_LIST.map(function(d) {
    var count = dzikir[d.id] || 0;
    var done = count >= d.target;
    var pct = Math.min(100, Math.round(count / d.target * 100));
    return '<div class="dzikir-item ' + (done?'done':'') + '">' +
      '<div class="dzikir-name">' + d.name + '</div>' +
      '<div class="dzikir-arabic">' + d.arabic + '</div>' +
      '<div class="dzikir-progress-bar"><div class="dzikir-progress-fill" style="width:' + pct + '%"></div></div>' +
      '<div class="dzikir-count-wrap">' +
        '<button class="dzikir-tap-btn" onclick="tapDzikir(\'' + d.id + '\',-1)">‚àí</button>' +
        '<span class="dzikir-num">' + count + '</span>' +
        '<button class="dzikir-tap-btn plus" onclick="tapDzikir(\'' + d.id + '\',1)">Ôºã</button>' +
      '</div>' +
      '<div class="dzikir-target">' + (done ? '‚úÖ Selesai!' : count + ' / ' + d.target) + '</div>' +
    '</div>';
  }).join('');
}

function tapDzikir(id, delta) {
  if (!data[currentDay].dzikir) data[currentDay].dzikir = {};
  const d = DZIKIR_LIST.find(x => x.id === id);
  const cur = data[currentDay].dzikir[id] || 0;
  const nxt = Math.max(0, Math.min(cur + delta, d.target * 3));
  const wasDone = cur >= d.target;
  data[currentDay].dzikir[id] = nxt;
  saveData();
  renderDzikir();
  if (!wasDone && nxt >= d.target) {
    showToast('üìø ' + d.name + ' selesai! Masya Allah ‚ú®', 'success');
    launchConfetti(10);
  }
}

// ===== CONFETTI =====
function launchConfetti(count) {
  const colors = ['#C8973A','#E8BE6A','#1A6B6B','#4ECDC4','#C05070','#50A0C0','#FFD080','#FF6B55'];
  for (let i = 0; i < count; i++) {
    setTimeout(() => {
      const el = document.createElement('div');
      el.className = 'confetti-piece';
      el.style.cssText = `
        left:${Math.random()*100}vw;
        background:${colors[Math.floor(Math.random()*colors.length)]};
        animation-duration:${1.5+Math.random()*2}s;
        animation-delay:${Math.random()*0.5}s;
        width:${6+Math.random()*8}px;
        height:${6+Math.random()*8}px;
        border-radius:${Math.random()>0.5?'50%':'2px'};
      `;
      document.body.appendChild(el);
      setTimeout(() => el.remove(), 4000);
    }, i * 60);
  }
}

// ===== MILESTONE POPUP =====
const MILESTONES = {3:'3 Hari Berturut!', 7:'1 Minggu Penuh! üî•', 14:'2 Minggu Istiqomah! üåü', 21:'21 Hari! Luar Biasa! üíé', 30:'30 Hari Khatam! üèÜ'};
let lastMilestoneShown = parseInt(localStorage.getItem('lastMilestone')||'0');
function checkMilestone(streak) {
  const milestoneVal = Object.keys(MILESTONES).map(Number).filter(n => n <= streak).pop();
  if (milestoneVal && milestoneVal > lastMilestoneShown) {
    lastMilestoneShown = milestoneVal;
    localStorage.setItem('lastMilestone', milestoneVal);
    const pop = document.getElementById('milestonePop');
    document.getElementById('milestoneIcon').textContent = milestoneVal >= 30 ? 'üèÜ' : milestoneVal >= 21 ? 'üíé' : 'üî•';
    document.getElementById('milestoneTitle').textContent = MILESTONES[milestoneVal];
    document.getElementById('milestoneMsg').textContent = 'Masya Allah! Streak ' + streak + ' hari! Pertahankan semangat ibadahmu!';
    pop.classList.add('show');
    launchConfetti(30);
    setTimeout(() => pop.classList.remove('show'), 4000);
  }
}

// ===== SHARE & REKAP =====
function buildRekapText() {
  const totalIbadah = Array.from({length:30},(_,i)=>i+1).reduce((s,d)=>s+Object.values((data[d]?.ibadah)||{}).filter(v=>v).length,0);
  const totalJuz = Array.from({length:30},(_,i)=>i+1).reduce((s,d)=>s+(data[d]?.quranJuz||0),0);
  const totalHal = Array.from({length:30},(_,i)=>i+1).reduce((s,d)=>s+(data[d]?.quranHal||0),0);
  const totalSedekah = Array.from({length:30},(_,i)=>i+1).reduce((s,d)=>s+(data[d]?.sedekah||[]).reduce((a,x)=>a+x.amt,0),0);
  const streak = calcMaxStreak();
  const niatCount = Array.from({length:30},(_,i)=>i+1).filter(d=>data[d]?.niat).length;
  const fmtRp = n => n>=1000000?(n/1000000).toFixed(1)+'jt':n>=1000?(n/1000).toFixed(0)+'rb':'Rp'+n;
  return {totalIbadah, totalJuz, totalHal, totalSedekah, streak, niatCount, fmtRp};
}

function calcMaxStreak() {
  let max=0, cur=0;
  for(let d=1;d<=30;d++){
    const ib=data[d]?.ibadah||{};
    const fardhu=IBADAH_LIST.filter(x=>x.streak).filter(x=>ib[x.id]).length;
    const tarawih=ib['tarawih'];
    const streakDay=fardhu>=5&&tarawih;
    if(streakDay){cur++;max=Math.max(max,cur);}else cur=0;
  }
  return max;
}

function renderRekap() {
  const {totalIbadah, totalJuz, totalHal, totalSedekah, streak, niatCount, fmtRp} = buildRekapText();
  const lines = [
    {label:'Total Ibadah', val: totalIbadah + ' ‚úì'},
    {label:'Niat Puasa', val: niatCount + '/30 hari'},
    {label:'Total Juz', val: totalJuz + ' juz'},
    {label:'Halaman Quran', val: totalHal + ' hal'},
    {label:'Streak Tertinggi', val: streak + ' hari üî•'},
    {label:'Total Sedekah', val: fmtRp(totalSedekah)},
  ];
  const rekapEl = document.getElementById('rekapContent');
  if (!rekapEl) return;
  rekapEl.innerHTML = lines.map(l =>
    `<div class="rekap-row"><span style="color:rgba(255,255,255,.7)">${l.label}</span><span style="color:var(--gold-light);font-weight:800">${l.val}</span></div>`
  ).join('');
}

function renderRekapAkhir() {
  const {totalIbadah, totalJuz, totalHal, totalSedekah, streak, niatCount, fmtRp} = buildRekapText();
  const items = [
    {num: niatCount, label:'Hari Berniat'},
    {num: totalIbadah, label:'Total Ibadah'},
    {num: totalJuz + ' juz', label:'Quran Dibaca'},
    {num: streak + 'üî•', label:'Streak Terbaik'},
    {num: fmtRp(totalSedekah), label:'Sedekah'},
    {num: totalHal, label:'Halaman Quran'},
  ];
  document.getElementById('rekapAkhirGrid').innerHTML = items.map(i =>
    `<div class="rekap-akhir-item"><div class="rekap-akhir-num">${i.num}</div><div class="rekap-akhir-label">${i.label}</div></div>`
  ).join('');
  
  // Pencapaian terbaik
  const bests = [];
  if (niatCount === 30) bests.push('üèÜ Berniat puasa penuh 30 hari!');
  if (streak >= 7) bests.push('üî• Streak ' + streak + ' hari berturut-turut!');
  if (totalJuz >= 30) bests.push('üìñ Khatam Al-Qur\'an di bulan Ramadan!');
  if (totalSedekah > 0) bests.push('üíù Bersedekah ' + fmtRp(totalSedekah) + ' selama Ramadan!');
  if (bests.length === 0) bests.push('‚ú® Semangat terus beribadah!');
  document.getElementById('rekapAkhirBest').innerHTML = bests.join('<br>');
}




function closeSplash() {
  const splash = document.getElementById('splashScreen');
  splash.classList.add('hidden');
  // Show PWA banner after splash if applicable
  setTimeout(checkPWAPrompt, 1500);
}

// ===== SPLASH SCREEN =====
(function initSplash() {
  // Buat bintang-bintang
  const starsEl = document.getElementById('splashStars');
  for (let i = 0; i < 80; i++) {
    const s = document.createElement('div');
    s.className = 'splash-star';
    const size = Math.random() * 2.5 + .5;
    s.style.cssText = `
      width:${size}px; height:${size}px;
      left:${Math.random()*100}%; top:${Math.random()*100}%;
      animation-duration:${2+Math.random()*3}s;
      animation-delay:${Math.random()*3}s;
      opacity:${Math.random()*.7+.1};
    `;
    starsEl.appendChild(s);
  }

  // Buat bintang di share card juga
  const cardStars = document.getElementById('shareCardStars');
  if (cardStars) {
    for (let i = 0; i < 30; i++) {
      const s = document.createElement('div');
      s.className = 'share-card-star';
      const size = Math.random() * 2 + .5;
      s.style.cssText = `
        width:${size}px; height:${size}px;
        left:${Math.random()*100}%; top:${Math.random()*100}%;
        animation-duration:${2+Math.random()*3}s;
        animation-delay:${Math.random()*3}s;
        opacity:${Math.random()*.5+.1};
      `;
      cardStars.appendChild(s);
    }
  }

  // Loading bar animation
  const fill = document.getElementById('splashFill');
  const loadingText = document.getElementById('splashLoadingText');
  const steps = [
    { pct: 20, text: 'Memuat jadwal ibadah...' },
    { pct: 45, text: 'Menyiapkan jadwal sahur & buka...' },
    { pct: 70, text: 'Mengatur data harian...' },
    { pct: 90, text: 'Hampir siap...' },
    { pct: 100, text: 'Bismillah, mulai! üåô' },
  ];

  let stepIdx = 0;
  const interval = setInterval(() => {
    if (stepIdx < steps.length) {
      fill.style.width = steps[stepIdx].pct + '%';
      loadingText.textContent = steps[stepIdx].text;
      stepIdx++;
    } else {
      clearInterval(interval);
      setTimeout(closeSplash, 600);
    }
  }, 420);
})();

// ===== PWA =====
let pwaInstallPrompt = null;

window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  pwaInstallPrompt = e;
  // Tunda banner sampai setelah splash
  setTimeout(() => {
    if (!localStorage.getItem('pwaDismissed')) {
      document.getElementById('pwaBanner').classList.add('show');
    }
  }, 3000);
});

window.addEventListener('appinstalled', () => {
  document.getElementById('pwaBanner').classList.remove('show');
  pwaInstallPrompt = null;
  showToast('üéâ Aplikasi berhasil dipasang di layar utama!', 'success');
});

function checkPWAPrompt() {
  // Jika di iOS Safari ‚Äî tampilkan instruksi manual
  const isIOS = /iphone|ipad|ipod/i.test(navigator.userAgent);
  const isSafari = /safari/i.test(navigator.userAgent) && !/chrome/i.test(navigator.userAgent);
  const isStandalone = window.matchMedia('(display-mode: standalone)').matches;
  
  if (isIOS && isSafari && !isStandalone && !localStorage.getItem('pwaDismissed')) {
    const banner = document.getElementById('pwaBanner');
    banner.querySelector('.pwa-text-title').textContent = 'Pasang di iPhone/iPad';
    banner.querySelector('.pwa-text-sub').textContent = 'Ketuk ‚Üë lalu pilih "Add to Home Screen"';
    banner.querySelector('.pwa-install-btn').textContent = 'Cara Pasang';
    banner.querySelector('.pwa-install-btn').onclick = () => {
      showToast('üì± Ketuk tombol Bagikan (‚Üë) lalu pilih "Tambahkan ke Layar Utama"', 'success');
    };
    banner.classList.add('show');
  }
}

async function installPWA() {
  if (!pwaInstallPrompt) {
    showToast('üì± Ketuk menu browser ‚Üí "Tambahkan ke Layar Utama"', 'success');
    return;
  }
  pwaInstallPrompt.prompt();
  const { outcome } = await pwaInstallPrompt.userChoice;
  if (outcome === 'accepted') {
    showToast('üéâ Aplikasi sedang dipasang!', 'success');
  }
  pwaInstallPrompt = null;
  document.getElementById('pwaBanner').classList.remove('show');
}

function dismissPWA() {
  document.getElementById('pwaBanner').classList.remove('show');
  localStorage.setItem('pwaDismissed', '1');
}

// ===== SHARE NAME =====
function getShareName() {
  return localStorage.getItem('shareUserName') || 'Andi Maulana Yusuf';
}
function updateShareName() {
  const input = document.getElementById('shareNameInput');
  const name = input.value.trim() || 'Andi Maulana Yusuf';
  localStorage.setItem('shareUserName', input.value.trim());
  const authorEl = document.getElementById('shareCardAuthor');
  if (authorEl) authorEl.textContent = '\u2756 ' + name + ' \u2756';
}

// ===== SHARE CARD =====
function openShareModal() {
  // Load saved name
  const savedName = getShareName();
  const nameInput = document.getElementById('shareNameInput');
  if (nameInput) nameInput.value = (localStorage.getItem('shareUserName') || '');
  const authorEl = document.getElementById('shareCardAuthor');
  if (authorEl) authorEl.textContent = '\u2756 ' + savedName + ' \u2756';

  // Populate share card dengan data terkini
  const totalIbadah = Array.from({length:30},(_,i)=>i+1)
    .reduce((s,d) => s + Object.values((data[d]?.ibadah)||{}).filter(v=>v).length, 0);
  const totalJuz = Array.from({length:30},(_,i)=>i+1)
    .reduce((s,d) => s + (data[d]?.quranJuz||0), 0);
  const totalSedekah = Array.from({length:30},(_,i)=>i+1)
    .reduce((s,d) => s + (data[d]?.sedekah||[]).reduce((a,x)=>a+x.amt,0), 0);
  const niatDone = Array.from({length:30},(_,i)=>i+1).filter(d=>data[d]?.niat).length;
  
  // Hitung streak terbaik
  let maxStreak=0, curStreak=0;
  for(let d=1;d<=30;d++){
    const ib=data[d]?.ibadah||{};
    if(typeof IBADAH_LIST !== 'undefined') {
      const fardhu = IBADAH_LIST.filter(x=>x.streak).filter(x=>ib[x.id]).length;
      const tarawih = ib['tarawih'];
      if(fardhu>=5&&tarawih){curStreak++;maxStreak=Math.max(maxStreak,curStreak);}
      else curStreak=0;
    }
  }

  // Dzikir total
  const dzikirTotal = Array.from({length:30},(_,i)=>i+1).reduce((s,d)=>{
    const dz = data[d]?.dzikir||{};
    return s + Object.values(dz).reduce((a,v)=>a+v,0);
  },0);

  const fmtRp = n => n>=1000000?(n/1000000).toFixed(1)+'jt':n>=1000?(n/1000).toFixed(0)+'rb':'Rp'+n;
  const daysActive = Array.from({length:30},(_,i)=>i+1).filter(d=>Object.values(data[d]?.ibadah||{}).some(v=>v)).length;

  // Render stats grid
  document.getElementById('shareCardStats').innerHTML = `
    <div class="share-stat">
      <span class="share-stat-icon">üïå</span>
      <span class="share-stat-num">${totalIbadah}</span>
      <span class="share-stat-label">Total Ibadah</span>
    </div>
    <div class="share-stat">
      <span class="share-stat-icon">üìñ</span>
      <span class="share-stat-num">${totalJuz}</span>
      <span class="share-stat-label">Juz Quran</span>
    </div>
    <div class="share-stat">
      <span class="share-stat-icon">ü§≤</span>
      <span class="share-stat-num">${niatDone}</span>
      <span class="share-stat-label">Hari Berniat</span>
    </div>
    <div class="share-stat">
      <span class="share-stat-icon">üíù</span>
      <span class="share-stat-num">${fmtRp(totalSedekah)}</span>
      <span class="share-stat-label">Sedekah</span>
    </div>
  `;

  const totalHaidShare = Array.from({length:30},(_,i)=>i+1).filter(d=>data[d]?.haid).length;
  document.getElementById('shareCardStreak').innerHTML = `
    <span class="share-card-streak-label">üî• Streak Terbaik</span>
    <span class="share-card-streak-val">${maxStreak} hari üî•</span>
    ${totalHaidShare > 0 ? `<span class="share-card-streak-label" style="margin-left:12px;color:rgba(255,182,193,.9)">üå∏ Haid</span><span class="share-card-streak-val" style="color:#FFB6C1">${totalHaidShare} hari</span>` : ''}
  `;

  // Quote motivasi
  const quotes = [
    '"Sesungguhnya amal yang dicintai Allah adalah yang dilakukan terus-menerus."',
    '"Doa orang yang berpuasa tidak akan ditolak hingga ia berbuka." ‚Äî HR. Ibn Majah',
    '"Ramadan adalah bulan kesabaran, dan pahala kesabaran adalah surga." ‚Äî HR. Baihaqi',
    '"Barangsiapa berpuasa Ramadan dengan iman, dosanya yang lalu diampuni." ‚Äî HR. Bukhari',
  ];
  document.getElementById('shareCardQuote').textContent = quotes[currentDay % quotes.length];
  document.getElementById('shareCardDays').textContent = `Hari ke-${currentDay} dari 30`;

  document.getElementById('shareModal').classList.add('show');
}

function closeShareModal() {
  document.getElementById('shareModal').classList.remove('show');
}

async function downloadShareCard() {
  try {
    showToast('üì∏ Membuat kartu...', 'success');

    const d = data[currentDay] || {};
    const ibadah = d.ibadah || {};
    const totalIbadahHari = Object.values(ibadah).filter(v => v).length;
    const totalJuz = Array.from({length:30},(_,i)=>i+1).reduce((s,dd)=>s+(data[dd]?.quranJuz||0),0);
    const niatDone = Array.from({length:30},(_,i)=>i+1).filter(dd=>data[dd]?.niat).length;
    const totalSedekah = Array.from({length:30},(_,i)=>i+1).reduce((s,dd)=>s+(data[dd]?.sedekah||[]).reduce((a,x)=>a+x.amt,0),0);
    const fmtRpCanvas = n => n>=1000000?'Rp'+(n/1000000).toFixed(1)+'jt':n>=1000?'Rp'+(n/1000).toFixed(0)+'rb':'Rp'+n;
    let streak = 0, cur = 0;
    for(let dd=1;dd<=30;dd++){
      const ib=data[dd]?.ibadah||{};
      const f=typeof IBADAH_LIST!=='undefined'?IBADAH_LIST.filter(x=>x.streak).filter(x=>ib[x.id]).length:0;
      if(f>=5&&ib['tarawih']){cur++;streak=Math.max(streak,cur);}else cur=0;
    }

    // Portrait canvas ‚Äî 1080x1920 (9:16 potret)
    const W = 1080, H = 1920;
    const cv = document.createElement('canvas');
    cv.width = W; cv.height = H;
    const ctx = cv.getContext('2d');

    // === BACKGROUND ===
    const bg = ctx.createLinearGradient(0, 0, 0, H);
    bg.addColorStop(0,   '#020A14');
    bg.addColorStop(0.4, '#061525');
    bg.addColorStop(0.8, '#0A1F2E');
    bg.addColorStop(1,   '#061020');
    ctx.fillStyle = bg; ctx.fillRect(0, 0, W, H);

    // Radial glow top
    const glow = ctx.createRadialGradient(W/2, 0, 0, W/2, 0, 700);
    glow.addColorStop(0, 'rgba(26,80,100,.5)');
    glow.addColorStop(1, 'transparent');
    ctx.fillStyle = glow; ctx.fillRect(0, 0, W, H);

    // Gold corner glow
    const glowR = ctx.createRadialGradient(W, 0, 0, W, 0, 500);
    glowR.addColorStop(0, 'rgba(200,151,58,.08)');
    glowR.addColorStop(1, 'transparent');
    ctx.fillStyle = glowR; ctx.fillRect(0, 0, W, H);

    // === STARS ===
    for(let i = 0; i < 160; i++) {
      const sx = Math.random()*W, sy = Math.random()*H*0.65;
      const sr = Math.random()*2 + 0.3;
      const sa = Math.random()*0.7 + 0.1;
      ctx.beginPath();
      ctx.arc(sx, sy, sr, 0, Math.PI*2);
      ctx.fillStyle = `rgba(255,255,255,${sa})`; ctx.fill();
    }

    // === OUTER BORDER ===
    ctx.strokeStyle = 'rgba(200,151,58,.45)'; ctx.lineWidth = 3;
    roundRect(ctx, 16, 16, W-32, H-32, 36); ctx.stroke();

    // Inner subtle border
    ctx.strokeStyle = 'rgba(200,151,58,.12)'; ctx.lineWidth = 1;
    roundRect(ctx, 28, 28, W-56, H-56, 28); ctx.stroke();

    // === BIG MOON DECO ===
    ctx.font = '320px serif'; ctx.fillStyle = 'rgba(200,151,58,.04)';
    ctx.fillText('üåô', W - 260, 360);

    // Stars deco small
    ctx.font = '60px serif'; ctx.fillStyle = 'rgba(255,255,255,.06)';
    ctx.fillText('‚ú®', 60, 180);
    ctx.font = '40px serif';
    ctx.fillText('‚≠ê', W - 110, 520);

    // === HEADER ===
    ctx.textAlign = 'center';

    // App title icon
    ctx.font = '90px serif';
    ctx.fillText('üåô', W/2, 200);

    // Title
    ctx.font = 'bold 52px serif'; ctx.fillStyle = '#E8BE6A';
    ctx.fillText('Ramadan Planner 1447H', W/2, 280);

    // Arabic subtitle
    ctx.font = '38px serif'; ctx.fillStyle = 'rgba(255,255,255,.4)';
    ctx.fillText('ÿ±ŸÖÿ∂ÿßŸÜ ŸÉÿ±ŸäŸÖ', W/2, 340);

    // Name
    ctx.font = 'bold 26px sans-serif'; ctx.fillStyle = 'rgba(200,151,58,.8)';
    ctx.fillText('\u2756 ' + getShareName().toUpperCase() + ' \u2756', W/2, 395);

    // === DIVIDER ===
    const div1 = ctx.createLinearGradient(80, 0, W-80, 0);
    div1.addColorStop(0, 'transparent');
    div1.addColorStop(0.5, 'rgba(200,151,58,.55)');
    div1.addColorStop(1, 'transparent');
    ctx.strokeStyle = div1; ctx.lineWidth = 1.5;
    ctx.beginPath(); ctx.moveTo(80, 425); ctx.lineTo(W-80, 425); ctx.stroke();

    // === DAY BADGE ===
    const badgeW = 320, badgeH = 64, badgeX = W/2 - badgeW/2, badgeY = 450;
    const bdg = ctx.createLinearGradient(badgeX, badgeY, badgeX+badgeW, badgeY+badgeH);
    bdg.addColorStop(0, 'rgba(200,151,58,.25)');
    bdg.addColorStop(1, 'rgba(200,151,58,.12)');
    ctx.fillStyle = bdg;
    roundRect(ctx, badgeX, badgeY, badgeW, badgeH, 32); ctx.fill();
    ctx.strokeStyle = 'rgba(200,151,58,.5)'; ctx.lineWidth = 1.5;
    roundRect(ctx, badgeX, badgeY, badgeW, badgeH, 32); ctx.stroke();
    ctx.font = 'bold 26px sans-serif'; ctx.fillStyle = '#E8BE6A';
    ctx.fillText(`üìÖ  Hari ke-${currentDay} dari 30`, W/2, badgeY + 41);

    // === PROGRESS BAR (Ramadan progress) ===
    const progPct = currentDay / 30;
    const pBarX = 80, pBarY = 560, pBarW = W - 160, pBarH = 16;
    ctx.fillStyle = 'rgba(255,255,255,.08)';
    roundRect(ctx, pBarX, pBarY, pBarW, pBarH, 8); ctx.fill();
    const pFill = ctx.createLinearGradient(pBarX, 0, pBarX + pBarW, 0);
    pFill.addColorStop(0, '#C8973A'); pFill.addColorStop(1, '#E8BE6A');
    ctx.fillStyle = pFill;
    roundRect(ctx, pBarX, pBarY, pBarW * progPct, pBarH, 8); ctx.fill();
    ctx.font = 'bold 22px sans-serif'; ctx.fillStyle = 'rgba(200,151,58,.7)';
    ctx.textAlign = 'right';
    ctx.fillText(Math.round(progPct*100) + '% Ramadan', W - 80, pBarY - 10);

    // === STATS: 5 cards vertical stacked ===
    const stats = [
      { icon:'ü§≤', val: niatDone+'/30 hari',   label:'Niat Puasa',       color:'rgba(26,107,107,.5)',  border:'rgba(46,158,158,.45)' },
      { icon:'üïå', val: totalIbadahHari+'/'+((typeof IBADAH_LIST!=='undefined')?IBADAH_LIST.length:9)+' ibadah', label:'Ibadah Hari Ini', color:'rgba(200,151,58,.18)', border:'rgba(200,151,58,.45)' },
      { icon:'üìñ', val: totalJuz+' juz',        label:'Total Juz Quran',  color:'rgba(80,140,200,.15)', border:'rgba(100,160,220,.4)' },
      { icon:'üî•', val: streak+' hari',         label:'Streak Terbaik',   color:'rgba(200,80,50,.15)',  border:'rgba(220,100,60,.4)'  },
      { icon:'üíù', val: fmtRpCanvas(totalSedekah), label:'Total Sedekah', color:'rgba(180,80,120,.18)', border:'rgba(220,100,150,.45)' },
    ];

    const cX = 60, cW = W - 120, cH = 152, cGap = 18;
    let cY = 610;

    stats.forEach(s => {
      // Card bg
      ctx.fillStyle = s.color;
      roundRect(ctx, cX, cY, cW, cH, 24); ctx.fill();
      ctx.strokeStyle = s.border; ctx.lineWidth = 1.5;
      roundRect(ctx, cX, cY, cW, cH, 24); ctx.stroke();

      // Icon left
      ctx.font = '58px serif'; ctx.textAlign = 'left';
      ctx.fillStyle = 'white';
      ctx.fillText(s.icon, cX + 36, cY + 96);

      // Label top
      ctx.font = 'bold 22px sans-serif'; ctx.fillStyle = 'rgba(255,255,255,.5)';
      ctx.fillText(s.label, cX + 128, cY + 54);

      // Value big
      ctx.font = 'bold 48px sans-serif'; ctx.fillStyle = 'white';
      ctx.fillText(s.val, cX + 128, cY + 114);

      cY += cH + cGap;
    });

    // === QUOTE ===
    const quoteY = cY + 30;
    ctx.fillStyle = 'rgba(255,255,255,.05)';
    roundRect(ctx, 60, quoteY, W-120, 120, 20); ctx.fill();
    ctx.strokeStyle = 'rgba(255,255,255,.08)'; ctx.lineWidth = 1;
    roundRect(ctx, 60, quoteY, W-120, 120, 20); ctx.stroke();

    const quotes = [
      'Berpuasa bukan hanya menahan lapar, tapi melatih jiwa.',
      'Setiap doa di bulan Ramadan adalah cahaya.',
      'Ramadan adalah madrasah hati yang sesungguhnya.',
      'Sesungguhnya amal yang dicintai Allah adalah yang dilakukan terus-menerus.',
    ];
    const quote = quotes[currentDay % quotes.length];
    ctx.textAlign = 'center'; ctx.font = 'italic 26px serif'; ctx.fillStyle = 'rgba(255,255,255,.5)';
    wrapText(ctx, '\u201C'+quote+'\u201D', W/2, quoteY + 48, W - 180, 34);

    // === DIVIDER BOTTOM ===
    const divBY = quoteY + 148;
    const div2 = ctx.createLinearGradient(80, 0, W-80, 0);
    div2.addColorStop(0,'transparent'); div2.addColorStop(.5,'rgba(200,151,58,.3)'); div2.addColorStop(1,'transparent');
    ctx.strokeStyle = div2; ctx.lineWidth = 1;
    ctx.beginPath(); ctx.moveTo(80, divBY); ctx.lineTo(W-80, divBY); ctx.stroke();

    // === FOOTER ===
    ctx.textAlign = 'left'; ctx.font = 'bold 24px sans-serif'; ctx.fillStyle = 'rgba(200,151,58,.65)';
    ctx.fillText('#Ramadan1447 #RamadanPlanner', 60, divBY + 50);
    ctx.textAlign = 'right'; ctx.font = '22px sans-serif'; ctx.fillStyle = 'rgba(255,255,255,.25)';
    ctx.fillText('Ramadan Planner 1447H', W-60, divBY + 50);

    const imgData = cv.toDataURL('image/png');

    // Native share (mobile)
    if (navigator.canShare && navigator.share) {
      try {
        const blob = await new Promise(res => cv.toBlob(res, 'image/png'));
        const file = new File([blob], `Ramadan-1447H-Hari${currentDay}.png`, {type:'image/png'});
        if (navigator.canShare({files:[file]})) {
          await navigator.share({title:'Ramadan Planner 1447H', text:`Hari ke-${currentDay} Ramadan 1447H ‚Äî Progress ibadahku! üåô #RamadanPlanner`, files:[file]});
          showToast('‚úÖ Kartu berhasil dibagikan! üéâ', 'success');
          return;
        }
      } catch(shareErr) {
        if (shareErr.name !== 'AbortError') console.warn('Share failed:', shareErr);
      }
    }
    // Fallback download
    const link = document.createElement('a');
    link.download = `Ramadan-1447H-Hari${currentDay}.png`;
    link.href = imgData;
    link.click();
    showToast('‚úÖ Kartu berhasil disimpan! üéâ', 'success');
  } catch(e) {
    showToast('‚ö†Ô∏è Gagal buat gambar, coba Salin Teks', 'error');
    console.error(e);
  }
}

function roundRect(ctx, x, y, w, h, r) {
  ctx.beginPath();
  ctx.moveTo(x+r, y);
  ctx.lineTo(x+w-r, y); ctx.quadraticCurveTo(x+w, y, x+w, y+r);
  ctx.lineTo(x+w, y+h-r); ctx.quadraticCurveTo(x+w, y+h, x+w-r, y+h);
  ctx.lineTo(x+r, y+h); ctx.quadraticCurveTo(x, y+h, x, y+h-r);
  ctx.lineTo(x, y+r); ctx.quadraticCurveTo(x, y, x+r, y);
  ctx.closePath();
}

function wrapText(ctx, text, x, y, maxW, lineH) {
  const words = text.split(' ');
  let line = '';
  for(let w of words){
    const test = line + w + ' ';
    if(ctx.measureText(test).width > maxW && line){
      ctx.fillText(line.trim(), x, y); y+=lineH; line = w+' ';
    } else line = test;
  }
  ctx.fillText(line.trim(), x, y);
}

function shareToWA() {
  const totalIbadah = Array.from({length:30},(_,i)=>i+1)
    .reduce((s,d) => s + Object.values((data[d]?.ibadah)||{}).filter(v=>v).length, 0);
  const totalJuz = Array.from({length:30},(_,i)=>i+1)
    .reduce((s,d) => s + (data[d]?.quranJuz||0), 0);
  const niatDone = Array.from({length:30},(_,i)=>i+1).filter(d=>data[d]?.niat).length;

  let maxStreak=0, cur=0;
  for(let d=1;d<=30;d++){
    const ib=data[d]?.ibadah||{};
    if(typeof IBADAH_LIST!=='undefined'){
      const f=IBADAH_LIST.filter(x=>x.streak).filter(x=>ib[x.id]).length;
      if(f>=5&&ib['tarawih']){cur++;maxStreak=Math.max(maxStreak,cur);}else cur=0;
    }
  }

  const msg = encodeURIComponent(
`üåô *Rekap Ramadan 1447H-ku ‚Äî Hari ke-${currentDay}*

‚úÖ Niat Puasa: ${niatDone}/30 hari
üïå Total Ibadah: ${totalIbadah} ‚úì
üìñ Total Juz Quran: ${totalJuz} juz
üî• Streak Terbaik: ${maxStreak} hari

_Alhamdulillah, semoga diterima Allah SWT_ ü§≤

#Ramadan1447H #RamadanPlanner`
  );
  window.open('https://wa.me/?text=' + msg, '_blank');
}

function copyShareText() {
  const totalIbadah = Array.from({length:30},(_,i)=>i+1)
    .reduce((s,d) => s + Object.values((data[d]?.ibadah)||{}).filter(v=>v).length, 0);
  const totalJuz = Array.from({length:30},(_,i)=>i+1)
    .reduce((s,d) => s + (data[d]?.quranJuz||0), 0);
  const niatDone = Array.from({length:30},(_,i)=>i+1).filter(d=>data[d]?.niat).length;

  const text = `üåô Rekap Ramadan 1447H-ku (Hari ke-${currentDay})

‚úÖ Niat Puasa: ${niatDone}/30 hari
üïå Total Ibadah: ${totalIbadah} ‚úì
üìñ Total Juz Quran: ${totalJuz} juz

Alhamdulillah ü§≤ #Ramadan1447H`;
  
  navigator.clipboard.writeText(text)
    .then(() => showToast('üìã Teks disalin! Tempel di WA/IG Story üéâ', 'success'))
    .catch(() => showToast('‚ö†Ô∏è Gagal salin', 'error'));
}

// PWA Manifest ‚Äî inject dinamis
(function setupPWAManifest() {
  const manifest = {
    name: "Ramadan Planner 1447H",
    short_name: "Ramadan 1447",
    description: "Tracker ibadah Ramadan oleh Andi Maulana Yusuf",
    start_url: "./",
    display: "standalone",
    background_color: "#020A14",
    theme_color: "#020A14",
    orientation: "portrait-primary",
    icons: [
      {
        src: "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'><rect width='512' height='512' rx='80' fill='%23020A14'/><text y='380' x='60' font-size='380'>üåô</text></svg>",
        sizes: "512x512",
        type: "image/svg+xml",
        purpose: "any maskable"
      }
    ]
  };
  const blob = new Blob([JSON.stringify(manifest)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const el = document.getElementById('pwaManifest');
  if (el) el.href = url;
})();


// ===== RENDER ALL =====

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// AYAT HARIAN ‚Äî 30 ayat pilihan untuk Ramadan
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
var AYAT_HARIAN = [
  {arabic:'ÿ¥ŸéŸáŸíÿ±Ÿè ÿ±ŸéŸÖŸéÿ∂ŸéÿßŸÜŸé ÿßŸÑŸéŸëÿ∞ŸêŸä ÿ£ŸèŸÜÿ≤ŸêŸÑŸé ŸÅŸêŸäŸáŸê ÿßŸÑŸíŸÇŸèÿ±Ÿíÿ¢ŸÜŸè ŸáŸèÿØŸãŸâ ŸÑŸêŸëŸÑŸÜŸéŸëÿßÿ≥Ÿê',latin:'Syahru RamadhƒÅnal-ladzƒ´ unzila fƒ´hil-Qur\'ƒÅnu hudal lin-nƒÅs',arti:'"Bulan Ramadan, bulan yang di dalamnya diturunkan Al-Qur\'an sebagai petunjuk bagi manusia."',ref:'QS. Al-Baqarah: 185'},
  {arabic:'ŸàŸéÿ•Ÿêÿ∞Ÿéÿß ÿ≥Ÿéÿ£ŸéŸÑŸéŸÉŸé ÿπŸêÿ®ŸéÿßÿØŸêŸä ÿπŸéŸÜŸêŸëŸä ŸÅŸéÿ•ŸêŸÜŸêŸëŸä ŸÇŸéÿ±ŸêŸäÿ®Ÿå',latin:'Wa idzƒÅ sa\'alaka \'ibƒÅdƒ´ \'annƒ´ fa innƒ´ qarƒ´b',arti:'"Dan apabila hamba-hamba-Ku bertanya kepadamu tentang Aku, maka sesungguhnya Aku dekat."',ref:'QS. Al-Baqarah: 186'},
  {arabic:'ÿ•ŸêŸÜŸéŸë ÿßŸÑŸÑŸéŸëŸáŸé ŸÖŸéÿπŸé ÿßŸÑÿµŸéŸëÿßÿ®Ÿêÿ±ŸêŸäŸÜŸé',latin:'InnallƒÅha ma\'ash-shƒÅbirƒ´n',arti:'"Sesungguhnya Allah beserta orang-orang yang sabar."',ref:'QS. Al-Baqarah: 153'},
  {arabic:'ŸàŸéÿßÿ≥Ÿíÿ™ŸéÿπŸêŸäŸÜŸèŸàÿß ÿ®ŸêÿßŸÑÿµŸéŸëÿ®Ÿíÿ±Ÿê ŸàŸéÿßŸÑÿµŸéŸëŸÑŸéÿßÿ©Ÿê',latin:'Wasta\'ƒ´n≈´ bish-shabri wash-shalƒÅh',arti:'"Jadikanlah sabar dan shalat sebagai penolongmu."',ref:'QS. Al-Baqarah: 45'},
  {arabic:'ŸÅŸéÿßÿ∞ŸíŸÉŸèÿ±ŸèŸàŸÜŸêŸä ÿ£Ÿéÿ∞ŸíŸÉŸèÿ±ŸíŸÉŸèŸÖŸí ŸàŸéÿßÿ¥ŸíŸÉŸèÿ±ŸèŸàÿß ŸÑŸêŸä ŸàŸéŸÑŸéÿß ÿ™ŸéŸÉŸíŸÅŸèÿ±ŸèŸàŸÜŸê',latin:'Fadzkur≈´nƒ´ adzkurkum wasykur≈´ lƒ´ wa lƒÅ takfur≈´n',arti:'"Maka ingatlah kepada-Ku, Aku pun akan ingat kepadamu. Bersyukurlah kepada-Ku dan janganlah kamu ingkar."',ref:'QS. Al-Baqarah: 152'},
  {arabic:'ÿ•ŸêŸÜŸéŸë ŸÖŸéÿπŸé ÿßŸÑŸíÿπŸèÿ≥Ÿíÿ±Ÿê ŸäŸèÿ≥Ÿíÿ±Ÿãÿß',latin:'Inna ma\'al-\'usri yusrƒÅ',arti:'"Sesungguhnya bersama kesulitan ada kemudahan."',ref:'QS. Al-Insyirah: 6'},
  {arabic:'ŸàŸéŸÖŸéŸÜ ŸäŸéÿ™ŸéŸëŸÇŸê ÿßŸÑŸÑŸéŸëŸáŸé ŸäŸéÿ¨ŸíÿπŸéŸÑ ŸÑŸéŸëŸáŸè ŸÖŸéÿÆŸíÿ±Ÿéÿ¨Ÿãÿß',latin:'Wa may yattaqillƒÅha yaj\'al lah≈´ makhraja',arti:'"Barang siapa bertakwa kepada Allah, niscaya Dia akan membukakan jalan keluar baginya."',ref:'QS. At-Thalaq: 2'},
  {arabic:'ÿ•ŸêŸÜŸéŸë ÿßŸÑŸÑŸéŸëŸáŸé ŸÑŸéÿß ŸäŸèÿ∂ŸêŸäÿπŸè ÿ£Ÿéÿ¨Ÿíÿ±Ÿé ÿßŸÑŸíŸÖŸèÿ≠Ÿíÿ≥ŸêŸÜŸêŸäŸÜŸé',latin:'InnallƒÅha lƒÅ yudlƒ´\'u ajral-muhsinƒ´n',arti:'"Sesungguhnya Allah tidak menyia-nyiakan pahala orang yang berbuat kebaikan."',ref:'QS. At-Taubah: 120'},
  {arabic:'ŸàŸéÿ£ŸéŸÇŸêŸäŸÖŸèŸàÿß ÿßŸÑÿµŸéŸëŸÑŸéÿßÿ©Ÿé ŸàŸéÿ¢ÿ™ŸèŸàÿß ÿßŸÑÿ≤ŸéŸëŸÉŸéÿßÿ©Ÿé',latin:'Wa aqƒ´mush-shalƒÅta wa ƒÅtuz-zakƒÅh',arti:'"Dirikanlah shalat dan tunaikanlah zakat."',ref:'QS. Al-Baqarah: 43'},
  {arabic:'ÿ±Ÿéÿ®ŸéŸëŸÜŸéÿß ÿ¢ÿ™ŸêŸÜŸéÿß ŸÅŸêŸä ÿßŸÑÿØŸèŸëŸÜŸíŸäŸéÿß ÿ≠Ÿéÿ≥ŸéŸÜŸéÿ©Ÿã ŸàŸéŸÅŸêŸä ÿßŸÑŸíÿ¢ÿÆŸêÿ±Ÿéÿ©Ÿê ÿ≠Ÿéÿ≥ŸéŸÜŸéÿ©Ÿã',latin:'RabbanƒÅ ƒÅtinƒÅ fid-dunyƒÅ hasanatan wa fil-ƒÅkhirati hasanah',arti:'"Ya Tuhan kami, berikanlah kami kebaikan di dunia dan kebaikan di akhirat."',ref:'QS. Al-Baqarah: 201'},
  {arabic:'ŸäŸéÿß ÿ£ŸéŸäŸèŸëŸáŸéÿß ÿßŸÑŸéŸëÿ∞ŸêŸäŸÜŸé ÿ¢ŸÖŸéŸÜŸèŸàÿß ŸÉŸèÿ™Ÿêÿ®Ÿé ÿπŸéŸÑŸéŸäŸíŸÉŸèŸÖŸè ÿßŸÑÿµŸêŸëŸäŸéÿßŸÖŸè',latin:'YƒÅ ayyuhal-ladzƒ´na ƒÅman≈´ kutiba \'alaykumush-shiyƒÅm',arti:'"Wahai orang-orang yang beriman! Diwajibkan atas kamu berpuasa."',ref:'QS. Al-Baqarah: 183'},
  {arabic:'ÿ•ŸêŸÜŸéŸë ÿßŸÑŸíŸÖŸèÿ≥ŸíŸÑŸêŸÖŸêŸäŸÜŸé ŸàŸéÿßŸÑŸíŸÖŸèÿ≥ŸíŸÑŸêŸÖŸéÿßÿ™Ÿê... ÿ£ŸéÿπŸéÿØŸéŸë ÿßŸÑŸÑŸéŸëŸáŸè ŸÑŸéŸáŸèŸÖ ŸÖŸéŸëÿ∫ŸíŸÅŸêÿ±Ÿéÿ©Ÿã ŸàŸéÿ£Ÿéÿ¨Ÿíÿ±Ÿãÿß ÿπŸéÿ∏ŸêŸäŸÖŸãÿß',latin:'InnallƒÅha a\'adda lahum maghfiratan wa ajran \'adhƒ´mƒÅ',arti:'"Allah telah menyediakan bagi mereka ampunan dan pahala yang besar."',ref:'QS. Al-Ahzab: 35'},
  {arabic:'ŸàŸéÿ≥Ÿéÿßÿ±ŸêÿπŸèŸàÿß ÿ•ŸêŸÑŸéŸâŸ∞ ŸÖŸéÿ∫ŸíŸÅŸêÿ±Ÿéÿ©Ÿç ŸÖŸêŸëŸÜ ÿ±ŸéŸëÿ®ŸêŸëŸÉŸèŸÖŸí ŸàŸéÿ¨ŸéŸÜŸéŸëÿ©Ÿç',latin:'Wa sƒÅri\'≈´ ilƒÅ maghfiratin mir-rabbikum wa jannah',arti:'"Dan bersegeralah kamu mencari ampunan dari Tuhanmu dan surga."',ref:'QS. Ali \'Imran: 133'},
  {arabic:'ÿ•ŸêŸÜŸéŸë ÿßŸÑŸÑŸéŸëŸáŸé ŸäŸèÿ≠Ÿêÿ®ŸèŸë ÿßŸÑŸíŸÖŸèÿ™ŸéŸàŸéŸÉŸêŸëŸÑŸêŸäŸÜŸé',latin:'InnallƒÅha yuhibbul-mutawakkilƒ´n',arti:'"Sesungguhnya Allah mencintai orang-orang yang bertawakal."',ref:'QS. Ali \'Imran: 159'},
  {arabic:'ŸàŸéÿßŸÑŸÑŸéŸëŸáŸè ŸäŸèÿ≠Ÿêÿ®ŸèŸë ÿßŸÑÿµŸéŸëÿßÿ®Ÿêÿ±ŸêŸäŸÜŸé',latin:'WallƒÅhu yuhibbush-shƒÅbirƒ´n',arti:'"Dan Allah mencintai orang-orang yang sabar."',ref:'QS. Ali \'Imran: 146'},
  {arabic:'ÿ•ŸêŸÜŸéŸë ÿßŸÑŸÑŸéŸëŸáŸé ŸÖŸéÿπ ÿßŸÑŸéŸëÿ∞ŸêŸäŸÜŸé ÿßÿ™ŸéŸëŸÇŸéŸàÿß ŸàŸéŸëÿßŸÑŸéŸëÿ∞ŸêŸäŸÜŸé ŸáŸèŸÖ ŸÖŸèŸëÿ≠Ÿíÿ≥ŸêŸÜŸèŸàŸÜŸé',latin:'InnallƒÅha ma\'al-ladzƒ´nat-taqaw wal-ladzƒ´na hum muhsin≈´n',arti:'"Sesungguhnya Allah beserta orang yang bertakwa dan orang yang berbuat kebaikan."',ref:'QS. An-Nahl: 128'},
  {arabic:'ŸÑŸéŸäŸíŸÑŸéÿ©Ÿè ÿßŸÑŸíŸÇŸéÿØŸíÿ±Ÿê ÿÆŸéŸäŸíÿ±Ÿå ŸÖŸêŸëŸÜŸí ÿ£ŸéŸÑŸíŸÅŸê ÿ¥ŸéŸáŸíÿ±Ÿç',latin:'Laylatul-qadri khayrum min alfi syahr',arti:'"Malam Kemuliaan itu lebih baik dari seribu bulan."',ref:'QS. Al-Qadr: 3'},
  {arabic:'ŸÅŸéÿ•ŸêŸÜŸéŸë ŸÖŸéÿπŸé ÿßŸÑŸíÿπŸèÿ≥Ÿíÿ±Ÿê ŸäŸèÿ≥Ÿíÿ±Ÿãÿß',latin:'Fa inna ma\'al-\'usri yusrƒÅ',arti:'"Maka sesungguhnya bersama kesulitan ada kemudahan."',ref:'QS. Al-Insyirah: 5'},
  {arabic:'ŸàŸéÿ∞ŸéŸÉŸéÿ±Ÿé ÿßÿ≥ŸíŸÖŸé ÿ±Ÿéÿ®ŸêŸëŸáŸê ŸÅŸéÿµŸéŸÑŸéŸëŸâŸ∞',latin:'Wa dzakara-smƒÅ rabbihƒ´ fa shallƒÅ',arti:'"Dan dia menyebut nama Tuhannya, lalu dia shalat."',ref:'QS. Al-A\'la: 15'},
  {arabic:'ŸÇŸéÿØŸí ÿ£ŸéŸÅŸíŸÑŸéÿ≠Ÿé ŸÖŸéŸÜ ÿ≤ŸéŸÉŸéŸëÿßŸáŸéÿß',latin:'Qad aflaha man zakkƒÅhƒÅ',arti:'"Sungguh beruntung orang yang menyucikan jiwanya."',ref:'QS. Asy-Syams: 9'},
  {arabic:'ŸàŸéŸÖŸéŸÜŸí ÿ£Ÿéÿ≠Ÿíÿ≥ŸéŸÜŸè ŸÇŸéŸàŸíŸÑŸãÿß ŸÖŸêŸëŸÖŸéŸëŸÜ ÿØŸéÿπŸéÿß ÿ•ŸêŸÑŸéŸâ ÿßŸÑŸÑŸéŸëŸáŸê',latin:'Wa man ahsanu qawlan mimman da\'ƒÅ ilallƒÅh',arti:'"Siapakah yang lebih baik perkataannya daripada orang yang menyeru kepada Allah?"',ref:'QS. Fushshilat: 33'},
  {arabic:'ŸÅŸéÿ®Ÿêÿ£ŸéŸäŸêŸë ÿ¢ŸÑŸéÿßÿ°Ÿê ÿ±Ÿéÿ®ŸêŸëŸÉŸèŸÖŸéÿß ÿ™ŸèŸÉŸéÿ∞ŸêŸëÿ®ŸéÿßŸÜŸê',latin:'Fa bi\'ayyi ƒÅlƒÅ\'i rabbikumƒÅ tukadzdzibƒÅn',arti:'"Maka nikmat Tuhanmu yang manakah yang kamu dustakan?"',ref:'QS. Ar-Rahman: 13'},
  {arabic:'ÿ•ŸêŸÜŸéŸë ÿßŸÑŸÑŸéŸëŸáŸé ÿ∫ŸéŸÅŸèŸàÿ±Ÿå ÿ±ŸéŸëÿ≠ŸêŸäŸÖŸå',latin:'InnallƒÅha ghaf≈´rur-rahƒ´m',arti:'"Sesungguhnya Allah Maha Pengampun lagi Maha Penyayang."',ref:'QS. Al-Baqarah: 173'},
  {arabic:'ŸàŸéÿ™ŸèŸàÿ®ŸèŸàÿß ÿ•ŸêŸÑŸéŸâ ÿßŸÑŸÑŸéŸëŸáŸê ÿ¨ŸéŸÖŸêŸäÿπŸãÿß ÿ£ŸéŸäŸèŸëŸáŸé ÿßŸÑŸíŸÖŸèÿ§ŸíŸÖŸêŸÜŸèŸàŸÜŸé',latin:'Wa t≈´b≈´ ilallƒÅhi jamƒ´\'an ayyuhal-mu\'min≈´n',arti:'"Dan bertaubatlah kamu semua kepada Allah, wahai orang-orang yang beriman."',ref:'QS. An-Nur: 31'},
  {arabic:'ŸàŸéÿπŸéÿ≥ŸéŸâŸ∞ ÿ£ŸéŸÜ ÿ™ŸéŸÉŸíÿ±ŸéŸáŸèŸàÿß ÿ¥ŸéŸäŸíÿ¶Ÿãÿß ŸàŸéŸáŸèŸàŸé ÿÆŸéŸäŸíÿ±Ÿå ŸÑŸéŸëŸÉŸèŸÖŸí',latin:'Wa \'asƒÅ an takrah≈´ syay\'an wa huwa khayrul-lakum',arti:'"Boleh jadi kamu membenci sesuatu, padahal itu baik bagimu."',ref:'QS. Al-Baqarah: 216'},
  {arabic:'ŸàŸéÿßŸÑŸÑŸéŸëŸáŸè ÿÆŸéŸäŸíÿ±Ÿè ÿßŸÑÿ±ŸéŸëÿßÿ≤ŸêŸÇŸêŸäŸÜŸé',latin:'WallƒÅhu khayrun-nƒÅziqƒ´n',arti:'"Dan Allah adalah sebaik-baik pemberi rezeki."',ref:'QS. Al-Jumu\'ah: 11'},
  {arabic:'ÿ±Ÿéÿ®ŸêŸë ÿßÿ¥Ÿíÿ±Ÿéÿ≠Ÿí ŸÑŸêŸä ÿµŸéÿØŸíÿ±ŸêŸä ŸàŸéŸäŸéÿ≥ŸêŸëÿ±Ÿí ŸÑŸêŸä ÿ£ŸéŸÖŸíÿ±ŸêŸä',latin:'Rabbisy-rah lƒ´ shadrƒ´ wa yassir lƒ´ amrƒ´',arti:'"Ya Tuhanku, lapangkanlah dadaku dan mudahkanlah urusanku."',ref:'QS. Tha-ha: 25-26'},
  {arabic:'ÿßŸÑŸéŸëÿ∞ŸêŸäŸÜŸé ÿ¢ŸÖŸéŸÜŸèŸàÿß ŸàŸéÿ™Ÿéÿ∑ŸíŸÖŸéÿ¶ŸêŸÜŸèŸë ŸÇŸèŸÑŸèŸàÿ®ŸèŸáŸèŸÖ ÿ®Ÿêÿ∞ŸêŸÉŸíÿ±Ÿê ÿßŸÑŸÑŸéŸëŸáŸê',latin:'Alladzƒ´na ƒÅman≈´ wa tatma\'innu qul≈´buhum bidzikrillƒÅh',arti:'"Orang-orang yang beriman dan hati mereka menjadi tenteram dengan mengingat Allah."',ref:'QS. Ar-Ra\'d: 28'},
  {arabic:'ÿ•ŸêŸÜŸéŸë ÿßŸÑŸÑŸéŸëŸáŸé ŸäŸèÿ≠Ÿêÿ®ŸèŸë ÿßŸÑŸíŸÖŸèŸÇŸíÿ≥Ÿêÿ∑ŸêŸäŸÜŸé',latin:'InnallƒÅha yuhibbul-muqsi·π≠ƒ´n',arti:'"Sesungguhnya Allah mencintai orang-orang yang berlaku adil."',ref:'QS. Al-Hujurat: 9'},
  {arabic:'ŸàŸéÿ£ŸéŸÜŸêŸäÿ®ŸèŸàÿß ÿ•ŸêŸÑŸéŸâŸ∞ ÿ±Ÿéÿ®ŸêŸëŸÉŸèŸÖŸí ŸàŸéÿ£Ÿéÿ≥ŸíŸÑŸêŸÖŸèŸàÿß ŸÑŸéŸáŸè',latin:'Wa anƒ´b≈´ ilƒÅ rabbikum wa aslim≈´ lah',arti:'"Dan kembalilah kamu kepada Tuhanmu, serta berserah dirilah kepada-Nya."',ref:'QS. Az-Zumar: 54'},
];

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TANTANGAN 30 HARI
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
var TANTANGAN_LIST = [
  {icon:'ü§≤',title:'Doa dengan Khusyuk',desc:'Hari ini, saat doa setelah shalat, pejamkan mata dan hayati setiap kata dengan penuh harap kepada Allah.'},
  {icon:'üíù',title:'Sedekah Diam-Diam',desc:'Berikan sedekah tanpa memberitahu siapapun. Hanya kamu dan Allah yang tahu.'},
  {icon:'üìñ',title:'Baca 5 Halaman Qur\'an',desc:'Targetkan baca minimal 5 halaman Al-Qur\'an hari ini dengan tartil dan pahami artinya.'},
  {icon:'üòä',title:'Senyum & Sapa',desc:'Berikan senyuman tulus kepada setidaknya 3 orang hari ini. Senyum adalah sedekah!'},
  {icon:'üìû',title:'Silaturahmi',desc:'Hubungi satu anggota keluarga atau teman lama yang sudah lama tidak berkomunikasi.'},
  {icon:'üåÖ',title:'Subuh Tepat Waktu',desc:'Shalat Subuh tepat di awal waktu, lalu duduk berdzikir hingga matahari terbit.'},
  {icon:'üö´',title:'Puasa Bicara Sia-sia',desc:'Hari ini, jaga lisanmu. Hindari gosip, perdebatan, dan kata-kata yang tidak bermanfaat.'},
  {icon:'üçΩÔ∏è',title:'Berbagi Takjil',desc:'Siapkan atau beli takjil untuk dibagikan kepada tetangga atau orang yang berbuka di masjid.'},
  {icon:'üåô',title:'Shalat Tarawih Penuh',desc:'Ikuti shalat Tarawih sampai selesai dengan penuh kekhusyukan malam ini.'},
  {icon:'üìù',title:'Tulis Surat untuk Diri Sendiri',desc:'Tulis surat pendek untuk dirimu di masa depan ‚Äî harapan, doa, dan janji ibadah setelah Ramadan.'},
  {icon:'‚≠ê',title:'Tahajud Malam Ini',desc:'Bangun sepertiga malam terakhir untuk shalat Tahajud minimal 2 rakaat sebelum sahur.'},
  {icon:'ü§ù',title:'Minta Maaf & Memaafkan',desc:'Sampaikan permintaan maaf tulus kepada seseorang yang pernah kamu sakiti, baik sengaja maupun tidak.'},
  {icon:'üåø',title:'Istighfar 100x',desc:'Baca Astaghfirullah 100 kali hari ini ‚Äî saat jalan, menunggu, atau kapanpun ada waktu luang.'},
  {icon:'üèÉ',title:'Olahraga Ringan',desc:'Lakukan 15 menit olahraga ringan sebelum sahur atau setelah berbuka. Tubuh sehat = ibadah lebih semangat!'},
  {icon:'üìø',title:'Selesaikan Dzikir Pagi & Petang',desc:'Hari ini, pastikan dzikir pagi dan petang kamu semua terisi penuh sebelum tidur.'},
  {icon:'üåü',title:'Lailatul Qadar ‚Äî Perbanyak Doa',desc:'Kita sudah di 10 malam terakhir! Perbanyak doa dan amalan malam ini dengan sungguh-sungguh.'},
  {icon:'üí≠',title:'Muhasabah 10 Menit',desc:'Luangkan 10 menit sebelum tidur untuk merenungkan amal hari ini ‚Äî apa yang baik dan perlu diperbaiki.'},
  {icon:'üïå',title:'I\'tikaf Mini',desc:'Duduklah di masjid atau mushola setidaknya 30 menit hari ini hanya untuk berdzikir dan berdoa.'},
  {icon:'üìö',title:'Baca Kisah Nabi',desc:'Baca satu kisah dari kehidupan Nabi Muhammad Ô∑∫ dan ambil pelajaran darinya hari ini.'},
  {icon:'üåô',title:'Cari Lailatul Qadar',desc:'Malam ganjil yang penuh berkah. Isi malam ini dengan shalat malam, membaca Qur\'an, dan doa.'},
  {icon:'ü§≤',title:'Doa untuk Orang Lain',desc:'Doakan setidaknya 5 orang di sekitarmu ‚Äî keluarga, teman, tetangga ‚Äî tanpa mereka mengetahuinya.'},
  {icon:'üí∞',title:'Hitung Zakat',desc:'Cek kewajiban zakat fitrah dan zakatmu. Pastikan sudah ditunaikan sebelum Idul Fitri.'},
  {icon:'‚úçÔ∏è',title:'Tulis 10 Syukur',desc:'Hari ini, tulis 10 hal yang kamu syukuri dalam hidupmu. Nikmat Allah tak terhitung!'},
  {icon:'üå∏',title:'Berbuat Baik Tanpa Diminta',desc:'Lakukan satu kebaikan spontan hari ini tanpa menunggu diminta ‚Äî bantu, belikan makanan, atau dengarkan curhat.'},
  {icon:'üìñ',title:'Khatamkan Bacaan Qur\'an',desc:'Push bacaan Al-Qur\'anmu hari ini. Semakin dekat akhir Ramadan, semakin semangat!'},
  {icon:'üåô',title:'Malam 27 Ramadan',desc:'Ini kemungkinan Lailatul Qadar! Jangan tidur dulu. Shalat, baca Qur\'an, dan perbanyak istighfar.'},
  {icon:'üéÅ',title:'Persiapkan Hadiah Kecil',desc:'Siapkan hadiah kecil untuk seseorang yang berarti bagimu sebagai bentuk syukur dan kasih sayang.'},
  {icon:'üè†',title:'Bersihkan Rumah & Hati',desc:'Bersihkan rumahmu hari ini sambil niatkan juga membersihkan hati dari dengki dan dendam.'},
  {icon:'ü§≤',title:'Doa Khataman',desc:'Hari terakhir Ramadan! Baca doa khataman Al-Qur\'an dan mohon agar ibadah diterima Allah SWT.'},
  {icon:'üåü',title:'Idul Fitri Mubarak!',desc:'Alhamdulillah! Selamat Hari Raya Idul Fitri. Pertahankan semangat ibadah Ramadan sepanjang tahun!'},
];

function renderAyat() {
  var idx = (currentDay - 1) % AYAT_HARIAN.length;
  var a = AYAT_HARIAN[idx];
  var el = document.getElementById('ayatArabic');
  if (!el) return;
  document.getElementById('ayatArabic').textContent = a.arabic;
  document.getElementById('ayatLatin').textContent = a.latin;
  document.getElementById('ayatArti').textContent = a.arti;
  document.getElementById('ayatRef').textContent = a.ref;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DOA PENUTUP HARI ‚Äî 30 doa pilihan
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
var DOA_PENUTUP = [
  {arabic:'ÿ®Ÿêÿßÿ≥ŸíŸÖŸêŸÉŸé ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ£ŸéŸÖŸèŸàÿ™Ÿè ŸàŸéÿ£Ÿéÿ≠ŸíŸäŸéÿß',latin:'BismikallƒÅhumma am≈´tu wa ahyƒÅ',arti:'"Dengan nama-Mu ya Allah, aku mati dan aku hidup."',ref:'HR. Bukhari ‚Äî Doa Sebelum Tidur'},
  {arabic:'ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿßÿ∫ŸíŸÅŸêÿ±Ÿí ŸÑŸêŸä ŸàŸéÿßÿ±Ÿíÿ≠ŸéŸÖŸíŸÜŸêŸä ŸàŸéÿßŸáŸíÿØŸêŸÜŸêŸä ŸàŸéÿπŸéÿßŸÅŸêŸÜŸêŸä ŸàŸéÿßÿ±Ÿíÿ≤ŸèŸÇŸíŸÜŸêŸä',latin:'AllƒÅhummagh-firlƒ´ warhamnƒ´ wahdinƒ´ wa \'ƒÅfinƒ´ warzuqnƒ´',arti:'"Ya Allah, ampunilah aku, rahmatilah aku, tunjukilah aku, sehatkanlah aku, dan berilah aku rezeki."',ref:'HR. Muslim ‚Äî Doa Ringkas Penuh Makna'},
  {arabic:'ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ•ŸêŸÜŸêŸëŸä ÿ£Ÿéÿ≥Ÿíÿ£ŸéŸÑŸèŸÉŸé ÿßŸÑŸíÿπŸéŸÅŸíŸàŸé ŸàŸéÿßŸÑŸíÿπŸéÿßŸÅŸêŸäŸéÿ©Ÿé ŸÅŸêŸä ÿßŸÑÿØŸèŸëŸÜŸíŸäŸéÿß ŸàŸéÿßŸÑŸíÿ¢ÿÆŸêÿ±Ÿéÿ©Ÿê',latin:'AllƒÅhumma innƒ´ as\'alukal-\'afwa wal-\'ƒÅfiyata fid-dunyƒÅ wal-ƒÅkhirah',arti:'"Ya Allah, sesungguhnya aku memohon maaf dan keselamatan di dunia dan akhirat."',ref:'HR. Abu Dawud ‚Äî Doa Pagi & Petang'},
  {arabic:'ÿ≥Ÿèÿ®Ÿíÿ≠ŸéÿßŸÜŸéŸÉŸé ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ŸàŸéÿ®Ÿêÿ≠ŸéŸÖŸíÿØŸêŸÉŸé ÿ£Ÿéÿ¥ŸíŸáŸéÿØŸè ÿ£ŸéŸÜŸí ŸÑŸéÿß ÿ•ŸêŸÑŸéŸáŸé ÿ•ŸêŸÑŸéŸëÿß ÿ£ŸéŸÜŸíÿ™Ÿé ÿ£Ÿéÿ≥Ÿíÿ™Ÿéÿ∫ŸíŸÅŸêÿ±ŸèŸÉŸé ŸàŸéÿ£Ÿéÿ™ŸèŸàÿ®Ÿè ÿ•ŸêŸÑŸéŸäŸíŸÉŸé',latin:'SubhƒÅnakallƒÅhumma wa bihamdika asyhadu allƒÅ ilƒÅha illƒÅ anta astaghfiruka wa at≈´bu ilayk',arti:'"Maha Suci Engkau ya Allah, aku memuji-Mu, aku bersaksi tiada Tuhan selain Engkau, aku memohon ampun dan bertaubat kepada-Mu."',ref:'HR. Tirmidzi ‚Äî Kaffaratul Majlis'},
  {arabic:'ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ™ŸéŸÇŸéÿ®ŸéŸëŸÑŸí ŸÖŸêŸÜŸéŸëÿß ÿ•ŸêŸÜŸéŸëŸÉŸé ÿ£ŸéŸÜŸíÿ™Ÿé ÿßŸÑÿ≥ŸéŸëŸÖŸêŸäÿπŸè ÿßŸÑŸíÿπŸéŸÑŸêŸäŸÖŸè',latin:'AllƒÅhumma taqabbal minnƒÅ innaka antas-samƒ´\'ul-\'alƒ´m',arti:'"Ya Allah, terimalah (amal) dari kami. Sesungguhnya Engkau Maha Mendengar lagi Maha Mengetahui."',ref:'QS. Al-Baqarah: 127 ‚Äî Doa Diterima Amal'},
  {arabic:'ÿ±Ÿéÿ®ŸéŸëŸÜŸéÿß ÿ∏ŸéŸÑŸéŸÖŸíŸÜŸéÿß ÿ£ŸéŸÜŸíŸÅŸèÿ≥ŸéŸÜŸéÿß ŸàŸéÿ•ŸêŸÜŸí ŸÑŸéŸÖŸí ÿ™Ÿéÿ∫ŸíŸÅŸêÿ±Ÿí ŸÑŸéŸÜŸéÿß ŸàŸéÿ™Ÿéÿ±Ÿíÿ≠ŸéŸÖŸíŸÜŸéÿß ŸÑŸéŸÜŸéŸÉŸèŸàŸÜŸéŸÜŸéŸë ŸÖŸêŸÜŸé ÿßŸÑŸíÿÆŸéÿßÿ≥Ÿêÿ±ŸêŸäŸÜŸé',latin:'RabbanƒÅ zhalamnƒÅ anfusanƒÅ wa illam taghfir lanƒÅ wa tarhamnƒÅ lanak≈´nanna minal-khƒÅsirƒ´n',arti:'"Ya Tuhan kami, kami telah menzalimi diri kami sendiri. Jika Engkau tidak mengampuni dan merahmati kami, niscaya kami termasuk orang yang rugi."',ref:'QS. Al-A\'raf: 23 ‚Äî Doa Nabi Adam AS'},
  {arabic:'ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ•ŸêŸÜŸéŸëŸÉŸé ÿπŸéŸÅŸèŸàŸåŸë ÿ™Ÿèÿ≠Ÿêÿ®ŸèŸë ÿßŸÑŸíÿπŸéŸÅŸíŸàŸé ŸÅŸéÿßÿπŸíŸÅŸè ÿπŸéŸÜŸêŸëŸä',latin:'AllƒÅhumma innaka \'afuwwun tuhibbul-\'afwa fa\'fu \'annƒ´',arti:'"Ya Allah, sesungguhnya Engkau Maha Pemaaf dan menyukai maaf, maka maafkanlah aku."',ref:'HR. Tirmidzi ‚Äî Doa Lailatul Qadar'},
  {arabic:'ÿ±Ÿéÿ®ŸéŸëŸÜŸéÿß ÿ¢ÿ™ŸêŸÜŸéÿß ŸÅŸêŸä ÿßŸÑÿØŸèŸëŸÜŸíŸäŸéÿß ÿ≠Ÿéÿ≥ŸéŸÜŸéÿ©Ÿã ŸàŸéŸÅŸêŸä ÿßŸÑŸíÿ¢ÿÆŸêÿ±Ÿéÿ©Ÿê ÿ≠Ÿéÿ≥ŸéŸÜŸéÿ©Ÿã ŸàŸéŸÇŸêŸÜŸéÿß ÿπŸéÿ∞Ÿéÿßÿ®Ÿé ÿßŸÑŸÜŸéŸëÿßÿ±Ÿê',latin:'RabbanƒÅ ƒÅtinƒÅ fid-dunyƒÅ hasanatan wa fil-ƒÅkhirati hasanatan wa qinƒÅ \'adzƒÅban-nƒÅr',arti:'"Ya Tuhan kami, berilah kami kebaikan di dunia dan kebaikan di akhirat, serta jauhkan kami dari siksa neraka."',ref:'QS. Al-Baqarah: 201 ‚Äî Doa Sapu Jagat'},
  {arabic:'ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ•ŸêŸÜŸêŸëŸä ÿ£ŸéÿπŸèŸàÿ∞Ÿè ÿ®ŸêŸÉŸé ŸÖŸêŸÜŸé ÿßŸÑŸíŸáŸéŸÖŸêŸë ŸàŸéÿßŸÑŸíÿ≠Ÿéÿ≤ŸéŸÜŸê',latin:'AllƒÅhumma innƒ´ a\'≈´dzu bika minal-hammi wal-hazan',arti:'"Ya Allah, aku berlindung kepada-Mu dari rasa gelisah dan kesedihan."',ref:'HR. Bukhari ‚Äî Doa dari Kesedihan'},
  {arabic:'ÿ≠Ÿéÿ≥Ÿíÿ®ŸèŸÜŸéÿß ÿßŸÑŸÑŸéŸëŸáŸè ŸàŸéŸÜŸêÿπŸíŸÖŸé ÿßŸÑŸíŸàŸéŸÉŸêŸäŸÑŸè',latin:'HasbunallƒÅhu wa ni\'mal-wakƒ´l',arti:'"Cukuplah Allah bagi kami, dan Dia sebaik-baik pelindung."',ref:'QS. Ali \'Imran: 173 ‚Äî Doa Tawakal'},
  {arabic:'ŸÑŸéÿß ÿ•ŸêŸÑŸéŸáŸé ÿ•ŸêŸÑŸéŸëÿß ÿ£ŸéŸÜŸíÿ™Ÿé ÿ≥Ÿèÿ®Ÿíÿ≠ŸéÿßŸÜŸéŸÉŸé ÿ•ŸêŸÜŸêŸëŸä ŸÉŸèŸÜŸíÿ™Ÿè ŸÖŸêŸÜŸé ÿßŸÑÿ∏ŸéŸëÿßŸÑŸêŸÖŸêŸäŸÜŸé',latin:'LƒÅ ilƒÅha illƒÅ anta subhƒÅnaka innƒ´ kuntu minazh-zhƒÅlimƒ´n',arti:'"Tiada Tuhan selain Engkau, Maha Suci Engkau. Sesungguhnya aku termasuk orang yang zalim."',ref:'QS. Al-Anbiya: 87 ‚Äî Doa Nabi Yunus AS'},
  {arabic:'ÿ±Ÿéÿ®ŸêŸë ÿßÿ¨ŸíÿπŸéŸÑŸíŸÜŸêŸä ŸÖŸèŸÇŸêŸäŸÖŸé ÿßŸÑÿµŸéŸëŸÑŸéÿßÿ©Ÿê ŸàŸéŸÖŸêŸÜ ÿ∞Ÿèÿ±ŸêŸëŸäŸéŸëÿ™ŸêŸä ÿ±Ÿéÿ®ŸéŸëŸÜŸéÿß ŸàŸéÿ™ŸéŸÇŸéÿ®ŸéŸëŸÑŸí ÿØŸèÿπŸéÿßÿ°Ÿê',latin:'Rabbij\'alnƒ´ muqƒ´mash-shalƒÅti wa min dzurriyyatƒ´ rabbanƒÅ wa taqabbal du\'ƒÅ\'',arti:'"Ya Tuhanku, jadikanlah aku orang yang mendirikan shalat dan begitu pula anak cucuku. Ya Tuhan kami, perkenankanlah doaku."',ref:'QS. Ibrahim: 40 ‚Äî Doa Nabi Ibrahim AS'},
  {arabic:'ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ£ŸéÿµŸíŸÑŸêÿ≠Ÿí ŸÑŸêŸä ÿØŸêŸäŸÜŸêŸä ŸàŸéÿØŸèŸÜŸíŸäŸéÿßŸäŸé ŸàŸéÿ¢ÿÆŸêÿ±Ÿéÿ™ŸêŸä',latin:'AllƒÅhumma ashlih lƒ´ dƒ´nƒ´ wa dunyƒÅya wa ƒÅkhiratƒ´',arti:'"Ya Allah, perbaikilah agamaku, duniaku, dan akhiratku."',ref:'HR. Muslim ‚Äî Doa Kebaikan'},
  {arabic:'ÿ±Ÿéÿ®ŸéŸëŸÜŸéÿß ŸÑŸéÿß ÿ™Ÿèÿ≤Ÿêÿ∫Ÿí ŸÇŸèŸÑŸèŸàÿ®ŸéŸÜŸéÿß ÿ®ŸéÿπŸíÿØŸé ÿ•Ÿêÿ∞Ÿí ŸáŸéÿØŸéŸäŸíÿ™ŸéŸÜŸéÿß ŸàŸéŸáŸéÿ®Ÿí ŸÑŸéŸÜŸéÿß ŸÖŸêŸÜ ŸÑŸéŸëÿØŸèŸÜŸÉŸé ÿ±Ÿéÿ≠ŸíŸÖŸéÿ©Ÿã',latin:'RabbanƒÅ lƒÅ tuzigh qul≈´banƒÅ ba\'da idz hadaytanƒÅ wa hab lanƒÅ min ladunka rahmah',arti:'"Ya Tuhan kami, janganlah Engkau jadikan hati kami condong kepada kesesatan sesudah Engkau beri petunjuk kepada kami, dan karuniakanlah kepada kami rahmat dari sisi-Mu."',ref:'QS. Ali \'Imran: 8 ‚Äî Doa Keteguhan Hati'},
  {arabic:'ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ•ŸêŸÜŸêŸëŸä ÿ£Ÿéÿ≥Ÿíÿ£ŸéŸÑŸèŸÉŸé ÿßŸÑŸíÿ¨ŸéŸÜŸéŸëÿ©Ÿé ŸàŸéÿ£ŸéÿπŸèŸàÿ∞Ÿè ÿ®ŸêŸÉŸé ŸÖŸêŸÜŸé ÿßŸÑŸÜŸéŸëÿßÿ±Ÿê',latin:'AllƒÅhumma innƒ´ as\'alukal-jannata wa a\'≈´dzu bika minan-nƒÅr',arti:'"Ya Allah, aku memohon surga kepada-Mu dan berlindung kepada-Mu dari neraka."',ref:'HR. Abu Dawud ‚Äî Doa Surga & Neraka'},
  {arabic:'ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ•ŸêŸÜŸéŸëŸÉŸé ÿπŸéŸÅŸèŸàŸåŸë ÿ™Ÿèÿ≠Ÿêÿ®ŸèŸë ÿßŸÑŸíÿπŸéŸÅŸíŸàŸé ŸÅŸéÿßÿπŸíŸÅŸè ÿπŸéŸÜŸêŸëŸä',latin:'AllƒÅhumma innaka \'afuwwun tuhibbul-\'afwa fa\'fu \'annƒ´',arti:'"Ya Allah, sesungguhnya Engkau Maha Pemaaf dan menyukai maaf, maka maafkanlah aku."',ref:'HR. Tirmidzi ‚Äî Doa Malam Lailatul Qadar (Hari ke-21)'},
  {arabic:'ÿ±Ÿéÿ®ŸêŸë ÿ≤ŸêÿØŸíŸÜŸêŸä ÿπŸêŸÑŸíŸÖŸãÿß',latin:'Rabbi zidnƒ´ \'ilmƒÅ',arti:'"Ya Tuhanku, tambahkanlah ilmu kepadaku."',ref:'QS. Tha-ha: 114 ‚Äî Doa Tambah Ilmu'},
  {arabic:'ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿßÿ¨ŸíÿπŸéŸÑŸí ÿÆŸéŸäŸíÿ±Ÿé ÿπŸèŸÖŸèÿ±ŸêŸä ÿ¢ÿÆŸêÿ±ŸéŸáŸè ŸàŸéÿÆŸéŸäŸíÿ±Ÿé ÿπŸéŸÖŸéŸÑŸêŸä ÿÆŸéŸàŸéÿßÿ™ŸêŸäŸÖŸéŸáŸè',latin:'AllƒÅhummaj\'al khayra \'umurƒ´ ƒÅkhirah≈´ wa khayra \'amalƒ´ khawƒÅtƒ´mah',arti:'"Ya Allah, jadikanlah sebaik-baik umurku di akhirnya, dan sebaik-baik amalku di penghujungnya."',ref:'HR. Thabrani ‚Äî Doa Akhir Hidup'},
  {arabic:'ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ•ŸêŸÜŸêŸëŸä ÿ£Ÿéÿ≥Ÿíÿ£ŸéŸÑŸèŸÉŸé ÿ≠Ÿèÿ®ŸéŸëŸÉŸé ŸàŸéÿ≠Ÿèÿ®ŸéŸë ŸÖŸéŸÜŸí ŸäŸèÿ≠Ÿêÿ®ŸèŸëŸÉŸé',latin:'AllƒÅhumma innƒ´ as\'aluka hubbaka wa hubba man yuhibbuk',arti:'"Ya Allah, aku memohon kepada-Mu cinta-Mu dan cinta orang yang mencintai-Mu."',ref:'HR. Tirmidzi ‚Äî Doa Cinta kepada Allah'},
  {arabic:'ÿ±Ÿéÿ®ŸêŸë ÿßÿ∫ŸíŸÅŸêÿ±Ÿí ŸÑŸêŸä ŸàŸéŸÑŸêŸàŸéÿßŸÑŸêÿØŸéŸäŸéŸë ŸàŸéŸÑŸêŸÑŸíŸÖŸèÿ§ŸíŸÖŸêŸÜŸêŸäŸÜŸé ŸäŸéŸàŸíŸÖŸé ŸäŸéŸÇŸèŸàŸÖŸè ÿßŸÑŸíÿ≠Ÿêÿ≥Ÿéÿßÿ®Ÿè',latin:'Rabbighfir lƒ´ wa liwƒÅlidayya wa lilmu\'minƒ´na yawma yaq≈´mul-hisƒÅb',arti:'"Ya Tuhanku, ampunilah aku, kedua orang tuaku, dan orang-orang mukmin pada hari terjadinya hisab."',ref:'QS. Ibrahim: 41 ‚Äî Doa untuk Orang Tua'},
  {arabic:'ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ•ŸêŸÜŸéŸëŸÉŸé ÿπŸéŸÅŸèŸàŸåŸë ÿ™Ÿèÿ≠Ÿêÿ®ŸèŸë ÿßŸÑŸíÿπŸéŸÅŸíŸàŸé ŸÅŸéÿßÿπŸíŸÅŸè ÿπŸéŸÜŸêŸëŸä',latin:'AllƒÅhumma innaka \'afuwwun tuhibbul-\'afwa fa\'fu \'annƒ´',arti:'"Ya Allah, sesungguhnya Engkau Maha Pemaaf dan menyukai maaf, maka maafkanlah aku."',ref:'HR. Tirmidzi ‚Äî Doa Malam Lailatul Qadar (Hari ke-23)'},
  {arabic:'ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿßŸÉŸíŸÅŸêŸÜŸêŸä ÿ®Ÿêÿ≠ŸéŸÑŸéÿßŸÑŸêŸÉŸé ÿπŸéŸÜŸí ÿ≠Ÿéÿ±ŸéÿßŸÖŸêŸÉŸé ŸàŸéÿ£Ÿéÿ∫ŸíŸÜŸêŸÜŸêŸä ÿ®ŸêŸÅŸéÿ∂ŸíŸÑŸêŸÉŸé ÿπŸéŸÖŸéŸëŸÜŸí ÿ≥ŸêŸàŸéÿßŸÉŸé',latin:'AllƒÅhummak-finƒ´ bihalƒÅlika \'an harƒÅmika wa aghnƒ´nƒ´ bifadhlika \'amman siwƒÅk',arti:'"Ya Allah, cukupkanlah aku dengan yang halal dari-Mu sehingga tidak perlu yang haram, dan kayakanlah aku dengan karunia-Mu sehingga tidak perlu selain-Mu."',ref:'HR. Tirmidzi ‚Äî Doa Kecukupan Rezeki'},
  {arabic:'ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ£Ÿéÿ≠ŸíŸäŸêŸÜŸéÿß ÿπŸéŸÑŸéŸâ ÿßŸÑŸíÿ•Ÿêÿ≥ŸíŸÑŸéÿßŸÖŸê ŸàŸéÿ£ŸéŸÖŸêÿ™ŸíŸÜŸéÿß ÿπŸéŸÑŸéŸâ ÿßŸÑŸíÿ•ŸêŸäŸÖŸéÿßŸÜŸê',latin:'AllƒÅhumma ahyinƒÅ \'alal-islƒÅmi wa amitnƒÅ \'alal-ƒ´mƒÅn',arti:'"Ya Allah, hidupkanlah kami di atas Islam dan matikanlah kami di atas iman."',ref:'Doa Husnul Khatimah'},
  {arabic:'ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ•ŸêŸÜŸéŸëŸÉŸé ÿπŸéŸÅŸèŸàŸåŸë ÿ™Ÿèÿ≠Ÿêÿ®ŸèŸë ÿßŸÑŸíÿπŸéŸÅŸíŸàŸé ŸÅŸéÿßÿπŸíŸÅŸè ÿπŸéŸÜŸêŸëŸä',latin:'AllƒÅhumma innaka \'afuwwun tuhibbul-\'afwa fa\'fu \'annƒ´',arti:'"Ya Allah, sesungguhnya Engkau Maha Pemaaf dan menyukai maaf, maka maafkanlah aku."',ref:'HR. Tirmidzi ‚Äî Doa Malam Lailatul Qadar (Hari ke-25)'},
  {arabic:'ÿ±Ÿéÿ®ŸéŸëŸÜŸéÿß ŸáŸéÿ®Ÿí ŸÑŸéŸÜŸéÿß ŸÖŸêŸÜŸí ÿ£Ÿéÿ≤ŸíŸàŸéÿßÿ¨ŸêŸÜŸéÿß ŸàŸéÿ∞Ÿèÿ±ŸêŸëŸäŸéŸëÿßÿ™ŸêŸÜŸéÿß ŸÇŸèÿ±ŸéŸëÿ©Ÿé ÿ£ŸéÿπŸíŸäŸèŸÜŸç ŸàŸéÿßÿ¨ŸíÿπŸéŸÑŸíŸÜŸéÿß ŸÑŸêŸÑŸíŸÖŸèÿ™ŸéŸëŸÇŸêŸäŸÜŸé ÿ•ŸêŸÖŸéÿßŸÖŸãÿß',latin:'RabbanƒÅ hab lanƒÅ min azwƒÅjinƒÅ wa dzurriyyƒÅtinƒÅ qurrata a\'yunin waj\'alnƒÅ lil-muttaqƒ´na imƒÅmƒÅ',arti:'"Ya Tuhan kami, anugerahkanlah kepada kami pasangan dan keturunan yang menjadi penyejuk hati, dan jadikanlah kami pemimpin bagi orang-orang yang bertakwa."',ref:'QS. Al-Furqan: 74 ‚Äî Doa Keluarga Sakinah'},
  {arabic:'ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ•ŸêŸÜŸéŸëŸÉŸé ÿπŸéŸÅŸèŸàŸåŸë ÿ™Ÿèÿ≠Ÿêÿ®ŸèŸë ÿßŸÑŸíÿπŸéŸÅŸíŸàŸé ŸÅŸéÿßÿπŸíŸÅŸè ÿπŸéŸÜŸêŸëŸä',latin:'AllƒÅhumma innaka \'afuwwun tuhibbul-\'afwa fa\'fu \'annƒ´',arti:'"Ya Allah, sesungguhnya Engkau Maha Pemaaf dan menyukai maaf, maka maafkanlah aku."',ref:'HR. Tirmidzi ‚Äî Doa Malam Lailatul Qadar (Hari ke-27)'},
  {arabic:'ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ£ŸéÿπŸêŸÜŸêŸëŸä ÿπŸéŸÑŸéŸâ ÿ∞ŸêŸÉŸíÿ±ŸêŸÉŸé ŸàŸéÿ¥ŸèŸÉŸíÿ±ŸêŸÉŸé ŸàŸéÿ≠Ÿèÿ≥ŸíŸÜŸê ÿπŸêÿ®ŸéÿßÿØŸéÿ™ŸêŸÉŸé',latin:'AllƒÅhumma a\'innƒ´ \'alƒÅ dzikrika wa syukrika wa husni \'ibƒÅdatik',arti:'"Ya Allah, tolonglah aku untuk selalu mengingat-Mu, bersyukur kepada-Mu, dan beribadah dengan baik kepada-Mu."',ref:'HR. Abu Dawud ‚Äî Doa Istiqomah Ibadah'},
  {arabic:'ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ•ŸêŸÜŸéŸëŸÉŸé ÿπŸéŸÅŸèŸàŸåŸë ÿ™Ÿèÿ≠Ÿêÿ®ŸèŸë ÿßŸÑŸíÿπŸéŸÅŸíŸàŸé ŸÅŸéÿßÿπŸíŸÅŸè ÿπŸéŸÜŸêŸëŸä',latin:'AllƒÅhumma innaka \'afuwwun tuhibbul-\'afwa fa\'fu \'annƒ´',arti:'"Ya Allah, sesungguhnya Engkau Maha Pemaaf dan menyukai maaf, maka maafkanlah aku."',ref:'HR. Tirmidzi ‚Äî Doa Malam Lailatul Qadar (Hari ke-29)'},
  {arabic:'ÿ±Ÿéÿ®ŸéŸëŸÜŸéÿß ÿ™ŸéŸÇŸéÿ®ŸéŸëŸÑŸí ŸÖŸêŸÜŸéŸëÿß ÿ•ŸêŸÜŸéŸëŸÉŸé ÿ£ŸéŸÜÿ™Ÿé ÿßŸÑÿ≥ŸéŸëŸÖŸêŸäÿπŸè ÿßŸÑŸíÿπŸéŸÑŸêŸäŸÖŸè ŸàŸéÿ™Ÿèÿ®Ÿí ÿπŸéŸÑŸéŸäŸíŸÜŸéÿß ÿ•ŸêŸÜŸéŸëŸÉŸé ÿ£ŸéŸÜÿ™Ÿé ÿßŸÑÿ™ŸéŸëŸàŸéŸëÿßÿ®Ÿè ÿßŸÑÿ±ŸéŸëÿ≠ŸêŸäŸÖŸè',latin:'RabbanƒÅ taqabbal minnƒÅ innaka antas-samƒ´\'ul-\'alƒ´m wa tub \'alaynƒÅ innaka antat-tawwƒÅbur-rahƒ´m',arti:'"Ya Tuhan kami, terimalah dari kami. Sesungguhnya Engkau Maha Mendengar lagi Maha Mengetahui, dan terimalah taubat kami. Sesungguhnya Engkau Maha Penerima taubat lagi Maha Penyayang."',ref:'QS. Al-Baqarah: 127,128 ‚Äî Doa Penutup Ramadan'},
];

function renderDoaPenutup() {
  var el = document.getElementById('doaArabic');
  if (!el) return;
  var idx = (currentDay - 1) % DOA_PENUTUP.length;
  var d = DOA_PENUTUP[idx];
  document.getElementById('doaArabic').textContent = d.arabic;
  document.getElementById('doaLatin').textContent = d.latin;
  document.getElementById('doaArti').textContent = d.arti;
  document.getElementById('doaRef').textContent = d.ref;
}











// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// HAPTIC FEEDBACK
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function hapticFeedback(isCheck) {
  if (!navigator.vibrate) return;
  if (isCheck) navigator.vibrate([30, 10, 60]); // dua ketukan: centang
  else navigator.vibrate(15);                    // satu ketukan ringan: uncheck
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CLICK SOUND (Web Audio API ‚Äî offline)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let _audioCtx = null;
function getAudioCtx() {
  if (!_audioCtx) _audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  if (_audioCtx.state === 'suspended') _audioCtx.resume();
  return _audioCtx;
}
function playClickSound(isCheck) {
  try {
    const ctx = getAudioCtx();
    const osc = ctx.createOscillator();
    const gain = ctx.createGain();
    osc.connect(gain); gain.connect(ctx.destination);
    if (isCheck) {
      // Nada naik: centang ibadah ‚Äî menyenangkan
      osc.frequency.setValueAtTime(440, ctx.currentTime);
      osc.frequency.exponentialRampToValueAtTime(880, ctx.currentTime + 0.12);
      gain.gain.setValueAtTime(0.15, ctx.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.18);
      osc.start(); osc.stop(ctx.currentTime + 0.18);
    } else {
      // Nada turun: uncheck
      osc.frequency.setValueAtTime(440, ctx.currentTime);
      osc.frequency.exponentialRampToValueAtTime(220, ctx.currentTime + 0.1);
      gain.gain.setValueAtTime(0.08, ctx.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.12);
      osc.start(); osc.stop(ctx.currentTime + 0.12);
    }
  } catch(e) {}
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STATUS PUASA
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ‚ïê‚ïê Rekap Mingguan ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ‚ïê‚ïê Qadha Tracker ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderQadha() {
  const el = document.getElementById('qadhaContent');
  if(!el) return;
  const batalDays = Array.from({length:30},(_,i)=>i+1).filter(d=>data[d]?.statusPuasa==='batal');
  const haidDays  = Array.from({length:30},(_,i)=>i+1).filter(d=>data[d]?.haid);
  // hari haid otomatis masuk qadha
  const allQadha = [...new Set([...batalDays, ...haidDays])].sort((a,b)=>a-b);
  const ALASAN_LABEL = {sakit:'ü§í Sakit', haid:'üå∏ Haid', safar:'‚úàÔ∏è Safar', lainnya:'üìù Lainnya'};
  const HARI_ID = ['Min','Sen','Sel','Rab','Kam','Jum','Sab'];
  if(allQadha.length === 0) {
    el.innerHTML = `<div style="text-align:center;padding:20px;color:var(--text-muted);font-size:13px;opacity:.7">‚úÖ Belum ada hari yang perlu diqadha</div>`;
    return;
  }
  const startDate = new Date(2026,1,19);
  el.innerHTML = `
    <div style="background:rgba(200,151,58,.1);border:1.5px solid rgba(200,151,58,.3);border-radius:12px;padding:12px;margin-bottom:12px;display:flex;align-items:center;gap:10px">
      <div style="font-size:28px;font-weight:900;color:var(--gold);font-family:'Amiri',serif">${allQadha.length}</div>
      <div><div style="font-size:13px;font-weight:900;color:var(--text)">Hari Perlu Diqadha</div><div style="font-size:11px;color:var(--text-muted)">Selesaikan sebelum Ramadan tahun depan</div></div>
    </div>
    <div style="display:flex;flex-direction:column;gap:6px">
      ${allQadha.map(d => {
        const dd = data[d]||{};
        const dt = new Date(startDate); dt.setDate(dt.getDate()+d-1);
        const tgl = `${HARI_ID[dt.getDay()]} ${dt.getDate()}/${dt.getMonth()+1}`;
        const alasan = dd.haid ? 'üå∏ Haid' : (ALASAN_LABEL[dd.batalAlasan] || '‚ùå Batal');
        const isHaid = dd.haid;
        return `<div style="display:flex;align-items:center;justify-content:space-between;padding:8px 12px;border-radius:10px;background:${isHaid?'rgba(255,182,193,.12)':'rgba(200,80,50,.06)'};border:1px solid ${isHaid?'rgba(255,105,180,.25)':'rgba(200,80,50,.18)'}">
          <div style="display:flex;align-items:center;gap:8px">
            <div style="font-size:15px;font-weight:900;color:var(--gold);font-family:'Amiri',serif;min-width:24px">H${d}</div>
            <div><div style="font-size:12px;font-weight:800;color:var(--text)">${tgl}</div><div style="font-size:10px;color:var(--text-muted)">${alasan}</div></div>
          </div>
          <div style="font-size:10px;padding:3px 8px;border-radius:20px;background:rgba(200,151,58,.15);color:var(--gold);font-weight:800">Qadha</div>
        </div>`;
      }).join('')}
    </div>`;
}

function checkRekapMingguan() {
  // Tampilkan rekap di akhir setiap minggu (hari 7, 14, 21, 28)
  const mingguKe = Math.floor((currentDay - 1) / 7) + 1;
  const isAkhirMinggu = currentDay % 7 === 0;
  if(!isAkhirMinggu) return;
  const start = currentDay - 6;
  const end = currentDay;
  let totalIb = 0, perfectDays = 0, totalJuz = 0;
  for(let d=start; d<=end; d++) {
    const dd = data[d]||{};
    totalIb += Object.values(dd.ibadah||{}).filter(v=>v).length;
    if(isStreakDay(dd)) perfectDays++;
    totalJuz += dd.quranJuz||0;
  }
  const streak = calcStreak();
  setTimeout(() => {
    showToast(`üìä Rekap Minggu ${mingguKe}: ${totalIb} ibadah ¬∑ ${perfectDays} hari sempurna ¬∑ ${totalJuz} juz ¬∑ Streak ${streak}üî•`, 'success');
  }, 2000);
}

function saveNiatCatatan() {
  const el = document.getElementById('niatCatatanInput');
  if(!el) return;
  data[currentDay].niatCatatan = el.value;
  saveData();
}
function renderNiatCatatan() {
  const el = document.getElementById('niatCatatanInput');
  if(el) el.value = data[currentDay]?.niatCatatan || '';
}
function setStatusPuasa(status) {
  data[currentDay].statusPuasa = status;
  if(status !== 'batal') data[currentDay].batalAlasan = '';
  saveData(); renderStatusPuasa();
  const msgs = {
    belum:'üò¥ Niatkan puasa malam ini ya!',
    puasa:'üåô Semangat! Puasamu tercatat. Allahu Akbar!',
    buka:'üåÖ Alhamdulillah, sudah berbuka! Jangan lupa minum air putih üíß',
    batal:'‚ùå Dicatat. Jangan lupa pilih alasan & tandai hari qadha nanti.'
  };
  showToast(msgs[status], status==='batal'?'info':'success');
  hapticFeedback(true);
}
function setBatalAlasan(alasan) {
  data[currentDay].batalAlasan = alasan;
  saveData(); renderStatusPuasa();
  const notes = {
    sakit:'ü§í Sakit ‚Äî wajib diqadha setelah Ramadan',
    haid:'üå∏ Haid/Uzur ‚Äî wajib diqadha setelah Ramadan',
    safar:'‚úàÔ∏è Safar ‚Äî boleh berbuka, wajib diqadha',
    lainnya:'üìù Catat alasan lengkap di catatan harian'
  };
  showToast(notes[alasan]||'', 'info');
}
function renderStatusPuasa() {
  const s = (data[currentDay] || {}).statusPuasa || '';
  const a = (data[currentDay] || {}).batalAlasan || '';
  ['belum','puasa','buka','batal'].forEach(function(k) {
    const btn = document.getElementById('sp-' + k);
    if (!btn) return;
    btn.className = 'sp-btn' + (s === k ? ' active-' + k : '');
  });
  const wrap = document.getElementById('batalAlasanWrap');
  if(wrap) wrap.style.display = s==='batal' ? 'block' : 'none';
  document.querySelectorAll('.batal-alasan-btn').forEach(b=>b.classList.remove('active'));
  if(a) { const ab = document.getElementById('ba-'+a); if(ab) ab.classList.add('active'); }
  const noteEl = document.getElementById('batalQadhaNote');
  if(noteEl) {
    const qadhaCount = Array.from({length:30},(_,i)=>i+1).filter(d=>data[d]?.statusPuasa==='batal').length;
    noteEl.textContent = qadhaCount > 0 ? `üìã Total hari batal: ${qadhaCount} hari ‚Äî harus diqadha setelah Ramadan` : '';
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// AIR MINUM
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
var AIR_TARGET = 8;
function renderAirMinum() {
  var grid = document.getElementById('airGlasses');
  var countEl = document.getElementById('airCount');
  if (!grid) return;
  var n = (data[currentDay] || {}).airMinum || 0;
  grid.innerHTML = '';
  for (var i = 0; i < AIR_TARGET; i++) {
    var g = document.createElement('div');
    g.className = 'air-glass' + (i < n ? ' filled' : '');
    g.textContent = i < n ? 'ü•§' : '‚¨ú';
    g.dataset.idx = i;
    g.onclick = (function(idx) { return function() { toggleAirGlass(idx); }; })(i);
    grid.appendChild(g);
  }
  if (countEl) countEl.textContent = n;
}
function toggleAirGlass(idx) {
  var cur = (data[currentDay] || {}).airMinum || 0;
  // Klik gelas yang sudah terisi = hapus sampai idx itu; gelas kosong = isi sampai idx
  if (idx < cur) data[currentDay].airMinum = idx;
  else data[currentDay].airMinum = idx + 1;
  saveData(); renderAirMinum();
  hapticFeedback(true);
  playClickSound(true);
  if (data[currentDay].airMinum >= AIR_TARGET) showToast('üíß Masya Allah! Target minum air terpenuhi! Sehat selalu üéâ', 'success');
  // Reminder minum air saat baru berbuka
  const _sp = (data[currentDay]||{}).statusPuasa;
  const _air = data[currentDay].airMinum;
  if(_sp === 'buka' && _air < 4) {
    setTimeout(()=>showToast('üíß Jangan lupa minum air putih dulu ya! Target 4 gelas setelah berbuka ü•§', 'info'), 1200);
  }
}
function resetAir() {
  data[currentDay].airMinum = 0;
  saveData(); renderAirMinum();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RESET DATA HARI INI
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function confirmResetHari() {
  const msg = document.getElementById('confirmResetMsg');
  if (msg) msg.innerHTML = 'Semua data <strong style="color:#FF8080">hari ke-' + currentDay + '</strong> akan dihapus.<br>Data hari lain tidak terpengaruh.';
  const modal = document.getElementById('confirmResetModal');
  if (modal) { modal.style.display = 'flex'; modal.style.animation = 'fadeIn .2s ease'; }
}
function closeConfirmReset() {
  const modal = document.getElementById('confirmResetModal');
  if (modal) modal.style.display = 'none';
}
function doResetHari() {
  closeConfirmReset();
  data[currentDay] = mkDay();
  saveData(); renderAll();
  showToast('üóëÔ∏è Data hari ke-' + currentDay + ' sudah direset.', 'info');
  hapticFeedback(false);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TIMER SHALAT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
var _shalatTimers = {};
function startShalatTimer(id) {
  if (_shalatTimers[id]) return; // sudah ada timer
  const SHALAT_IDS = ['subuh','dzuhur','ashar','maghrib','isya','tarawih'];
  if (!SHALAT_IDS.includes(id)) return;
  _shalatTimers[id] = { start: Date.now() };
  updateShalatTimerBadge(id);
}
function updateShalatTimerBadge(id) {
  const t = _shalatTimers[id];
  if (!t) return;
  // Cek apakah ibadah masih tercentang
  if (!(data[currentDay] && data[currentDay].ibadah && data[currentDay].ibadah[id])) {
    delete _shalatTimers[id];
    return;
  }
  const elapsed = Math.floor((Date.now() - t.start) / 1000);
  const m = Math.floor(elapsed / 60), s = elapsed % 60;
  const badge = document.querySelector('[data-ibadah-id="' + id + '"] .shalat-timer-badge');
  if (badge) {
    badge.textContent = m + ':' + String(s).padStart(2,'0');
    badge.classList.toggle('done', elapsed >= 300); // hijau setelah 5 menit
  }
  setTimeout(function() { updateShalatTimerBadge(id); }, 1000);
}
// Inject timer badge ke ibadah item setelah render
function injectShalatTimers() {
  const SHALAT_IDS = ['subuh','dzuhur','ashar','maghrib','isya','tarawih'];
  SHALAT_IDS.forEach(function(id) {
    if (_shalatTimers[id] && data[currentDay] && data[currentDay].ibadah && data[currentDay].ibadah[id]) {
      const el = document.querySelector('[data-ibadah-id="' + id + '"]');
      if (el && !el.querySelector('.shalat-timer-badge')) {
        var badge = document.createElement('span');
        badge.className = 'shalat-timer-badge';
        badge.textContent = '0:00';
        el.appendChild(badge);
        updateShalatTimerBadge(id);
      }
    }
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MOOD KALENDER 30 HARI
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
var MOOD_EMOJI = {semangat:'üí™', tenang:'üòå', syukur:'ü•∞', lelah:'üò¥', lapar:'üò§'};
function renderMoodCalendar() {
  var grid = document.getElementById('moodCalGrid');
  var lbl  = document.getElementById('moodCalLabel');
  if (!grid) return;
  grid.innerHTML = '';
  var filled = 0;
  for (var d = 1; d <= 30; d++) {
    var mood = (data[d] || {}).mood || '';
    var dot = document.createElement('div');
    dot.className = 'mood-cal-dot ' + (mood || 'empty');
    dot.title = 'Hari ' + d + (mood ? ': ' + mood : ': belum diisi');
    dot.textContent = mood ? (MOOD_EMOJI[mood] || '') : d;
    dot.style.fontSize = mood ? '14px' : '9px';
    dot.style.color = mood ? '' : 'var(--text-muted)';
    dot.onclick = (function(day) { return function() { switchDay(day); }; })(d);
    grid.appendChild(dot);
    if (mood) filled++;
  }
  if (lbl) lbl.textContent = filled + ' dari 30 hari sudah diisi mood';
  renderMoodTrend();
}

function renderMoodTrend() {
  const cv = document.getElementById('moodTrendCanvas');
  if(!cv) return;
  const W = cv.parentElement.clientWidth || 300;
  const H = 60;
  cv.width = W; cv.height = H;
  const ctx = cv.getContext('2d');
  ctx.clearRect(0,0,W,H);

  // mood ‚Üí angka energi (untuk grafik)
  const MOOD_VAL = {semangat:5, syukur:4, tenang:3, lapar:2, lelah:1};
  const MOOD_COLOR = {semangat:'#FFD060', syukur:'#F080A0', tenang:'#60C0F0', lapar:'#80D080', lelah:'#A080D0'};
  const MOOD_LABEL = {semangat:'üí™ Semangat', syukur:'ü•∞ Syukur', tenang:'üòå Tenang', lapar:'üò§ Lapar', lelah:'üò¥ Lelah'};

  const days = Array.from({length:30},(_,i)=>i+1);
  const moods = days.map(d=>(data[d]||{}).mood||'');
  const vals = moods.map(m=>MOOD_VAL[m]||0);

  const pad = {l:8, r:8, t:8, b:16};
  const gW = W - pad.l - pad.r;
  const gH = H - pad.t - pad.b;
  const barW = Math.max(3, (gW/30) - 2);

  // background adaptif
  const _moodDark = document.body.classList.contains('dark-mode');
  ctx.fillStyle = _moodDark ? 'rgba(0,0,0,0.25)' : 'rgba(200,180,140,0.18)';
  if(ctx.roundRect) ctx.roundRect(0,0,W,H,8); else ctx.rect(0,0,W,H);
  ctx.fill();

  vals.forEach((v, i) => {
    if(!v) return;
    const mood = moods[i];
    const h = (v/5) * gH;
    const x = pad.l + (gW/30)*i + 1;
    const y = pad.t + gH - h;
    const col = MOOD_COLOR[mood] || '#888';
    const grad = ctx.createLinearGradient(0, y, 0, y+h);
    grad.addColorStop(0, col);
    grad.addColorStop(1, col + '55');
    ctx.fillStyle = grad;
    ctx.beginPath();
    if(ctx.roundRect) ctx.roundRect(x, y, barW, h, 2); else ctx.rect(x, y, barW, h);
    ctx.fill();

    // emoji di atas bar kalau cukup lebar
    if(barW >= 8) {
      ctx.font = '8px serif';
      ctx.textAlign = 'center';
      ctx.fillText(MOOD_EMOJI[mood]||'', x+barW/2, y-1);
    }
  });

  // hari ini marker
  const todayX = pad.l + (gW/30)*(currentDay-1) + barW/2;
  ctx.strokeStyle = 'rgba(255,215,0,0.6)';
  ctx.lineWidth = 1.5;
  ctx.setLineDash([3,3]);
  ctx.beginPath(); ctx.moveTo(todayX, pad.t); ctx.lineTo(todayX, pad.t+gH); ctx.stroke();
  ctx.setLineDash([]);

  // day labels
  ctx.fillStyle = _moodDark ? 'rgba(255,255,255,0.45)' : 'rgba(60,40,10,0.5)';
  ctx.font = '8px Nunito, sans-serif';
  ctx.textAlign = 'center';
  [5,10,15,20,25,30].forEach(d=>{
    const x = pad.l + (gW/30)*(d-1) + barW/2;
    ctx.fillText(d, x, H-2);
  });

  // Legend
  const legEl = document.getElementById('moodTrendLegend');
  if(legEl) {
    const counts = {};
    moods.forEach(m=>{ if(m) counts[m]=(counts[m]||0)+1; });
    legEl.innerHTML = Object.entries(counts).sort((a,b)=>b[1]-a[1]).map(([m,c])=>
      `<div style="display:flex;align-items:center;gap:4px;font-size:10px;font-weight:800;color:var(--text-muted)">
        <div style="width:10px;height:10px;border-radius:3px;background:${MOOD_COLOR[m]}"></div>
        ${MOOD_LABEL[m]||m}: ${c}x
      </div>`
    ).join('');
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STREAK API TIKTOK ‚Äî warna & level berubah
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
var STREAK_LEVELS = [
  { min:0,  max:0,  cls:'sf-lv0', emoji:'üí§', label:'Belum ada streak', tag:'Ayo mulai hari ini!' },
  { min:1,  max:2,  cls:'sf-lv1', emoji:'üî•', label:'HARI STREAK',      tag:'Bagus! Pertahankan!' },
  { min:3,  max:6,  cls:'sf-lv2', emoji:'üî•', label:'HARI STREAK',      tag:'Semangat! Istiqomah!' },
  { min:7,  max:13, cls:'sf-lv3', emoji:'üî•', label:'HARI STREAK',      tag:'Masya Allah! üåü' },
  { min:14, max:20, cls:'sf-lv4', emoji:'üî•', label:'HARI STREAK',      tag:'Luar Biasa! Hampir Khatam! üíé' },
  { min:21, max:30, cls:'sf-lv5', emoji:'üî•', label:'HARI STREAK',      tag:'LEGENDARIS! üèÜ SUBHANALLAH!' },
];
function getStreakLevel(n) {
  for (var i = STREAK_LEVELS.length - 1; i >= 0; i--) {
    if (n >= STREAK_LEVELS[i].min) return STREAK_LEVELS[i];
  }
  return STREAK_LEVELS[0];
}
function updateStreakFire(n) {
  var wrap = document.getElementById('streakFireDisplay');
  var emoji = document.getElementById('streakFireEmoji');
  var num   = document.getElementById('streakFireNum');
  var tag   = document.getElementById('streakFireTag');
  if (!wrap) return;
  var lv = getStreakLevel(n);
  // Hapus semua class level lama
  wrap.className = 'streak-fire-display ' + lv.cls;
  emoji.textContent = lv.emoji;
  num.textContent   = n;
  tag.textContent   = lv.tag;
  // Animasi burst saat naik level
}
function renderStreakFireDisplay() {
  updateStreakFire(calcStreak());
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SWIPE KIRI/KANAN UNTUK GANTI HARI
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
(function() {
  var touchStartX = 0, touchStartY = 0, touchStartT = 0;
  document.addEventListener('touchstart', function(e) {
    if (e.touches.length !== 1) return;
    touchStartX = e.touches[0].clientX;
    touchStartY = e.touches[0].clientY;
    touchStartT = Date.now();
  }, {passive: true});
  document.addEventListener('touchend', function(e) {
    if (e.changedTouches.length !== 1) return;
    var dx = e.changedTouches[0].clientX - touchStartX;
    var dy = e.changedTouches[0].clientY - touchStartY;
    var dt = Date.now() - touchStartT;
    // Swipe: dx > 60px, lebih horizontal dari vertikal, cepat (< 400ms)
    if (Math.abs(dx) > 60 && Math.abs(dx) > Math.abs(dy) * 1.5 && dt < 400) {
      // Cek apakah target bukan input/select/scrollable element
      var target = e.target;
      while (target && target !== document.body) {
        if (target.scrollWidth > target.clientWidth + 10) return; // scrollable
        if (['INPUT','SELECT','TEXTAREA'].includes(target.tagName)) return;
        target = target.parentElement;
      }
      if (dx < 0 && currentDay < 30) {
        switchDay(currentDay + 1); // swipe kiri = hari berikutnya
        showToast('üìÖ Hari ke-' + (currentDay), 'info');
      } else if (dx > 0 && currentDay > 1) {
        switchDay(currentDay - 1); // swipe kanan = hari sebelumnya
        showToast('üìÖ Hari ke-' + (currentDay), 'info');
      }
    }
  }, {passive: true});
})();


function renderAll() {
  ensureDay(data[currentDay]);
  renderQuote(); renderHeaderDate();
  renderIbadah(); renderQuran(); renderMood(); renderTargets();
  renderAmal(); renderSedekah(); renderMenu(); renderNotes();
  renderStreak(); renderOverallProgress(); updateSummary();
  // Jadwal: hanya update tampilan waktu berdasarkan hari yang dipilih
  // fetchSchedule() TIDAK dipanggil di sini agar waktu tidak berkedip
  updateTimes(); updateCountdown();
  renderSyukur(); renderStat(); renderBadges(); renderNiatCatatan(); renderStatusPuasa(); renderQadha();
  renderNiat(); renderDzikir(); renderRekap(); renderRekapAkhir();
  renderDoa();
  renderAyat();
  renderDoaPenutup();
  updateHeaderProgress();
  renderStatusPuasa();
  renderAirMinum();
  renderMoodCalendar();
  renderStreakFireDisplay();
  // autoCheckDarkMode dinonaktifkan ‚Äî mode gelap/terang diatur manual oleh user
}

let _scheduleInited = false;
function initScheduleOnce() {
  if (_scheduleInited) return;
  _scheduleInited = true;
  populateCitySelect('WIB');
  const zonaInfoEl = document.getElementById('zonaInfo');
  if (zonaInfoEl) zonaInfoEl.textContent = ZONA_DESC['WIB'];
  fetchSchedule();
}

function renderStat() {
  // Defer to next frame so canvas has proper width
  requestAnimationFrame(() => {
    renderStat_draw();
    if(window._bindStatEvents) window._bindStatEvents();
  });
}
function renderStat_draw() {
  if(typeof currentStat !== 'undefined') renderStat_impl();
}
// Store bar positions for tooltip hit-testing
let _statBars = [];

function renderStat_impl() {
  const canvas = document.getElementById('statCanvas');
  if(!canvas) return;
  const ctx = canvas.getContext('2d');
  const W = canvas.parentElement.clientWidth || 600;
  const H = 240;
  canvas.width = W;
  canvas.height = H;
  ctx.clearRect(0, 0, W, H);

  // Background canvas adaptif dark/light mode
  const _isDark = document.body.classList.contains('dark-mode');
  const bgGrad = ctx.createLinearGradient(0, 0, 0, H);
  if(_isDark) {
    bgGrad.addColorStop(0, '#0D1E30');
    bgGrad.addColorStop(1, '#071525');
  } else {
    bgGrad.addColorStop(0, '#F2EDE0');
    bgGrad.addColorStop(1, '#E8E0CE');
  }
  ctx.fillStyle = bgGrad;
  ctx.beginPath();
  if(ctx.roundRect) ctx.roundRect(0, 0, W, H, 12); else ctx.rect(0, 0, W, H);
  ctx.fill();

  const days = Array.from({length: 30}, (_,i) => i+1);
  let values = [];
  let maxVal = 1;
  let label = '';

  if(currentStat === 'ibadah') {
    values = days.map(d => Object.values((data[d]?.ibadah)||{}).filter(v=>v).length);
    maxVal = IBADAH_LIST.length;
    label = 'Ibadah / hari';
  } else if(currentStat === 'quran') {
    values = days.map(d => data[d]?.quranJuz || 0);
    maxVal = Math.max(3, ...values);
    label = 'Juz / hari';
  } else {
    values = days.map(d => (data[d]?.sedekah||[]).reduce((s,i)=>s+i.amt,0));
    maxVal = Math.max(50000, ...values);
    label = 'Sedekah / hari';
  }

  const pad = {l:32, r:12, t:20, b:36};
  const gW = W - pad.l - pad.r;
  const gH = H - pad.t - pad.b;
  const barW = Math.max(5, (gW / 30) - 3);

  // Grid lines adaptif dark/light
  const gridLines = 5;
  const _gridColor = _isDark ? 'rgba(255,255,255,0.09)' : 'rgba(0,0,0,0.09)';
  const _gridColorBot = _isDark ? 'rgba(200,151,58,0.3)' : 'rgba(200,151,58,0.5)';
  const _labelColor = _isDark ? 'rgba(255,255,255,0.5)' : 'rgba(60,40,10,0.6)';
  for(let i=0;i<=gridLines;i++) {
    const y = pad.t + (gH/gridLines)*i;
    ctx.strokeStyle = i===gridLines ? _gridColorBot : _gridColor;
    ctx.lineWidth = i===gridLines ? 1.5 : 1;
    ctx.beginPath(); ctx.moveTo(pad.l, y); ctx.lineTo(W-pad.r, y); ctx.stroke();
    // Y axis labels
    const val = Math.round(maxVal * (1 - i/gridLines));
    if(val > 0) {
      ctx.fillStyle = _labelColor;
      ctx.font = '9px Nunito, sans-serif';
      ctx.textAlign = 'right';
      const fmt = n => n>=1000000?(n/1000000).toFixed(1)+'jt':n>=1000?(n/1000).toFixed(0)+'rb':String(n);
      ctx.fillText(fmt(val), pad.l - 4, y + 3);
    }
  }

  // Color helper per bar
  function getBarColor(dayNum, v) {
    const dd = data[dayNum] || {};
    if(dd.haid) return { top:'#FF69B4', bot:'rgba(255,182,193,0.3)', isHaid:true };
    const isToday = dayNum === currentDay;
    if(isToday) return { top:'#FFD700', bot:'rgba(255,200,0,0.3)', isHaid:false };
    if(currentStat === 'ibadah') {
      const perfect = isStreakDay(dd);
      const partial = v > 0 && !perfect;
      const none = v === 0;
      if(perfect) return { top:'#4ADE80', bot:'rgba(74,222,128,0.25)', isHaid:false };
      if(partial) return { top:'#E8BE6A', bot:'rgba(232,190,106,0.25)', isHaid:false };
      return { top: _isDark?'rgba(255,255,255,0.12)':'rgba(180,160,120,0.25)', bot: _isDark?'rgba(255,255,255,0.04)':'rgba(180,160,120,0.08)', isHaid:false };
    }
    if(currentStat === 'quran') {
      if(v >= 1) return { top:'#C8973A', bot:'rgba(200,151,58,0.25)', isHaid:false };
      return { top: _isDark?'rgba(255,255,255,0.12)':'rgba(180,160,120,0.25)', bot: _isDark?'rgba(255,255,255,0.04)':'rgba(180,160,120,0.08)', isHaid:false };
    }
    // sedekah
    if(v > 0) return { top:'#E06090', bot:'rgba(224,96,144,0.25)', isHaid:false };
    return { top:'rgba(255,255,255,0.15)', bot:'rgba(255,255,255,0.04)', isHaid:false };
  }

  _statBars = [];
  values.forEach((v, i) => {
    const dayNum = i+1;
    const { top, bot, isHaid } = getBarColor(dayNum, v);
    const isToday = dayNum === currentDay;
    const rawH = isHaid ? Math.max(8, gH * 0.10) : (v > 0 ? Math.max(4, (v / maxVal) * gH) : 3);
    const x = pad.l + (gW / 30) * i + 1;
    const y = pad.t + gH - rawH;

    const grad = ctx.createLinearGradient(0, y, 0, y + rawH);
    grad.addColorStop(0, top);
    grad.addColorStop(1, bot);
    ctx.fillStyle = grad;

    // Glow for perfect/today
    if(isToday || (currentStat==='ibadah' && isStreakDay(data[dayNum]||{}))) {
      ctx.shadowColor = top;
      ctx.shadowBlur = isToday ? 10 : 6;
    } else {
      ctx.shadowBlur = 0;
    }

    ctx.beginPath();
    if(ctx.roundRect) ctx.roundRect(x, y, barW, rawH, [3,3,1,1]);
    else ctx.rect(x, y, barW, rawH);
    ctx.fill();
    ctx.shadowBlur = 0;

    // Star marker for best day (ibadah only)
    const maxV = Math.max(...values);
    if(v === maxV && maxV > 0 && !isHaid && currentStat === 'ibadah') {
      ctx.fillStyle = '#FFD700';
      ctx.font = '10px serif';
      ctx.textAlign = 'center';
      ctx.fillText('‚òÖ', x + barW/2, y - 4);
    }

    _statBars.push({ x, y: pad.t, w: barW, h: gH, dayNum, v, isHaid });
  });

  // X axis day labels
  ctx.font = '9px Nunito, sans-serif';
  ctx.textAlign = 'center';
  const _xLabelColor = _isDark ? 'rgba(255,255,255,0.5)' : 'rgba(60,40,10,0.55)';
  [1,5,10,15,20,25,30].forEach(d => {
    const x = pad.l + (gW/30)*(d-1) + barW/2;
    ctx.fillStyle = d === currentDay ? '#C8973A' : _xLabelColor;
    ctx.fillText(d, x, H - 10);
  });

  const totalDone = values.filter(v=>v>0).length;
  const totalSum = values.reduce((a,b)=>a+b,0);
  const maxDay = values.indexOf(Math.max(...values)) + 1;
  const haidCount = days.filter(d=>data[d]?.haid).length;

  const sumEl = document.getElementById('statSummary');
  if(sumEl) {
    const haidHtml = haidCount > 0 ? `<div class="stat-sum-item" style="border:1.5px solid rgba(255,105,180,0.4);background:rgba(255,182,193,0.1)"><div class="stat-sum-num" style="color:#FF69B4">${haidCount}</div><div class="stat-sum-label">Hari Haid üå∏</div></div>` : '';
    if(currentStat === 'ibadah') {
      const perfectCount = days.filter(d=>isStreakDay(data[d]||{})).length;
      sumEl.innerHTML = `
        <div class="stat-sum-item"><div class="stat-sum-num">${totalSum}</div><div class="stat-sum-label">Total Ibadah</div></div>
        <div class="stat-sum-item" style="border:1.5px solid rgba(74,222,128,0.4);background:rgba(74,222,128,0.08)"><div class="stat-sum-num" style="color:#4ADE80">${perfectCount}</div><div class="stat-sum-label">Hari Sempurna üî•</div></div>
        <div class="stat-sum-item"><div class="stat-sum-num">${Math.round(totalSum/Math.max(1,totalDone))}</div><div class="stat-sum-label">Rata-rata/Hari</div></div>
        ${haidHtml}`;
    } else if(currentStat === 'quran') {
      sumEl.innerHTML = `
        <div class="stat-sum-item"><div class="stat-sum-num">${totalSum}</div><div class="stat-sum-label">Total Juz</div></div>
        <div class="stat-sum-item"><div class="stat-sum-num">${totalDone}</div><div class="stat-sum-label">Hari Baca</div></div>
        <div class="stat-sum-item"><div class="stat-sum-num">Hari ${maxDay}</div><div class="stat-sum-label">Terbanyak ‚òÖ</div></div>
        ${haidHtml}`;
    } else {
      const fmt = n => n>=1000000?(n/1000000).toFixed(1)+'jt':n>=1000?(n/1000).toFixed(0)+'rb':n;
      sumEl.innerHTML = `
        <div class="stat-sum-item"><div class="stat-sum-num">${fmt(totalSum)}</div><div class="stat-sum-label">Total Sedekah</div></div>
        <div class="stat-sum-item"><div class="stat-sum-num">${totalDone}</div><div class="stat-sum-label">Hari Bersedekah</div></div>
        <div class="stat-sum-item"><div class="stat-sum-num">${fmt(Math.round(totalSum/Math.max(1,totalDone)))}</div><div class="stat-sum-label">Rata-rata/Hari</div></div>
        ${haidHtml}`;
    }
  }

  const legEl = document.getElementById('statLegend');
  if(legEl) {
    if(currentStat === 'ibadah') {
      legEl.innerHTML = `
        <div class="stat-legend-item"><div class="stat-legend-dot" style="background:#4ADE80"></div>Sempurna üî•</div>
        <div class="stat-legend-item"><div class="stat-legend-dot" style="background:#E8BE6A"></div>Sebagian</div>
        <div class="stat-legend-item"><div class="stat-legend-dot" style="background:rgba(255,255,255,0.2)"></div>Belum</div>
        <div class="stat-legend-item"><div class="stat-legend-dot" style="background:#FFD700"></div>Hari ini</div>
        <div class="stat-legend-item"><div class="stat-legend-dot" style="background:#FF69B4"></div>Haid üå∏</div>`;
    } else {
      const mainColor = currentStat==='quran'?'#C8973A':'#E06090';
      legEl.innerHTML = `
        <div class="stat-legend-item"><div class="stat-legend-dot" style="background:${mainColor}"></div>${label}</div>
        <div class="stat-legend-item"><div class="stat-legend-dot" style="background:#FFD700"></div>Hari ini</div>
        <div class="stat-legend-item"><div class="stat-legend-dot" style="background:#FF69B4"></div>Haid üå∏</div>`;
    }
  }
}

// ‚îÄ‚îÄ Tooltip on tap/hover ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function _statGetTooltipText(bar) {
  const dd = data[bar.dayNum] || {};
  const fmt = n => n>=1000000?(n/1000000).toFixed(1)+'jt':n>=1000?(n/1000).toFixed(0)+'rb':String(n);
  if(bar.isHaid) return `Hari ${bar.dayNum} üå∏ Haid/Uzur`;
  if(currentStat === 'ibadah') {
    const perfect = isStreakDay(dd);
    const status = perfect ? 'üî• Sempurna' : bar.v > 0 ? '‚ú® Sebagian' : '‚Äî';
    return `Hari ${bar.dayNum}: ${bar.v} ibadah ${status}`;
  }
  if(currentStat === 'quran') return `Hari ${bar.dayNum}: ${bar.v} juz`;
  return `Hari ${bar.dayNum}: Rp ${fmt(bar.v)}`;
}

function _statHandlePointer(e) {
  const canvas = document.getElementById('statCanvas');
  const tooltip = document.getElementById('statTooltip');
  if(!canvas || !tooltip || !_statBars.length) return;
  const rect = canvas.getBoundingClientRect();
  const scaleX = canvas.width / rect.width;
  const clientX = e.touches ? e.touches[0].clientX : e.clientX;
  const clientY = e.touches ? e.touches[0].clientY : e.clientY;
  const mx = (clientX - rect.left) * scaleX;
  const my = (clientY - rect.top) * (canvas.height / rect.height);
  const hit = _statBars.find(b => mx >= b.x && mx <= b.x+b.w && my >= b.y && my <= b.y+b.h);
  if(hit) {
    tooltip.style.display = 'block';
    tooltip.style.top = '8px';
    tooltip.textContent = _statGetTooltipText(hit);
    // Hitung posisi supaya tidak terpotong
    const tipW = tooltip.offsetWidth || 160;
    const wrapW = canvas.parentElement.offsetWidth || W;
    const centerX = (hit.x + hit.w/2) / canvas.width * wrapW;
    const clampedX = Math.min(Math.max(centerX, tipW/2 + 4), wrapW - tipW/2 - 4);
    tooltip.style.left = clampedX + 'px';
    tooltip.style.transform = 'translateX(-50%)';
  } else {
    tooltip.style.display = 'none';
  }
}

function _statHideTooltip() {
  const t = document.getElementById('statTooltip');
  if(t) t.style.display = 'none';
}

// Bind events once
(function() {
  let bound = false;
  const orig = renderStat;
  window._bindStatEvents = function() {
    if(bound) return; bound = true;
    const canvas = document.getElementById('statCanvas');
    if(!canvas) return;
    canvas.addEventListener('mousemove', _statHandlePointer);
    canvas.addEventListener('touchstart', _statHandlePointer, {passive:true});
    canvas.addEventListener('mouseleave', _statHideTooltip);
    canvas.addEventListener('touchend', () => setTimeout(_statHideTooltip, 1500));
  };
})();

// ===== NIGHT SKY BG =====
(function(){
  const cv=document.getElementById('bg-canvas'), ctx=cv.getContext('2d');
  let stars=[],shooting=[],W,H;
  const resize=()=>{ W=cv.width=innerWidth; H=cv.height=innerHeight; initStars(); };
  const initStars=()=>{ stars=[]; const n=Math.floor(W*H/4500)+100; for(let i=0;i<n;i++) stars.push({x:Math.random()*W,y:Math.random()*H*.78,r:Math.random()*1.7+.2,a:Math.random()*.7+.3,d:Math.random()>.5?1:-1,ts:Math.random()*.02+.005,c:Math.random()>.85?'#E8D8A0':Math.random()>.7?'#B0D8FF':'#FFF'}); };
  const bg=()=>{
    const g=ctx.createLinearGradient(0,0,0,H); g.addColorStop(0,'#020A14'); g.addColorStop(.4,'#061525'); g.addColorStop(.7,'#0B1F30'); g.addColorStop(1,'#0E2838'); ctx.fillStyle=g; ctx.fillRect(0,0,W,H);
    const mw=ctx.createRadialGradient(W*.5,H*.25,0,W*.5,H*.25,W*.5); mw.addColorStop(0,'rgba(100,160,200,.05)'); mw.addColorStop(1,'transparent'); ctx.fillStyle=mw; ctx.fillRect(0,0,W,H);
    const mn=ctx.createRadialGradient(W*.83,H*.12,0,W*.83,H*.12,130); mn.addColorStop(0,'rgba(255,240,180,.2)'); mn.addColorStop(.5,'rgba(255,230,150,.06)'); mn.addColorStop(1,'transparent'); ctx.fillStyle=mn; ctx.fillRect(0,0,W,H);
    const hr=ctx.createLinearGradient(0,H*.65,0,H); hr.addColorStop(0,'transparent'); hr.addColorStop(.5,'rgba(200,100,30,.06)'); hr.addColorStop(1,'rgba(180,70,15,.12)'); ctx.fillStyle=hr; ctx.fillRect(0,0,W,H);
  };
  const animate=()=>{
    ctx.clearRect(0,0,W,H); bg();
    stars.forEach(s=>{ s.a+=s.ts*s.d; if(s.a>1||s.a<.1) s.d*=-1; ctx.save(); ctx.globalAlpha=s.a; ctx.beginPath(); ctx.arc(s.x,s.y,s.r,0,Math.PI*2); ctx.fillStyle=s.c; ctx.shadowBlur=s.r*4; ctx.shadowColor=s.c; ctx.fill(); ctx.restore(); });
    if(Math.random()<.003) shooting.push({x:Math.random()*W,y:Math.random()*H*.4,vx:4+Math.random()*5,vy:2+Math.random()*3,l:0,ml:60+Math.random()*40});
    shooting=shooting.filter(s=>s.l<s.ml);
    shooting.forEach(s=>{ s.l++; const p=s.l/s.ml,a=p<.3?p/.3:1-(p-.3)/.7; const x2=s.x+s.vx*s.l,y2=s.y+s.vy*s.l,x1=x2-s.vx*Math.min(s.l,20),y1=y2-s.vy*Math.min(s.l,20); const gr=ctx.createLinearGradient(x1,y1,x2,y2); gr.addColorStop(0,'rgba(255,255,255,0)'); gr.addColorStop(1,`rgba(255,240,180,${a})`); ctx.save(); ctx.beginPath(); ctx.moveTo(x1,y1); ctx.lineTo(x2,y2); ctx.strokeStyle=gr; ctx.lineWidth=1.5; ctx.stroke(); ctx.beginPath(); ctx.arc(x2,y2,2,0,Math.PI*2); ctx.fillStyle=`rgba(255,240,180,${a})`; ctx.shadowBlur=8; ctx.shadowColor='rgba(255,240,180,.8)'; ctx.fill(); ctx.restore(); });
    requestAnimationFrame(animate);
  };
  window.addEventListener('resize',resize); resize(); animate();

  // Lanterns ‚Äî responsive count
  const isMobile = innerWidth < 600;
  const lanternData = isMobile
    ? [{body:'#C8973A',glow:'#FFD080'},{body:'#1A6B6B',glow:'#4ECDC4'},{body:'#C0392B',glow:'#FF6B55'}]
    : [{body:'#C0392B',glow:'#FF6B55'},{body:'#C8973A',glow:'#FFD080'},{body:'#1A6B6B',glow:'#4ECDC4'},{body:'#8E44AD',glow:'#D498F5'},{body:'#C05C00',glow:'#FFB347'}];
  const positions = isMobile ? ['12%','50%','86%'] : ['8%','22%','40%','60%','78%'];
  lanternData.forEach((lc,i)=>{
    const pos=positions[i];
    const div=document.createElement('div'); div.className='lantern'; div.style.left=pos;
    div.innerHTML=`<div class="lantern-string"></div><div class="lantern-body" style="background:${lc.body};color:${lc.glow}"><div class="lantern-glow" style="background:radial-gradient(circle,${lc.glow}80,transparent)"></div><span class="lantern-inner">\uD83C\uDFEE</span></div><div class="lantern-bottom" style="background:${lc.body}"></div><div class="lantern-tassel"></div>`;
    document.getElementById('lanternsContainer').appendChild(div);
  });

  // Particles
  for(let i=0;i<22;i++){
    const p=document.createElement('div'); p.className='particle';
    const sz=Math.random()*5+2,isG=Math.random()>.5;
    p.style.cssText=`width:${sz}px;height:${sz}px;left:${Math.random()*100}%;background:${isG?'rgba(200,151,58,.7)':'rgba(255,255,255,.4)'};animation-duration:${9+Math.random()*14}s;animation-delay:${Math.random()*12}s;box-shadow:0 0 ${sz*2}px ${isG?'rgba(200,151,58,.8)':'rgba(255,255,255,.5)'}`;
    document.getElementById('particlesContainer').appendChild(p);
  }
})();

// ===== TOMBOL HARI INI =====
function goToToday() {
  const start = new Date(2026,1,19);
  const today = Math.min(30, Math.max(1, Math.floor((new Date() - start) / 864e5) + 1));
  switchDay(today);
}

function updateTodayLabel() {
  const start = new Date(2026,1,19);
  const today = Math.min(30, Math.max(1, Math.floor((new Date() - start) / 864e5) + 1));
  const el = document.getElementById('todayLabel');
  if (el) el.textContent = 'Hari ke-' + today + ' dari 30';
}

// ===== KALKULATOR ZAKAT FITRAH =====
let jiwaCount = 1;
let caraBayar = 'beras';

function changeJiwa(delta) {
  jiwaCount = Math.max(1, jiwaCount + delta);
  document.getElementById('jiwaCount').textContent = jiwaCount;
  hitungZakat();
}

function setCaraBayar(cara) {
  caraBayar = cara;
  const uangWrap = document.getElementById('zakatUangWrap');
  const btnBeras = document.getElementById('btnCaraBeras');
  const btnUang  = document.getElementById('btnCaraUang');
  const activeStyle = 'padding:12px 8px;border-radius:12px;border:2px solid var(--teal);background:linear-gradient(135deg,rgba(26,107,107,.12),rgba(26,107,107,.04));font-family:\'Nunito\',sans-serif;font-size:12px;font-weight:800;color:var(--teal);cursor:pointer;transition:all .2s;text-align:center;line-height:1.5';
  const inactiveStyle = 'padding:12px 8px;border-radius:12px;border:2px solid var(--cream-dark);background:white;font-family:\'Nunito\',sans-serif;font-size:12px;font-weight:800;color:var(--text-muted);cursor:pointer;transition:all .2s;text-align:center;line-height:1.5';
  if (cara === 'beras') {
    btnBeras.style.cssText = activeStyle;
    btnUang.style.cssText  = inactiveStyle;
    uangWrap.style.display = 'none';
  } else {
    btnUang.style.cssText  = activeStyle;
    btnBeras.style.cssText = inactiveStyle;
    uangWrap.style.display = 'block';
  }
  hitungZakat();
}

function setPricePreset(harga) {
  document.getElementById('hargaBeras').value = harga;
  ['preset1','preset2','preset3'].forEach(id => {
    const el = document.getElementById(id);
    if (!el) return;
    el.style.border = '1.5px solid var(--cream-dark)';
    el.style.background = 'white';
    el.style.color = 'var(--text-muted)';
  });
  const map = {12000:'preset1', 15000:'preset2', 20000:'preset3'};
  const active = document.getElementById(map[harga]);
  if (active) {
    active.style.border = '2px solid var(--teal)';
    active.style.background = 'linear-gradient(135deg,rgba(26,107,107,.1),rgba(26,107,107,.03))';
    active.style.color = 'var(--teal)';
  }
  hitungZakat();
}

function hitungZakat() {
  const harga = parseFloat(document.getElementById('hargaBeras').value) || 15000;
  const berasPerJiwa = 2.5;
  const totalBeras = jiwaCount * berasPerJiwa;
  const totalUang = totalBeras * harga;

  document.getElementById('zakatHasilBeras').textContent = totalBeras.toLocaleString('id-ID') + ' kg beras';
  document.getElementById('zakatHasilUang').textContent = '‚âà Rp ' + totalUang.toLocaleString('id-ID');

  let contoh = jiwaCount + ' orang √ó 2,5 kg = <strong>' + totalBeras + ' kg beras</strong>';
  if (caraBayar === 'uang') {
    contoh += '<br>' + totalBeras + ' kg √ó Rp ' + harga.toLocaleString('id-ID') + '/kg = <strong>Rp ' + totalUang.toLocaleString('id-ID') + '</strong>';
  }
  document.getElementById('zakatContoh').innerHTML = contoh;
}

// ===== ONBOARDING =====
let obCurrentStep = 0;
const OB_STEPS = 4;

function showOnboarding() {
  if (localStorage.getItem('onboardingDone')) return;
  document.getElementById('onboardingModal').style.display = 'flex';
}

function closeOnboarding() {
  document.getElementById('onboardingModal').style.display = 'none';
  localStorage.setItem('onboardingDone', '1');
}

function obNav(dir) {
  obCurrentStep = Math.max(0, Math.min(OB_STEPS - 1, obCurrentStep + dir));
  for (let i = 1; i <= OB_STEPS; i++) {
    const el = document.getElementById('obStep' + i);
    if (el) el.classList.toggle('active', i - 1 === obCurrentStep);
    const dot = document.getElementById('obDot' + (i-1));
    if (dot) dot.classList.toggle('active', i - 1 === obCurrentStep);
  }
  const prev = document.getElementById('obPrevBtn');
  const next = document.getElementById('obNextBtn');
  if (prev) prev.style.display = obCurrentStep > 0 ? 'block' : 'none';
  if (next) {
    if (obCurrentStep === OB_STEPS - 1) {
      next.textContent = '‚úÖ Mulai Sekarang!';
      next.onclick = closeOnboarding;
    } else {
      next.textContent = 'Selanjutnya ‚Üí';
      next.onclick = () => obNav(1);
    }
  }
}

// ===== TARGET KHATAM =====
function updateQuranTarget() {
  const target = parseInt(document.getElementById('quranTargetSelect').value) || 30;
  const totalJuz = Array.from({length:30},(_,i)=>i+1).reduce((s,d)=>s+(data[d]?.quranJuz||0),0);
  const idealPerDay = target / 30;
  const idealByNow = Math.round(idealPerDay * currentDay);
  const diff = totalJuz - idealByNow;
  const statusEl = document.getElementById('quranTargetStatus');
  const labelEl = document.getElementById('quranTargetLabel');
  const detailEl = document.getElementById('quranTargetDetail');
  if (!statusEl) return;

  if (totalJuz === 0) {
    statusEl.style.background = 'rgba(255,255,255,.05)';
    statusEl.style.border = '1px solid rgba(255,255,255,.1)';
    labelEl.style.color = 'rgba(255,255,255,.5)';
    labelEl.textContent = 'üìñ Belum ada bacaan tercatat';
    detailEl.textContent = 'Seharusnya sudah ' + idealByNow + ' juz di hari ke-' + currentDay;
  } else if (diff >= 0) {
    statusEl.style.background = 'rgba(74,222,128,.1)';
    statusEl.style.border = '1px solid rgba(74,222,128,.3)';
    labelEl.style.color = '#4ADE80';
    labelEl.textContent = 'üü¢ On Track! ' + (diff > 0 ? 'Unggul ' + diff + ' juz dari target' : 'Tepat sesuai target');
    detailEl.textContent = totalJuz + ' juz tercatat ¬∑ target hari ini: ' + idealByNow + ' juz';
  } else {
    statusEl.style.background = 'rgba(255,160,50,.1)';
    statusEl.style.border = '1px solid rgba(255,160,50,.3)';
    labelEl.style.color = '#FFA032';
    labelEl.textContent = 'üü° Perlu Kejar! Kurang ' + Math.abs(diff) + ' juz dari target';
    detailEl.textContent = 'Perlu baca ¬±' + Math.ceil(Math.abs(diff) / Math.max(1, 30 - currentDay)) + ' juz/hari sampai hari ke-30';
  }
  localStorage.setItem('quranTarget', target);
}

// ===== IBADAH TIME INDICATOR =====
function getIbadahTimeStatus(id) {
  const t = getTodaySchedule();
  if (!t) return null;
  const now = new Date();
  const h = now.getHours(), m = now.getMinutes();
  const [ih, im] = t.imsak.split(':').map(Number);
  const [bh, bm] = t.maghrib.split(':').map(Number);
  const nowMin = h * 60 + m;
  const imsakMin = ih * 60 + im;
  const maghribMin = bh * 60 + bm;
  const ibadah = data[currentDay]?.ibadah || {};

  // Jika sudah dicentang = tidak perlu indikator
  if (ibadah[id]) return null;

  // Waktu sudah lewat tapi belum dicentang
  const timeMap = {
    subuh: imsakMin + 2,        // setelah imsak
    dzuhur: 12 * 60,
    ashar: 15 * 60,
    maghrib: maghribMin,
    isya: maghribMin + 90,
    tarawih: maghribMin + 120,
  };
  const deadline = timeMap[id];
  if (!deadline) return null;
  if (nowMin > deadline + 60) return 'merah';   // lewat >1 jam
  if (nowMin > deadline - 15) return 'kuning';  // mepet/hampir
  return null;
}

function renderIbadahIndicators() {
  IBADAH_LIST.forEach(item => {
    const btn = document.querySelector(`[data-ibadah-id="${item.id}"]`);
    if (!btn) return;
    const old = btn.querySelector('.ibadah-time-dot');
    if (old) old.remove();
    const status = getIbadahTimeStatus(item.id);
    if (status) {
      const dot = document.createElement('span');
      dot.className = 'ibadah-time-dot';
      dot.style.background = status === 'merah' ? '#FF6060' : '#FFB830';
      dot.title = status === 'merah' ? 'Waktu sudah lewat' : 'Waktu hampir habis';
      btn.appendChild(dot);
    }
  });
}

// ===== PRINT =====
function printRekap() {
  showToast('üñ®Ô∏è Membuka dialog cetak...', 'success');
  setTimeout(() => window.print(), 400);
}

// ===== INIT =====
// Register Service Worker untuk PWA offline support
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    // Inline service worker sebagai blob URL
    const swCode = `
const CACHE = 'ramadan-planner-v1';
const ASSETS = ['/'];
self.addEventListener('install', e => {
  e.waitUntil(caches.open(CACHE).then(c => c.addAll(ASSETS)).catch(()=>{}));
  self.skipWaiting();
});
self.addEventListener('activate', e => {
  e.waitUntil(caches.keys().then(keys => Promise.all(
    keys.filter(k=>k!==CACHE).map(k=>caches.delete(k))
  )));
  self.clients.claim();
});
self.addEventListener('fetch', e => {
  e.respondWith(
    fetch(e.request).catch(() => caches.match(e.request))
  );
});
    `;
    const swBlob = new Blob([swCode], {type:'application/javascript'});
    const swUrl = URL.createObjectURL(swBlob);
    navigator.serviceWorker.register(swUrl).catch(()=>{});
  });
}

loadData();
const _start=new Date(2026,1,19);
currentDay=Math.min(30,Math.max(1,Math.floor((new Date()-_start)/(864e5))+1));
ensureDay(data[currentDay]);
buildDaySelector();
applyDarkMode();
renderAll();
// Inisialisasi jadwal sekali saja ‚Äî tidak diulang saat ganti hari
initScheduleOnce();
updateTodayLabel();
hitungZakat();
updateHeaderProgress();

// Restore quran target if saved
const _savedTarget = localStorage.getItem('quranTarget');
if (_savedTarget) {
  const sel = document.getElementById('quranTargetSelect');
  if (sel) sel.value = _savedTarget;
}
updateQuranTarget();

// Onboarding ‚Äî tampil hanya pertama kali
setTimeout(() => showOnboarding(), 1200);

// Init notifikasi ‚Äî schedule ulang setiap jam
rescheduleNotifications();
setInterval(rescheduleNotifications, 3600000);
updateDailyWidget();

// Indikator waktu ibadah ‚Äî update tiap menit
setInterval(renderIbadahIndicators, 60000);

const _initDay = currentDay;
setTimeout(()=>showToast(L('toastDay',_initDay),'success'),900);

// Auto dark mode dinonaktifkan ‚Äî user mengatur manual via tombol üåô/‚òÄÔ∏è
// setInterval(()=>autoCheckDarkMode(), 60000);

// ‚îÄ‚îÄ Scroll to Top ‚îÄ‚îÄ
function scrollToTop() {
  window.scrollTo({top: 0, behavior: 'smooth'});
}
(function() {
  var btn = document.getElementById('scrollTopBtn');
  if (!btn) return;
  var ticking = false;
  window.addEventListener('scroll', function() {
    if (!ticking) {
      requestAnimationFrame(function() {
        if (window.scrollY > 300) {
          btn.classList.add('visible');
        } else {
          btn.classList.remove('visible');
        }
        ticking = false;
      });
      ticking = true;
    }
  }, {passive: true});
})();



// ‚îÄ‚îÄ Tab switcher Statistik / Rekap Akhir ‚îÄ‚îÄ
function switchMainTab(tab) {
  const panelStat  = document.getElementById('mainPanelStat');
  const panelRekap = document.getElementById('mainPanelRekap');
  const btnStat    = document.getElementById('mainTabStat');
  const btnRekap   = document.getElementById('mainTabRekap');
  if (!panelStat) return;
  const isStat = tab === 'stat';
  panelStat.style.display  = isStat ? '' : 'none';
  panelRekap.style.display = isStat ? 'none' : '';
  const on  = "flex:1;padding:9px;border-radius:10px;border:none;font-family:'Nunito',sans-serif;font-size:13px;font-weight:800;cursor:pointer;transition:all .25s;background:rgba(26,107,107,.8);color:white";
  const off = "flex:1;padding:9px;border-radius:10px;border:none;font-family:'Nunito',sans-serif;font-size:13px;font-weight:800;cursor:pointer;transition:all .25s;background:transparent;color:rgba(255,255,255,.5)";
  if(btnStat)  btnStat.style.cssText  = isStat ? on : off;
  if(btnRekap) btnRekap.style.cssText = isStat ? off : on;
  if(!isStat) renderRekapAkhir(); else renderStat();
}

// ‚îÄ‚îÄ Toggle collapsible Menu Makanan ‚îÄ‚îÄ
function toggleMenuCollapse() {
  const body  = document.getElementById('menuBody');
  const arrow = document.getElementById('menuCollapseArrow');
  if (!body) return;
  const isHidden = body.style.display === 'none' || body.style.display === '';
  body.style.display  = isHidden ? 'block' : 'none';
  if(arrow) arrow.style.transform = isHidden ? 'rotate(180deg)' : 'rotate(0deg)';
}


// ‚îÄ‚îÄ showTooltip ‚Äî wrapper untuk tombol export/import ‚îÄ‚îÄ
function showTooltip(type) {
  const msgs = {
    export: 'üíæ Data berhasil di-backup!',
    import: 'üì• Pilih file backup (.json) untuk import',
  };
  if(msgs[type]) showToast(msgs[type], type==='export' ? 'success' : 'info');
}

</script>

<!-- ‚ïê‚ïê‚ïê NOTIF MODAL ‚ïê‚ïê‚ïê -->
<div id="notifModal" onclick="if(event.target===this)closeNotifModal()">
  <div class="notif-box">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px">
      <div>
        <div style="font-size:18px;font-weight:900;color:white">üîî Pengingat Ibadah</div>
        <div style="font-size:11px;color:rgba(255,255,255,.4);margin-top:3px">Notifikasi otomatis imsak & buka puasa</div>
      </div>
      <button onclick="closeNotifModal()" style="background:rgba(255,255,255,.08);border:none;border-radius:50%;width:32px;height:32px;color:white;font-size:16px;cursor:pointer;display:flex;align-items:center;justify-content:center">‚úï</button>
    </div>

    <div id="notifPermStatus" style="background:rgba(200,151,58,.12);border:1px solid rgba(200,151,58,.3);border-radius:12px;padding:12px;margin-bottom:14px;font-size:12px;color:rgba(255,255,255,.7);display:none"></div>

    <div class="notif-toggle-row">
      <div>
        <div class="notif-toggle-label">üåô Pengingat Imsak</div>
        <div class="notif-toggle-sub">Notif beberapa menit sebelum imsak</div>
      </div>
      <label class="notif-switch"><input type="checkbox" id="notifImsak" onchange="saveNotifSettings()"><span class="notif-slider"></span></label>
    </div>
    <div class="notif-time-row" style="margin-top:8px;margin-bottom:4px">
      <div class="notif-time-label">‚è∞ Berapa menit sebelum imsak?</div>
      <input type="number" class="notif-time-input" id="notifImsakMenit" value="15" min="1" max="60" onchange="saveNotifSettings()">
    </div>

    <div class="notif-toggle-row" style="margin-top:4px">
      <div>
        <div class="notif-toggle-label">üåÖ Pengingat Buka Puasa</div>
        <div class="notif-toggle-sub">Notif saat waktu maghrib tiba</div>
      </div>
      <label class="notif-switch"><input type="checkbox" id="notifBuka" onchange="saveNotifSettings()"><span class="notif-slider"></span></label>
    </div>

    <div class="notif-toggle-row">
      <div>
        <div class="notif-toggle-label">üïå Pengingat Ibadah Malam</div>
        <div class="notif-toggle-sub">Reminder shalat tarawih & witir</div>
      </div>
      <label class="notif-switch"><input type="checkbox" id="notifTarawih" onchange="saveNotifSettings()"><span class="notif-slider"></span></label>
    </div>
    <div class="notif-time-row">
      <div class="notif-time-label">‚è∞ Jam pengingat tarawih</div>
      <input type="time" class="notif-time-input" id="notifTarawihJam" value="19:45" onchange="saveNotifSettings()">
    </div>

    <div class="notif-toggle-row">
      <div>
        <div class="notif-toggle-label">üìø Pengingat Dzikir Pagi</div>
        <div class="notif-toggle-sub">Reminder dzikir setelah subuh</div>
      </div>
      <label class="notif-switch"><input type="checkbox" id="notifDzikir" onchange="saveNotifSettings()"><span class="notif-slider"></span></label>
    </div>

    <button onclick="requestNotifPermAndSave()" style="width:100%;margin-top:18px;padding:13px;background:linear-gradient(135deg,var(--gold),var(--gold-light));border:none;border-radius:14px;font-family:Nunito,sans-serif;font-size:14px;font-weight:900;color:#020A14;cursor:pointer;transition:all .2s">
      ‚úÖ Aktifkan Notifikasi
    </button>
    <div style="font-size:10px;color:rgba(255,255,255,.3);text-align:center;margin-top:10px">Notifikasi hanya berjalan saat browser/tab ini terbuka</div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê PDF EXPORT MODAL ‚ïê‚ïê‚ïê -->
<div id="pdfModal" onclick="if(event.target===this)closePdfModal()">
  <div class="pdf-box">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:20px">
      <div>
        <div style="font-size:18px;font-weight:900;color:white">üìÑ Export Rekap PDF</div>
        <div style="font-size:11px;color:rgba(255,255,255,.4);margin-top:3px">Pilih data yang ingin disertakan</div>
      </div>
      <button onclick="closePdfModal()" style="background:rgba(255,255,255,.08);border:none;border-radius:50%;width:32px;height:32px;color:white;font-size:16px;cursor:pointer;display:flex;align-items:center;justify-content:center">‚úï</button>
    </div>

    <label class="pdf-section-check"><input type="checkbox" id="pdfChkRekap" checked><div><div class="pdf-check-label">üìä Rekap Keseluruhan</div><div class="pdf-check-sub">Total ibadah, juz, sedekah, streak terbaik</div></div></label>
    <label class="pdf-section-check"><input type="checkbox" id="pdfChkHarian" checked><div><div class="pdf-check-label">üìÖ Detail Harian (30 hari)</div><div class="pdf-check-sub">Checklist ibadah, niat, juz per hari</div></div></label>
    <label class="pdf-section-check"><input type="checkbox" id="pdfChkSedekah" checked><div><div class="pdf-check-label">üíù Catatan Sedekah</div><div class="pdf-check-sub">Semua catatan sedekah beserta nominal</div></div></label>
    <label class="pdf-section-check"><input type="checkbox" id="pdfChkSyukur"><div><div class="pdf-check-label">‚ú® Catatan Syukur</div><div class="pdf-check-sub">3 hal syukur yang kamu catat setiap hari</div></div></label>
    <label class="pdf-section-check"><input type="checkbox" id="pdfChkTarget"><div><div class="pdf-check-label">üéØ Target Harian</div><div class="pdf-check-sub">Target yang sudah dan belum tercapai</div></div></label>
    <label class="pdf-section-check"><input type="checkbox" id="pdfChkBadge"><div><div class="pdf-check-label">üèÜ Pencapaian & Badge</div><div class="pdf-check-sub">Badge yang berhasil diraih</div></div></label>

    <button class="pdf-export-btn" onclick="generatePDF()">üìÑ Buat & Unduh PDF Rekap</button>
  </div>
</div>

</body>
</html>
